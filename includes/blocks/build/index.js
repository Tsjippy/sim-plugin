(()=>{"use strict";const e=window.wp.element,t=window.wp.components,n=window.wp.data,l=window.wp.coreData,o=window.wp.htmlEntities,{__}=wp.i18n,{createHigherOrderComponent:s}=wp.compose,{Fragment:r}=wp.element,{InspectorControls:a}=wp.blockEditor,{PanelBody:i,SelectControl:c,ToggleControl:d,CheckboxControl:g}=wp.components;wp.hooks.addFilter("blocks.registerBlockType","sim/block-filter-attribute",(function(e,t){return void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{hideOnMobile:{type:"boolean"},onlyOnHomePage:{type:"boolean"},onlyLoggedIn:{type:"boolean"},onlyOn:{type:"object"}})),e}));const p=s((s=>c=>{const{attributes:p,setAttributes:m}=c,[u,b]=(0,e.useState)("");let h=[];null!=p.onlyOn&&(h=Object.keys(p.onlyOn));let y={};for(const e in p.onlyOn)y[e]=!0;const[w,E]=(0,e.useState)(y),O=function(n){let{hasResolved:l,pages:s,showLoader:a=!0}=n;if(!l)return(0,e.createElement)(r,null,(0,e.createElement)(t.Spinner,null),(0,e.createElement)("br",null));if(null==p.onlyOn&&(p.onlyOn={}),null==s||!s.length)return a?(0,e.createElement)("div",null,"No search results"):"";const i=function(e){let t=Object.assign({},w);t[this]=e,m({onlyOn:t}),E(t)};return null==s?void 0:s.map((t=>(0,e.createElement)(g,{label:(0,o.decodeEntities)(t.title.rendered),onChange:i.bind(t.id),checked:w[t.id]})))},{pages:k,selectedPages:C,pagesResolved:v,selectedPagesResolved:f}=(0,n.useSelect)((e=>{const t={exclude:h};u&&(t.search=u);const n=["postType","page",t],o=["postType","page",{include:h}];return{pages:e(l.store).getEntityRecords(...n),selectedPages:e(l.store).getEntityRecords(...o),pagesResolved:e(l.store).hasFinishedResolution("getEntityRecords",n),selectedPagesResolved:e(l.store).hasFinishedResolution("getEntityRecords",o)}}),[u,w]);let R="";return h.length>0&&(R=(0,e.createElement)(r,null,(0,e.createElement)("i",null,"Currently selected pages:"),(0,e.createElement)("br",null),(0,e.createElement)(O,{hasResolved:f,pages:C,props:c,showLoader:!1}))),(0,e.createElement)(r,null,(0,e.createElement)(s,c),(0,e.createElement)(a,null,(0,e.createElement)(i,{title:__("Block Visibility")},(0,e.createElement)(d,{label:wp.i18n.__("Hide on mobile","sim"),checked:!!p.hideOnMobile,onChange:e=>m({hideOnMobile:!p.hideOnMobile})}),(0,e.createElement)(d,{label:wp.i18n.__("Only on home page","sim"),checked:!!p.onlyOnHomePage,onChange:e=>m({onlyOnHomePage:!p.onlyOnHomePage})}),(0,e.createElement)(d,{label:wp.i18n.__("Hide if not logged in","sim"),checked:!!p.onlyLoggedIn,onChange:e=>m({onlyLoggedIn:!p.onlyLoggedIn})}),(0,e.createElement)("strong",null,"Select pages"),(0,e.createElement)("br",null),"Select pages you want this widget to show on.",(0,e.createElement)("br",null),"Leave empty for all pages",(0,e.createElement)("br",null),(0,e.createElement)("br",null),R,(0,e.createElement)("i",null,"Use searchbox below to search for more pages to include"),(0,e.createElement)(t.SearchControl,{onChange:b,value:u}),(0,e.createElement)(O,{hasResolved:v,pages:k,props:c}))))}),"blockFilterControls");wp.hooks.addFilter("editor.BlockEdit","sim/block-filter-controls",p),wp.hooks.addFilter("blocks.getSaveContent.extraProps","sim/block-filter-resultx",(function(e,t,n){const{hideOnMobile:l}=n;return void 0!==l&&l&&(e.className=e.className+" hide-on-mobile"),e}))})();