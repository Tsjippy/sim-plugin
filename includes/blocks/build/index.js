(()=>{"use strict";const e=window.wp.element,t=window.wp.components,l=window.wp.data,n=window.wp.coreData,o=window.wp.htmlEntities,{__}=wp.i18n,{createHigherOrderComponent:s}=wp.compose,{Fragment:i}=wp.element,{InspectorControls:r}=wp.blockEditor,{PanelBody:a,ToggleControl:c,CheckboxControl:p}=wp.components;wp.hooks.addFilter("blocks.registerBlockType","sim/block-filter-attribute",(function(e){return void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{hideOnMobile:{type:"boolean"},onlyOnHomePage:{type:"boolean"},onlyLoggedIn:{type:"boolean"},onlyOn:{type:"array"},phpFilters:{type:"array"}})),e}));const d=s((s=>d=>{const{attributes:u,setAttributes:h,isSelected:m}=d;if(!m)return(0,e.createElement)(i,null,(0,e.createElement)(s,d));null==u.onlyOn&&(u.onlyOn=[]);const[g,E]=(0,e.useState)(""),{initialSelectedPages:y,selectedPagesResolved:b}=(0,l.useSelect)((e=>{const t=["postType","page",{include:u.onlyOn}];return{initialSelectedPages:e(n.store).getEntityRecords(...t),selectedPagesResolved:e(n.store).hasFinishedResolution("getEntityRecords",t)}}),[]),{pages:w,pagesResolved:f}=(0,l.useSelect)((e=>{if(!g)return{pages:!0,pagesResolved:[]};const t=["postType","page",{exclude:u.onlyOn,search:g}];return{pages:e(n.store).getEntityRecords(...t),pagesResolved:e(n.store).hasFinishedResolution("getEntityRecords",t)}}),[g]),O=function(e){let t=[...u.onlyOn];if(e){t.push(this);let e=[...v];e.push(w.find((e=>e.id==this))),S(e)}else t=t.filter((e=>e!=this));h({onlyOn:t})},C=function(l){let{hasResolved:n,items:s,showNoResults:r=!0}=l;return n?null!=s&&s.length?null==s?void 0:s.map((t=>(0,e.createElement)(p,{label:(0,o.decodeEntities)(t.title.rendered),onChange:O.bind(t.id),checked:u.onlyOn.includes(t.id)}))):r&&g?(0,e.createElement)("div",null," ",__("No search results","sim")):"":(0,e.createElement)(i,null,(0,e.createElement)(t.Spinner,null),(0,e.createElement)("br",null))},F=function(e){let t=this;if(""!=t||u.phpFilters.includes(e))if(""==e){let e=u.phpFilters.findIndex((e=>e==t));u.phpFilters.splice(e,1)}else{let l=u.phpFilters.findIndex((e=>e==t));u.phpFilters[l]=e}else u.phpFilters.push(e);h({phpFilters:u.phpFilters}),H(R(u.phpFilters))},R=function(l){return l.map((l=>(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,value:l,onChange:F.bind(l)})))};let k="";null!=u.phpFilters?k=R(u.phpFilters):u.phpFilters=[];const[v,S]=(0,e.useState)([]),[P,I]=(0,e.useState)(u.onlyOn.length>0?(0,e.createElement)(i,null,(0,e.createElement)("i",null," ",__("Currently selected pages","sim"),":"),(0,e.createElement)("br",null),(0,e.createElement)(C,{hasResolved:b,items:y,showNoResults:!1})):""),[x,H]=(0,e.useState)(k);return(0,e.useEffect)((()=>{S(y)}),[b]),(0,e.useEffect)((()=>{S(v.filter((e=>u.onlyOn.includes(e.id))))}),[u.onlyOn]),(0,e.useEffect)((()=>{I(C({hasResolved:b,items:v,showNoResults:!1}))}),[v]),(0,e.createElement)(i,null,(0,e.createElement)(s,d),(0,e.createElement)(r,null,(0,e.createElement)(a,{title:__("Block Visibility")},(0,e.createElement)(c,{label:__("Hide on mobile","sim"),checked:!!u.hideOnMobile,onChange:()=>h({hideOnMobile:!u.hideOnMobile})}),(0,e.createElement)(c,{label:__("Only on home page","sim"),checked:!!u.onlyOnHomePage,onChange:()=>h({onlyOnHomePage:!u.onlyOnHomePage})}),(0,e.createElement)(c,{label:__("Hide if not logged in","sim"),checked:!!u.onlyLoggedIn,onChange:()=>h({onlyLoggedIn:!u.onlyLoggedIn})}),(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,label:"Add php filters like 'isPage(12)'",value:"",onChange:F.bind("")}),x,(0,e.createElement)("strong",null,__("Select pages","sim")),(0,e.createElement)("br",null),__("Select pages you want this widget to show on","sim"),".",(0,e.createElement)("br",null),__("Leave empty for all pages","sim"),(0,e.createElement)("br",null),(0,e.createElement)("br",null),P,(0,e.createElement)("i",null,__("Use searchbox below to search for more pages to include","sim")),(0,e.createElement)(t.SearchControl,{onChange:E,value:g}),(0,e.createElement)(C,{hasResolved:f,items:w}))))}),"blockFilterControls");wp.hooks.addFilter("editor.BlockEdit","sim/block-filter-controls",d)})();