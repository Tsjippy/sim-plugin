(()=>{"use strict";const e=window.React,t=window.wp.components,n=window.wp.element,l=window.wp.data,o=window.wp.coreData,s=window.wp.htmlEntities,{__}=wp.i18n,{createHigherOrderComponent:i}=wp.compose,{Fragment:r}=wp.element,{InspectorControls:a}=wp.blockEditor,{PanelBody:c,ToggleControl:d,CheckboxControl:p}=wp.components;wp.hooks.addFilter("blocks.registerBlockType","sim/block-filter-attribute",(function(e){return void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{hideOnMobile:{type:"boolean"},onlyLoggedIn:{type:"boolean"},onlyNotLoggedIn:{type:"boolean"},onlyOn:{type:"array"},phpFilters:{type:"array"}})),e}));const u=i((i=>u=>{const{attributes:g,setAttributes:m,isSelected:h}=u;if(!h)return(0,e.createElement)(r,null,(0,e.createElement)(i,{...u}));null==g.onlyOn&&(g.onlyOn=[]);const[y,E]=(0,n.useState)(""),{initialSelectedPages:b,selectedPagesResolved:w}=(0,l.useSelect)((e=>{const t=["postType","page",{include:g.onlyOn}];return{initialSelectedPages:e(o.store).getEntityRecords(...t),selectedPagesResolved:e(o.store).hasFinishedResolution("getEntityRecords",t)}}),[]),{pages:f,pagesResolved:O}=(0,l.useSelect)((e=>{if(!y)return{pages:[],pagesResolved:!0};const t=["postType","page",{exclude:g.onlyOn,search:y,per_page:100,orderby:"relevance"}];return{pages:e(o.store).getEntityRecords(...t),pagesResolved:e(o.store).hasFinishedResolution("getEntityRecords",t)}}),[y]),C=function(e){e?(m({onlyOn:[...g.onlyOn,this]}),I([...S,f.find((e=>e.id==this))])):m({onlyOn:g.onlyOn.filter((e=>e!=this))})},R=function({hasResolved:n,items:l,showNoResults:o=!0}){return n?l?.length?l?.map((t=>(0,e.createElement)(p,{label:(0,s.decodeEntities)(t.title.rendered),onChange:C.bind(t.id),checked:g.onlyOn.includes(t.id)}))):o&&y?(0,e.createElement)("div",null," ",__("No search results","sim")):"":(0,e.createElement)(r,null,(0,e.createElement)(t.Spinner,null),(0,e.createElement)("br",null))},v=function(e){let t=this,n=[...g.phpFilters];""!=t||g.phpFilters.includes(e)?""==e?n=g.phpFilters.filter((e=>e!=t)):n[g.phpFilters.findIndex((e=>e==t))]=e:n.push(e),m({phpFilters:n}),T(""),x(k(n))},k=function(n){return n.map((n=>(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,value:n,onChange:v.bind(n)})))};let F="";null!=g.phpFilters?F=k(g.phpFilters):g.phpFilters=[];const[S,I]=(0,n.useState)([]),[L,N]=(0,n.useState)(g.onlyOn.length>0?(0,e.createElement)(r,null,(0,e.createElement)("i",null," ",__("Currently selected pages","sim"),":"),(0,e.createElement)("br",null),(0,e.createElement)(R,{hasResolved:w,items:b,showNoResults:!1})):""),[_,x]=(0,n.useState)(F),[P,T]=(0,n.useState)("");return(0,n.useEffect)((()=>{I(b)}),[w]),(0,n.useEffect)((()=>{I(S.filter((e=>g.onlyOn.includes(e.id))))}),[g.onlyOn]),(0,n.useEffect)((()=>{N(R({hasResolved:w,items:S,showNoResults:!1}))}),[S]),(0,e.createElement)(r,null,(0,e.createElement)(i,{...u}),(0,e.createElement)(a,null,(0,e.createElement)(c,{title:__("Block Visibility","sim"),initialOpen:!1},(0,e.createElement)(d,{label:__("Hide on mobile","sim"),checked:!!g.hideOnMobile,onChange:()=>m({hideOnMobile:!g.hideOnMobile})}),(0,e.createElement)(d,{label:__("Hide if not logged in","sim"),checked:!!g.onlyLoggedIn,onChange:()=>m({onlyLoggedIn:!g.onlyLoggedIn})}),(0,e.createElement)(d,{label:__("Hide if logged in","sim"),checked:!!g.onlyNotLoggedIn,onChange:()=>m({onlyNotLoggedIn:!g.onlyNotLoggedIn})}),(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,label:"Add php filters by name. I.e 'is_tax'",value:P,onChange:v.bind("")}),_,(0,e.createElement)("strong",null,__("Select pages","sim")),(0,e.createElement)("br",null),__("Select pages you want this widget to show on","sim"),".",(0,e.createElement)("br",null),__("Leave empty for all pages","sim"),(0,e.createElement)("br",null),(0,e.createElement)("br",null),L,(0,e.createElement)("i",null,__("Use searchbox below to search for more pages to include","sim")),(0,e.createElement)(t.SearchControl,{onChange:E,value:y}),(0,e.createElement)(R,{hasResolved:O,items:f}))))}),"blockFilterControls");wp.hooks.addFilter("editor.BlockEdit","sim/block-filter-controls",u)})();