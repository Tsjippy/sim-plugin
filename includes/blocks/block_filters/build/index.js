(()=>{"use strict";const e=window.wp.element,t=window.wp.components,n=window.wp.data,l=window.wp.coreData,o=window.wp.htmlEntities,{__}=wp.i18n,{createHigherOrderComponent:s}=wp.compose,{Fragment:i}=wp.element,{InspectorControls:r}=wp.blockEditor,{PanelBody:a,ToggleControl:c,CheckboxControl:d}=wp.components;wp.hooks.addFilter("blocks.registerBlockType","sim/block-filter-attribute",(function(e){return void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{hideOnMobile:{type:"boolean"},onlyLoggedIn:{type:"boolean"},onlyNotLoggedIn:{type:"boolean"},onlyOn:{type:"array"},phpFilters:{type:"array"}})),e}));const p=s((s=>p=>{const{attributes:u,setAttributes:g,isSelected:m}=p;if(!m)return(0,e.createElement)(i,null,(0,e.createElement)(s,p));null==u.onlyOn&&(u.onlyOn=[]);const[h,y]=(0,e.useState)(""),{initialSelectedPages:E,selectedPagesResolved:b}=(0,n.useSelect)((e=>{const t=["postType","page",{include:u.onlyOn}];return{initialSelectedPages:e(l.store).getEntityRecords(...t),selectedPagesResolved:e(l.store).hasFinishedResolution("getEntityRecords",t)}}),[]),{pages:w,pagesResolved:f}=(0,n.useSelect)((e=>{if(!h)return{pages:[],pagesResolved:!0};const t=["postType","page",{exclude:u.onlyOn,search:h,per_page:100,orderby:"relevance"}];return{pages:e(l.store).getEntityRecords(...t),pagesResolved:e(l.store).hasFinishedResolution("getEntityRecords",t)}}),[h]),O=function(e){e?(g({onlyOn:[...u.onlyOn,this]}),S([...F,w.find((e=>e.id==this))])):g({onlyOn:u.onlyOn.filter((e=>e!=this))})},C=function(n){let{hasResolved:l,items:s,showNoResults:r=!0}=n;return l?null!=s&&s.length?null==s?void 0:s.map((t=>(0,e.createElement)(d,{label:(0,o.decodeEntities)(t.title.rendered),onChange:O.bind(t.id),checked:u.onlyOn.includes(t.id)}))):r&&h?(0,e.createElement)("div",null," ",__("No search results","sim")):"":(0,e.createElement)(i,null,(0,e.createElement)(t.Spinner,null),(0,e.createElement)("br",null))},R=function(e){let t=this,n=[...u.phpFilters];""!=t||u.phpFilters.includes(e)?""==e?n=u.phpFilters.filter((e=>e!=t)):n[u.phpFilters.findIndex((e=>e==t))]=e:n.push(e),g({phpFilters:n}),P(""),_(v(n))},v=function(n){return n.map((n=>(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,value:n,onChange:R.bind(n)})))};let k="";null!=u.phpFilters?k=v(u.phpFilters):u.phpFilters=[];const[F,S]=(0,e.useState)([]),[I,L]=(0,e.useState)(u.onlyOn.length>0?(0,e.createElement)(i,null,(0,e.createElement)("i",null," ",__("Currently selected pages","sim"),":"),(0,e.createElement)("br",null),(0,e.createElement)(C,{hasResolved:b,items:E,showNoResults:!1})):""),[N,_]=(0,e.useState)(k),[x,P]=(0,e.useState)("");return(0,e.useEffect)((()=>{S(E)}),[b]),(0,e.useEffect)((()=>{S(F.filter((e=>u.onlyOn.includes(e.id))))}),[u.onlyOn]),(0,e.useEffect)((()=>{L(C({hasResolved:b,items:F,showNoResults:!1}))}),[F]),(0,e.createElement)(i,null,(0,e.createElement)(s,p),(0,e.createElement)(r,null,(0,e.createElement)(a,{title:__("Block Visibility","sim"),initialOpen:!1},(0,e.createElement)(c,{label:__("Hide on mobile","sim"),checked:!!u.hideOnMobile,onChange:()=>g({hideOnMobile:!u.hideOnMobile})}),(0,e.createElement)(c,{label:__("Hide if not logged in","sim"),checked:!!u.onlyLoggedIn,onChange:()=>g({onlyLoggedIn:!u.onlyLoggedIn})}),(0,e.createElement)(c,{label:__("Hide if logged in","sim"),checked:!!u.onlyNotLoggedIn,onChange:()=>g({onlyNotLoggedIn:!u.onlyNotLoggedIn})}),(0,e.createElement)(t.__experimentalInputControl,{isPressEnterToChange:!0,label:"Add php filters by name. I.e 'is_tax'",value:x,onChange:R.bind("")}),N,(0,e.createElement)("strong",null,__("Select pages","sim")),(0,e.createElement)("br",null),__("Select pages you want this widget to show on","sim"),".",(0,e.createElement)("br",null),__("Leave empty for all pages","sim"),(0,e.createElement)("br",null),(0,e.createElement)("br",null),I,(0,e.createElement)("i",null,__("Use searchbox below to search for more pages to include","sim")),(0,e.createElement)(t.SearchControl,{onChange:y,value:h}),(0,e.createElement)(C,{hasResolved:f,items:w}))))}),"blockFilterControls");wp.hooks.addFilter("editor.BlockEdit","sim/block-filter-controls",p)})();