{"version":3,"file":"fileupload.min.js","mappings":"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","sources":["webpack://fileupload/./fileupload.js"],"sourcesContent":["console.log(\"Fileupload.js loaded\");\r\n\r\nlet totalFiles\t\t\t= 0;\r\nlet fileUploadWrap\t\t= '';\r\nlet datasetString\t\t= '';\r\n\r\nfunction createProgressBar(target){\r\n\t//Show loading gif\r\n\ttarget.closest('.upload_div').querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\tvar html\t= ` \r\n\t<div id=\"progress-wrapper\" class=\"hidden\">\r\n\t\t<progress id=\"upload_progress\" value=\"0\" max=\"100\"></progress>\r\n\t\t<span id=\"progress_percentage\">   0%</span>\r\n\t</div>\r\n\t`;\r\n\r\n\tfileUploadWrap.insertAdjacentHTML('beforeEnd', html);\r\n}\r\n\r\nfunction addPreview(link, value){\r\n\tlet name\t\t= fileUploadWrap.querySelector('.file_upload').name.replace('_files','');\r\n\r\n\tlet html = `\r\n\t<div class='document'>\r\n\t\t<input type='hidden' name='${name}' value='${value}'>\r\n\t\t${link}\r\n\t\t<img class=\"remove_document_loader hidden\" src=\"${sim.loadingGif}\" style=\"height:40px;\">\r\n\t</div>`;\r\n\r\n\tfileUploadWrap.querySelector('.documentpreview').insertAdjacentHTML('beforeend', html);\r\n\r\n\treturn fileUploadWrap.querySelector('.documentpreview .document');\r\n}\r\n\r\nasync function fileUpload(target){\r\n\tlet s\t\t\t= \"\";\r\n\tfileUploadWrap\t= target.closest('.file_upload_wrap');\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\tMain.displayMessage(\"Please select some files before hitting the uplad button!\", 'error');\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'upload_files');\r\n\t\r\n\t//Loop over the dataset attributes and add them to post\r\n\tdatasetString\t= '';\r\n\ttarget.parentNode.querySelectorAll('input').forEach( \r\n\t\tinput => {\r\n\t\t\tformData.append(input.name, input.value);\r\n\t\t\tif(input.type != 'file' && !input.name.includes('fileupload')){\r\n\t\t\t\tdatasetString += `data-${input.name}=\"${input.value}\"`;\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\t// file is a video and vimeo enabled\r\n\t\tif(target.files[index].type.split('/')[0] == 'video' && typeof(vimeoUploader) == 'object'){\r\n\t\t\tcreateProgressBar(target);\r\n\r\n\t\t\t//update post id on a postform\r\n\t\t\tawait uploadVideo(target.files[index]);\r\n\t\t// file to big\r\n\t\t}else if(target.files[index].size > sim.maxFileSize){\r\n\t\t\tMain.displayMessage('File too big, max file size is '+(parseInt(sim.maxFileSize)/1024/1024)+'MB','error');\r\n\t\t\ttarget.value = '';\r\n\t\t\treturn;\r\n\t\t}else{\r\n\t\t\tformData.append('files[]', target.files[index]);\r\n\t\t}\r\n\t}\r\n\r\n\t// No files remaining to upload\r\n\tif(formData.get('files[]') == null){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t//Create a progressbar\r\n\tcreateProgressBar(target);\r\n\t\r\n\t//Send AJAX request\r\n\tif (totalFiles > 1){\r\n\t\ts = \"s\";\r\n\t}\r\n\ttarget.closest('.upload_div').querySelector('.uploadmessage').textContent = \"Uploading document\"+s;\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\trequest.send(formData);\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tvar max = e.total;\r\n\t\tvar current = e.loaded;\r\n\r\n\t\tvar percentage = (current * 100)/max;\r\n\t\tpercentage = Math.round(percentage*10)/10\r\n\t\t\r\n\t\tdocument.getElementById(\"upload_progress\").value \t\t\t= percentage;\r\n\t\tdocument.getElementById(\"progress_percentage\").textContent\t= `   ${percentage}%`;\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").remove();\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing documents\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing document\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\r\n\t}\r\n}\r\n\r\nfunction fileUploadSucces(result){\r\n\tlet imgUrls\t\t= JSON.parse(result);\r\n\tlet src\t\t\t= '';\r\n\t\r\n\tfor(const element of imgUrls) {\r\n\t\tsrc \t\t\t= element['url'];\r\n\t\tlet url \t\t= sim.baseUrl+'/'+src;\r\n\t\tlet value\t\t= '';\r\n\t\tlet anchorLink\t= '';\r\n\t\t\r\n\t\tif(element['id'] != undefined){\r\n\t\t\tdatasetString += ' data-libraryid=\"'+element['id']+'\"';\r\n\t\t}\r\n\r\n\t\tif(element['id'] == undefined){\r\n\t\t\tvalue\t\t= url;\r\n\t\t}else{\r\n\t\t\tvalue\t\t= element['id'];\r\n\t\t}\r\n\r\n\t\t//is image\r\n\t\tif (src.toLowerCase().match(/\\.(jpe|jpeg|jpg|gif|png)$/) != null){\r\n\t\t\t//Add the image\r\n\t\t\tanchorLink\t= `<a class=\"fileupload\" href=\"${url}\"><img src=\"${url}\" alt=\"picture\" style=\"width:150px;height:150px;\"></a>`;\r\n\t\t}else{\r\n\t\t\t//Add a link\r\n\t\t\tanchorLink\t= `<a class=\"fileupload\" href=\"${url}\">${filename}</a>`;\r\n\t\t}\r\n\t\tanchorLink += `<button type=\"button\" class=\"remove_document button\" data-url=\"${src}\" ${datasetString}>X</button>`;\r\n\r\n\t\taddPreview(anchorLink, value);\r\n\t}\r\n\t\r\n\tif(imgUrls.length==1){\r\n\t\tlet fileName \t= src.split(\"/\")[src.split(\"/\").length-1];\r\n\t\tMain.displayMessage(`The file ${fileName} has been uploaded succesfully.`,'success',true);\r\n\t}else{\r\n\t\tMain.displayMessage(\"The files have been uploaded succesfully.\",'success',true);\r\n\t}\r\n\t\r\n\t//Hide upload button if only one file allowed\r\n\tif(!fileUploadWrap.querySelector('.file_upload').multiple){\r\n\t\tfileUploadWrap.querySelector('.upload_div').classList.add('hidden');\r\n\t}\r\n}\r\n\r\nasync function removeDocument(target){\r\n\tlet data = new FormData();\t\t\r\n\t//Loop over the dataset attributes and add them to post\r\n\tfor(let d in target.dataset){\r\n\t\tif(target.dataset[d] != ''){\r\n\t\t\tdata.append(d,target.dataset[d]);\r\n\t\t}\r\n\t}\r\n\t\r\n\t//hide the remove button\r\n\ttarget.style.display = \"none\";\r\n\t\r\n\t//add an id to the remove button so we can query for it later\r\n\ttarget.parentNode.classList.add('removethisdocument');\r\n\t\r\n\t//show loader\r\n\ttarget.parentNode.querySelector('.remove_document_loader').classList.remove('hidden');\r\n\t\r\n\tlet response\t= await FormSubmit.fetchRestApi('remove_document', data);\r\n\r\n\tif(response){\r\n\t\tlet docWrapper\t\t= target.closest('.document');\r\n\t\tfileUploadWrap\t\t= docWrapper.closest('.file_upload_wrap');\r\n\t\t\r\n\t\t//hide the loading gif\r\n\t\tdocWrapper.querySelector('.remove_document_loader').classList.add('hidden');\r\n\t\t\t\r\n\t\t// If successful\r\n\t\ttry{\r\n\t\t\t//show the upload field\r\n\t\t\tfileUploadWrap.querySelector('.upload_div').classList.remove('hidden');\r\n\t\t}catch{\r\n\t\t\t//remove featured image id\r\n\t\t\tdocument.querySelector('[name=\"post_image_id\"]').value = '';\r\n\t\t}\r\n\t\t\r\n\t\t//remove the document/picture\r\n\t\tdocWrapper.remove();\r\n\t\t\r\n\t\t//var re = new RegExp('(.*)[0-9](.*)',\"g\");\r\n\t\t//reindex documents\r\n\t\tfileUploadWrap.querySelectorAll('.file_url').forEach((el,index)=>{\r\n\t\t\t//el.name = el.name.replace(re, '$1'+index+'$2');\r\n\t\t\tel.name = el.name.replace(/(\\d)/g, index);\r\n\t\t});\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nfunction refreshVimeoiFrame(){\r\n\t// Show the vimeo video after 60 seconds when the video is hopefully rendered\r\n\tdocument.querySelectorAll('.vimeo-embed-container.loading iframe').forEach(el=>{\r\n\t\t// replace the src with itself to refresh the iframe\r\n\t\tel.src\t= el.src;\r\n\t});\r\n}\r\n\r\nasync function uploadVideo(file){\r\n\tvar uploader\t= new vimeoUploader.VimeoUpload(file);\r\n\tvar upload\t\t= await uploader.tusUploader();\r\n\tvar s\t\t\t= '';\r\n\r\n\t// Could not upload\r\n\tif(!upload){\r\n\t\t//clear file upload\r\n\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\r\n\t\t\t\t\r\n\t\t//Remove progress barr\r\n\t\tdocument.getElementById(\"progress-wrapper\").remove();\r\n\r\n\t\t// Hide the loader\r\n\t\tdocument.querySelector('.loadergif_wrapper:not(.hidden)').classList.add('hidden');\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Upload started\r\n\tif (totalFiles > 1){\r\n\t\ts = \"s\";\r\n\t}else{\r\n\t\ts = \"\";\r\n\t}\r\n\r\n\tupload.options.onProgress   = function(bytesUploaded, bytesTotal) {\r\n\t\t//calculate percentage\r\n\t\tvar percentage = (bytesUploaded / bytesTotal * 100).toFixed(2)\r\n\t\r\n\t\t//show percentage in progressbar\r\n\t\tdocument.getElementById(\"upload_progress\").value\t\t\t= percentage;\r\n\t\tdocument.getElementById(\"progress_percentage\").textContent\t= `   ${percentage}%`;\r\n\r\n\t\tif(percentage>98){\r\n\t\t\tdocument.querySelector('.upload-message').textContent = \"Processing video\"+s;\r\n\t\t\tdocument.getElementById('progress-wrapper').classList.add('hidden');\r\n\t\t}\r\n\t};\r\n\r\n\tupload.options.onSuccess    = async function() {\r\n\t\tlet postId\t= uploader.storedEntry.postId;\r\n\t\t// Add post id of the video to the form\r\n\t\tlet formData = new FormData();\r\n        formData.append('post_id', postId);\r\n    \r\n        let request = new XMLHttpRequest();\r\n        request.open('POST', `${sim.baseUrl}/wp-json${sim.restApiPrefix}/vimeo/add_uploaded_vimeo`, false);\r\n        request.send(formData);\r\n\r\n\t\t//Remove progress barr\r\n\t\tdocument.getElementById(\"progress-wrapper\").remove();\r\n\t\t\r\n\t\tlet link\t= `\r\n\t\t<div class=\"vimeo-wrapper\">\r\n\t\t\t<div class='vimeo-embed-container loading'>\r\n\t\t\t\t<iframe src='https://player.vimeo.com/video/${uploader.storedEntry.vimeoId}' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><br>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\r\n\t\tvar preview\t\t= addPreview(link, postId);\r\n\r\n\t\t// Hide the loader\r\n\t\tdocument.querySelector('.loadergif_wrapper:not(.hidden)').classList.add('hidden');\r\n\r\n\t\tMain.displayMessage(`The file ${file.name} has been uploaded succesfully.`,'success',true);\r\n\t\t\r\n\t\t//Hide upload button if only one file allowed\r\n\t\tif(!fileUploadWrap.querySelector('.file_upload').multiple){\r\n\t\t\tfileUploadWrap.querySelector('.upload_div').classList.add('hidden');\r\n\t\t}\r\n\r\n\t\t//clear file upload\r\n\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\r\n\t\t\r\n\t\tuploader.urlStorage.removeUpload(uploader.storedEntry.urlStorageKey);\r\n\r\n\t\t// check if we are uploading from frontend posting form\r\n\t\tvar postForm = document.getElementById('postform');\r\n\t\tif(postForm != null){\r\n\t\t\tpostForm.querySelector('[name=\"update\"]').value\t\t= 'true';\r\n\t\t\tpostForm.querySelector('[name=\"post_id\"]').value\t= postId;\r\n\t\t}\r\n\r\n\t\t// Wait for the video to be processed on Vimeo\r\n\t\tvar result\t= '';\r\n\t\twhile(!result.ok){\r\n\t\t\tawait new Promise(res => setTimeout(res, 10000));\r\n\t\t\tresult = await fetch(\r\n\t\t\t\t`https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/${uploader.storedEntry.vimeoId}`,\r\n\t\t\t\t{method: 'GET'}\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar response\t= await result.json();\r\n\r\n\t\tpreview.querySelector('.vimeo-wrapper').innerHTML = DOMPurify.sanitize(response.html);\r\n\t}\r\n\r\n\tupload.options.onError      = function(error) {\r\n\t\tconsole.error(\"Failed because: \" + error);\t\t\t\t\r\n\t}\r\n\r\n\tdocument.querySelector('.upload-message').textContent = \"Uploading video\"+s;\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\tupload.start();\r\n}\r\n\r\n//Remove picture on button click\r\nwindow.addEventListener(\"click\", function(event) {\r\n\tvar target = event.target;\r\n\t\r\n\tif (target.className.includes(\"remove_document\")){\r\n\t\tevent.preventDefault();\r\n\t\tremoveDocument(target);\r\n\t}\r\n});\r\n\r\nwindow.addEventListener(\"change\", event => {\r\n\tlet target = event.target;\r\n\r\n\tif (target.className.includes(\"file_upload\")){\r\n\t\tevent.preventDefault();\r\n\t\tfileUpload(target);\r\n\t}\r\n});"],"names":["console","log","totalFiles","fileUploadWrap","datasetString","createProgressBar","target","closest","querySelectorAll","forEach","loader","classList","remove","el","textContent","add","insertAdjacentHTML","addPreview","link","value","html","querySelector","name","replace","sim","loadingGif","fileUploadProgress","e","lengthComputable","max","total","percentage","loaded","Math","round","document","getElementById","readyStateChanged","request","readyState","status","result","imgUrls","JSON","parse","src","element","url","baseUrl","anchorLink","undefined","toLowerCase","match","filename","length","fileName","split","Main","displayMessage","multiple","fileUploadSucces","responseText","error","async","uploadVideo","file","s","uploader","vimeoUploader","VimeoUpload","upload","tusUploader","options","onProgress","bytesUploaded","bytesTotal","toFixed","onSuccess","postId","storedEntry","formData","FormData","append","XMLHttpRequest","open","restApiPrefix","send","preview","vimeoId","urlStorage","removeUpload","urlStorageKey","postForm","ok","Promise","res","setTimeout","fetch","method","response","json","innerHTML","DOMPurify","sanitize","onError","start","window","addEventListener","event","className","includes","preventDefault","data","d","dataset","style","display","parentNode","FormSubmit","fetchRestApi","docWrapper","index","removeDocument","files","input","type","size","maxFileSize","parseInt","get","onreadystatechange","ajaxUrl","fileUpload"],"sourceRoot":""}