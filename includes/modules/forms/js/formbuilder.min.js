!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.formFunctions=t():e.formFunctions=t()}(self,(function(){return(()=>{var e;function t(){try{modal.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element_id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){var t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(formFunctions.removeDefaultSelect(e),null!=e._niceselect&&(e._niceselect.clear(),e._niceselect.update()))})),c(modal.querySelector("form"))}catch(e){console.error(e)}}function o(e){e.querySelectorAll(".form_element_wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}function n(e){modal.querySelector(".element_conditions_wrapper").innerHTML=e,modal.querySelectorAll(".condition_select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}async function r(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;var o=new FormData;o.append("formid",e.closest(".form_element_wrapper").dataset.formid),o.append("elementid",e.closest(".form_element_wrapper").dataset.id),o.append("new_width",t),response=await fetchRestApi("forms/edit_formfield_width",o),response&&(hide_modals(),display_message(response))}}async function a(e){var t=e.parentNode,n=e.closest(".form_element_wrapper"),r=n.dataset.formid,a=n.dataset.id,l=e.closest("form");showLoader(e);var i=t.querySelector(".loadergif");i.style.paddingRight="10px",i.classList.remove("loadergif");var s=new FormData;s.append("formid",r),s.append("elementindex",a),response=await fetchRestApi("forms/remove_element",s),response&&(n.remove(),o(l),display_message(response))}async function l(e){if(0==reordering_busy){reordering_busy=!0;var t=parseInt(e.item.dataset.priority);o(e.item.closest("form"));var n=e.newIndex-e.oldIndex,r=new FormData;r.append("formid",e.item.dataset.formid),r.append("old_index",t),r.append("new_index",t+n);var a=await fetchRestApi("forms/reorder_form_elements",r);a&&(reordering_busy=!1,display_message(a))}else Swal.fire({icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"})}const i=new ResizeObserver((function(t){var o=t[0].target;if(null!=o.parentNode){var n=t[0].contentRect.width,a=Math.round(n/o.parentNode.offsetWidth*100),l=o.querySelector(".widthpercentage");a<99?l.textContent=a+"%":null!=l&&(l.textContent=""),clearTimeout(e),e=setTimeout(r,500,o,a)}}));function s(e,t){switch(c(t),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"]').classList.replace("hidden","hide"),t.querySelector('[name="labeltext"] .elementtype').textContent=e,t.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hide","hidden")}));break;case"info":t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"radio":case"select":case"checkbox":case"datalist":t.querySelector('[name="valuelist"]').classList.replace("hidden","hide"),t.querySelector('[name="select_options"]').classList.replace("hidden","hide"),t.querySelector('[name="defaults"]').classList.replace("hidden","hide"),"select"!=e&&t.querySelector('[name="multiple"]').classList.replace("hide","hidden");break;case"p":t.querySelectorAll('[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"php":t.querySelectorAll('[name="elementname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="functionname"]').classList.replace("hidden","hide");break;case"file":case"image":t.querySelectorAll('[name="functionname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="defaults"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="upload-options"]').classList.replace("hidden","hide"),t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function c(e){e.querySelectorAll(".hide").forEach((function(e){e.classList.replace("hide","hidden")})),e.querySelector('[name="multiple"]').classList.replace("hidden","hide"),e.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hidden","hide")}))}function d(e){var t=formFunctions.cloneNode(e),o=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=o,e.parentNode.insertBefore(t,e.nextSibling),m(e.closest(".condition_row"))}function m(e){var t=e.querySelectorAll(".element_conditions_wrapper .rule_row"),o=0;t.forEach((e=>{e.dataset.rule_index=o,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o))})),o++}))}function u(){var e=modal.querySelectorAll(".element_conditions_wrapper .condition_row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function f(){var e=document.querySelectorAll("#conditions_wrapper .warning_conditions"),t=0;e.forEach((e=>{e.dataset.index=t,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,t)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,t)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,t))})),t++}))}return reordering_busy=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Formbuilder.js loaded");var e={handle:".movecontrol",animation:150,onEnd:l};document.querySelectorAll(".form_elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{i.observe(e)}))})),window.addEventListener("click",(e=>{var r=e.target;if(formwrapper=r.closest(".sim_form.wrapper"),form_element_wrapper=r.closest(".form_element_wrapper"),null!=formwrapper&&(modal=formwrapper.querySelector(".add_form_element_modal")),"editform"==r.name&&function(e){"show"==e.dataset.action?(formwrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.remove("hidden"),e.textContent="Hide form edit controls",e.dataset.action="hide"})),formwrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.add("show")})),formwrapper.querySelector('[name="submit_form"]').classList.add("hidden")):(formwrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.add("hidden"),e.textContent="Show form edit controls",e.dataset.action="show"})),formwrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.remove("show")})),formwrapper.querySelector('[name="submit_form"]').classList.remove("hidden"))}(r),(r.classList.contains("add_form_element")||"createform"==r.name)&&async function(e){e.classList.add("clicked");var o=e.dataset.formid;null==o&&(o=e.closest(".form_element_wrapper").dataset.formid),t(),null!=form_element_wrapper&&(modal.querySelector('[name="insertafter"]').value=form_element_wrapper.dataset.priority),modal.querySelector('[name="submit_form_element"]').textContent=modal.querySelector('[name="submit_form_element"]').textContent.replace("Update","Add"),modal.querySelector(".element_conditions_wrapper").innerHTML='<img src="'+sim.loading_gif+'" style="display:block; margin:0px auto 0px auto;">',modal.classList.remove("hidden");var r=new FormData;r.append("elementid","-1"),r.append("formid",o),n(await fetchRestApi("forms/request_form_conditions_html",r))}(r),"submit_form_element"==r.name&&async function(e){var n=e.closest("form"),r=await submitForm(e,"forms/add_formfield");if(r){if(""==n.querySelector('[name="element_id"]').value){t();var a=document.createElement("template");a.innerHTML=r.html;var l=a.content.firstChild;referenceNode=document.querySelector(".form_elements .clicked"),referenceNode.classList.remove("clicked"),referenceNode.closest(".form_element_wrapper").parentNode.insertBefore(l,referenceNode.closest(".form_element_wrapper").nextSibling),o(n),i.observe(l)}else document.querySelector(".form_elements .clicked").closest(".form_element_wrapper").outerHTML=r.html;hide_modals(),display_message(r.message)}}(r),"submit_form_condition"==r.name&&async function(e){var t=await submitForm(e,"forms/save_element_conditions");t&&(hide_modals(),display_message(t))}(r),"submit_form_setting"==r.name&&async function(e){var t=await submitForm(e,"forms/save_form_settings");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),display_message(t))}(r),"submit_form_emails"==r.name&&async function(e){var t=await submitForm(e,"forms/save_form_emails");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),display_message(t))}(r),r.classList.contains("edit_form_element")&&async function(e){e.classList.add("clicked");var o=form_element_wrapper.dataset.id,r=e.closest(".form_element_wrapper").dataset.formid;modal.querySelector('[name="element_id"]').value=form_element_wrapper.dataset.id,modal.originalhtml=e.outerHTML;var a=e.parentNode;showLoader(e),a.querySelector(".loadergif").style.margin="5px 19px 0px 19px";var l=new FormData;l.append("elementid",o),l.append("formid",r);var i=await fetchRestApi("forms/request_form_element",l);if(i){t(),n(i.conditions_html),function(e){if(null!=modal.querySelector("#warning_conditions_form"))try{modal.querySelector("#warning_conditions_form").innerHTML=e.warning_conditions,modal.querySelectorAll("#warning_conditions_form select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}catch(e){console.error(e)}}(i.warning_conditions);var c=i.original,d=modal.querySelector("form");s(c.type,d),modal.querySelectorAll(".formbuilder").forEach((function(e){if(null!=e.name){var t=e.name.replace("formfield[","").replace("]","");null!=c[t]&&""!=c[t]&&("checkbox"==e.type?1==c[t]&&(e.checked=!0):e.value=c[t],"select-one"==e.type&&e.selectedOptions.length>0&&(e.selectedOptions[0].defaultSelected=!0,"undefined"!=e._niceselect&&e._niceselect.update()),e.classList.contains("wp-editor-area")&&tinyMCE.get(e.id).setContent(c[t]))}})),modal.querySelector('[name="element_id"]').value=o,modal.querySelector('[name="submit_form_element"]').textContent=modal.querySelector('[name="submit_form_element"]').textContent.replace("Add","Update"),modal.classList.remove("hidden");var m=document.querySelector(`.form_element_wrapper[data-id="${o}"][data-formid="${r}"] .loadergif`),u=document.createElement("template");u.innerHTML=modal.originalhtml;var f=u.content.firstChild;m.parentNode.replaceChild(f,m)}}(r),r.classList.contains("remove_form_element")&&function(e){"undefined"==typeof Swal?a(e):Swal.fire({title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((t=>{t.isConfirmed&&a(e)}))}(r),null!=r.closest(".elementtype")&&(s(r.dataset.value,r.closest("form")),"label"==r.dataset.value&&(r.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0)),null!=r.closest(".equation")&&function(e){e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule_row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("checked"))&&e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(r),(r.classList.contains("and_rule")||r.classList.contains("or_rule"))&&function(e){var t=e.closest(".rule_row"),o=t.querySelector(".active");if(null==o||e.classList.contains("active"))d(t),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent;else{if("AND"==o.textContent)var n="AND",r="OR";else n="OR",r="AND";Swal.fire({title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Change "+n+" to "+r,denyButtonText:"Add a new rule"}).then((n=>{n.isConfirmed?(o.classList.remove("active"),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent):n.isDenied&&d(t)}))}}(r),r.classList.contains("add_condition")&&function(e){var t=e.closest(".condition_row");e.classList.contains("opposite")?clone=formFunctions.cloneNode(t,!1):clone=formFunctions.cloneNode(t);var o=parseInt(t.dataset.condition_index)+1;clone.dataset.condition_index=o,e.classList.contains("opposite")||clone.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")})),e.classList.contains("opposite")&&clone.querySelectorAll(".element_condition").forEach((function(e){if("SELECT"==e.tagName&&e.classList.contains("equation")){formFunctions.removeDefaultSelect(e);var o=t.querySelector(".equation").selectedIndex;0!=o&&(o%2?e.options[o+1].defaultSelected=!0:e.options[o-1].defaultSelected=!0),e._niceselect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(0==e.checked?e.checked=!0:e.checked=!1)}));var n={};if(t.querySelectorAll('input[type="radio"]:checked').forEach((e=>{n[e.value]=e.value})),t.parentNode.insertBefore(clone,t.nextSibling),!e.classList.contains("opposite")){var r=clone.querySelectorAll(".rule_row").length;clone.querySelectorAll(".rule_row").forEach((function(e){e.dataset.rule_index!=r-1?e.remove():m(e.closest(".condition_row"))}))}u(),t.querySelectorAll('input[type="radio"]').forEach((e=>{null!=n[e.value]&&(e.checked=!0)})),e.style.display="none"}(r),r.classList.contains("remove_condition")&&function(e){var t=e.closest(".condition_row");t.querySelectorAll(".rule_row").length>1?Swal.fire({title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"}).then((o=>{if(o.isConfirmed){var n=e.closest(".rule_row").dataset.rule_index,r=t.querySelector('[data-rule_index="'+(n-1)+'"]');null!=r&&(r.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),r.querySelector(".combinator").value=""),e.closest(".rule_row").remove(),m(t)}else o.isDenied&&(t.remove(),u())})):Swal.fire({title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((e=>{e.isConfirmed&&(t.remove(),u())}))}(r),r.classList.contains("showcopyfields")&&(r.checked?r.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):r.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),r.classList.contains("emailtrigger")&&(el=r.closest(".clone_div").querySelector(".emailfieldcondition"),"fieldchanged"==r.value?el.classList.remove("hidden"):el.classList.add("hidden")),r.classList.contains("fromemail")&&(div1=r.closest(".clone_div").querySelector(".emailfromfixed"),div2=r.closest(".clone_div").querySelector(".emailfromconditional"),"fixed"==r.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),r.classList.contains("emailto")&&(div1=r.closest(".clone_div").querySelector(".emailtofixed"),div2=r.closest(".clone_div").querySelector(".emailtoconditional"),"fixed"==r.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),r.classList.contains("placeholderselect")||r.classList.contains("placeholders")){var l="";r.classList.contains("placeholders")?l=r.textContent:""!=r.value&&(l=r.value,r.selectedIndex="0"),""!=l&&(Swal.fire({icon:"success",title:"Copied "+l,showConfirmButton:!1,timer:1500}),navigator.clipboard.writeText(l))}if("settings[autoarchive]"==r.name&&(el=r.closest(".formsettings_wrapper").querySelector(".autoarchivelogic"),"true"==r.value?el.classList.remove("hidden"):el.classList.add("hidden")),"settings[save_in_meta]"==r.name&&r.closest(".sim_form.builder").querySelector(".submit_others_form_wrapper").classList.toggle("hidden"),"formfield[mandatory]"==r.name&&r.checked&&(r.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0),r.matches(".warn_cond")){var c=formFunctions.cloneNode(r.closest(".warning_conditions"));document.getElementById("conditions_wrapper").insertAdjacentElement("beforeEnd",c),r.classList.add("active"),r.closest(".warning_conditions").querySelector(".combinator").value=r.value,f()}r.matches(".remove_warn_cond")&&(r.closest(".warning_conditions").remove(),f())})),window.addEventListener("change",(e=>{if(e.target.matches(".meta_key")){var t=e.target.list.querySelector("[value='"+e.target.value+"' i]").dataset.keys;if(null!=t){parent=e.target.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden"),console.log(parent);var o=parent.querySelector(".meta_key_index_list");console.log(o);for(var n=1;n<o.options.length;n++)o.options[n].remove();t.split(",").forEach((e=>{var t=document.createElement("option");t.value=e,o.appendChild(t)}))}}})),{}})()}));
//# sourceMappingURL=formbuilder.min.js.map