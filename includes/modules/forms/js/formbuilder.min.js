(()=>{var e,t,o,n,a;function r(){try{n.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element_id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){var t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(FormFunctions.removeDefaultSelect(e),null!=e._niceselect&&(e._niceselect.clear(),e._niceselect.update()))})),u(n.querySelector("form"))}catch(e){console.error(e)}}function i(e){e.querySelectorAll(".form_element_wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}async function l(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;var o=new FormData;o.append("formid",e.closest(".form_element_wrapper").dataset.formid),o.append("elementid",e.closest(".form_element_wrapper").dataset.id),o.append("new_width",t);var n=await FormSubmit.fetchRestApi("forms/edit_formfield_width",o);n&&(Main.hideModals(),Main.displayMessage(n))}}async function s(e){var t=e.parentNode,o=e.closest(".form_element_wrapper"),n=o.dataset.formid,a=o.dataset.id,r=e.closest("form");Main.showLoader(e);var l=t.querySelector(".loadergif");l.style.paddingRight="10px",l.classList.remove("loadergif");var s=new FormData;s.append("formid",n),s.append("elementindex",a);var c=await FormSubmit.fetchRestApi("forms/remove_element",s);c&&(o.remove(),i(r),Main.displayMessage(c))}async function c(t){if(e)Swal.fire({icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"});else{e=!0;var o=parseInt(t.item.dataset.priority);i(t.item.closest("form"));var n=t.newIndex-t.oldIndex,a=new FormData;a.append("formid",t.item.dataset.formid),a.append("old_index",o),a.append("new_index",o+n);var r=await FormSubmit.fetchRestApi("forms/reorder_form_elements",a);r&&(e=!1,Main.displayMessage(r))}}const d=new ResizeObserver((function(e){var t=e[0].target;if(null!=t.parentNode){var o=e[0].contentRect.width,n=Math.round(o/t.parentNode.offsetWidth*100),r=t.querySelector(".widthpercentage");n<99?r.textContent=n+"%":null!=r&&(r.textContent=""),clearTimeout(a),a=setTimeout(l,500,t,n)}}));function m(e,t){switch(u(t),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"]').classList.replace("hidden","hide"),t.querySelector('[name="labeltext"] .elementtype').textContent=e,t.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hide","hidden")}));break;case"info":t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"radio":case"select":case"checkbox":case"datalist":t.querySelector('[name="valuelist"]').classList.replace("hidden","hide"),t.querySelector('[name="select_options"]').classList.replace("hidden","hide"),t.querySelector('[name="defaults"]').classList.replace("hidden","hide"),"select"!=e&&t.querySelector('[name="multiple"]').classList.replace("hide","hidden");break;case"p":t.querySelectorAll('[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"php":t.querySelectorAll('[name="elementname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="functionname"]').classList.replace("hidden","hide");break;case"file":case"image":t.querySelectorAll('[name="functionname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="defaults"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="upload-options"]').classList.replace("hidden","hide"),t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function u(e){e.querySelectorAll(".hide").forEach((function(e){e.classList.replace("hide","hidden")})),e.querySelector('[name="multiple"]').classList.replace("hidden","hide"),e.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hidden","hide")}))}function f(e){var t=FormFunctions.cloneNode(e),o=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=o,e.parentNode.insertBefore(t,e.nextSibling),h(e.closest(".condition_row"))}function p(e){return e.querySelectorAll(".element_condition").forEach((function(e){if("SELECT"==e.tagName&&e.classList.contains("equation")){FormFunctions.removeDefaultSelect(e);var t=row.querySelector(".equation").selectedIndex;t&&(t%2?e.options[t+1].defaultSelected=!0:e.options[t-1].defaultSelected=!0),e._niceselect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(e.checked?e.checked=!1:e.checked=!0)})),e}function h(e){var t=e.querySelectorAll(".element_conditions_wrapper .rule_row"),o=0;t.forEach((e=>{e.dataset.rule_index=o,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o))})),o++}))}function _(){var e=n.querySelectorAll(".element_conditions_wrapper .condition_row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function v(e){var t=e.querySelectorAll(".warning_conditions"),o=0;t.forEach((e=>{e.dataset.index=o,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,o)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,o)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,o))})),o++}))}e=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Formbuilder.js loaded");var e={handle:".movecontrol",animation:150,onEnd:c};document.querySelectorAll(".form_elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{d.observe(e)}))})),window.addEventListener("click",(e=>{var a=e.target;if(t=a.closest(".sim_form.wrapper"),o=a.closest(".form_element_wrapper"),null!=t&&(n=t.querySelector(".add_form_element_modal")),"editform"==a.name)!function(e){"show"==e.dataset.action?(t.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.remove("hidden"),e.textContent="Hide form edit controls",e.dataset.action="hide"})),t.querySelectorAll(".resizer").forEach((function(e){e.classList.add("show")})),t.querySelector('[name="submit_form"]').classList.add("hidden")):(t.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.add("hidden"),e.textContent="Show form edit controls",e.dataset.action="show"})),t.querySelectorAll(".resizer").forEach((function(e){e.classList.remove("show")})),t.querySelector('[name="submit_form"]').classList.remove("hidden"))}(a);else if("submit_form_element"==a.name)e.stopPropagation(),async function(e){console.log(e);var t=e.closest("form"),o=await FormSubmit.submitForm(e,"forms/add_form_element");if(o){if(""==t.querySelector('[name="element_id"]').value){r();var n=document.querySelector(".form_elements .clicked");null==n&&(window.location.href=window.location.href+"&formbuilder=true"),n.classList.remove("clicked"),n.closest(".form_element_wrapper").insertAdjacentHTML("afterEnd",o.html),i(t),t.querySelectorAll(".resizer").forEach((e=>{d.observe(e)}))}else document.querySelector(".form_elements .clicked").closest(".form_element_wrapper").outerHTML=o.html;Main.hideModals(),Main.displayMessage(o.message)}}(a);else if("submit_form_condition"==a.name)!async function(e){var t=await FormSubmit.submitForm(e,"forms/save_element_conditions");t&&(Main.hideModals(),Main.displayMessage(t))}(a);else if("submit_form_setting"==a.name)!async function(e){var t=await FormSubmit.submitForm(e,"forms/save_form_settings");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(a);else if("submit_form_emails"==a.name)!async function(e){var t=await FormSubmit.submitForm(e,"forms/save_form_emails");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(a);else if("settings[autoarchive]"==a.name){let e=a.closest(".formsettings_wrapper").querySelector(".autoarchivelogic");"true"==a.value?e.classList.remove("hidden"):e.classList.add("hidden")}else"settings[save_in_meta]"==a.name?a.closest(".sim_form.builder").querySelector(".submit_others_form_wrapper").classList.toggle("hidden"):"formfield[mandatory]"==a.name&&a.checked&&(a.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0);if(a.classList.contains("edit_form_element")&&async function(e){e.classList.add("clicked");var t=o.dataset.id,a=e.closest(".form_element_wrapper").dataset.formid;n.querySelector('[name="element_id"]').value=o.dataset.id,n.originalhtml=e.outerHTML;var r=e.outerHTML,i=Main.showLoader(e);i.querySelector(".loadergif").style.margin="5px 19px 0px 19px";var l=new FormData;l.append("elementid",t),l.append("formid",a);var s=await FormSubmit.fetchRestApi("forms/request_form_element",l);s&&(null!=n.querySelector('[name="add_form_element_form"]')&&(n.querySelector('[name="add_form_element_form"]').innerHTML=s.elementForm,n.querySelectorAll(".wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),m(n.querySelector('[name="formfield[type]"]').value,n.querySelector('[name="add_form_element_form"]')),n.querySelector(".element_conditions_wrapper").innerHTML=s.conditionsHtml,n.querySelectorAll("select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})})),n.classList.remove("hidden"),i.outerHTML=r)}(a),a.classList.contains("remove_form_element")&&function(e){"undefined"==typeof Swal?s(e):Swal.fire({title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((t=>{t.isConfirmed&&s(e)}))}(a),(a.classList.contains("add_form_element")||"createform"==a.name)&&async function(e){e.classList.add("clicked");var t=e.dataset.formid;null==t&&(t=null!=e.closest(".form_element_wrapper")?e.closest(".form_element_wrapper").dataset.formid:document.querySelector('input[type=hidden][name="formid"').value),r(),null!=o&&(n.querySelector('[name="insertafter"]').value=o.dataset.priority),n.querySelector('[name="submit_form_element"]').textContent=n.querySelector('[name="submit_form_element"]').textContent.replace("Update","Add"),n.querySelector(".element_conditions_wrapper").innerHTML='<img src="'+sim.loadingGif+'" style="display:block; margin:0px auto 0px auto;">',n.classList.remove("hidden");var a=new FormData;a.append("elementid","-1"),a.append("formid",t);var i=await FormSubmit.fetchRestApi("forms/request_form_conditions_html",a);n.querySelector(".element_conditions_wrapper").innerHTML=i,n.querySelectorAll(".condition_select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}(a),null!=a.closest(".elementtype")&&(m(a.dataset.value,a.closest("form")),"label"==a.dataset.value&&(a.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0)),null!=a.closest(".equation")&&function(e){e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule_row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("checked"))&&e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(a),(a.classList.contains("and_rule")||a.classList.contains("or_rule"))&&function(e){var t=e.closest(".rule_row"),o=t.querySelector(".active");if(null==o||e.classList.contains("active"))f(t),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent;else{var n="OR",a="AND";"AND"==o.textContent&&(n="AND",a="OR"),Swal.fire({title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:`Change ${n} to ${a}`,denyButtonText:"Add a new rule"}).then((n=>{n.isConfirmed?(o.classList.remove("active"),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent):n.isDenied&&f(t)}))}}(a),a.classList.contains("add_condition")&&function(e){var t,o=e.closest(".condition_row");t=e.classList.contains("opposite")?p(t=FormFunctions.cloneNode(o,!1)):FormFunctions.cloneNode(o);var n=parseInt(o.dataset.condition_index)+1;t.dataset.condition_index=n,e.classList.contains("opposite")||t.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")}));var a={};if(o.querySelectorAll('input[type="radio"]:checked').forEach((e=>{a[e.value]=e.value})),o.parentNode.insertBefore(t,o.nextSibling),!e.classList.contains("opposite")){var r=t.querySelectorAll(".rule_row").length;t.querySelectorAll(".rule_row").forEach((function(e){e.dataset.rule_index!=r-1?e.remove():h(e.closest(".condition_row"))}))}_(),o.querySelectorAll('input[type="radio"]').forEach((e=>{null!=a[e.value]&&(e.checked=!0)})),e.style.display="none"}(a),a.classList.contains("remove_condition")&&function(e){var t=e.closest(".condition_row");t.querySelectorAll(".rule_row").length>1?Swal.fire({title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"}).then((o=>{if(o.isConfirmed){var n=e.closest(".rule_row").dataset.rule_index,a=conditionrow.querySelector('[data-rule_index="'+(n-1)+'"]');null!=a&&(a.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),a.querySelector(".combinator").value=""),e.closest(".rule_row").remove(),h(t)}else o.isDenied&&(conditionrow.remove(),_())})):Swal.fire({title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((e=>{e.isConfirmed&&(t.remove(),_())}))}(a),a.classList.contains("showcopyfields")&&(a.checked?a.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):a.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),a.classList.contains("emailtrigger")){let e=a.closest(".clone_div").querySelector(".emailfieldcondition");"fieldchanged"==a.value?e.classList.remove("hidden"):e.classList.add("hidden")}a.classList.contains("fromemail")&&function(e){var t=e.closest(".clone_div").querySelector(".emailfromfixed"),o=e.closest(".clone_div").querySelector(".emailfromconditional");"fixed"==e.value?(t.classList.remove("hidden"),o.classList.add("hidden")):(o.classList.remove("hidden"),t.classList.add("hidden"))}(a),a.classList.contains("emailto")&&function(e){var t=e.closest(".clone_div").querySelector(".emailtofixed"),o=e.closest(".clone_div").querySelector(".emailtoconditional");"fixed"==e.value?(t.classList.remove("hidden"),o.classList.add("hidden")):(o.classList.remove("hidden"),t.classList.add("hidden"))}(a),(a.classList.contains("placeholderselect")||a.classList.contains("placeholders"))&&function(e){var t="";e.classList.contains("placeholders")?t=e.textContent:""!=e.value&&(t=e.value,e.selectedIndex="0"),""!=t&&(Swal.fire({icon:"success",title:"Copied "+t,showConfirmButton:!1,timer:1500}),navigator.clipboard.writeText(t))}(a),a.matches(".warn_cond")&&function(e){var t=FormFunctions.cloneNode(e.closest(".warning_conditions"));e.closest(".conditions_wrapper").insertAdjacentElement("beforeEnd",t),e.classList.add("active"),e.closest(".warning_conditions").querySelector(".combinator").value=e.value,v(e.closest(".conditions_wrapper"))}(a),a.matches(".remove_warn_cond")&&function(e){var t=e.closest(".warning_conditions");null==t.nextElementSibling&&(t.previousElementSibling.querySelector(".active").classList.remove("active"),t.previousElementSibling.querySelector(".combinator").value=""),t.remove(),v(e.closest(".conditions_wrapper"))}(a)})),window.addEventListener("change",(e=>{if(e.target.matches(".meta_key")){var t=e.target.list.querySelector("[value='"+e.target.value+"' i]").dataset.keys;if(null!=t){parent=e.target.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden");for(var o=parent.querySelector(".meta_key_index_list"),n=1;n<o.options.length;n++)o.options[n].remove();t.split(",").forEach((e=>{var t=document.createElement("option");t.value=e,o.appendChild(t)}))}}}))})();
//# sourceMappingURL=formbuilder.min.js.map