(()=>{var e,t,o,n,l;function i(){try{n.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element_id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){let t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(FormFunctions.removeDefaultSelect(e),null!=e._niceselect&&(e._niceselect.clear(),e._niceselect.update()))})),u(n.querySelector("form"))}catch(e){console.error(e)}}function a(e){e.querySelectorAll(".form_element_wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}async function r(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;let o=new FormData;o.append("formid",e.closest(".form_element_wrapper").dataset.formid),o.append("elementid",e.closest(".form_element_wrapper").dataset.id),o.append("new_width",t);let n=await FormSubmit.fetchRestApi("forms/edit_formfield_width",o);n&&(Main.hideModals(),Main.displayMessage(n))}}async function s(e){let t=e.parentNode,o=e.closest(".form_element_wrapper"),n=o.dataset.formid,l=o.dataset.id,i=e.closest("form");Main.showLoader(e);let r=t.querySelector(".loadergif");r.style.paddingRight="10px",r.classList.remove("loadergif");let s=new FormData;s.append("formid",n),s.append("elementindex",l);let c=await FormSubmit.fetchRestApi("forms/remove_element",s);c&&(o.remove(),a(i),Main.displayMessage(c))}async function c(t){if(e){let e={icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e)}else{e=!0;let o=parseInt(t.item.dataset.priority);a(t.item.closest("form"));let n=t.newIndex-t.oldIndex,l=new FormData;l.append("form_id",t.item.dataset.formid),l.append("el_id",t.item.dataset.id),l.append("old_index",o),l.append("new_index",o+n);let i=await FormSubmit.fetchRestApi("forms/reorder_form_elements",l);i&&(e=!1,Main.displayMessage(i))}}const d=new ResizeObserver((function(e){let t=e[0].target;if(null!=t.parentNode){var o=e[0].contentRect.width,n=Math.round(o/t.parentNode.offsetWidth*100);let i=t.querySelector(".widthpercentage");n<99?i.textContent=n+"%":null!=i&&(i.textContent=""),clearTimeout(l),l=setTimeout(r,500,t,n)}}));function m(e,t){switch(u(t),t.querySelectorAll(`.elementoption:not(.${e}, .reverse), .elementoption.not${e}`).forEach((e=>e.classList.replace("hide","hidden"))),t.querySelectorAll(`.elementoption.${e}`).forEach((e=>e.classList.replace("hidden","hide"))),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"] .elementtype').textContent=e;break;case"info":t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"radio":case"select":case"checkbox":case"datalist":case"php":default:break;case"p":t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"file":case"image":t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function u(e){e.querySelectorAll(".elementoption.reverse").forEach((e=>e.classList.replace("hidden","hide")))}function f(e){let t=FormFunctions.cloneNode(e),o=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=o,e.parentNode.insertBefore(t,e.nextSibling),p(e.closest(".condition_row"))}function p(e){let t=e.querySelectorAll(".element_conditions_wrapper .rule_row"),o=0;t.forEach((e=>{e.dataset.rule_index=o,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o))})),o++}))}function h(){let e=n.querySelectorAll(".element_conditions_wrapper .condition_row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function _(e){var t=e.querySelectorAll(".warning_conditions"),o=0;t.forEach((e=>{e.dataset.index=o,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,o)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,o)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,o))})),o++}))}e=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Formbuilder.js loaded");let e={handle:".movecontrol",animation:150,onEnd:c};document.querySelectorAll(".form_elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{d.observe(e)}))})),window.addEventListener("click",(e=>{let l=e.target;if(t=l.closest(".sim_form.wrapper"),o=l.closest(".form_element_wrapper"),null!=t&&(n=t.querySelector(".add_form_element_modal")),"showid"==l.name)!function(e){const o=new URL(window.location);"show"==e.dataset.action?(o.searchParams.set("showid","true"),t.querySelectorAll(".elid.hidden").forEach((e=>e.classList.remove("hidden"))),e.textContent="Hide ids",e.dataset.action="hide"):(o.searchParams.delete("showid"),t.querySelectorAll(".elid:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.textContent="Show ids",e.dataset.action="show"),window.history.pushState({},"",o)}(l);else if("showname"==l.name)!function(e){const o=new URL(window.location);"show"==e.dataset.action?(o.searchParams.set("showname","true"),t.querySelectorAll(".elname.hidden").forEach((e=>e.classList.remove("hidden"))),e.textContent="Hide names",e.dataset.action="hide"):(o.searchParams.delete("showid"),t.querySelectorAll(".elname:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.textContent="Show names",e.dataset.action="show"),window.history.pushState({},"",o)}(l);else if("submit_form_element"==l.name)e.stopPropagation(),async function(e){let t=e.closest("form"),o=await FormSubmit.submitForm(e,"forms/add_form_element");if(o){if(""==t.querySelector('[name="element_id"]').value){i();let e=document.querySelector(".form_elements .clicked");null==e&&(window.location.href=window.location.href+"&formbuilder=true"),e.classList.remove("clicked"),e.closest(".form_element_wrapper").insertAdjacentHTML("afterEnd",o.html),a(t),t.querySelectorAll(".resizer").forEach((e=>{d.observe(e)}))}else document.querySelector(".form_elements .clicked").closest(".form_element_wrapper").outerHTML=o.html;Main.hideModals(),Main.displayMessage(o.message)}}(l);else if("submit_form_condition"==l.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_element_conditions");t&&(Main.hideModals(),Main.displayMessage(t))}(l);else if("submit_form_setting"==l.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_form_settings");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(l);else if("submit_form_emails"==l.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_form_emails");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(l);else if("settings[autoarchive]"==l.name){let e=l.closest(".formsettings_wrapper").querySelector(".autoarchivelogic");"true"==l.value?e.classList.remove("hidden"):e.classList.add("hidden")}else"settings[save_in_meta]"==l.name?l.closest(".sim_form.builder").querySelector(".submit_others_form_wrapper").classList.toggle("hidden"):"formfield[mandatory]"==l.name&&l.checked&&(l.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0);if(l.classList.contains("edit_form_element")&&async function(e){e.classList.add("clicked");let t=o.dataset.id,l=e.closest(".form_element_wrapper").dataset.formid;n.querySelector('[name="element_id"]').value=o.dataset.id,n.originalhtml=e.outerHTML;let i=e.outerHTML,a=Main.showLoader(e);a.querySelector(".loadergif").style.margin="5px 19px 0px 19px";let r=new FormData;r.append("elementid",t),r.append("formid",l);let s=await FormSubmit.fetchRestApi("forms/request_form_element",r);s&&(null!=n.querySelector('[name="add_form_element_form"]')&&(n.querySelector('[name="add_form_element_form"]').innerHTML=s.elementForm,n.querySelectorAll(".wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),m(n.querySelector('[name="formfield[type]"]').value,n.querySelector('[name="add_form_element_form"]')),n.querySelector(".element_conditions_wrapper").innerHTML=s.conditionsHtml,n.querySelectorAll("select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})})),Main.showModal(n),a.outerHTML=i)}(l),l.classList.contains("remove_form_element")&&function(e){if("undefined"==typeof Swal)s(e);else{let t={title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),Swal.fire(t).then((t=>{t.isConfirmed&&s(e)}))}}(l),(l.classList.contains("add_form_element")||"createform"==l.name)&&async function(e){e.classList.add("clicked");let t=e.dataset.formid;null==t&&(t=null!=e.closest(".form_element_wrapper")?e.closest(".form_element_wrapper").dataset.formid:document.querySelector('input[type=hidden][name="formid"').value),i(),n.querySelectorAll(".hide").forEach((e=>e.classList.replace("hide","hidden"))),null!=o&&(n.querySelector('[name="insertafter"]').value=o.dataset.priority),n.querySelector('[name="submit_form_element"]').textContent=n.querySelector('[name="submit_form_element"]').textContent.replace("Change","Add"),n.querySelector(".element_conditions_wrapper").innerHTML=`<img src="${sim.loadingGif}" style="display:block; margin:0px auto 0px auto;">`,Main.showModal(n);var l=new FormData;l.append("elementid","-1"),l.append("formid",t);var a=await FormSubmit.fetchRestApi("forms/request_form_conditions_html",l);n.querySelector(".element_conditions_wrapper").innerHTML=a,n.querySelectorAll(".condition_select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}(l),null!=l.closest(".elementtype")&&(m(l.dataset.value,l.closest("form")),"label"==l.dataset.value&&(l.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0)),null!=l.closest(".equation")&&function(e){e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule_row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("checked"))&&e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(l),(l.classList.contains("and_rule")||l.classList.contains("or_rule"))&&function(e){let t=e.closest(".rule_row"),o=t.querySelector(".active");if(null==o||e.classList.contains("active"))f(t),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent;else{let n="OR",l="AND";"AND"==o.textContent&&(n="AND",l="OR");let i={title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:`Change ${n} to ${l}`,denyButtonText:"Add a new rule"};null!=document.fullscreenElement&&(i.target=document.fullscreenElement),Swal.fire(i).then((n=>{n.isConfirmed?(o.classList.remove("active"),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent):n.isDenied&&f(t)}))}}(l),l.classList.contains("add_condition")&&function(e){let t,o=e.closest(".condition_row");e.classList.contains("opposite")?(t=FormFunctions.cloneNode(o,!1),t=function(e,t){return e.querySelectorAll(".element_condition").forEach((function(e){if("SELECT"==e.tagName&&e.classList.contains("equation")){FormFunctions.removeDefaultSelect(e);let o=t.closest(".condition_row").querySelector(".equation").selectedIndex;o&&(o%2?e.options[o+1].defaultSelected=!0:e.options[o-1].defaultSelected=!0),e._niceselect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(e.checked?e.checked=!1:e.checked=!0)})),e}(t,e)):t=FormFunctions.cloneNode(o);let n=parseInt(o.dataset.condition_index)+1;t.dataset.condition_index=n,e.classList.contains("opposite")||t.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")}));let l={};if(o.querySelectorAll('input[type="radio"]:checked').forEach((e=>{l[e.value]=e.value})),o.parentNode.insertBefore(t,o.nextSibling),!e.classList.contains("opposite")){let e=t.querySelectorAll(".rule_row").length;t.querySelectorAll(".rule_row").forEach((function(t){t.dataset.rule_index!=e-1?t.remove():p(t.closest(".condition_row"))}))}h(),o.querySelectorAll('input[type="radio"]').forEach((e=>{null!=l[e.value]&&(e.checked=!0)})),e.style.display="none"}(l),l.classList.contains("remove_condition")&&function(e){let t=e.closest(".condition_row");if(t.querySelectorAll(".rule_row").length>1){let o={title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"};null!=document.fullscreenElement&&(o.target=document.fullscreenElement),Swal.fire(o).then((o=>{if(o.isConfirmed){let o=e.closest(".rule_row"),n=parseInt(o.dataset.rule_index),l=t.querySelector('[data-rule_index="'+(n-1)+'"]');null!=l&&(null==t.querySelector(`[data-rule_index="${n+1}"]`)&&l.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),l.querySelector(".combinator").value=""),e.closest(".rule_row").remove(),p(t)}else o.isDenied&&(t.remove(),h())}))}else{let e={title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e).then((e=>{e.isConfirmed&&(t.remove(),h())}))}}(l),l.classList.contains("showcopyfields")&&(l.checked?l.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):l.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),l.classList.contains("emailtrigger")){let e=l.closest(".clone_div").querySelector(".emailfieldcondition");"fieldchanged"==l.value?e.classList.remove("hidden"):e.classList.add("hidden")}l.classList.contains("fromemail")&&function(e){let t=e.closest(".clone_div").querySelector(".emailfromfixed"),o=e.closest(".clone_div").querySelector(".emailfromconditional");"fixed"==e.value?(t.classList.remove("hidden"),o.classList.add("hidden")):(o.classList.remove("hidden"),t.classList.add("hidden"))}(l),l.classList.contains("emailto")&&function(e){let t=e.closest(".clone_div").querySelector(".emailtofixed"),o=e.closest(".clone_div").querySelector(".emailtoconditional");"fixed"==e.value?(t.classList.remove("hidden"),o.classList.add("hidden")):(o.classList.remove("hidden"),t.classList.add("hidden"))}(l),(l.classList.contains("placeholderselect")||l.classList.contains("placeholders"))&&function(e){let t="";if(e.classList.contains("placeholders")?t=e.textContent:""!=e.value&&(t=e.value,e.selectedIndex="0"),""!=t){let e={icon:"success",title:"Copied "+t,showConfirmButton:!1,timer:1500};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),navigator.clipboard.writeText(t)}}(l),l.matches(".warn_cond")&&function(e){let t=FormFunctions.cloneNode(e.closest(".warning_conditions"));e.closest(".conditions_wrapper").insertAdjacentElement("beforeEnd",t),e.classList.add("active"),e.closest(".warning_conditions").querySelector(".combinator").value=e.value,_(e.closest(".conditions_wrapper"))}(l),l.matches(".remove_warn_cond")&&function(e){let t=e.closest(".warning_conditions");null==t.nextElementSibling&&(t.previousElementSibling.querySelector(".active").classList.remove("active"),t.previousElementSibling.querySelector(".combinator").value=""),t.remove(),_(e.closest(".conditions_wrapper"))}(l),l.matches(".permissins-rights-form")&&l.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden")})),window.addEventListener("change",(e=>{if(e.target.matches(".meta_key")){let t=e.target.list.querySelector("[value='"+e.target.value+"' i]").dataset.keys;if(null!=t){parent=e.target.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden");let o=parent.querySelector(".meta_key_index_list");for(let e=1;e<o.options.length;e++)o.options[e].remove();t.split(",").forEach((e=>{let t=document.createElement("option");t.value=e,o.appendChild(t)}))}}e.target.matches("[name*='[property_value]']")&&(numericElements.includes(e.target.value)?e.target.closest(".condition_form").querySelectorAll(".addition.hidden").forEach((e=>e.classList.remove("hidden"))):e.target.closest(".condition_form").querySelectorAll(".addition:not(.hidden)").forEach((e=>e.classList.add("hidden"))))}))})();
//# sourceMappingURL=formbuilder.min.js.map