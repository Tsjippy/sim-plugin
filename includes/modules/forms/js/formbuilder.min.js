(()=>{function e(){try{modal.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element_id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){var t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(FormFunctions.removeDefaultSelect(e),null!=e._niceselect&&(e._niceselect.clear(),e._niceselect.update()))})),s(modal.querySelector("form"))}catch(e){console.error(e)}}function t(e){e.querySelectorAll(".form_element_wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}async function o(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;var o=new FormData;o.append("formid",e.closest(".form_element_wrapper").dataset.formid),o.append("elementid",e.closest(".form_element_wrapper").dataset.id),o.append("new_width",t),response=await FormSubmit.fetchRestApi("forms/edit_formfield_width",o),response&&(Main.hideModals(),Main.displayMessage(response))}}async function n(e){var o=e.parentNode,n=e.closest(".form_element_wrapper"),a=n.dataset.formid,r=n.dataset.id,l=e.closest("form");Main.showLoader(e);var i=o.querySelector(".loadergif");i.style.paddingRight="10px",i.classList.remove("loadergif");var s=new FormData;s.append("formid",a),s.append("elementindex",r),response=await FormSubmit.fetchRestApi("forms/remove_element",s),response&&(n.remove(),t(l),Main.displayMessage(response))}async function a(e){if(0==reorderingBusy){reorderingBusy=!0;var o=parseInt(e.item.dataset.priority);t(e.item.closest("form"));var n=e.newIndex-e.oldIndex,a=new FormData;a.append("formid",e.item.dataset.formid),a.append("old_index",o),a.append("new_index",o+n);var r=await FormSubmit.fetchRestApi("forms/reorder_form_elements",a);r&&(reorderingBusy=!1,Main.displayMessage(r))}else Swal.fire({icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"})}var r;const l=new ResizeObserver((function(e){var t=e[0].target;if(null!=t.parentNode){var n=e[0].contentRect.width,a=Math.round(n/t.parentNode.offsetWidth*100),l=t.querySelector(".widthpercentage");a<99?l.textContent=a+"%":null!=l&&(l.textContent=""),clearTimeout(r),r=setTimeout(o,500,t,a)}}));function i(e,t){switch(s(t),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"]').classList.replace("hidden","hide"),t.querySelector('[name="labeltext"] .elementtype').textContent=e,t.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hide","hidden")}));break;case"info":t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"radio":case"select":case"checkbox":case"datalist":t.querySelector('[name="valuelist"]').classList.replace("hidden","hide"),t.querySelector('[name="select_options"]').classList.replace("hidden","hide"),t.querySelector('[name="defaults"]').classList.replace("hidden","hide"),"select"!=e&&t.querySelector('[name="multiple"]').classList.replace("hide","hidden");break;case"p":t.querySelectorAll('[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"php":t.querySelectorAll('[name="elementname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="functionname"]').classList.replace("hidden","hide");break;case"file":case"image":t.querySelectorAll('[name="functionname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="defaults"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="upload-options"]').classList.replace("hidden","hide"),t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function s(e){e.querySelectorAll(".hide").forEach((function(e){e.classList.replace("hide","hidden")})),e.querySelector('[name="multiple"]').classList.replace("hidden","hide"),e.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hidden","hide")}))}function c(e){var t=FormFunctions.cloneNode(e),o=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=o,e.parentNode.insertBefore(t,e.nextSibling),d(e.closest(".condition_row"))}function d(e){var t=e.querySelectorAll(".element_conditions_wrapper .rule_row"),o=0;t.forEach((e=>{e.dataset.rule_index=o,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o))})),o++}))}function m(){var e=modal.querySelectorAll(".element_conditions_wrapper .condition_row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function u(e){var t=e.querySelectorAll(".warning_conditions"),o=0;t.forEach((e=>{e.dataset.index=o,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,o)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,o)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,o))})),o++}))}reorderingBusy=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Formbuilder.js loaded");var e={handle:".movecontrol",animation:150,onEnd:a};document.querySelectorAll(".form_elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{l.observe(e)}))})),window.addEventListener("click",(o=>{var a=o.target;if(formWrapper=a.closest(".sim_form.wrapper"),formElementWrapper=a.closest(".form_element_wrapper"),null!=formWrapper&&(modal=formWrapper.querySelector(".add_form_element_modal")),"editform"==a.name&&function(e){"show"==e.dataset.action?(formWrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.remove("hidden"),e.textContent="Hide form edit controls",e.dataset.action="hide"})),formWrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.add("show")})),formWrapper.querySelector('[name="submit_form"]').classList.add("hidden")):(formWrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.add("hidden"),e.textContent="Show form edit controls",e.dataset.action="show"})),formWrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.remove("show")})),formWrapper.querySelector('[name="submit_form"]').classList.remove("hidden"))}(a),(a.classList.contains("add_form_element")||"createform"==a.name)&&async function(t){t.classList.add("clicked");var o=t.dataset.formid;null==o&&(o=null!=t.closest(".form_element_wrapper")?t.closest(".form_element_wrapper").dataset.formid:document.querySelector('input[type=hidden][name="formid"').value),e(),null!=formElementWrapper&&(modal.querySelector('[name="insertafter"]').value=formElementWrapper.dataset.priority),modal.querySelector('[name="submit_form_element"]').textContent=modal.querySelector('[name="submit_form_element"]').textContent.replace("Update","Add"),modal.querySelector(".element_conditions_wrapper").innerHTML='<img src="'+sim.loadingGif+'" style="display:block; margin:0px auto 0px auto;">',modal.classList.remove("hidden");var n=new FormData;n.append("elementid","-1"),n.append("formid",o);var a=await FormSubmit.fetchRestApi("forms/request_form_conditions_html",n);modal.querySelector(".element_conditions_wrapper").innerHTML=a,modal.querySelectorAll(".condition_select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}(a),"submit_form_element"==a.name&&(o.stopPropagation(),async function(o){console.log(o);var n=o.closest("form"),a=await FormSubmit.submitForm(o,"forms/add_form_element");if(a){if(""==n.querySelector('[name="element_id"]').value){e();var r=document.querySelector(".form_elements .clicked");null==r&&(window.location.href=window.location.href+"&formbuilder=true"),r.classList.remove("clicked"),r.closest(".form_element_wrapper").insertAdjacentHTML("afterEnd",a.html),t(n),n.querySelectorAll(".resizer").forEach((e=>{l.observe(e)}))}else document.querySelector(".form_elements .clicked").closest(".form_element_wrapper").outerHTML=a.html;Main.hideModals(),Main.displayMessage(a.message)}}(a)),"submit_form_condition"==a.name&&async function(e){var t=await FormSubmit.submitForm(e,"forms/save_element_conditions");t&&(Main.hideModals(),Main.displayMessage(t))}(a),"submit_form_setting"==a.name&&async function(e){var t=await FormSubmit.submitForm(e,"forms/save_form_settings");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(a),"submit_form_emails"==a.name&&async function(e){var t=await FormSubmit.submitForm(e,"forms/save_form_emails");t&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(t))}(a),a.classList.contains("edit_form_element")&&async function(e){e.classList.add("clicked");var t=formElementWrapper.dataset.id,o=e.closest(".form_element_wrapper").dataset.formid;modal.querySelector('[name="element_id"]').value=formElementWrapper.dataset.id,modal.originalhtml=e.outerHTML;var n=e.outerHTML,a=Main.showLoader(e);a.querySelector(".loadergif").style.margin="5px 19px 0px 19px";var r=new FormData;r.append("elementid",t),r.append("formid",o);var l=await FormSubmit.fetchRestApi("forms/request_form_element",r);l&&(null!=modal.querySelector('[name="add_form_element_form"]')&&(modal.querySelector('[name="add_form_element_form"]').innerHTML=l.elementForm,modal.querySelectorAll(".wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),i(modal.querySelector('[name="formfield[type]"]').value,modal.querySelector('[name="add_form_element_form"]')),modal.querySelector(".element_conditions_wrapper").innerHTML=l.conditionsHtml,modal.querySelectorAll("select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})})),modal.classList.remove("hidden"),a.outerHTML=n)}(a),a.classList.contains("remove_form_element")&&function(e){"undefined"==typeof Swal?n(e):Swal.fire({title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((t=>{t.isConfirmed&&n(e)}))}(a),null!=a.closest(".elementtype")&&(i(a.dataset.value,a.closest("form")),"label"==a.dataset.value&&(a.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0)),null!=a.closest(".equation")&&function(e){e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule_row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("checked"))&&e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(a),(a.classList.contains("and_rule")||a.classList.contains("or_rule"))&&function(e){var t=e.closest(".rule_row"),o=t.querySelector(".active");if(null==o||e.classList.contains("active"))c(t),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent;else{if("AND"==o.textContent)var n="AND",a="OR";else n="OR",a="AND";Swal.fire({title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:`Change ${n} to ${a}`,denyButtonText:"Add a new rule"}).then((n=>{n.isConfirmed?(o.classList.remove("active"),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent):n.isDenied&&c(t)}))}}(a),a.classList.contains("add_condition")&&function(e){var t=e.closest(".condition_row");e.classList.contains("opposite")?clone=FormFunctions.cloneNode(t,!1):clone=FormFunctions.cloneNode(t);var o=parseInt(t.dataset.condition_index)+1;clone.dataset.condition_index=o,e.classList.contains("opposite")||clone.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")})),e.classList.contains("opposite")&&clone.querySelectorAll(".element_condition").forEach((function(e){if("SELECT"==e.tagName&&e.classList.contains("equation")){FormFunctions.removeDefaultSelect(e);var o=t.querySelector(".equation").selectedIndex;0!=o&&(o%2?e.options[o+1].defaultSelected=!0:e.options[o-1].defaultSelected=!0),e._niceselect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(0==e.checked?e.checked=!0:e.checked=!1)}));var n={};if(t.querySelectorAll('input[type="radio"]:checked').forEach((e=>{n[e.value]=e.value})),t.parentNode.insertBefore(clone,t.nextSibling),!e.classList.contains("opposite")){var a=clone.querySelectorAll(".rule_row").length;clone.querySelectorAll(".rule_row").forEach((function(e){e.dataset.rule_index!=a-1?e.remove():d(e.closest(".condition_row"))}))}m(),t.querySelectorAll('input[type="radio"]').forEach((e=>{null!=n[e.value]&&(e.checked=!0)})),e.style.display="none"}(a),a.classList.contains("remove_condition")&&function(e){var t=e.closest(".condition_row");t.querySelectorAll(".rule_row").length>1?Swal.fire({title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"}).then((o=>{if(o.isConfirmed){var n=e.closest(".rule_row").dataset.rule_index,a=conditionrow.querySelector('[data-rule_index="'+(n-1)+'"]');null!=a&&(a.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),a.querySelector(".combinator").value=""),e.closest(".rule_row").remove(),d(t)}else o.isDenied&&(conditionrow.remove(),m())})):Swal.fire({title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((e=>{e.isConfirmed&&(t.remove(),m())}))}(a),a.classList.contains("showcopyfields")&&(a.checked?a.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):a.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),a.classList.contains("emailtrigger")&&(el=a.closest(".clone_div").querySelector(".emailfieldcondition"),"fieldchanged"==a.value?el.classList.remove("hidden"):el.classList.add("hidden")),a.classList.contains("fromemail")&&(div1=a.closest(".clone_div").querySelector(".emailfromfixed"),div2=a.closest(".clone_div").querySelector(".emailfromconditional"),"fixed"==a.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),a.classList.contains("emailto")&&(div1=a.closest(".clone_div").querySelector(".emailtofixed"),div2=a.closest(".clone_div").querySelector(".emailtoconditional"),"fixed"==a.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),a.classList.contains("placeholderselect")||a.classList.contains("placeholders")){var r="";a.classList.contains("placeholders")?r=a.textContent:""!=a.value&&(r=a.value,a.selectedIndex="0"),""!=r&&(Swal.fire({icon:"success",title:"Copied "+r,showConfirmButton:!1,timer:1500}),navigator.clipboard.writeText(r))}if("settings[autoarchive]"==a.name&&(el=a.closest(".formsettings_wrapper").querySelector(".autoarchivelogic"),"true"==a.value?el.classList.remove("hidden"):el.classList.add("hidden")),"settings[save_in_meta]"==a.name&&a.closest(".sim_form.builder").querySelector(".submit_others_form_wrapper").classList.toggle("hidden"),"formfield[mandatory]"==a.name&&a.checked&&(a.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0),a.matches(".warn_cond")){var s=FormFunctions.cloneNode(a.closest(".warning_conditions"));a.closest(".conditions_wrapper").insertAdjacentElement("beforeEnd",s),a.classList.add("active"),a.closest(".warning_conditions").querySelector(".combinator").value=a.value,u(a.closest(".conditions_wrapper"))}if(a.matches(".remove_warn_cond")){var f=a.closest(".warning_conditions");null==f.nextElementSibling&&(console.log(f.previousElementSibling),f.previousElementSibling.querySelector(".active").classList.remove("active"),f.previousElementSibling.querySelector(".combinator").value=""),f.remove(),u(a.closest(".conditions_wrapper"))}})),window.addEventListener("change",(e=>{if(e.target.matches(".meta_key")){var t=e.target.list.querySelector("[value='"+e.target.value+"' i]").dataset.keys;if(null!=t){parent=e.target.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden");for(var o=parent.querySelector(".meta_key_index_list"),n=1;n<o.options.length;n++)o.options[n].remove();t.split(",").forEach((e=>{var t=document.createElement("option");t.value=e,o.appendChild(t)}))}}}))})();
//# sourceMappingURL=formbuilder.min.js.map