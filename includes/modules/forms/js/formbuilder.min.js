(()=>{function e(e,t){try{modal.querySelector(".element_conditions_wrapper").innerHTML=t.conditions_html,modal.querySelectorAll(".condition_select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}catch(e){console.error(e)}}function t(){try{modal.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element_id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){var t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(remove_default_select(e),null!=e._niceselect&&(e._niceselect.clear(),e._niceselect.update()))})),i(modal.querySelector("form"))}catch(e){console.error(e)}}var o;window.after_form_element_submit=function(e,o){try{if(e.status>=200&&e.status<400){t();var r=document.createElement("template");r.innerHTML=o.html;var l=r.content.firstChild;referenceNode=document.querySelector("form#sim_form_"+o.formname+' .form_elements [data-priority="'+(parseInt(o.index)-1)+'"]'),null==referenceNode?document.querySelector("form#sim_form_"+o.formname+" .form_elements").insertAdjacentElement("beforeend",l):referenceNode.parentNode.insertBefore(l,referenceNode.nextSibling),d(document.querySelector("form#sim_form_"+o.formname)),n.observe(l)}}catch(e){console.error(e)}},window.update_form_element=function(e,t){try{e.status>=200&&e.status<400&&document.querySelectorAll("form#sim_form_"+t.formid+' .form_elements [data-id="'+t.index+'"]').forEach((e=>e.outerHTML=t.html))}catch(e){console.error(e)}},window.conditions_html=e,window.prefillforminput=function(o,n){try{if(o.status>=200&&o.status<400){t(),e(0,n),function(e,t){try{modal.querySelector("#warning_conditions_form").innerHTML=t.warning_conditions,modal.querySelectorAll("#warning_conditions_form select").forEach((function(e){e._niceselect=NiceSelect.bind(e,{searchable:!0})}))}catch(e){console.error(e)}}(0,n);var r=n.original,l=modal.querySelector("form");a(r.type,l),modal.querySelectorAll(".formbuilder").forEach((function(e){if(null!=e.name){var t=e.name.replace("formfield[","").replace("]","");null!=r[t]&&""!=r[t]&&("checkbox"==e.type?1==r[t]&&(e.checked=!0):e.value=r[t],"select-one"==e.type&&e.selectedOptions.length>0&&(e.selectedOptions[0].defaultSelected=!0,"undefined"!=e._niceselect&&e._niceselect.update()),e.classList.contains("wp-editor-area")&&tinyMCE.get(e.id).setContent(r[t]))}})),modal.querySelector('[name="element_id"]').value=n.element_id,modal.querySelector('[name="submit_form_element"]').textContent=modal.querySelector('[name="submit_form_element"]').textContent.replace("Add","Update"),modal.classList.remove("hidden");var i=document.querySelector('.form_element_wrapper[data-id="'+n.element_id+'"][data-formid="'+n.formid+'"] .loadergif'),c=document.createElement("template");c.innerHTML=modal.originalhtml;var s=c.content.firstChild;i.parentNode.replaceChild(s,i)}else console.log(o)}catch(e){console.error(e)}},window.removerow=function(e,t){try{if(e.status>=200&&e.status<400){var o=document.querySelector('[data-formid="'+t.formid+'"][data-id="'+t.elementindex+'"]'),n=o.closest("form");o.remove(),d(n)}}catch(e){console.error(e)}},window.after_reorder=function(e,t){try{reordering_busy=!1}catch(e){console.error(e)}};const n=new ResizeObserver((function(e){var t=e[0].target;if(null!=t.parentNode){var n=e[0].contentRect.width,l=Math.round(n/t.parentNode.offsetWidth*100),a=t.querySelector(".widthpercentage");l<99?a.textContent=l+"%":null!=a&&(a.textContent=""),clearTimeout(o),o=setTimeout(r,500,t,l)}}));function r(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;var o=document.querySelector('[name="remove_form_element_nonce"]').value,n=new FormData;n.append("action","edit_formfield_width"),n.append("formid",e.closest(".form_element_wrapper").dataset.formid),n.append("elementid",e.closest(".form_element_wrapper").dataset.id),n.append("new_width",t),n.append("remove_form_element_nonce",o),sendAJAX(n)}}function l(e){if(0==reordering_busy){reordering_busy=!0;var t=parseInt(e.item.dataset.priority);d(e.item.closest("form"));var o=e.newIndex-e.oldIndex,n=document.querySelector('[name="remove_form_element_nonce"]').value,r=new FormData;r.append("action","reorder_form_elements"),r.append("formid",e.item.dataset.formid),r.append("old_index",t),r.append("new_index",t+o),r.append("remove_form_element_nonce",n),sendAJAX(r)}else Swal.fire({icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"})}function a(e,t){switch(i(t),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"]').classList.replace("hidden","hide"),t.querySelector('[name="labeltext"] .elementtype').textContent=e,t.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hide","hidden")}));break;case"info":t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"radio":case"select":case"checkbox":case"datalist":t.querySelector('[name="valuelist"]').classList.replace("hidden","hide"),t.querySelector('[name="select_options"]').classList.replace("hidden","hide"),t.querySelector('[name="defaults"]').classList.replace("hidden","hide"),"select"!=e&&t.querySelector('[name="multiple"]').classList.replace("hide","hidden");break;case"p":t.querySelectorAll('[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="infotext"]').classList.replace("hidden","hide"),t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"php":t.querySelectorAll('[name="elementname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="multiple"],[name="defaults"],[name="elementoptions"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="functionname"]').classList.replace("hidden","hide");break;case"file":case"image":t.querySelectorAll('[name="functionname"],[name="infotext"],[name="labeltext"],[name="wrap"],[name="defaults"]').forEach((e=>e.classList.add("hidden"))),t.querySelector('[name="upload-options"]').classList.replace("hidden","hide"),t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function i(e){e.querySelectorAll(".hide").forEach((function(e){e.classList.replace("hide","hidden")})),e.querySelector('[name="multiple"]').classList.replace("hidden","hide"),e.querySelectorAll(".labelhide").forEach((function(e){e.classList.replace("hidden","hide")}))}function c(e){var t=e.parentNode,o=e.closest(".form_element_wrapper"),n=o.dataset.formid,r=o.dataset.id;showLoader(e),t.querySelector(".loadergif").style.paddingRight="10px";var l=document.querySelector('[name="remove_form_element_nonce"]').value,a=new FormData;a.append("action","remove_formfield"),a.append("formid",n),a.append("elementindex",r),a.append("remove_form_element_nonce",l),sendAJAX(a)}function s(e){var t=clone_node(e),o=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=o,e.parentNode.insertBefore(t,e.nextSibling),m(e.closest(".condition_row"))}function d(e){e.querySelectorAll(".form_element_wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}function m(e){var t=e.querySelectorAll(".element_conditions_wrapper .rule_row"),o=0;t.forEach((e=>{e.dataset.rule_index=o,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+o))})),o++}))}function u(){var e=modal.querySelectorAll(".element_conditions_wrapper .condition_row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element_conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function f(){modal.scrollTo(0,0),modal.querySelector('[name="add_form_element_form"] .nice-select').focus(),callback=null}function p(){var e=document.querySelectorAll("#conditions_wrapper .warning_conditions"),t=0;e.forEach((e=>{e.dataset.index=t,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,t)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,t)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,t))})),t++}))}reordering_busy=!1,document.addEventListener("DOMContentLoaded",(function(){console.log("Formbuilder.js loaded");var e={handle:".movecontrol",animation:150,onEnd:l};document.querySelectorAll(".form_elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{n.observe(e)}))})),window.addEventListener("click",(e=>{var o=e.target;if(formwrapper=o.closest(".sim_form.wrapper"),form_element_wrapper=o.closest(".form_element_wrapper"),null!=formwrapper&&(modal=formwrapper.querySelector(".add_form_element_modal")),"editform"==o.name&&function(e){"show"==e.dataset.action?(formwrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.remove("hidden"),e.textContent="Hide form edit controls",e.dataset.action="hide"})),formwrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.add("show")})),formwrapper.querySelector('[name="submit_form"]').classList.add("hidden")):(formwrapper.querySelectorAll(".formfieldbutton").forEach((function(t){t.classList.add("hidden"),e.textContent="Show form edit controls",e.dataset.action="show"})),formwrapper.querySelectorAll(".resizer").forEach((function(e){e.classList.remove("show")})),formwrapper.querySelector('[name="submit_form"]').classList.remove("hidden"))}(o),(o.classList.contains("add_form_element")||"createform"==o.name)&&function(e){var o=document.querySelector('[name="request_form_element_nonce"]').value,n=e.dataset.formname;null==n&&(n=e.closest(".form_element_wrapper").dataset.formname),t(),null!=form_element_wrapper&&(modal.querySelector('[name="insertafter"]').value=form_element_wrapper.dataset.priority),modal.querySelector('[name="submit_form_element"]').textContent=modal.querySelector('[name="submit_form_element"]').textContent.replace("Update","Add"),modal.querySelector(".element_conditions_wrapper").innerHTML='<img src="'+sim.loading_gif+'" style="display:block; margin:0px auto 0px auto;">';var r=new FormData;r.append("action","request_form_conditions_html"),r.append("elementindex","-1"),r.append("request_form_element_nonce",o),r.append("formname",n),sendAJAX(r),modal.classList.remove("hidden")}(o),"submit_form_element"==o.name&&(callback=f),o.classList.contains("edit_form_element")&&function(e){var t=form_element_wrapper.dataset.id,o=document.querySelector('[name="request_form_element_nonce"]').value,n=e.closest(".form_element_wrapper").dataset.formid;modal.querySelector('[name="element_id"]').value=form_element_wrapper.dataset.id,modal.originalhtml=e.outerHTML;var r=e.parentNode;showLoader(e),r.querySelector(".loadergif").style.margin="5px 19px 0px 19px";var l=new FormData;l.append("action","request_form_elements"),l.append("elementid",t),l.append("request_form_element_nonce",o),l.append("formid",n),sendAJAX(l)}(o),o.classList.contains("remove_form_element")&&function(e){"undefined"==typeof Swal?c(e):Swal.fire({title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((t=>{t.isConfirmed&&c(e)}))}(o),null!=o.closest(".elementtype")&&(a(o.dataset.value,o.closest("form")),"label"==o.dataset.value&&(o.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0)),null!=o.closest(".equation")&&function(e){e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule_row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule_row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("checked"))&&e.closest(".rule_row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(o),(o.classList.contains("and_rule")||o.classList.contains("or_rule"))&&function(e){var t=e.closest(".rule_row"),o=t.querySelector(".active");if(null==o||e.classList.contains("active"))s(t),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent;else{if("AND"==o.textContent)var n="AND",r="OR";else n="OR",r="AND";Swal.fire({title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Change "+n+" to "+r,denyButtonText:"Add a new rule"}).then((n=>{n.isConfirmed?(o.classList.remove("active"),e.classList.add("active"),t.querySelector(".combinator").value=e.textContent):n.isDenied&&s(t)}))}}(o),o.classList.contains("add_condition")&&function(e){var t=e.closest(".condition_row");e.classList.contains("opposite")?clone=clone_node(t,!1):clone=clone_node(t);var o=parseInt(t.dataset.condition_index)+1;clone.dataset.condition_index=o,e.classList.contains("opposite")||clone.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")})),e.classList.contains("opposite")&&clone.querySelectorAll(".element_condition").forEach((function(e){if("SELECT"==e.tagName&&e.classList.contains("equation")){remove_default_select(e);var o=t.querySelector(".equation").selectedIndex;0!=o&&(o%2?e.options[o+1].defaultSelected=!0:e.options[o-1].defaultSelected=!0),e._niceselect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(0==e.checked?e.checked=!0:e.checked=!1)}));var n={};if(t.querySelectorAll('input[type="radio"]:checked').forEach((e=>{n[e.value]=e.value})),t.parentNode.insertBefore(clone,t.nextSibling),!e.classList.contains("opposite")){var r=clone.querySelectorAll(".rule_row").length;clone.querySelectorAll(".rule_row").forEach((function(e){e.dataset.rule_index!=r-1?e.remove():m(e.closest(".condition_row"))}))}u(),t.querySelectorAll('input[type="radio"]').forEach((e=>{null!=n[e.value]&&(e.checked=!0)})),e.style.display="none"}(o),o.classList.contains("remove_condition")&&function(e){var t=e.closest(".condition_row");t.querySelectorAll(".rule_row").length>1?Swal.fire({title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"}).then((o=>{if(o.isConfirmed){var n=e.closest(".rule_row").dataset.rule_index,r=t.querySelector('[data-rule_index="'+(n-1)+'"]');null!=r&&(r.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),r.querySelector(".combinator").value=""),e.closest(".rule_row").remove(),m(t)}else o.isDenied&&(t.remove(),u())})):Swal.fire({title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((e=>{e.isConfirmed&&(t.remove(),u())}))}(o),o.classList.contains("showcopyfields")&&(o.checked?o.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):o.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),o.classList.contains("emailtrigger")&&(el=o.closest(".clone_div").querySelector(".emailfieldcondition"),"fieldchanged"==o.value?el.classList.remove("hidden"):el.classList.add("hidden")),o.classList.contains("fromemail")&&(div1=o.closest(".clone_div").querySelector(".emailfromfixed"),div2=o.closest(".clone_div").querySelector(".emailfromconditional"),"fixed"==o.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),o.classList.contains("emailto")&&(div1=o.closest(".clone_div").querySelector(".emailtofixed"),div2=o.closest(".clone_div").querySelector(".emailtoconditional"),"fixed"==o.value?(div1.classList.remove("hidden"),div2.classList.add("hidden")):(div2.classList.remove("hidden"),div1.classList.add("hidden"))),o.classList.contains("placeholderselect")||o.classList.contains("placeholders")){var n="";o.classList.contains("placeholders")?n=o.textContent:""!=o.value&&(n=o.value,o.selectedIndex="0"),""!=n&&(Swal.fire({icon:"success",title:"Copied "+n,showConfirmButton:!1,timer:1500}),navigator.clipboard.writeText(n))}if("settings[autoarchive]"==o.name&&(el=o.closest(".formsettings_wrapper").querySelector(".autoarchivelogic"),"true"==o.value?el.classList.remove("hidden"):el.classList.add("hidden")),"settings[save_in_meta]"==o.name&&o.closest(".sim_form.builder").querySelector(".submit_others_form_wrapper").classList.toggle("hidden"),"formfield[mandatory]"==o.name&&o.checked&&(o.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0),o.matches(".warn_cond")){var r=clone_node(o.closest(".warning_conditions"));document.getElementById("conditions_wrapper").insertAdjacentElement("beforeEnd",r),o.classList.add("active"),o.closest(".warning_conditions").querySelector(".combinator").value=o.value,p()}o.matches(".remove_warn_cond")&&(o.closest(".warning_conditions").remove(),p())})),window.addEventListener("change",(e=>{if(e.target.matches(".meta_key")){var t=e.target.list.querySelector("[value='"+e.target.value+"' i]").dataset.keys;if(null!=t){parent=e.target.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden"),console.log(parent);var o=parent.querySelector(".meta_key_index_list");console.log(o);for(var n=1;n<o.options.length;n++)o.options[n].remove();t.split(",").forEach((e=>{var t=document.createElement("option");t.value=e,o.appendChild(t)}))}}}))})();
//# sourceMappingURL=formbuilder.min.js.map