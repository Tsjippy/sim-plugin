{"version":3,"file":"forms_table.min.js","mappings":"MAyDAA,eAAeC,EAAgBC,GAW9B,aAVmBC,KAAKC,KAAK,CAC5BC,MAAO,gBACPH,KAAM,4BAA4BA,UAClCI,KAAM,UACNC,kBAAkB,EAClBC,mBAAoB,UACpBC,kBAAmB,OACnBC,kBAAmB,QAAQR,WAGdS,YA0Gf,SAASC,EAAoBC,EAAQC,GACpC,IAAIZ,EAES,WAAVY,GACFA,EAAU,YACVZ,EAAO,cAEPY,EAAU,UACVZ,EAAO,WAERW,EAAOE,UAAY,kBAAkBD,sCAA2CA,oBAAyBA,MAAWZ,aAGrHF,eAAegB,EAAaC,GAC3B,IACIC,EADUD,EAAOE,QAAQ,SACRC,QAAQC,OACtBC,EAAeL,EAAOE,QAAQ,MAAMC,QAAQG,GAC/CC,EAAUP,EAAOG,QAAQK,MACtBC,EAAWT,EAAOG,QAAQG,GAC7BI,EAAYV,EAAOW,YAEpBC,KAAKC,WAAWb,EAAOc,YAE1Bd,EAAOG,QAAQY,QAAYL,EAE3B,IAAIM,EAAW,IAAIC,SAChBD,EAASE,OAAO,SAAUjB,GAC1Be,EAASE,OAAO,eAAgBb,GACnCW,EAASE,OAAO,QAASX,GACtBS,EAASE,OAAO,YAAaT,GAEhC,IAYyCU,EACrCC,EAGAC,EAhBAC,QAAiBC,WAAWC,aAAa,uBAAwBR,GAElEM,IACFtB,EAAOyB,UAAaH,EAUjBF,GADqCD,EAPPnB,GAQf0B,iBAAiB,yBAGhCL,EAAWM,KAAKC,MAAMT,EAAKhB,QAAQ0B,UAGnCC,MAAMC,QAAQV,KACjBA,EAAW,CAACA,IAGbD,EAAOY,SAAQ,CAACC,EAAWC,KAC1B,IAAIC,EAAMd,EAASa,GACG,GAAnBb,EAASe,QAAeF,EAAQ,IAClCC,EAAMd,EAAS,IAGK,YAAlBY,EAAUI,MAAwC,SAAlBJ,EAAUI,KACzCJ,EAAUK,OAASH,EAAII,SACzBN,EAAUO,SAAU,GAEK,UAAlBP,EAAUI,KAClBJ,EAAUQ,cAAc,iBAAiBN,EAAI,MAAMO,UAAW,EAE9DT,EAAUK,MAAQH,EAGE,cAAlBF,EAAUI,OACZJ,EAAUU,YAAcC,WAAWC,KAAKZ,EAAU,CAACa,YAAY,KAIhEb,EAAUc,iBAAiB,SAAS,SAASC,GACtB,KAAlBA,EAAMC,SACTC,EAAuBF,EAAMhD,WAK/BmD,SAASJ,iBAAiB,QAASK,GAEd,YAAlBnB,EAAUI,MAAuC,GAAjBjB,EAAOgB,SACpB,QAAlBH,EAAUI,KACZJ,EAAUc,iBAAiB,OAAQG,GAEnCjB,EAAUc,iBAAiB,SAAUG,GAGtCjB,EAAUoB,YApDXF,SAASJ,iBAAiB,QAASK,IAyDrC,SAASA,EAAyBJ,GACA,MAA9BA,EAAMhD,OAAOE,QAAQ,OAA+D,MAA9C8C,EAAMhD,OAAOE,QAAQ,MAAMC,QAAQY,UAE3EuC,KAAKC,oBAAoB,QAASC,UAAUC,QAC5CP,EAAuBC,SAASV,cAAc,oBAKhD,IAAIiB,GAAU,EACd3E,eAAemE,EAAuBlD,GAMrC,GAJoB2D,MAAjB3D,EAAOA,SACTA,EAASA,EAAOA,QAGd0D,GAAW1D,GAA0B,IAAhBA,EAAOsC,MAA/B,CAGAoB,EAAU1D,EAEV4D,YAAW,WAAYF,GAAU,IAAS,KAE1C,IAAIG,EAAU7D,EAAOE,QAAQ,SACzBD,EAAW4D,EAAM1D,QAAQC,OACzBe,EAASnB,EAAOE,QAAQ,MACrBO,EAAWU,EAAKhB,QAAQG,GAC3BgC,EAAUwB,cAAcC,cAAc/D,EAAQmB,GAAM,GACpDd,EAAeL,EAAOE,QAAQ,MAAMC,QAAQG,GAC5CC,EAAUY,EAAKhB,QAAQK,MAM3B,GAHA2C,SAASI,oBAAoB,QAASH,GAGlCd,GAASX,KAAKC,MAAMT,EAAKhB,QAAQ0B,UAAU,CAC9CjB,KAAKC,WAAWM,EAAKL,YAGrB,IAAIE,EAAW,IAAIC,SACnBD,EAASE,OAAO,SAAUjB,GAC1Be,EAASE,OAAO,eAAgBb,GACpBsD,MAATpD,GACFS,EAASE,OAAO,QAASX,GAE1BS,EAASE,OAAO,YAAaT,GAC7BO,EAASE,OAAO,WAAYoB,GAE5B,IAAIhB,QAAiBC,WAAWC,aAAa,mBAAoBR,GAEjE,GAAGM,EAAS,CACX,IAAI0C,EAAW1C,EAAS2C,SAET,IAAZD,IAAgBA,EAAW,KAGlB,MAATzD,GACFP,EAAS6D,EAAMnC,iBAAiB,eAAerB,mBAA8BI,QACtEuB,SAAQkC,IAAKA,EAAGzC,UAAYuC,KAEnC7C,EAAKM,UAAYuC,EAGlBpD,KAAKuD,eAAe7C,EAAS8C,eAG9BC,QAAQC,IAAIhC,GACZnB,EAAKM,UAAYN,EAAKhB,QAAQY,QAGF4C,MAA1B3D,EAAOG,QAAQY,gBACVf,EAAOG,QAAQY,SAIxBoC,SAASJ,iBAAiB,SAASC,IAClC,IAAIhD,EAASgD,EAAMhD,OAwBnB,GAtBkB,yBAAfA,EAAOuE,MApTXxF,eAAkCiB,GACjC,IAAIsB,QAAiBC,WAAWiD,WAAWxE,EAAQ,8BAEhDsB,IACFV,KAAKuD,eAAe7C,GACpBmD,SAASC,UAgTTC,CAAmB3E,GAGF,wBAAfA,EAAOuE,MA/SXxF,eAAiCiB,GAChC,IAAIsB,QAAiBC,WAAWiD,WAAWxE,EAAQ,6BAEhDsB,GACFV,KAAKuD,eAAe7C,GA4SpBsD,CAAkB5E,GAIhBA,EAAO6E,QAAQ,+BA9RnB9F,eAAgCiB,GAC/B,GAAGhB,EAAgB,UAAU,CAC5B,IAAIqB,EAAeL,EAAOE,QAAQ,MAAMC,QAAQG,GAC5CuD,EAAU7D,EAAOE,QAAQ,SAEzBc,EAAW,IAAIC,SACnBD,EAASE,OAAO,eAAgBb,GAGhCO,KAAKC,WAAWb,SAEKuB,WAAWC,aAAa,0BAA2BR,IAGvE6C,EAAMnC,iBAAiB,uBAAuBrB,OAAkB2B,SAC/D8C,GAAKA,EAAIC,YAgRXC,CAAiBhF,GAGfA,EAAO6E,QAAQ,+DA7QnB9F,eAAiCiB,GAChC,IAAI6D,EAAU7D,EAAOE,QAAQ,SACzB+E,EAAYjF,EAAOE,QAAQ,MAC3BG,EAAe4E,EAAS9E,QAAQG,GAChC4E,GAAY,EACZrF,EAAWG,EAAOsC,MAElBtB,EAAa,IAAIC,SAMrB,GALAD,EAASE,OAAO,SAAU2C,EAAM1D,QAAQC,QACxCY,EAASE,OAAO,eAAgBb,GAChCW,EAASE,OAAO,SAAUrB,GAGG8D,MAA1BsB,EAAS9E,QAAQK,MAAmB,CACtC0E,GAAW,EAEX,IAAI5D,QAAiBpC,KAAKC,KAAK,CAC9BC,MAAO,uBAAuBS,KAC9BZ,KAAM,kBAAkBY,wCACxBR,KAAM,WACN8F,gBAAgB,EAChB7F,kBAAkB,EAClBG,kBAAmB,gBACnB2F,eAAgB,oBAChB7F,mBAAoB,YAQrB,GALI+B,EAAS5B,aACZsB,EAASE,OAAO,QAAS+D,EAAS9E,QAAQK,OAIxCc,EAAS+D,YACX,OAIF,KAAGH,GACclG,EAAgBa,MAQjCe,KAAKC,WAAWb,SAEKuB,WAAWC,aAAa,2BAA4BR,IAE7D,CACX,MAAMsE,EAAS,IAAIC,MAAM,IAAIC,gBAAgBC,OAAOhB,SAASiB,QAAS,CACrEC,IAAK,CAACC,EAAcC,IAASD,EAAaD,IAAIE,KAInB,MAAzB7E,EAAS2E,IAAI,SACf9B,EAAMnC,iBAAiB,uBAAuBrB,OAAkB2B,SAAQ8C,IAEjD,QAAnBQ,EAAOQ,SAETnG,EADamF,EAAIrC,cAAc,oBAAoB5C,GACvBA,GAE5BiF,EAAIC,YAKNlB,EAAMnC,iBAAiB,uBAAuBrB,mBAA8B4E,EAAS9E,QAAQK,WAAWwB,SAAQ8C,IAEzF,QAAnBQ,EAAOQ,SAETnG,EADamF,EAAIrC,cAAc,kBACH5C,GAE5BiF,EAAIC,aAoMPgB,CAAkB/F,GAGhBA,EAAO6E,QAAQ,+BACjBY,OAAOhB,SAASuB,KAAOP,OAAOhB,SAASuB,KAAKC,MAAM,KAAK,GAAG,wBAAwBpC,MAAM1D,QAAQG,GAAG,kBAAkB4F,UAAUzD,cAAc,eAAe9B,aAI3I,8BAAfX,EAAOuE,KAAqC,CAC9C,IAAI4B,EAAKnG,EAAOE,QAAQ,yBAAyBuC,cAAc,qBAC5C,QAAhBzC,EAAOsC,MACT6D,EAAGC,UAAUrB,OAAO,UAEpBoB,EAAGC,UAAUC,IAAI,UAKhBrG,EAAOoG,UAAUE,SAAS,gCAC5BnD,SAASV,cAAc,kCAAkC2D,UAAUrB,OAAO,UAI3E,IAAIb,EAAKlE,EAAOE,QAAQ,MACrBF,EAAO6E,QAAQ,wBAAoD,MAA1B7E,EAAOG,QAAQY,SAC1DiC,EAAMuD,kBACNxG,EAAaC,IACC,MAANkE,GAAyC,MAA1BlE,EAAOG,QAAQY,SAAmBmD,EAAGW,QAAQ,wBAA4C,SAAlB7E,EAAOwG,SAAwC,KAAlBxG,EAAOwG,SAAoC,YAAlBxG,EAAOwG,UAA0BxG,EAAOE,QAAQ,kBACpM8C,EAAMuD,kBACNxG,EAAaC,EAAOE,QAAQ,QAI1BF,EAAOoG,UAAUE,SAAS,oBACP,QAAlBtG,EAAOwG,UACTxG,EAASA,EAAOyC,cAAc,QAI5BzC,EAAOyG,WAAW5B,QAAQ,MAjZ/B9F,eAA0BoC,GAEzB,IAAI0C,EAAS1C,EAAKjB,QAAQ,SACtBwG,EAAY7C,EAAM8C,KACtB,IAAK,MAAMC,KAAWF,EACrBE,EAAQC,MAAM1F,EAAK2F,WAAWV,UAAUC,IAAI,UAK7ClF,EAAKjB,QAAQ,kBAAkBuC,cAAc,kBAAkB2D,UAAUrB,OAAO,UAGhF,IAAI/D,EAAW,IAAIC,SACnBD,EAASE,OAAO,SAAU2C,EAAM1D,QAAQC,QACxCY,EAASE,OAAO,cAAeC,EAAKb,UAE9BiB,WAAWC,aAAa,yBAA0BR,GAiYtD+F,CAAW/G,EAAOyG,YAGfzG,EAAOoG,UAAUE,SAAS,YAC5BtG,EAAOoG,UAAUY,QAAQ,UAAU,aACnChH,EAAOiH,IAAMjH,EAAOiH,IAAID,QAAQ,cAAc,iBAC9ChH,EAAOE,QAAQ,2BAA2BuC,cAAc,mBAAmBH,MAAQ,SAEnFtC,EAAOoG,UAAUY,QAAQ,YAAY,WACrChH,EAAOiH,IAAMjH,EAAOiH,IAAID,QAAQ,gBAAgB,eAChDhH,EAAOE,QAAQ,2BAA2BuC,cAAc,mBAAmBH,MAAQ,SAKnFtC,EAAO6E,QAAQ,mBA7YnB9F,eAAiCiB,GAEhCA,EAAOE,QAAQ,kBAAkBuC,cAAc,kBAAkB2D,UAAUC,IAAI,UAG/E,IAAIxC,EAAS7D,EAAOE,QAAQ,kBAAkBuC,cAAc,SAC5DoB,EAAMnC,iBAAiB,wBAAwBM,SAAQmE,GAAIA,EAAGC,UAAUrB,OAAO,YAG/E,IAAI/D,EAAW,IAAIC,SACnBD,EAASE,OAAO,SAAU2C,EAAM1D,QAAQC,QAExC,IAAIkB,QAAiBC,WAAWC,aAAa,2BAA4BR,GAEtEM,IACFV,KAAKuD,eAAe7C,GACpBmD,SAASC,UA8XTwC,CAAkBlH,MAIpBmD,SAASJ,iBAAiB,oBAAmB,WAG5C,GAFAsB,QAAQC,IAAI,wBAEW,oBAAd,SAA0B,CAElC,IAAI6C,EAAU,CACbC,OAAQ,eACRC,UAAW,KAGZlE,SAASzB,iBAAiB,kCAAkCM,SAAQmE,IACnEmB,SAASC,OAAOpB,EAAIgB,UAKvBhE,SAASJ,iBAAiB,UAAUC,IACnC,IAAIhD,EAASgD,EAAMhD,OAEH,sBAAbA,EAAOM,KACT6C,SAASzB,iBAAiB,sBAAsBM,SAAQmE,IACvDA,EAAGC,UAAUC,IAAI,aAElBlD,SAASqE,eAAexH,EAAOsC,OAAO8D,UAAUrB,OAAO,UAGvD0C,kBAAkBC,qB","sources":["webpack://forms/./forms_table.js"],"sourcesContent":["async function hideColumn(cell){\n\t// Hide the column\n\tvar table\t\t= cell.closest('table');\n\tvar tableRows\t= table.rows;\n\tfor (const element of tableRows) {\n\t\telement.cells[cell.cellIndex].classList.add('hidden')\n\t}\n\n\t//show the reset button\n\n\tcell.closest('.table-wrapper').querySelector('.reset-col-vis').classList.remove('hidden');\n\n\t// store as preference\n\tvar formData\t= new FormData();\n\tformData.append('formid', table.dataset.formid);\n\tformData.append('column_name', cell.id);\n\t\n\tawait FormSubmit.fetchRestApi('forms/save_table_prefs', formData);\n}\n\nasync function showHiddenColumns(target){\n\t//hiden the reset button\n\ttarget.closest('.table-wrapper').querySelector('.reset-col-vis').classList.add('hidden');\n\n\t// Show the columns again\n\tvar table\t\t= target.closest('.table-wrapper').querySelector('table');\n\ttable.querySelectorAll('th.hidden, td.hidden').forEach(el=>el.classList.remove('hidden'));\n\n\t// store as preference\n\tvar formData\t= new FormData();\n\tformData.append('formid', table.dataset.formid);\n\n\tvar response\t= await FormSubmit.fetchRestApi('forms/delete_table_prefs', formData);\n\n\tif(response){\n\t\tMain.displayMessage(response);\n\t\tlocation.reload();\n\t}\n}\n\nasync function saveColumnSettings(target){\n\tvar response = await FormSubmit.submitForm(target, 'forms/save_column_settings');\n\n\tif(response){\n\t\tMain.displayMessage(response);\n\t\tlocation.reload();\n\t}\n}\n\nasync function saveTableSettings(target){\n\tvar response = await FormSubmit.submitForm(target, 'forms/save_table_settings');\n\n\tif(response){\n\t\tMain.displayMessage(response);\n\t}\n}\n\nasync function askConfirmation(text){\n\tvar result = await Swal.fire({\n\t\ttitle: 'Are you sure?',\n\t\ttext: `Are you sure you want to ${text} this?`,\n\t\ticon: 'warning',\n\t\tshowCancelButton: true,\n\t\tconfirmButtonColor: \"#bd2919\",\n\t\tcancelButtonColor: '#d33',\n\t\tconfirmButtonText: `Yes, ${text} it!`\n\t});\n\n\treturn result.isConfirmed;\n}\n\nasync function removeSubmission(target){\n\tif(askConfirmation('delete')){\t\t\n\t\tvar submissionId\t= target.closest('tr').dataset.id;\n\t\tvar table\t\t\t= target.closest('table');\n\n\t\tvar formData = new FormData();\n\t\tformData.append('submissionid', submissionId);\n\t\t\n\t\t//display loading gif\n\t\tMain.showLoader(target);\n\n\t\tvar response\t= await FormSubmit.fetchRestApi('forms/remove_submission', formData);\n\n\t\tif(response){\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"]`).forEach(\n\t\t\t\trow=>row.remove()\n\t\t\t);\n\t\t}\n\t}\n}\n\nasync function archiveSubmission(target){\t\n\tvar table\t\t\t= target.closest('table');\n\tvar tableRow\t\t= target.closest('tr');\n\tvar submissionId\t= tableRow.dataset.id;\n\tvar showSwal\t\t= true;\n\tvar action\t\t\t= target.value;\n\n\tvar formData \t\t= new FormData();\n\tformData.append('formid', table.dataset.formid);\n\tformData.append('submissionid', submissionId);\n\tformData.append('action', action);\n\t\n\t// Ask whether to archive one piece or the whole\n\tif(tableRow.dataset.subid != undefined){\n\t\tshowSwal = false;\n\t\t\n\t\tlet response = await Swal.fire({\n\t\t\ttitle: `What do you want to ${action}?`,\n\t\t\ttext: `Do you want to ${action} just this one or the whole request?`,\n\t\t\ticon: 'question',\n\t\t\tshowDenyButton: true,\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonText: 'Just this one',\n\t\t\tdenyButtonText: 'The whole request',\n\t\t\tconfirmButtonColor: \"#bd2919\",\n\t\t});\n\n\t\tif (response.isConfirmed) {\n\t\t\tformData.append('subid', tableRow.dataset.subid);\n\t\t}\n\t\t\n\t\t// skip if denied\n\t\tif(response.isDismissed){\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\tif(showSwal){\n\t\tvar confirmed = askConfirmation(action);\n\n\t\tif(!confirmed){\n\t\t\treturn;\n\t\t}\n\t}\n\n\t//display loading gif\n\tMain.showLoader(target);\n\t\n\tlet response\t= await FormSubmit.fetchRestApi('forms/archive_submission', formData);\n\n\tif(response){\n\t\tconst params = new Proxy(new URLSearchParams(window.location.search), {\n\t\t\tget: (searchParams, prop) => searchParams.get(prop),\n\t\t});\n\t\t\n\t\t// Delete all\n\t\tif(formData.get('subid') == null){\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"]`).forEach(row=>{\n\t\t\t\t// just change the button name\n\t\t\t\tif(params.archived == 'true'){\n\t\t\t\t\tvar loader = row.querySelector('.loaderwrapper, .'+action);\n\t\t\t\t\tchangeArchiveButton(loader, action);\n\t\t\t\t}else{\n\t\t\t\t\trow.remove();\n\t\t\t\t}\n\t\t\t});\n\t\t// Only delete subid\n\t\t}else{\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"][data-subid=\"${tableRow.dataset.subid}\"]`).forEach(row=>{\n\t\t\t\t// just change the button name\n\t\t\t\tif(params.archived == 'true'){\n\t\t\t\t\tvar loader = row.querySelector('.loaderwrapper');\n\t\t\t\t\tchangeArchiveButton(loader, action);\n\t\t\t\t}else{\n\t\t\t\t\trow.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n}\n\nfunction changeArchiveButton(loader, action){\n\tvar text;\n\n\tif(action == 'archive'){\n\t\taction \t= 'unarchive';\n\t\ttext\t= 'Unarchive';\n\t}else{\n\t\taction \t= 'archive';\n\t\ttext\t= 'Archive';\n\t}\n\tloader.outerHTML = `<button class=\"${action} button forms_table_action\" name=\"${action}_action\" value=\"${action}\">${text}</button>`;\n}\n\nasync function getInputHtml(target){\n\tvar table\t\t\t= target.closest('table');\n\tvar formId\t\t\t= table.dataset.formid;\n    var submissionId\t= target.closest('tr').dataset.id;\n\tvar subId\t\t\t= target.dataset.subid;\n    var cellId\t\t\t= target.dataset.id\n\tvar oldText\t\t\t= target.textContent;\n    \n    Main.showLoader(target.firstChild);\n\t\n\ttarget.dataset.oldtext\t \t= oldText;\n\n\tvar formData = new FormData();\n    formData.append('formid', formId);\n    formData.append('submissionid', submissionId);\n\tformData.append('subid', subId);\n    formData.append('fieldname', cellId);\n\n\tvar response\t= await FormSubmit.fetchRestApi('forms/get_input_html', formData);\n\n\tif(response){\n\t\ttarget.innerHTML\t = response;\n\n\t\taddFormsTableInputEventListeners(target);\n\n\t\t//add a listener for clicks outside the cell\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\n\t}\n}\n\nfunction addFormsTableInputEventListeners(cell){\n\tvar inputs\t\t= cell.querySelectorAll('input,select,textarea');\n\n\t// get old value\n\tvar oldValue\t= JSON.parse(cell.dataset.oldvalue);\n\n\t// make it an array if not an array\n\tif(!Array.isArray(oldValue)){\n\t\toldValue = [oldValue];\n\t}\n\t\t\n\tinputs.forEach((inputNode, index)=>{\n\t\tvar val\t= oldValue[index];\n\t\tif(oldValue.length == 1 && index > 0){\n\t\t\tval\t= oldValue[0];\n\t\t}\n\n\t\tif(inputNode.type == 'checkbox' || inputNode.type == 'radio'){\n\t\t\tif(inputNode.value == val.trim()){\n\t\t\t\tinputNode.checked = true;\n\t\t\t}\n\t\t}else if(inputNode.type == 'select'){\n\t\t\tinputNode.querySelector('option[value=\"'+val+'\"]').selected = true;\n\t\t}else{\n\t\t\tinputNode.value\t= val;\n\t\t}\n\t\t\n\t\tif(inputNode.type == 'select-one'){\n\t\t\tinputNode._niceselect = NiceSelect.bind(inputNode,{searchable: true});\n\t\t}\n\t\t\n\t\t//Add a keyboard\n\t\tinputNode.addEventListener(\"keyup\", function(event){\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\tprocessFormsTableInput(event.target);\n\t\t\t}\n\t\t});\n\t\t\n\t\t//add a listener for clicks outside the cell\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\n\t\t\n\t\tif(inputNode.type != 'checkbox' || inputs.length == 1){\n\t\t\tif(inputNode.type == 'date'){\n\t\t\t\tinputNode.addEventListener(\"blur\", processFormsTableInput);\n\t\t\t}else{\n\t\t\t\tinputNode.addEventListener(\"change\", processFormsTableInput);\n\t\t\t}\n\t\t\t\n\t\t\tinputNode.focus();\n\t\t}\n\t});\n}\n\nfunction outsideFormsTableClicked(event){\n\tif(event.target.closest('td') == null || event.target.closest('td').dataset.oldtext == null){\n\t\t//remove as soon as we come here\n\t\tthis.removeEventListener(\"click\", arguments.callee);\n\t\tprocessFormsTableInput(document.querySelector('[data-oldtext]'));\n\t}\n}\n\n//function to get the temp input value and save it over AJAX\nvar running = false;\nasync function processFormsTableInput(target){\t\n\t// target is an event\n\tif(target.target != undefined){\n\t\ttarget = target.target;\n\t}\n\t\n\tif(running == target || target.value == ''){\n\t\treturn;\n\t}\n\trunning = target;\n\t\n\tsetTimeout(function(){ running = false;}, 500);\t\n\n\tvar table\t\t\t= target.closest('table');\n\tvar formId\t\t\t= table.dataset.formid;\n\tvar cell\t\t\t= target.closest('td');\n    var cellId\t\t\t= cell.dataset.id\n\tvar value\t\t\t= FormFunctions.getFieldValue(target, cell, false);\n\tvar submissionId\t= target.closest('tr').dataset.id;\n\tvar subId\t\t\t= cell.dataset.subid;\n\t\n\t//remove all event listeners\n\tdocument.removeEventListener(\"click\", outsideFormsTableClicked);\n\t\n\t//Only update when needed\n\tif (value != JSON.parse(cell.dataset.oldvalue)){\n\t\tMain.showLoader(cell.firstChild);\n\t\t\n\t\t// Submit new value and receive the filtered value back\n\t\tvar formData = new FormData();\n\t\tformData.append('formid', formId);\n\t\tformData.append('submissionid', submissionId);\n\t\tif(subId != undefined){\n\t\t\tformData.append('subid', subId);\n\t\t}\n\t\tformData.append('fieldname', cellId);\n\t\tformData.append('newvalue', value);\n\t\t\n\t\tvar response\t= await FormSubmit.fetchRestApi('forms/edit_value', formData);\n\t\n\t\tif(response){\n\t\t\tvar newValue = response.newvalue;\n\t\t\t//Replace the input element with its value\n\t\t\tif(newValue == \"\") newValue = \"X\";\n\t\n\t\t\t//Update all occurences of this field\n\t\t\tif(subId == null){\n\t\t\t\ttarget\t= table.querySelectorAll(`tr[data-id=\"${submissionId}\"] td[data-id=\"${cellId}\"]`);\n\t\t\t\ttarget.forEach(td=>{td.innerHTML = newValue;});\n\t\t\t}else{\n\t\t\t\tcell.innerHTML = newValue;\n\t\t\t}\n\t\n\t\t\tMain.displayMessage(response.message)\n\t\t}\n\t}else{\n\t\tconsole.log(value)\n\t\tcell.innerHTML = cell.dataset.oldtext;\n\t}\n\n\tif(target.dataset.oldtext != undefined){\n\t\tdelete target.dataset.oldtext;\n\t}\n}\n\ndocument.addEventListener(\"click\", event=>{\n\tvar target = event.target;\n\n\tif(target.name == 'submit_column_setting'){\n\t\tsaveColumnSettings(target);\n\t}\n\n\tif(target.name == 'submit_table_setting'){\n\t\tsaveTableSettings(target);\n\t}\n\n\t//Actions\n\tif(target.matches('.delete.forms_table_action')){\n\t\tremoveSubmission(target);\n\t}\n\n\tif(target.matches('.archive.forms_table_action, .unarchive.forms_table_action')){\n\t\tarchiveSubmission(target);\n\t}\n\n\tif(target.matches('.print.forms_table_action')){\n\t\twindow.location.href = window.location.href.split('?')[0]+\"?print=true&table_id=\"+table.dataset.id+\"&submission_id=\"+table_row.querySelector(\"[id='id' i]\").textContent;\n\t}\n\t\n\t//show auto archive fields\n\tif(target.name == 'form_settings[autoarchive]'){\n\t\tlet el = target.closest('.table_rights_wrapper').querySelector('.autoarchivelogic');\n\t\tif(target.value == 'true'){\n\t\t\tel.classList.remove('hidden');\n\t\t}else{\n\t\t\tel.classList.add('hidden');\n\t\t}\n\t}\n\t\n\t//Open settings modal\n\tif(target.classList.contains('edit_formshortcode_settings')){\n\t\tdocument.querySelector('.modal.form_shortcode_settings').classList.remove('hidden');\n\t}\n\t\n\t//Edit data\n\tvar td = target.closest('td');\n\tif(target.matches('td.edit_forms_table') && target.dataset.oldtext == null){\n\t\tevent.stopPropagation();\n\t\tgetInputHtml(target);\n\t}else if(td != null  && target.dataset.oldtext == null && td.matches('td.edit_forms_table') && target.tagName != 'INPUT' && target.tagName != 'A' && target.tagName != 'TEXTAREA' && !target.closest('.nice-select') ){\n\t\tevent.stopPropagation();\n\t\tgetInputHtml(target.closest('td'));\n\t}\n\t\n\t//Hide column\n\tif(target.classList.contains('visibilityicon')){\n\t\tif(target.tagName == 'SPAN'){\n\t\t\ttarget = target.querySelector('img');\n\t\t}\n\n\t\t// Table itself\n\t\tif(target.parentNode.matches('th')){\n\t\t\thideColumn(target.parentNode);\n\t\t// Table settings\n\t\t}else{\n\t\t\tif(target.classList.contains('visible')){\n\t\t\t\ttarget.classList.replace('visible','invisible');\n\t\t\t\ttarget.src\t= target.src.replace('visible.png','invisible.png');\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'hide';\n\t\t\t}else{\n\t\t\t\ttarget.classList.replace('invisible','visible');\n\t\t\t\ttarget.src\t= target.src.replace('invisible.png','visible.png');\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'show';\n\t\t\t}\n\t\t}\n\t}\n\n\tif(target.matches('.reset-col-vis')){\n\t\tshowHiddenColumns(target);\n\t}\n});\n\ndocument.addEventListener(\"DOMContentLoaded\",function() {\n\tconsole.log(\"Formstable.js loaded\");\n\t\n\tif(typeof(Sortable) != 'undefined'){\n\t\t//Make the sortable_column_settings_rows div sortable\n\t\tvar options = {\n\t\t\thandle: '.movecontrol',\n\t\t\tanimation: 150,\n\t\t};\n\n\t\tdocument.querySelectorAll('.sortable_column_settings_rows').forEach(el=>{\n\t\t\tSortable.create(el, options);\n\t\t});\n\t}\n});\n\ndocument.addEventListener('change', event=>{\n\tvar target = event.target;\n\n\tif(target.id == 'sim-forms-selector'){\n\t\tdocument.querySelectorAll('.main_form_wrapper').forEach(el=>{\n\t\t\tel.classList.add('hidden');\n\t\t});\n\t\tdocument.getElementById(target.value).classList.remove('hidden');\n\n\t\t// position table\n\t\tSimTableFunctions.positionTable();\n\t}\n});"],"names":["async","askConfirmation","text","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","changeArchiveButton","loader","action","outerHTML","getInputHtml","target","formId","closest","dataset","formid","submissionId","id","subId","subid","cellId","oldText","textContent","Main","showLoader","firstChild","oldtext","formData","FormData","append","cell","inputs","oldValue","response","FormSubmit","fetchRestApi","innerHTML","querySelectorAll","JSON","parse","oldvalue","Array","isArray","forEach","inputNode","index","val","length","type","value","trim","checked","querySelector","selected","_niceselect","NiceSelect","bind","searchable","addEventListener","event","keyCode","processFormsTableInput","document","outsideFormsTableClicked","focus","this","removeEventListener","arguments","callee","running","undefined","setTimeout","table","FormFunctions","getFieldValue","newValue","newvalue","td","displayMessage","message","console","log","name","submitForm","location","reload","saveColumnSettings","saveTableSettings","matches","row","remove","removeSubmission","tableRow","showSwal","showDenyButton","denyButtonText","isDismissed","params","Proxy","URLSearchParams","window","search","get","searchParams","prop","archived","archiveSubmission","href","split","table_row","el","classList","add","contains","stopPropagation","tagName","parentNode","tableRows","rows","element","cells","cellIndex","hideColumn","replace","src","showHiddenColumns","options","handle","animation","Sortable","create","getElementById","SimTableFunctions","positionTable"],"sourceRoot":""}