{"version":3,"file":"forms_table.min.js","mappings":"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","sources":["webpack://forms/./forms_table.js"],"sourcesContent":["async function hideColumn(cell){\n\t// Hide the column\n\tvar table\t\t= cell.closest('table');\n\tvar tablerows\t= table.rows;\n\tfor (let i = 0; i < tablerows.length; i++) {\n\t\ttablerows[i].cells[cell.cellIndex].classList.add('hidden')\n\t}\n\n\t//show the reset button\n\n\tcell.closest('.form-table-wrapper').querySelector('.reset-col-vis').classList.remove('hidden');\n\n\t// store as preference\n\tvar formdata\t= new FormData();\n\tformdata.append('formid', table.dataset.formid);\n\tformdata.append('column_name', cell.id);\n\t\n\tvar response\t= await fetchRestApi('forms/save_table_prefs', formdata);\n}\n\nasync function showHiddenColumns(target){\n\t//hiden the reset button\n\ttarget.closest('.form-table-wrapper').querySelector('.reset-col-vis').classList.add('hidden');\n\n\t// Show the columns again\n\tvar table\t\t= target.closest('.form-table-wrapper').querySelector('table');\n\ttable.querySelectorAll('th.hidden, td.hidden').forEach(el=>el.classList.remove('hidden'));\n\n\t// store as preference\n\tvar formdata\t= new FormData();\n\tformdata.append('formid', table.dataset.formid);\n\n\tvar response\t= await fetchRestApi('forms/delete_table_prefs', formdata);\n\n\tif(response){\n\t\tdisplay_message(response);\n\t\tlocation.reload();\n\t}\n}\n\nasync function saveColumnSettings(target){\n\tvar response = await submitForm(target, 'forms/save_column_settings');\n\n\tif(response){\n\t\tdisplay_message(response);\n\t\tlocation.reload();\n\t}\n}\n\nasync function saveTableSettings(target){\n\tvar response = await submitForm(target, 'forms/save_table_settings');\n\n\tif(response){\n\t\tdisplay_message(response);\n\t}\n}\n\nasync function askConfirmation(text){\n\tvar result = await Swal.fire({\n\t\ttitle: 'Are you sure?',\n\t\ttext: `Are you sure you want to ${text} this?`,\n\t\ticon: 'warning',\n\t\tshowCancelButton: true,\n\t\tconfirmButtonColor: \"#bd2919\",\n\t\tcancelButtonColor: '#d33',\n\t\tconfirmButtonText: `Yes, ${text} it!`\n\t});\n\n\treturn result.isConfirmed;\n}\n\nasync function removeSubmission(target){\n\tif(askConfirmation('delete')){\t\t\n\t\tvar submissionid\t= target.closest('tr').dataset.id;\n\t\tvar table\t\t\t= target.closest('table');\n\n\t\tvar formdata = new FormData();\n\t\tformdata.append('submissionid', submissionid);\n\t\t\n\t\t//display loading gif\n\t\tshowLoader(target);\n\n\t\tvar response\t= await fetchRestApi('forms/remove_submission', formdata);\n\n\t\tif(response){\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionid}\"]`).forEach(\n\t\t\t\trow=>row.remove()\n\t\t\t);\n\t\t}\n\t}\n};\n\nasync function archiveSubmission(target){\t\n\tvar table\t\t\t= target.closest('table');\n\tvar table_row\t\t= target.closest('tr');\n\tvar submissionid\t= table_row.dataset.id;\n\tvar show_swal\t\t= true;\n\tvar action\t\t\t= target.value;\n\n\tvar formdata \t\t= new FormData();\n\tformdata.append('formid', table.dataset.formid);\n\tformdata.append('submissionid', submissionid);\n\tformdata.append('action', action);\n\t\n\t// Ask whether to archive one piece or the whole\n\tif(table_row.dataset.subid != undefined){\n\t\tshow_swal = false;\n\t\t\n\t\tvar response = await Swal.fire({\n\t\t\ttitle: `What do you want to ${action}?`,\n\t\t\ttext: `Do you want to ${action} just this one or the whole request?`,\n\t\t\ticon: 'question',\n\t\t\tshowDenyButton: true,\n\t\t\tshowCancelButton: true,\n\t\t\tconfirmButtonText: 'Just this one',\n\t\t\tdenyButtonText: 'The whole request',\n\t\t\tconfirmButtonColor: \"#bd2919\",\n\t\t});\n\n\t\tif (response.isConfirmed) {\n\t\t\tformdata.append('subid', table_row.dataset.subid);\n\t\t}\n\t\t\n\t\t// skip if denied\n\t\tif(response.isDismissed){\n\t\t\treturn;\n\t\t}\n\t}\n\t\n\tif(show_swal == true){\n\t\tvar confirmed = askConfirmation(action);\n\n\t\tif(!confirmed){\n\t\t\treturn;\n\t\t}\n\t}\n\n\t//display loading gif\n\tshowLoader(target);\n\t\n\tvar response\t= await fetchRestApi('forms/archive_submission', formdata);\n\n\tif(response){\n\t\tconst params = new Proxy(new URLSearchParams(window.location.search), {\n\t\t\tget: (searchParams, prop) => searchParams.get(prop),\n\t\t});\n\t\t\n\t\t// Delete all\n\t\tif(formdata.get('subid') == null){\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionid}\"]`).forEach(row=>{\n\t\t\t\t// just change the button name\n\t\t\t\tif(params.archived == 'true'){\n\t\t\t\t\tvar loader = row.querySelector('.loaderwrapper, .'+action);\n\t\t\t\t\tchangeArchiveButton(loader, action);\n\t\t\t\t}else{\n\t\t\t\t\trow.remove();\n\t\t\t\t}\n\t\t\t});\n\t\t// Only delete subid\n\t\t}else{\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionid}\"][data-subid=\"${table_row.dataset.subid}\"]`).forEach(row=>{\n\t\t\t\t// just change the button name\n\t\t\t\tif(params.archived == 'true'){\n\t\t\t\t\tvar loader = row.querySelector('.loaderwrapper');\n\t\t\t\t\tchangeArchiveButton(loader, action);\n\t\t\t\t}else{\n\t\t\t\t\trow.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n};\n\nfunction changeArchiveButton(loader, action){\n\tif(action == 'archive'){\n\t\taction \t= 'unarchive';\n\t\ttext\t= 'Unarchive';\n\t}else{\n\t\taction \t= 'archive';\n\t\ttext\t= 'Archive';\n\t}\n\tloader.outerHTML = `<button class=\"${action} button forms_table_action\" name=\"${action}_action\" value=\"${action}\">${text}</button>`;\n}\n\nasync function getInputHtml(target){\n\tvar table\t\t\t= target.closest('table');\n\tvar formid\t\t\t= table.dataset.formid;\n    var submission_id\t= target.closest('tr').dataset.id;\n    var cell_id\t\t\t= target.dataset.id\n\n\told_text\t\t\t= target.textContent;\n    \n    showLoader(target.firstChild);\n    \n    /* if (old_value == \"Click to update\" || old_value == \"X\"){\n        old_value = \"\";\n    } */\n\t\n\ttarget.dataset.oldtext\t \t= old_text;\n\n\tvar formdata = new FormData();\n    formdata.append('formid', formid);\n    formdata.append('submissionid',submission_id);\n    formdata.append('fieldname',cell_id);\n\n\tvar response\t= await fetchRestApi('forms/get_input_html', formdata);\n\n\tif(response){\n\t\ttarget.innerHTML\t = response;\n\n\t\taddFormsTableInputEventListeners(target);\n\n\t\t//add a listener for clicks outside the cell\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\n\t}\n}\n\nfunction addFormsTableInputEventListeners(cell){\n\tvar inputs\t= cell.querySelectorAll('input,select,textarea');\n\n\t// get old value\n\tvar oldValue\t= JSON.parse(cell.dataset.oldvalue);\n\n\t// make it an array if not an array\n\tif(!Array.isArray(oldValue)){\n\t\toldValue = [oldValue];\n\t}\n\t\t\n\tinputs.forEach((inputnode, index)=>{\n\t\tvar val\t= oldValue[index];\n\n\t\tif(inputnode.type == 'checkbox' || inputnode.type == 'radio'){\n\t\t\tif(inputnode.value == val.trim()){\n\t\t\t\tinputnode.checked = true;\n\t\t\t}\n\t\t}else if(inputnode.type == 'select'){\n\t\t\tinputnode.querySelector('option[value=\"'+val+'\"]').selected = true;\n\t\t}else{\n\t\t\tinputnode.value\t= val;\n\t\t}\n\t\t\n\t\tif(inputnode.type == 'select-one'){\n\t\t\tinputnode._niceselect = NiceSelect.bind(inputnode,{searchable: true});\n\t\t}\n\t\t\n\t\t//Add a keyboard\n\t\tinputnode.addEventListener(\"keyup\", function(event){\n\t\t\tif (event.keyCode === 13) {\n\t\t\t\tprocessFormsTableInput(event.target);\n\t\t\t}\n\t\t});\n\t\t\n\t\t//add a listener for clicks outside the cell\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\n\t\t\n\t\tif(inputnode.type != 'checkbox' || inputs.length == 1){\n\t\t\tif(inputnode.type == 'date'){\n\t\t\t\tinputnode.addEventListener(\"blur\", function(event){\n\t\t\t\t\t//only process if we added a value\n\t\t\t\t\tif(event.target.value != ''){\n\t\t\t\t\t\tprocessFormsTableInput(event.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tinputnode.addEventListener(\"change\", function(event){\n\t\t\t\t\t//only process if we added a value\n\t\t\t\t\tif(event.target.value != ''){\n\t\t\t\t\t\tprocessFormsTableInput(event.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tinputnode.focus();\n\t\t}\n\t});\n}\n\nfunction outsideFormsTableClicked(event){\n\tif(event.target.closest('td') == null || event.target.closest('td').dataset.oldtext == null){\n\t\t//remove as soon as we come here\n\t\tthis.removeEventListener(\"click\", arguments.callee);\n\t\tprocessFormsTableInput(document.querySelector('[data-oldtext]'));\n\t}\n}\n\n//function to get the temp input value and save it over AJAX\nvar running = false;\nasync function processFormsTableInput(target){\t\n\tif(running == target){\n\t\treturn;\n\t}\n\trunning = target;\n\t\n\tsetTimeout(function(){ running = false;}, 500);\t\n\n\tvar table\t\t\t= target.closest('table');\n\tvar formid\t\t\t= table.dataset.formid;\n\tvar cell\t\t\t= target.closest('td');\n    var cell_id\t\t\t= cell.dataset.id\n\tvar value\t\t\t= formFunctions.getFieldValue(target,false);\n\tvar submission_id\t= target.closest('tr').dataset.id;\n\tvar sub_id\t\t\t= cell.dataset.subid;\n\t\n\t//remove all event listeners\n\tdocument.removeEventListener(\"click\", outsideFormsTableClicked);\n\t\n\t//Only update when needed\n\tif (value != JSON.parse(cell.dataset.oldvalue)){\n\t\tshowLoader(cell.firstChild);\n\t\t\n\t\t// Submit new value and receive the filtered value back\n\t\tvar formdata = new FormData();\n\t\tformdata.append('formid', formid);\n\t\tformdata.append('submissionid',submission_id);\n\t\tformdata.append('subid',sub_id);\n\t\tformdata.append('fieldname',cell_id);\n\t\tformdata.append('newvalue',value);\n\t\t\n\t\tvar response\t= await fetchRestApi('forms/edit_value', formdata);\n\t\n\t\tif(response){\n\t\t\tvar value = response.newvalue;\n\t\t\t//Replace the input element with its value\n\t\t\tif(value == \"\") value = \"X\";\n\t\n\t\t\t//Update all occurences of this field\n\t\t\tif(sub_id == null){\n\t\t\t\tvar target\t= table.querySelectorAll(`tr[data-id=\"${submission_id}\"] td[data-id=\"${cell_id}\"]`);\n\t\t\t\ttarget.forEach(cell=>{\n\t\t\t\t\tcell.innerHTML = value;\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tcell.innerHTML = value;\n\t\t\t}\n\t\n\t\t\tdisplay_message(response.message)\n\t\t}\n\t}else{\n\t\tconsole.log(value)\n\t\tcell.innerHTML = cell.dataset.oldtext;\n\t}\n\n\tdelete target.dataset.oldtext;\n}\n\n\n\n\n\ndocument.addEventListener(\"click\", event=>{\n\tvar target = event.target;\n\n\tif(target.name == 'submit_column_setting'){\n\t\tsaveColumnSettings(target);\n\t}\n\n\tif(target.name == 'submit_table_setting'){\n\t\tsaveTableSettings(target);\n\t}\n\n\t//Actions\n\tif(target.matches('.delete.forms_table_action')){\n\t\tremoveSubmission(target);\n\t}\n\n\tif(target.matches('.archive.forms_table_action, .unarchive.forms_table_action')){\n\t\tarchiveSubmission(target);\n\t}\n\n\tif(target.matches('.print.forms_table_action')){\n\t\twindow.location.href = window.location.href.split('?')[0]+\"?print=true&table_id=\"+table.dataset.id+\"&submission_id=\"+table_row.querySelector(\"[id='id' i]\").textContent;\n\t}\n\t\n\t//show auto archive fields\n\tif(target.name == 'form_settings[autoarchive]'){\n\t\tel = target.closest('.table_rights_wrapper').querySelector('.autoarchivelogic');\n\t\tif(target.value == 'true'){\n\t\t\tel.classList.remove('hidden');\n\t\t}else{\n\t\t\tel.classList.add('hidden');\n\t\t}\n\t}\n\t\n\t//Open settings modal\n\tif(target.classList.contains('edit_formshortcode_settings')){\n\t\ttarget.parentNode.querySelector('.form_shortcode_settings').classList.remove('hidden');\n\t}\n\t\n\t//Edit data]\n\tvar td = target.closest('td');\n\tif(target.matches('td.edit_forms_table') && target.dataset.oldtext == null){\n\t\tgetInputHtml(target);\n\t}else if(td != null  && target.dataset.oldtext == null && td.matches('td.edit_forms_table') && target.tagName != 'INPUT' && target.tagName != 'A' && target.tagName != 'TEXTAREA' && !target.closest('.nice-select') ){\n\t\tgetInputHtml(target.closest('td'));\n\t}\n\t\n\t//Hide column\n\tif(target.classList.contains('visibilityicon')){\n\t\tif(target.tagName == 'SPAN'){\n\t\t\ttarget = target.querySelector('img');\n\t\t}\n\n\t\t// Table itself\n\t\tif(target.parentNode.matches('th')){\n\t\t\thideColumn(target.parentNode);\n\t\t// Table settings\n\t\t}else{\n\t\t\tif(target.classList.contains('visible')){\n\t\t\t\ttarget.classList.replace('visible','invisible');\n\t\t\t\ttarget.src\t= target.src.replace('visible.png','invisible.png');\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'hide';\n\t\t\t}else{\n\t\t\t\ttarget.classList.replace('invisible','visible');\n\t\t\t\ttarget.src\t= target.src.replace('invisible.png','visible.png');\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'show';\n\t\t\t}\n\t\t}\n\t}\n\n\tif(target.matches('.reset-col-vis')){\n\t\tshowHiddenColumns(target);\n\t}\n});\n\ndocument.addEventListener(\"DOMContentLoaded\",function() {\n\tconsole.log(\"Formstable.js loaded\");\n\t\n\tif(typeof(Sortable) != 'undefined'){\n\t\t//Make the sortable_column_settings_rows div sortable\n\t\tvar options = {\n\t\t\thandle: '.movecontrol',\n\t\t\tanimation: 150,\n\t\t};\n\n\t\tdocument.querySelectorAll('.sortable_column_settings_rows').forEach(el=>{\n\t\t\tSortable.create(el, options);\n\t\t});\n\t}\n});\n\ndocument.addEventListener('change', event=>{\n\tvar target = event.target;\n\n\tif(target.id == 'sim-forms-selector'){\n\t\tdocument.querySelectorAll('.main_form_wrapper').forEach(el=>{\n\t\t\tel.classList.add('hidden');\n\t\t});\n\t\tdocument.getElementById(target.value).classList.remove('hidden');\n\n\t\t// position table\n\t\tposition_table();\n\t}\n});"],"names":["async","askConfirmation","text","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","changeArchiveButton","loader","action","outerHTML","getInputHtml","target","formid","closest","dataset","submission_id","id","cell_id","old_text","textContent","showLoader","firstChild","oldtext","formdata","FormData","append","cell","inputs","oldValue","response","fetchRestApi","innerHTML","querySelectorAll","JSON","parse","oldvalue","Array","isArray","forEach","inputnode","index","val","type","value","trim","checked","querySelector","selected","_niceselect","NiceSelect","bind","searchable","addEventListener","event","keyCode","processFormsTableInput","document","outsideFormsTableClicked","length","focus","this","removeEventListener","arguments","callee","running","setTimeout","table","formFunctions","getFieldValue","sub_id","subid","newvalue","display_message","message","console","log","name","submitForm","location","reload","saveColumnSettings","saveTableSettings","matches","submissionid","row","remove","removeSubmission","table_row","show_swal","undefined","showDenyButton","denyButtonText","isDismissed","params","Proxy","URLSearchParams","window","search","get","searchParams","prop","archived","archiveSubmission","href","split","el","classList","add","contains","parentNode","td","tagName","tablerows","rows","i","cells","cellIndex","hideColumn","replace","src","showHiddenColumns","options","handle","animation","Sortable","create","getElementById","position_table"],"sourceRoot":""}