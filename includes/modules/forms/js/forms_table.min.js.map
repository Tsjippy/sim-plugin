{"version":3,"file":"forms_table.min.js","mappings":"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","sources":["webpack://forms/./forms_table.js"],"sourcesContent":["async function hideColumn(cell){\r\n\t// Hide the column\r\n\tvar table\t\t= cell.closest('table');\r\n\tvar tableRows\t= table.rows;\r\n\tfor (const element of tableRows) {\r\n\t\telement.cells[cell.cellIndex].classList.add('hidden')\r\n\t}\r\n\r\n\t//show the reset button\r\n\r\n\tcell.closest('.table-wrapper').querySelector('.reset-col-vis').classList.remove('hidden');\r\n\r\n\t// store as preference\r\n\tvar formData\t= new FormData();\r\n\tformData.append('formid', table.dataset.formid);\r\n\tformData.append('column_name', cell.id);\r\n\t\r\n\tawait FormSubmit.fetchRestApi('forms/save_table_prefs', formData);\r\n}\r\n\r\nasync function showHiddenColumns(target){\r\n\t//hiden the reset button\r\n\ttarget.closest('.table-wrapper').querySelector('.reset-col-vis').classList.add('hidden');\r\n\r\n\t// Show the columns again\r\n\tlet table\t\t= target.closest('.table-wrapper').querySelector('table');\r\n\ttable.querySelectorAll('th.hidden, td.hidden').forEach(el=>el.classList.remove('hidden'));\r\n\r\n\t// store as preference\r\n\tlet formData\t= new FormData();\r\n\tformData.append('formid', table.dataset.formid);\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/delete_table_prefs', formData);\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t\tlocation.reload();\r\n\t}\r\n}\r\n\r\nasync function saveColumnSettings(target){\r\n\tlet response = await FormSubmit.submitForm(target, 'forms/save_column_settings');\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t\tlocation.reload();\r\n\t}\r\n}\r\n\r\nasync function saveTableSettings(target){\r\n\tlet response = await FormSubmit.submitForm(target, 'forms/save_table_settings');\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nasync function askConfirmation(text){\r\n\tlet result = await Swal.fire({\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: `Are you sure you want to ${text} this?`,\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: `Yes, ${text} it!`\r\n\t});\r\n\r\n\treturn result.isConfirmed;\r\n}\r\n\r\nasync function removeSubmission(target){\r\n\tif(askConfirmation('delete')){\t\t\r\n\t\tlet submissionId\t= target.closest('tr').dataset.id;\r\n\t\tlet table\t\t\t= target.closest('table');\r\n\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('submissionid', submissionId);\r\n\t\t\r\n\t\t//display loading gif\r\n\t\tMain.showLoader(target);\r\n\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('forms/remove_submission', formData);\r\n\r\n\t\tif(response){\r\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"]`).forEach(\r\n\t\t\t\trow=>row.remove()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function archiveSubmission(target){\t\r\n\tlet table\t\t\t= target.closest('table');\r\n\tlet tableRow\t\t= target.closest('tr');\r\n\tlet submissionId\t= tableRow.dataset.id;\r\n\tlet showSwal\t\t= true;\r\n\tlet action\t\t\t= target.value;\r\n\tlet response;\r\n\r\n\tlet formData \t\t= new FormData();\r\n\tformData.append('formid', table.dataset.formid);\r\n\tformData.append('submissionid', submissionId);\r\n\tformData.append('action', action);\r\n\t\r\n\t// Ask whether to archive one piece or the whole\r\n\tif(tableRow.dataset.subid != undefined){\r\n\t\tshowSwal = false;\r\n\t\t\r\n\t\tresponse = await Swal.fire({\r\n\t\t\ttitle: `What do you want to ${action}?`,\r\n\t\t\ttext: `Do you want to ${action} just this one or the whole request?`,\r\n\t\t\ticon: 'question',\r\n\t\t\tshowDenyButton: true,\r\n\t\t\tshowCancelButton: true,\r\n\t\t\tconfirmButtonText: 'Just this one',\r\n\t\t\tdenyButtonText: 'The whole request',\r\n\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t});\r\n\r\n\t\tif (response.isConfirmed) {\r\n\t\t\tformData.append('subid', tableRow.dataset.subid);\r\n\t\t}\r\n\t\t\r\n\t\t// skip if denied\r\n\t\tif(response.isDismissed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(showSwal){\r\n\t\tlet confirmed = askConfirmation(action);\r\n\r\n\t\tif(!confirmed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t//display loading gif\r\n\tMain.showLoader(target);\r\n\t\r\n\tresponse\t= await FormSubmit.fetchRestApi('forms/archive_submission', formData);\r\n\r\n\tif(response){\r\n\t\tconst params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\t\tget: (searchParams, prop) => searchParams.get(prop),\r\n\t\t});\r\n\t\t\r\n\t\t// Delete all\r\n\t\tif(formData.get('subid') == null){\r\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"]`).forEach(row=>{\r\n\t\t\t\t// just change the button name\r\n\t\t\t\tif(params.archived == 'true'){\r\n\t\t\t\t\tlet loader = row.querySelector('.loaderwrapper, .'+action);\r\n\t\t\t\t\tchangeArchiveButton(loader, action);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trow.remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t// Only delete subid\r\n\t\t}else{\r\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"][data-subid=\"${tableRow.dataset.subid}\"]`).forEach(row=>{\r\n\t\t\t\t// just change the button name\r\n\t\t\t\tif(params.archived == 'true'){\r\n\t\t\t\t\tlet loader = row.querySelector('.loaderwrapper');\r\n\t\t\t\t\tchangeArchiveButton(loader, action);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trow.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction changeArchiveButton(loader, action){\r\n\tlet text;\r\n\r\n\tif(action == 'archive'){\r\n\t\taction \t= 'unarchive';\r\n\t\ttext\t= 'Unarchive';\r\n\t}else{\r\n\t\taction \t= 'archive';\r\n\t\ttext\t= 'Archive';\r\n\t}\r\n\tloader.outerHTML = `<button class=\"${action} button forms_table_action\" name=\"${action}_action\" value=\"${action}\">${text}</button>`;\r\n}\r\n\r\nasync function getInputHtml(target){\r\n\tlet table\t\t\t= target.closest('table');\r\n\tlet formId\t\t\t= table.dataset.formid;\r\n    let submissionId\t= target.closest('tr').dataset.id;\r\n\tlet subId\t\t\t= target.dataset.subid;\r\n    let cellId\t\t\t= target.dataset.id\r\n\tlet oldText\t\t\t= target.textContent;\r\n    \r\n    Main.showLoader(target.firstChild);\r\n\t\r\n\ttarget.dataset.oldtext\t \t= oldText;\r\n\r\n\tlet formData = new FormData();\r\n    formData.append('formid', formId);\r\n    formData.append('submissionid', submissionId);\r\n\tformData.append('subid', subId);\r\n    formData.append('fieldname', cellId);\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/get_input_html', formData);\r\n\r\n\tif(response){\r\n\t\ttarget.innerHTML\t = response;\r\n\r\n\t\taddFormsTableInputEventListeners(target);\r\n\r\n\t\t//add a listener for clicks outside the cell\r\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\r\n\t\ttarget.querySelectorAll('.file_upload_wrap').forEach(el=>el.addEventListener('uploadfinished', uploadFinished));\r\n\t}\r\n}\r\n\r\nfunction addFormsTableInputEventListeners(cell){\r\n\tlet inputs\t\t= cell.querySelectorAll('input,select,textarea');\r\n\r\n\t// get old value\r\n\tlet oldValue\t= '';\r\n\tif(cell.dataset.oldvalue != undefined){\r\n\t\toldValue\t= JSON.parse(cell.dataset.oldvalue);\r\n\t}\r\n\r\n\t// make it an array if not an array\r\n\tif(!Array.isArray(oldValue)){\r\n\t\toldValue = [oldValue];\r\n\t}\r\n\t\t\r\n\tinputs.forEach((inputNode, index)=>{\r\n\t\tlet val\t= oldValue[index];\r\n\t\tif(oldValue.length == 1 && index > 0){\r\n\t\t\tval\t= oldValue[0];\r\n\t\t}\r\n\r\n\t\tif(inputNode.type == 'checkbox' || inputNode.type == 'radio'){\r\n\t\t\tif(inputNode.value == val.trim()){\r\n\t\t\t\tinputNode.checked = true;\r\n\t\t\t}\r\n\t\t}else if(inputNode.type == 'select'){\r\n\t\t\tinputNode.querySelector('option[value=\"'+val+'\"]').selected = true;\r\n\t\t}else if(inputNode.type == 'date'){\r\n\t\t\tinputNode.value = oldValue;\r\n\t\t}else if(inputNode.type != 'file'){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(inputNode.type == 'select-one'){\r\n\t\t\tinputNode._niceselect = NiceSelect.bind(inputNode,{searchable: true});\r\n\t\t}\r\n\t\t\r\n\t\t//Add a keyboard\r\n\t\tinputNode.addEventListener(\"keyup\", function(event){\r\n\t\t\tif (event.keyCode === 13) {\r\n\t\t\t\tprocessFormsTableInput(event.target);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//add a listener for clicks outside the cell\r\n\t\tdocument.addEventListener('click', outsideFormsTableClicked);\r\n\t\t\r\n\t\tif(inputNode.type != 'checkbox' || inputs.length == 1){\r\n\t\t\tif(inputNode.type == 'date'){\r\n\t\t\t\tinputNode.addEventListener(\"blur\", processFormsTableInput);\r\n\t\t\t}else if(inputNode.type != 'file'){\r\n\t\t\t\tinputNode.addEventListener(\"change\", processFormsTableInput);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tinputNode.focus();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction outsideFormsTableClicked(event){\r\n\tif(event.target.closest('td') == null || event.target.closest('td').dataset.oldtext == null){\r\n\t\t//remove as soon as we come here\r\n\t\tthis.removeEventListener(\"click\", arguments.callee);\r\n\t\tprocessFormsTableInput(document.querySelector('[data-oldtext]'));\r\n\t}\r\n}\r\n\r\nfunction uploadFinished(event){\r\n\tif(event.target.closest('td') != null){\r\n\t\t//remove as soon as we come here\r\n\t\tdocument.removeEventListener('uploadfinished', uploadFinished);\r\n\t\tprocessFormsTableInput(document.querySelector('[data-oldtext]'));\r\n\t}\r\n}\r\n\r\n//function to get the temp input value and save it over AJAX\r\nvar running = false;\r\nasync function processFormsTableInput(target){\r\n\t// target is an event\r\n\tif(target.target != undefined){\r\n\t\ttarget = target.target;\r\n\t}\r\n\t\r\n\tif(running == target || target.value == ''){\r\n\t\treturn;\r\n\t}\r\n\trunning = target;\r\n\t\r\n\tsetTimeout(function(){ running = false;}, 500);\t\r\n\r\n\tlet table\t\t\t= target.closest('table');\r\n\tlet formId\t\t\t= table.dataset.formid;\r\n\tlet cell\t\t\t= target.closest('td');\r\n    let cellId\t\t\t= cell.dataset.id\r\n\tlet value\t\t\t= FormFunctions.getFieldValue(target, cell, false);\r\n\tlet submissionId\t= target.closest('tr').dataset.id;\r\n\tlet subId\t\t\t= cell.dataset.subid;\r\n\t\r\n\t//remove all event listeners\r\n\tdocument.removeEventListener(\"click\", outsideFormsTableClicked);\r\n\t\r\n\t//Only update when needed\r\n\tconsole.log(value)\r\n\tconsole.log(cell.dataset.oldvalue)\r\n\tif (value != cell.dataset.oldvalue){\r\n\t\tMain.showLoader(cell.firstChild);\r\n\t\t\r\n\t\t// Submit new value and receive the filtered value back\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('formid', formId);\r\n\t\tformData.append('submissionid', submissionId);\r\n\t\tif(subId != undefined){\r\n\t\t\tformData.append('subid', subId);\r\n\t\t}\r\n\t\tformData.append('fieldname', cellId);\r\n\t\tformData.append('newvalue', JSON.stringify(value));\r\n\t\t\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('forms/edit_value', formData);\r\n\t\r\n\t\tif(response){\r\n\t\t\tlet newValue = response.newvalue;\r\n\t\t\t//Replace the input element with its value\r\n\t\t\tif(newValue == \"\") newValue = \"X\";\r\n\t\r\n\t\t\t//Update all occurences of this field\r\n\t\t\tif(subId == null){\r\n\t\t\t\tlet targets\t= table.querySelectorAll(`tr[data-id=\"${submissionId}\"] td[data-id=\"${cellId}\"]`);\r\n\t\t\t\ttargets.forEach(td=>{td.innerHTML = newValue;});\r\n\t\t\t}else{\r\n\t\t\t\tcell.innerHTML = newValue;\r\n\t\t\t}\r\n\t\r\n\t\t\tMain.displayMessage(response.message)\r\n\t\t}\r\n\t}else{\r\n\t\tconsole.log(value)\r\n\t\tcell.innerHTML = cell.dataset.oldtext;\r\n\t}\r\n\r\n\taddFormsTableInputEventListeners(target);\r\n\r\n\tif(target.dataset.oldtext != undefined){\r\n\t\tdelete target.dataset.oldtext;\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"click\", event=>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'submit_column_setting'){\r\n\t\tsaveColumnSettings(target);\r\n\t}\r\n\r\n\tif(target.name == 'submit_table_setting'){\r\n\t\tsaveTableSettings(target);\r\n\t}\r\n\r\n\t//Actions\r\n\tif(target.matches('.delete.forms_table_action')){\r\n\t\tremoveSubmission(target);\r\n\t}\r\n\r\n\tif(target.matches('.archive.forms_table_action, .unarchive.forms_table_action')){\r\n\t\tarchiveSubmission(target);\r\n\t}\r\n\r\n\tif(target.matches('.print.forms_table_action')){\r\n\t\twindow.location.href = window.location.href.split('?')[0]+\"?print=true&table_id=\"+table.dataset.id+\"&submission_id=\"+table_row.querySelector(\"[id='id' i]\").textContent;\r\n\t}\r\n\t\r\n\t//show auto archive fields\r\n\tif(target.name == 'form_settings[autoarchive]'){\r\n\t\tlet el = target.closest('.table_rights_wrapper').querySelector('.autoarchivelogic');\r\n\t\tif(target.value == 'true'){\r\n\t\t\tel.classList.remove('hidden');\r\n\t\t}else{\r\n\t\t\tel.classList.add('hidden');\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Open settings modal\r\n\tif(target.classList.contains('edit_formshortcode_settings')){\r\n\t\tdocument.querySelector('.modal.form_shortcode_settings').classList.remove('hidden');\r\n\t}\r\n\t\r\n\t//Edit data\r\n\tlet td = target.closest('td');\r\n\tif(target.matches('td.edit_forms_table') && (target.dataset.oldtext == null || target.dataset.oldtext == 'X')){\r\n\t\tevent.stopPropagation();\r\n\t\tgetInputHtml(target);\r\n\t}else if(td != null  && target.dataset.oldtext == null && td.matches('td.edit_forms_table') && target.tagName != 'INPUT' && target.tagName != 'A' && target.tagName != 'TEXTAREA' && !target.closest('.nice-select') ){\r\n\t\tevent.stopPropagation();\r\n\t\tgetInputHtml(target.closest('td'));\r\n\t}\r\n\t\r\n\t//Hide column\r\n\tif(target.classList.contains('visibilityicon')){\r\n\t\tif(target.tagName == 'SPAN'){\r\n\t\t\ttarget = target.querySelector('img');\r\n\t\t}\r\n\r\n\t\t// Table itself\r\n\t\tif(target.parentNode.matches('th')){\r\n\t\t\thideColumn(target.parentNode);\r\n\t\t// Table settings\r\n\t\t}else{\r\n\t\t\tif(target.classList.contains('visible')){\r\n\t\t\t\ttarget.classList.replace('visible','invisible');\r\n\t\t\t\ttarget.src\t= target.src.replace('visible.png','invisible.png');\r\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'hide';\r\n\t\t\t}else{\r\n\t\t\t\ttarget.classList.replace('invisible','visible');\r\n\t\t\t\ttarget.src\t= target.src.replace('invisible.png','visible.png');\r\n\t\t\t\ttarget.closest('.column_setting_wrapper').querySelector('.visibilitytype').value = 'show';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(target.matches('.reset-col-vis')){\r\n\t\tshowHiddenColumns(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"Formstable.js loaded\");\r\n\t\r\n\tif(typeof(Sortable) != 'undefined'){\r\n\t\t//Make the sortable_column_settings_rows div sortable\r\n\t\tlet options = {\r\n\t\t\thandle: '.movecontrol',\r\n\t\t\tanimation: 150,\r\n\t\t};\r\n\r\n\t\tdocument.querySelectorAll('.sortable_column_settings_rows').forEach(el=>{\r\n\t\t\tSortable.create(el, options);\r\n\t\t});\r\n\t}\r\n});\r\n\r\ndocument.addEventListener('change', event=>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.id == 'sim-forms-selector'){\r\n\t\tdocument.querySelectorAll('.main_form_wrapper').forEach(el=>{\r\n\t\t\tel.classList.add('hidden');\r\n\t\t});\r\n\r\n\t\tdocument.getElementById(target.value).classList.remove('hidden');\r\n\r\n\t\t// position table\r\n\t\tSimTableFunctions.positionTable();\r\n\t}\r\n});"],"names":["async","askConfirmation","text","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","changeArchiveButton","loader","action","outerHTML","getInputHtml","target","formId","closest","dataset","formid","submissionId","id","subId","subid","cellId","oldText","textContent","Main","showLoader","firstChild","oldtext","formData","FormData","append","response","FormSubmit","fetchRestApi","innerHTML","addFormsTableInputEventListeners","document","addEventListener","outsideFormsTableClicked","querySelectorAll","forEach","el","uploadFinished","cell","inputs","oldValue","undefined","oldvalue","JSON","parse","Array","isArray","inputNode","index","val","length","type","value","trim","checked","querySelector","selected","_niceselect","NiceSelect","bind","searchable","event","keyCode","processFormsTableInput","focus","this","removeEventListener","arguments","callee","running","setTimeout","table","FormFunctions","getFieldValue","console","log","stringify","newValue","newvalue","td","displayMessage","message","name","submitForm","location","reload","saveColumnSettings","saveTableSettings","matches","row","remove","removeSubmission","tableRow","showSwal","showDenyButton","denyButtonText","isDismissed","params","Proxy","URLSearchParams","window","search","get","searchParams","prop","archived","archiveSubmission","href","split","table_row","classList","add","contains","tagName","stopPropagation","parentNode","tableRows","rows","element","cells","cellIndex","hideColumn","replace","src","showHiddenColumns","options","handle","animation","Sortable","create","getElementById","SimTableFunctions","positionTable"],"sourceRoot":""}