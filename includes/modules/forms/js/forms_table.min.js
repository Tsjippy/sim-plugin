(()=>{async function e(e){return(await Swal.fire({title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`})).isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms_table_action" name="${t}_action" value="${t}">${a}</button>`}async function a(e){let t=e.closest("table").dataset.formid,a=e.closest("tr").dataset.id,o=e.dataset.subid,n=e.dataset.id,l=e.textContent;Main.showLoader(e.firstChild),e.dataset.oldtext=l;let r=new FormData;r.append("formid",t),r.append("submissionid",a),r.append("subid",o),r.append("fieldname",n);let d=await FormSubmit.fetchRestApi("forms/get_input_html",r);d&&(e.innerHTML=d,s(e),document.addEventListener("click",i))}function s(e){var t=e.querySelectorAll("input,select,textarea");let a="";null!=e.dataset.oldvalue&&(a=JSON.parse(e.dataset.oldvalue)),Array.isArray(a)||(a=[a]),t.forEach(((e,s)=>{let o=a[s];1==a.length&&s>0&&(o=a[0]),"checkbox"==e.type||"radio"==e.type?e.value==o.trim()&&(e.checked=!0):"select"==e.type?e.querySelector('option[value="'+o+'"]').selected=!0:e.value=o,"select-one"==e.type&&(e._niceselect=NiceSelect.bind(e,{searchable:!0})),e.addEventListener("keyup",(function(e){13===e.keyCode&&n(e.target)})),document.addEventListener("click",i),"checkbox"==e.type&&1!=t.length||("date"==e.type?e.addEventListener("blur",n):e.addEventListener("change",n),e.focus())}))}function i(e){null!=e.target.closest("td")&&null!=e.target.closest("td").dataset.oldtext||(this.removeEventListener("click",arguments.callee),n(document.querySelector("[data-oldtext]")))}var o=!1;async function n(e){if(null!=e.target&&(e=e.target),o==e||""==e.value)return;o=e,setTimeout((function(){o=!1}),500);let t=e.closest("table"),a=t.dataset.formid,n=e.closest("td"),l=n.dataset.id,r=FormFunctions.getFieldValue(e,n,!1),d=e.closest("tr").dataset.id,c=n.dataset.subid;if(document.removeEventListener("click",i),r!=JSON.parse(n.dataset.oldvalue)){Main.showLoader(n.firstChild);let e=new FormData;e.append("formid",a),e.append("submissionid",d),null!=c&&e.append("subid",c),e.append("fieldname",l),e.append("newvalue",r);let s=await FormSubmit.fetchRestApi("forms/edit_value",e);if(s){let e=s.newvalue;""==e&&(e="X"),null==c?t.querySelectorAll(`tr[data-id="${d}"] td[data-id="${l}"]`).forEach((t=>{t.innerHTML=e})):n.innerHTML=e,Main.displayMessage(s.message)}}else console.log(r),n.innerHTML=n.dataset.oldtext;s(e),null!=e.dataset.oldtext&&delete e.dataset.oldtext}document.addEventListener("click",(s=>{var i=s.target;if("submit_column_setting"==i.name&&async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(i),"submit_table_setting"==i.name&&async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(i),i.matches(".delete.forms_table_action")&&async function(t){if(e("delete")){let e=t.closest("tr").dataset.id,a=t.closest("table"),s=new FormData;s.append("submissionid",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",s)&&a.querySelectorAll(`.table-row[data-id="${e}"]`).forEach((e=>e.remove()))}}(i),i.matches(".archive.forms_table_action, .unarchive.forms_table_action")&&async function(a){let s=a.closest("table"),i=a.closest("tr"),o=i.dataset.id,n=!0,l=a.value,r=new FormData;if(r.append("formid",s.dataset.formid),r.append("submissionid",o),r.append("action",l),null!=i.dataset.subid&&(n=!1,d=await Swal.fire({title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"}),d.isConfirmed&&r.append("subid",i.dataset.subid),d.isDismissed))return;if(n&&!e(l))return;Main.showLoader(a);let d=await FormSubmit.fetchRestApi("forms/archive_submission",r);if(d){const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});null==r.get("subid")?s.querySelectorAll(`.table-row[data-id="${o}"]`).forEach((a=>{"true"==e.archived?t(a.querySelector(".loaderwrapper, ."+l),l):a.remove()})):s.querySelectorAll(`.table-row[data-id="${o}"][data-subid="${i.dataset.subid}"]`).forEach((a=>{"true"==e.archived?t(a.querySelector(".loaderwrapper"),l):a.remove()}))}}(i),i.matches(".print.forms_table_action")&&(window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent),"form_settings[autoarchive]"==i.name){let e=i.closest(".table_rights_wrapper").querySelector(".autoarchivelogic");"true"==i.value?e.classList.remove("hidden"):e.classList.add("hidden")}i.classList.contains("edit_formshortcode_settings")&&document.querySelector(".modal.form_shortcode_settings").classList.remove("hidden");let o=i.closest("td");!i.matches("td.edit_forms_table")||null!=i.dataset.oldtext&&"X"!=i.dataset.oldtext?null!=o&&null==i.dataset.oldtext&&o.matches("td.edit_forms_table")&&"INPUT"!=i.tagName&&"A"!=i.tagName&&"TEXTAREA"!=i.tagName&&!i.closest(".nice-select")&&(s.stopPropagation(),a(i.closest("td"))):(s.stopPropagation(),a(i)),i.classList.contains("visibilityicon")&&("SPAN"==i.tagName&&(i=i.querySelector("img")),i.parentNode.matches("th")?async function(e){var t=e.closest("table"),a=t.rows;for(const t of a)t.cells[e.cellIndex].classList.add("hidden");e.closest(".table-wrapper").querySelector(".reset-col-vis").classList.remove("hidden");var s=new FormData;s.append("formid",t.dataset.formid),s.append("column_name",e.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",s)}(i.parentNode):i.classList.contains("visible")?(i.classList.replace("visible","invisible"),i.src=i.src.replace("visible.png","invisible.png"),i.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="hide"):(i.classList.replace("invisible","visible"),i.src=i.src.replace("invisible.png","visible.png"),i.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="show")),i.matches(".reset-col-vis")&&async function(e){e.closest(".table-wrapper").querySelector(".reset-col-vis").classList.add("hidden");let t=e.closest(".table-wrapper").querySelector("table");t.querySelectorAll("th.hidden, td.hidden").forEach((e=>e.classList.remove("hidden")));let a=new FormData;a.append("formid",t.dataset.formid);let s=await FormSubmit.fetchRestApi("forms/delete_table_prefs",a);s&&(Main.displayMessage(s),location.reload())}(i)})),document.addEventListener("DOMContentLoaded",(function(){if(console.log("Formstable.js loaded"),"undefined"!=typeof Sortable){var e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable_column_settings_rows").forEach((t=>{Sortable.create(t,e)}))}})),document.addEventListener("change",(e=>{var t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main_form_wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable())}))})();
//# sourceMappingURL=forms_table.min.js.map