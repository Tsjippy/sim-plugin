(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms_table_action" name="${t}_action" value="${t}">${a}</button>`}async function a(e){let t=e.closest("table");document.querySelectorAll("td.active").forEach((t=>{t!=e&&i(t)})),e.classList.add("active");let a=t.dataset.formid,s=e.closest("tr").dataset.id,n=e.dataset.subid,r=e.dataset.id,d=e.dataset.name,c=e.textContent;Main.showLoader(e.firstChild),e.dataset.oldtext=c;let u=new FormData;u.append("formid",a),u.append("submissionid",s),null!=n&&u.append("subid",n),u.append("elementid",r),u.append("elementname",d);let m=await FormSubmit.fetchRestApi("forms/get_input_html",u);m?(e.innerHTML=m,o(e),e.querySelectorAll(".file_upload_wrap").forEach((e=>e.addEventListener("uploadfinished",l)))):(e.innerHTML=e.dataset.oldtext,e.classList.remove("active"))}function s(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".pagenumber").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}function o(e){let t=e.querySelectorAll("input,select,textarea");t.forEach((e=>{"select-one"==e.type&&(e._niceselect=NiceSelect.bind(e,{searchable:!0})),("radio"!=e.type&&"checkbox"!=e.type||1==t.length)&&("date"==e.type&&e.addEventListener("blur",i),e.focus())}))}function l(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",l),i(document.querySelector("[data-oldtext]")))}console.log("Formstable.js loaded");var n=!1;async function i(e){if(null!=e.target&&(e=e.target),n==e||""==e.value||e.matches(".nice-select-search"))return;n=e,setTimeout((function(){n=!1}),500);let t=e.closest("table"),a=t.dataset.formid,s=e.closest("td");s.classList.remove("active");let l=s.dataset.id,i=s.dataset.name,r=FormFunctions.getFieldValue(e,s,!1),d=e.closest("tr").dataset.id,c=s.dataset.subid,u="";if(null!=e.closest("[data-shortcodeid]")&&(u=e.closest("[data-shortcodeid]").dataset.shortcodeid),r!=JSON.parse(s.dataset.oldvalue)){Main.showLoader(s.firstChild);let e=new FormData;e.append("formid",a),e.append("submissionid",d),null!=c&&e.append("subid",c),e.append("elementid",l),e.append("elementname",i),e.append("newvalue",JSON.stringify(r)),""!=u&&e.append("shortcodeid",u);let o=await FormSubmit.fetchRestApi("forms/edit_value",e);if(o){console.log(o);let e=o.newvalue;"string"==typeof e&&e.replace("_"," "),""==e&&(e="X"),null==c?t.querySelectorAll(`tr[data-id="${d}"] td[data-id="${l}"]`).forEach((t=>{t.innerHTML=e})):s.innerHTML=e,s.dataset.oldvalue=JSON.stringify(e),console.log(s),Main.displayMessage(o.message.replace("_"," "))}}else s.innerHTML=s.dataset.oldtext;o(e),null!=e.dataset.oldtext&&delete e.dataset.oldtext}function r(e){let t=e.closest("td.active");if(null==t)return;let a=document.createElement("button");a.innerHTML="Save changes",a.classList.add("button"),a.classList.add("small"),a.classList.add("save"),a.addEventListener("click",(e=>i(e.target.closest("td").querySelector("input")))),null==t.querySelector(".save")&&t.appendChild(a)}document.addEventListener("click",(o=>{let l=o.target;if("submit_column_setting"==l.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(l);else if("submit_table_setting"==l.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(l);else if("form_settings[autoarchive]"==l.name){let e=l.closest(".table_rights_wrapper").querySelector(".autoarchivelogic");"true"==l.value?e.classList.remove("hidden"):e.classList.add("hidden")}else null!=l.closest(".form-result-navigation")&&(l.matches(".next")||l.matches(".prev")||l.matches(".pagenumber"))&&(async function(e){let t=e.closest(".form.table-wrapper"),a=e.closest(".form-result-navigation"),o=e.closest(".form-results-wrapper"),l=o.querySelector(".form-data-table:not(.hidden)");l.classList.add("hidden");let n,i=parseInt(a.querySelector(".page-number-wrapper .current").dataset.nr);n=e.matches(".next")?i+1:e.matches(".prev")?i-1:e.dataset.nr,s(a,n);let r=o.querySelector(`[data-page="${n}"]`);if(null!=r)return console.log(r),void r.classList.remove("hidden");let d=l.dataset.formid,c=Main.showLoader(l,!1),u=new FormData(t.querySelector(".filteroptions"));u.append("formid",d),u.append("pagenumber",n),u.append("shortcodeid",l.dataset.shortcodeid),u.append("type",l.dataset.type);let m,p,h=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});m=null!=h.archived,p=null!=h.onlyown,u.append("archived",m),u.append("onlyown",p);let f=await FormSubmit.fetchRestApi("forms/get_page",u);f?c.outerHTML=f:(l.classList.remove("hidden"),c.remove(),s(a,i))}(l),o.stopPropagation());l.matches(".delete.forms_table_action")&&async function(t){if(await e("delete")){let e=t.closest("tr").dataset.id,a=t.closest("table"),s=new FormData;s.append("submissionid",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",s)&&a.querySelectorAll(`.table-row[data-id="${e}"]`).forEach((e=>e.remove()))}}(l),l.matches(".archive.forms_table_action, .unarchive.forms_table_action")&&async function(a){let s,o=a.closest("table"),l=a.closest("tr"),n=l.dataset.id,i=!0,r=a.value,d=new FormData;if(d.append("formid",o.dataset.formid),d.append("submissionid",n),d.append("action",r),null!=l.dataset.subid){i=!1;let e={title:`What do you want to ${r}?`,text:`Do you want to ${r} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),s=await Swal.fire(e),s.isConfirmed&&d.append("subid",l.dataset.subid),s.isDismissed)return}if((!i||await e(r))&&(Main.showLoader(a),s=await FormSubmit.fetchRestApi("forms/archive_submission",d),s)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?o.querySelectorAll(`[data-id="${n}"]`).forEach((s=>{if(s.dispatchEvent(a),"true"==e.archived){let e;e="archive"==r?s.querySelector(".loaderwrapper, .archive"):s.querySelector(".loaderwrapper, .unarchive"),t(e,r)}else s.remove()})):o.querySelectorAll(`.table-row[data-id="${n}"][data-subid="${l.dataset.subid}"]`).forEach((s=>{s.dispatchEvent(a),"true"==e.archived?t(s.querySelector(".loaderwrapper"),r):s.remove()}))}}(l),l.matches(".print.forms_table_action")&&(window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent),l.classList.contains("edit_formshortcode_settings")&&Main.showModal(document.querySelector(".modal.form_shortcode_settings"));let n=l.closest("td");n&&!n.matches(".active")&&(l.matches("td.edit_forms_table")?(o.stopPropagation(),a(l)):!n.matches("td.edit_forms_table")||"INPUT"==l.tagName||"A"==l.tagName||"TEXTAREA"==l.tagName||l.closest(".nice-select")||l.matches(".button.save")||(console.log(l),o.stopPropagation(),a(l.closest("td")))),l.classList.contains("visibilityicon")&&("SPAN"==l.tagName&&(l=l.querySelector("img")),l.parentNode.matches("th")?async function(e){var t=e.closest("table"),a=t.rows;for(const t of a)t.cells[e.cellIndex].classList.add("hidden");e.closest(".table-wrapper").querySelector(".reset-col-vis").classList.remove("hidden");var s=new FormData;s.append("formid",t.dataset.formid),s.append("column_name",e.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",s)}(l.parentNode):l.classList.contains("visible")?(l.classList.replace("visible","invisible"),l.src=l.src.replace("visible.png","invisible.png"),l.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="hide"):(l.classList.replace("invisible","visible"),l.src=l.src.replace("invisible.png","visible.png"),l.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="show")),l.matches(".reset-col-vis")&&async function(e){e.closest(".table-wrapper").querySelector(".reset-col-vis").classList.add("hidden");let t=e.closest(".table-wrapper").querySelector("table");t.querySelectorAll("th.hidden, td.hidden").forEach((e=>e.classList.remove("hidden")));let a=new FormData;a.append("formid",t.dataset.formid);let s=await FormSubmit.fetchRestApi("forms/delete_table_prefs",a);s&&(Main.displayMessage(s),location.reload())}(l);let r=document.querySelector("td.active");null!=r&&null==n&&("checkbox"==l.type&&1!=l.length||(console.log(l),i(r))),l.matches(".permissins-rights-form")&&l.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden")})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable_column_settings_rows").forEach((t=>{Sortable.create(t,e)}))}})),document.addEventListener("change",(e=>{let t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main_form_wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable()),null!=t.closest("td.active")&&("file"!=t.type&&"date"!=t.type&&"checkbox"!=t.type?(names=[],t.closest("td.active").querySelectorAll("input").forEach((e=>{names.includes(e.type)||names.push(e.type)})),1==names.length?i(t):r(t)):"file"!=t.type&&r(t))})),document.addEventListener("keyup",(function(e){if(["Enter","NumpadEnter"].includes(e.key)&&null==d.Shift){let e=document.querySelector("td.active");null!=e&&i(e)}delete d[e.key]}));let d={};document.addEventListener("keydown",(e=>{d[e.key]=!0}))})();
//# sourceMappingURL=forms_table.min.js.map