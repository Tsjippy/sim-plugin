(()=>{async function e(e){return(await Swal.fire({title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`})).isConfirmed}function t(e,t){"archive"==t?(t="unarchive",text="Unarchive"):(t="archive",text="Archive"),e.outerHTML=`<button class="${t} button forms_table_action" name="${t}_action" value="${t}">${text}</button>`}async function a(e){var t=e.closest("table").dataset.formid,a=e.closest("tr").dataset.id,o=e.dataset.id;oldText=e.textContent,main.showLoader(e.firstChild),e.dataset.oldtext=old_text;var r=new FormData;r.append("formid",t),r.append("submissionid",a),r.append("fieldname",o);var n,l,d,c=await FormSubmit.fetchRestApi("forms/get_input_html",r);c&&(e.innerHTML=c,l=(n=e).querySelectorAll("input,select,textarea"),d=JSON.parse(n.dataset.oldvalue),Array.isArray(d)||(d=[d]),l.forEach(((e,t)=>{var a=d[t];"checkbox"==e.type||"radio"==e.type?e.value==a.trim()&&(e.checked=!0):"select"==e.type?e.querySelector('option[value="'+a+'"]').selected=!0:e.value=a,"select-one"==e.type&&(e._niceselect=NiceSelect.bind(e,{searchable:!0})),e.addEventListener("keyup",(function(e){13===e.keyCode&&i(e.target)})),document.addEventListener("click",s),"checkbox"==e.type&&1!=l.length||("date"==e.type?e.addEventListener("blur",(function(e){""!=e.target.value&&i(e.target)})):e.addEventListener("change",(function(e){""!=e.target.value&&i(e.target)})),e.focus())})),document.addEventListener("click",s))}function s(e){null!=e.target.closest("td")&&null!=e.target.closest("td").dataset.oldtext||(this.removeEventListener("click",arguments.callee),i(document.querySelector("[data-oldtext]")))}var o=!1;async function i(e){if(o!=e){o=e,setTimeout((function(){o=!1}),500);var t=e.closest("table"),a=t.dataset.formid,i=e.closest("td"),r=i.dataset.id,n=FormFunctions.getFieldValue(e,!1),l=e.closest("tr").dataset.id,d=i.dataset.subid;if(document.removeEventListener("click",s),n!=JSON.parse(i.dataset.oldvalue)){main.showLoader(i.firstChild);var c=new FormData;c.append("formid",a),c.append("submissionid",l),c.append("subid",d),c.append("fieldname",r),c.append("newvalue",n);var u=await FormSubmit.fetchRestApi("forms/edit_value",c);u&&(""==(n=u.newvalue)&&(n="X"),null==d?(e=t.querySelectorAll(`tr[data-id="${l}"] td[data-id="${r}"]`)).forEach((e=>{e.innerHTML=n})):i.innerHTML=n,main.displayMessage(u.message))}else console.log(n),i.innerHTML=i.dataset.oldtext;delete e.dataset.oldtext}}document.addEventListener("click",(s=>{var o=s.target;"submit_column_setting"==o.name&&async function(e){var t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(main.displayMessage(t),location.reload())}(o),"submit_table_setting"==o.name&&async function(e){var t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&main.displayMessage(t)}(o),o.matches(".delete.forms_table_action")&&async function(t){if(e("delete")){var a=t.closest("tr").dataset.id,s=t.closest("table"),o=new FormData;o.append("submissionid",a),main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",o)&&s.querySelectorAll(`.table-row[data-id="${a}"]`).forEach((e=>e.remove()))}}(o),o.matches(".archive.forms_table_action, .unarchive.forms_table_action")&&async function(a){var s,o=a.closest("table"),i=a.closest("tr"),r=i.dataset.id,n=!0,l=a.value,d=new FormData;if(d.append("formid",o.dataset.formid),d.append("submissionid",r),d.append("action",l),(null==i.dataset.subid||(n=!1,(s=await Swal.fire({title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"})).isConfirmed&&d.append("subid",i.dataset.subid),!s.isDismissed))&&(!n||e(l))&&(main.showLoader(a),s=await FormSubmit.fetchRestApi("forms/archive_submission",d))){const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});null==d.get("subid")?o.querySelectorAll(`.table-row[data-id="${r}"]`).forEach((a=>{"true"==e.archived?t(a.querySelector(".loaderwrapper, ."+l),l):a.remove()})):o.querySelectorAll(`.table-row[data-id="${r}"][data-subid="${i.dataset.subid}"]`).forEach((a=>{"true"==e.archived?t(a.querySelector(".loaderwrapper"),l):a.remove()}))}}(o),o.matches(".print.forms_table_action")&&(window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent),"form_settings[autoarchive]"==o.name&&(el=o.closest(".table_rights_wrapper").querySelector(".autoarchivelogic"),"true"==o.value?el.classList.remove("hidden"):el.classList.add("hidden")),o.classList.contains("edit_formshortcode_settings")&&o.parentNode.querySelector(".form_shortcode_settings").classList.remove("hidden");var i=o.closest("td");o.matches("td.edit_forms_table")&&null==o.dataset.oldtext?(s.stopPropagation(),a(o)):null!=i&&null==o.dataset.oldtext&&i.matches("td.edit_forms_table")&&"INPUT"!=o.tagName&&"A"!=o.tagName&&"TEXTAREA"!=o.tagName&&!o.closest(".nice-select")&&(s.stopPropagation(),a(o.closest("td"))),o.classList.contains("visibilityicon")&&("SPAN"==o.tagName&&(o=o.querySelector("img")),o.parentNode.matches("th")?async function(e){var t=e.closest("table"),a=t.rows;for(let t=0;t<a.length;t++)a[t].cells[e.cellIndex].classList.add("hidden");e.closest(".form-table-wrapper").querySelector(".reset-col-vis").classList.remove("hidden");var s=new FormData;s.append("formid",t.dataset.formid),s.append("column_name",e.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",s)}(o.parentNode):o.classList.contains("visible")?(o.classList.replace("visible","invisible"),o.src=o.src.replace("visible.png","invisible.png"),o.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="hide"):(o.classList.replace("invisible","visible"),o.src=o.src.replace("invisible.png","visible.png"),o.closest(".column_setting_wrapper").querySelector(".visibilitytype").value="show")),o.matches(".reset-col-vis")&&async function(e){e.closest(".form-table-wrapper").querySelector(".reset-col-vis").classList.add("hidden");var t=e.closest(".form-table-wrapper").querySelector("table");t.querySelectorAll("th.hidden, td.hidden").forEach((e=>e.classList.remove("hidden")));var a=new FormData;a.append("formid",t.dataset.formid);var s=await FormSubmit.fetchRestApi("forms/delete_table_prefs",a);s&&(main.displayMessage(s),location.reload())}(o)})),document.addEventListener("DOMContentLoaded",(function(){if(console.log("Formstable.js loaded"),"undefined"!=typeof Sortable){var e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable_column_settings_rows").forEach((t=>{Sortable.create(t,e)}))}})),document.addEventListener("change",(e=>{var t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main_form_wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable())}))})();
//# sourceMappingURL=forms_table.min.js.map