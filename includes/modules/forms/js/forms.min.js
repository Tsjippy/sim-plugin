!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormFunctions=t():e.FormFunctions=t()}(self,(()=>(()=>{"use strict";var e={d:(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};let l;e.r(t),e.d(t,{changeFieldProperty:()=>S,changeFieldValue:()=>y,changeVisibility:()=>v,cloneNode:()=>s,copyFormInput:()=>a,fixNumbering:()=>d,getFieldValue:()=>r,nextPrev:()=>p,removeDefaultSelect:()=>c,removeNode:()=>u,showTab:()=>h,tidyMultiInputs:()=>m,updateMultiStepControls:()=>f});let o=function(){tinymce.remove(),document.querySelectorAll(".entry-content .wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)})),window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0})),document.querySelectorAll(".wp-switch-editor").forEach((e=>e.addEventListener("click",(t=>{let l=e.closest(".wp-editor-wrap").querySelector(".wp-editor-area"),o=e.closest(".wp-editor-wrap").querySelector(".mce-panel");l.style.visibility="unset",t.target.matches(".switch-tmce")?(o.style.display="block",l.style.display="none"):(o.style.display="none",l.style.display="block")})))),document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach((function(e){null==e._niceselect&&(e._niceselect=NiceSelect.bind(e,{searchable:!0}))}))},n=function(){let e=l.shift();if(null==document.getElementById(e.id)&&"SCRIPT"==e.tagName){var t=document.createElement("script");""==e.type?t.type="text/javascript":t.type=e.type,""!=e.src?t.src=e.src:t.innerHTML=e.innerHTML,t.id=e.id,document.head.appendChild(t),l.length>0?""!=e.src?t.addEventListener("load",n):n():""!=e.src?t.addEventListener("load",o):o()}else l.length>0?n():o()};function r(e,t,l=!0,o=null,n=!1){let r="",c="",i="",s="";return e instanceof Element?(r=e,"INPUT"!=r.tagName&&"TEXTAREA"!=r.tagName&&"SELECT"!=r.tagName&&null==r.closest(".nice-select-dropdown")&&(r=r.querySelector("input, select, textarea")),null==r&&(r=e),c=r.name):e.match("E[0-9]")?(s=`#${e}`,r=t.querySelector(s),c=r.name):(c=e,s=`[name='${c}' i]`,r=t.querySelector(s)),null==r?(console.trace(),console.log("cannot find element with name "+c),i):("radio"==r.type?i=function(e,t){let l=e.querySelector(`${t}:checked`);return null==l?"":l.value}(t,s):"checkbox"==r.type?i=function(e,t,l,o){let n="",r="";return"checkbox"==o.type?o.checked?o.value:"":(null!=l?(r=e.querySelector(`${t}[value="${l}" i]:checked`),null!=r&&(n=l)):(r=e.querySelectorAll(`${t}:checked`),n=[],r.forEach((e=>{n.push(e.value)}))),n)}(t,s,o,e):null!=r.closest(".nice-select-dropdown")&&null!=r.dataset.value?i=r.dataset.value:null!=r.list&&l?i=function(e){let t="",l=e.list.querySelector(`[value='${e.value}' i]`);return null==l?t=e.value:(t=l.dataset.value,""==t&&(t=e.value)),t}(r):null!=r.value&&"undefined"!=r.value&&(i=r.value),n?i.toLowerCase():i)}function c(e){Array.from(e.options).forEach((function(e){e.defaultSelected=!1}))}let i=[];function s(e,t=!0){!function(e){e.querySelectorAll("select").forEach((e=>{-1!=e.selectedIndex&&(e.options[e.selectedIndex].defaultSelected||c(e)),e.selectedOptions.length>0&&(e.selectedOptions[0].defaultSelected=!0),e._niceselect.destroy()})),"undefined"!=typeof tinymce&&e.querySelectorAll(".wp-editor-area").forEach((e=>{let t=tinymce.get(e.id);null!=t&&(i[e.id]=t.settings,t.save(),t.remove())}))}(e);let l=e.cloneNode(!0);return e.querySelectorAll("select").forEach((e=>{e._niceselect=NiceSelect.bind(e,{searchable:!0}),""==e.value&&e._niceselect.clear()})),e.querySelectorAll(".wp-editor-area").forEach((e=>{tinymce.init(i[e.id])})),t?l.querySelectorAll("input,select,textarea").forEach((e=>{"checkbox"==e.type||"radio"==e.type?e.checked=!1:"hidden"!=e.type&&(e.value=""),"select-one"==e.type&&(c(e),e._niceselect=NiceSelect.bind(e,{searchable:!0}),e._niceselect.clear())})):l.querySelectorAll("select").forEach((e=>{e._niceselect=NiceSelect.bind(e,{searchable:!0})})),l}function a(e){let t=s(e);t.querySelectorAll(".upload-files").forEach((function(e){e.dataset.index=nodeNr})),t.querySelectorAll(".documentpreview").forEach((function(e){e.innerHTML=""}));let l=0;if(t.querySelectorAll("select").forEach((t=>{let o=e.getElementsByTagName("select")[l].selectedIndex;t.options[o].style.display="none",t._niceselect.update(),t.nextSibling.querySelector(".current").textContent="Select an option",l++})),null==e.querySelector(".remove")&&null==t.querySelector(".remove")){let l='<button type="button" class="remove button" style="flex: 1;">-</button>';e.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",l),t.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",l)}return e.parentNode.insertBefore(t,e.nextSibling),t}function d(e){e.querySelectorAll(":scope > .clone_div").forEach(((e,t)=>{""!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),null!=e.dataset.divid&&(e.dataset.divid=t),e.querySelectorAll("h3, h4, legend :first-child").forEach((e=>{e.textContent=e.textContent.replace(/[0-9]+(?!.*[0-9])/,t+1)})),e.querySelectorAll("input,select,textarea").forEach((e=>{e.classList.contains("nice-select-search")||(""!=e.id&&null!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),""!=e.name&&null!=e.name&&(e.name=e.name.replace(/[0-9]+(?!.*[0-9])/,t)),"button"==e.type&&(e.value=e.value.replace(/[0-9]+(?!.*[0-9])/,t)))}))}))}function u(e){let t=e.closest(".clone_div"),l=t.closest(".clone_divs_wrapper"),o=l.querySelectorAll(".clone_div");if(o[o.length-1]==t){let e=t.querySelector(".add"),l=t.previousElementSibling;null==l.querySelector(".buttonwrapper .add")&&l.querySelector(".buttonwrapper").appendChild(e)}t.remove(),1==l.querySelectorAll(".clone_div").length&&l.querySelector(".remove").remove(),d(l)}function m(){document.querySelectorAll(".clone_divs_wrapper").forEach((function(e){let t=e.querySelectorAll(":scope > .clone_div");1==t.length&&t[0].querySelectorAll(".remove").forEach((e=>e.remove())),t.forEach((function(e,t,l){e.dataset.divid=t,t!=l.length-1&&e.querySelectorAll(".add:not(:scope .clone_divs_wrapper .add)").forEach((e=>e.remove()))}))}))}function f(e){let t=e.querySelectorAll(".formstep"),l=e.querySelectorAll(".formstep:not(.hidden)"),o=e.querySelectorAll(".multistepcontrols_wrapper .step");for(let e=l.length;e<t.length;e++)o[e].classList.add("hidden");let n=e.querySelector(".formstep:not(.stephidden)");l[l.length-1]==n?(e.querySelector(".nextBtn").classList.add("hidden"),e.querySelector(".form_submit ").classList.remove("hidden")):(e.querySelector(".nextBtn").classList.remove("hidden"),e.querySelector(".form_submit ").classList.add("hidden"))}function h(e,t){if(void 0!==t){if(0==e){let e=t.querySelector(".formsteploader");null!=e&&(e.classList.add("hidden"),t.querySelector(".multistepcontrols").classList.remove("hidden"))}t.querySelectorAll(".formstep:not(.stephidden)").forEach((e=>e.classList.add("stephidden")));let l=t.getElementsByClassName("formstep");if(0==l.length)return;let o=l[e].offsetTop-document.querySelector("#masthead").offsetHeight;window.scrollTo({top:o,behavior:"auto"}),l[e].classList.remove("stephidden"),t.querySelectorAll(".step.active").forEach((e=>{e.classList.remove("active")})),l=t.getElementsByClassName("step"),l[e].classList.add("active"),0==e?t.querySelector('[name="prevBtn"]').classList.add("hidden"):t.querySelector('[name="prevBtn"]').classList.remove("hidden"),e==l.length-1?(t.querySelector('[name="nextBtn"]').classList.add("hidden"),t.querySelector(".form_submit").classList.remove("hidden")):(t.querySelector('[name="nextBtn"]').classList.remove("hidden"),t.querySelector(".form_submit").classList.add("hidden"))}else console.log("no form defined")}function p(e){let t,l=form.querySelectorAll(".formstep"),o=form.querySelectorAll(".step"),n=0;if(l.forEach(((e,t)=>{e.matches(".stephidden")||(n=t)})),e>0){let e=l[n].querySelectorAll(".required:not(.hidden) input, .required:not(.hidden) textarea, .required:not(.hidden) select");for(const l of e)if(null==l.closest(".hidden")&&null==l.closest("div.nice-select")&&("file"!=l.type||null==l.closest(".file_upload_wrap").querySelector(".documentpreview input"))&&(l.required=!0,t=l.reportValidity(),!t))break;if(!t)return;o[n].classList.add("finish")}else o[n].classList.remove("finish");for(Array.from(l).forEach(((e,t)=>{e.classList.contains("hidden")&&o[t].classList.add("hidden")})),n+=e;l[n].classList.contains("hidden")&&(n+=e,!(n>=l.length)););return!(n>=l.length||(h(n,form),0))}function y(e,t,l,o,n=""){let c="",i="";e instanceof Element?(i=e,c=i.name,e=""==i.id?`[name^="${i.name}" i]`:`#${i.id}`):(i=o.querySelector(e),c=i.name);let s=r(i,o,!1,t);if(console.log(s),console.log(t),s==t)return;if(null==i){let e=o.querySelectorAll(`.clone_div [name^="${c}" i]`);if(0===e.length)return;1==e.length?(i=e[0],e=""):(i=e[0],e.forEach(((e,t)=>{0==t?y(e,"","",o):u(e)})))}if(""!=n)if(/\d{4}-\d{2}-\d{2}/.test(t)){let e=new Date(t);e.setDate(e.getDate()+parseInt(n)),t=e.toISOString().split("T")[0]}else t+=parseInt(n);if("radio"==i.type||"checkbox"==i.type)if(""==t)""!=e&&o.querySelectorAll(e).forEach((e=>e.checked=!1));else if(i.value.toLowerCase()==t.toLowerCase())i.checked=!0;else{let e=o.querySelectorAll(`[name="${c}" i]`);for(const l of e)l.value.toLowerCase()==t.toLowerCase()&&(l.checked=!0)}else if(null!=i.list){let e=i.list.querySelector(`[data-value="${t}" i]`);if(null!=e)if(null!=i.closest(".clone_div")){let t;e.value.split(";").forEach((e=>{t=a(i.closest(".clone_div")),y(t.querySelector(i.tagName),e,"",o)})),d(i.closest(".clone_divs_wrapper")),i.closest(".clone_div").remove()}else i.value=e.value;else i.value=t}else i.value=t;let m=new Event("input");i.dispatchEvent(m),"function"==typeof l&&(console.log(i),l(i))}function v(e,t,l){console.log(e),console.log(t);let o=t.closest(".inputwrapper");if(null==o&&(o=t),"add"==e){if(o.matches(".hidden"))return;o.classList.add("hidden")}else{if(!o.matches(".hidden"))return;o.classList.remove("hidden")}let n=new Event("input");o.dispatchEvent(n),"function"==typeof l&&l(t)}function S(e,t,l,o,n,r=""){let c=n.querySelector(e);if(""!=r)if(/\d{4}-\d{2}-\d{2}/.test(l)){let e=new Date(l);e.setDate(e.getDate()+parseInt(r)),l=e.toISOString().split("T")[0]}else l+=parseInt(r);c[t]=l;let i=new Event("input");c.dispatchEvent(i),o(c)}async function w(e){let t=e.closest(".form.table-wrapper"),l=e.outerHTML,o=new FormData,n=t.querySelector(".sim-table.form-data-table").dataset.formid,r=t.querySelector(".sim-table.form-data-table").dataset.shortcodeid;o.append("formid",n),o.append("id",r);const c=new URL(window.location);c.searchParams.get("onlyown")&&o.append("onlyown",!0),c.searchParams.get("all")&&o.append("all",!0),c.searchParams.get("archived")&&o.append("archived",!0);let i=Main.showLoader(e,!1,"Requesting form results...");t.innerHTML=i.outerHTML;let s=await FormSubmit.fetchRestApi("forms/show_form_results",o);s?t.innerHTML=s:i.outerHTML=l}return document.addEventListener("DOMContentLoaded",(function(){console.log("Forms.js is loaded")})),window.addEventListener("online",(function(){document.querySelectorAll(".form_submit").forEach((e=>{e.disabled=!1,e.querySelectorAll(".offline").forEach((e=>e.remove()))}))})),window.addEventListener("offline",(function(){document.querySelectorAll(".form_submit").forEach((e=>{e.disabled=!0,null==e.querySelector(".online")&&(e.innerHTML='<div class="online">'+e.innerHTML+"</div>"),e.innerHTML+='<div class="offline">You are offline</div>'}))})),document.addEventListener("click",(function(e){let t=e.target;if(t.matches(".add")){let e=a(t.closest(".clone_div"));d(t.closest(".clone_divs_wrapper")),e.querySelectorAll(".wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)})),t.remove()}t.matches(".remove")&&u(t),t.matches('.sim_form [name="submit_form"]')&&(e.stopPropagation(),async function(e){let t=e.closest("form");t.querySelectorAll(".required:not(hidden) input, .required:not(hidden) textarea, .required:not(hidden) select").forEach((e=>{null!=e.closest("div.nice-select")||"file"==e.type&&null!=e.closest(".file_upload_wrap").querySelector(".documentpreview input")||(e.required=!0)}));let l=await FormSubmit.submitForm(e,"forms/save_form_input");l&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(l),"true"==t.dataset.reset&&FormSubmit.formReset(t))}(t)),(t.matches(".formbuilder-switch")||t.matches(".formbuilder-switch-back"))&&async function(e){let t,o=e.closest(".sim_form.wrapper"),r=e.outerHTML,c=new FormData;const i=new URL(window.location);e.matches(".formbuilder-switch")?(c.append("formbuilder",!0),i.searchParams.set("formbuilder",!0),t=o.querySelector("form.sim_form").dataset.formid):(i.searchParams.delete("formbuilder"),t=o.querySelector('[name="formid"]').value),window.history.pushState({},"",i),c.append("formid",t);let s=Main.showLoader(e,!1,"Requesting form...");o.innerHTML=s.outerHTML;let a=await FormSubmit.fetchRestApi("forms/form_builder",c);a?(o.innerHTML=a.html,function(e){let t=document.createElement("div");e.js&&(t.innerHTML=e.js,l=[...t.children],n()),e.css&&(t.innerHTML=e.css,[...t.children].forEach((e=>{document.head.appendChild(e)})))}(a)):s.outerHTML=r}(t),(t.matches(".archive-switch-hide")||t.matches(".archive-switch-show"))&&async function(e){const t=new URL(window.location);e.matches(".archive-switch-show")?t.searchParams.set("archived",!0):t.searchParams.delete("archived"),window.history.pushState({},"",t),w(e)}(t),(t.matches(".onlyown-switch-all")||t.matches(".onlyown-switch-on"))&&async function(e){const t=new URL(window.location);e.matches(".onlyown-switch-on")?(t.searchParams.set("onlyown",!0),t.searchParams.delete("all",!0)):(t.searchParams.set("all",!0),t.searchParams.delete("onlyown")),window.history.pushState({},"",t),w(e)}(t)})),t})()));
//# sourceMappingURL=forms.min.js.map