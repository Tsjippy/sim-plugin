{"version":3,"file":"media_gallery.min.js","mappings":"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","sources":["webpack://mediagallery/./media_gallery.js"],"sourcesContent":["console.log('Media galery js loaded');\r\n\r\nfunction showImage(index){\r\n    //hide all containers\r\n    document.querySelectorAll('.large-image:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\r\n    //show new one\r\n    document.querySelector('.large-image[data-index=\"'+index+'\"]').classList.remove('hidden');\r\n}\r\n\r\nasync function load_more(index, showfirst, skipAmount){\r\n    var amount  = document.querySelector('#media-amount').value;\r\n    if(amount == skipAmount) return;\r\n    var types   = [];\r\n    document.querySelectorAll('.media-type-selector:checked').forEach(el=>types.push(el.value));\r\n    \r\n    var formData\t= new FormData();\r\n    formData.append('amount', amount);\r\n    formData.append('page', document.querySelector('#paged').value);\r\n    formData.append('skipAmount', skipAmount);\r\n    formData.append('types', types);\r\n    formData.append('startIndex', index+1);\r\n\r\n    var response    = await fetchRestApi('media_gallery/load_more_media', formData);\r\n\r\n    document.querySelectorAll('#medialoaderwrapper:not(.hidden), .loaderwrapper:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\r\n    if(!response){\r\n        display_message('All media are loaded', 'info');\r\n        document.getElementById('loadmoremedia').classList.add('hidden');\r\n    }else{\r\n        document.querySelector('.mediawrapper').insertAdjacentHTML('beforeEnd', response);\r\n\r\n        if(showfirst){\r\n            var el      = document.querySelector('[data-index=\"'+index+'\"]');\r\n            var next_el = el.nextElementSibling.nextElementSibling;\r\n\r\n            showImage(next_el.dataset.index);\r\n        }\r\n\r\n        //hide the load more button if the last cell has no next button\r\n        var cells = document.querySelectorAll('.large-image');\r\n        if(cells[cells.length-1].querySelector('.nextbtn') == null){\r\n            document.getElementById('loadmoremedia').classList.add('hidden');\r\n        }\r\n    }\r\n}\r\n\r\nasync function mediaSearch(target){\r\n    var amount          = document.querySelector('#media-amount').value;\r\n    var types           = [];\r\n    document.querySelectorAll('.media-type-selector:checked').forEach(el=>types.push(el.value));\r\n    var searchstring    = target.closest('.mediabuttons').querySelector('.searchtext').value;\r\n    \r\n    var formData\t= new FormData();\r\n    formData.append('amount', amount);\r\n    formData.append('types', types);\r\n    formData.append('search', searchstring);\r\n\r\n    var response    = await fetchRestApi('media_gallery/media_search', formData);\r\n    \r\n    if(!response){\r\n        display_message('Nothing found', 'warning');\r\n    }else{\r\n        document.querySelector('.mediawrapper').innerHTML = response;\r\n    }\r\n}\r\n\r\ndocument.querySelectorAll('.searchtext').forEach(el=>{\r\n    el.addEventListener(\"keyup\", function(event){\r\n        if (event.keyCode === 13) {\r\n            mediaSearch(event.target);\r\n        }\r\n    });\r\n});\r\n\r\ndocument.addEventListener('click', async ev=>{\r\n    var target  = ev.target;\r\n    var parent  = target.closest('.large-image');\r\n\r\n    if(target.matches('.media-item')){\r\n        ev.preventDefault();\r\n\t\tev.stopPropagation();\r\n        showImage(target.closest('.cell').dataset.index);\r\n    }\r\n\r\n    if(target.matches('.closebtn')){\r\n        parent.classList.add('hidden');\r\n\r\n        //stop any video's\r\n        var iframe  = parent.querySelector( 'iframe');\r\n        if(iframe != null){\r\n            iframe.src  = iframe.src;\r\n        }\r\n    }\r\n\r\n    if(target.matches('.prevbtn')){\r\n        var el      = target.closest('.large-image');\r\n        var prev_el = el.previousElementSibling.previousElementSibling;\r\n\r\n        showImage(prev_el.dataset.index);\r\n    }\r\n\r\n    if(target.matches('.nextbtn')){\r\n        var el      = target.closest('.large-image');\r\n        var next_el = el.nextElementSibling;\r\n        if(next_el != null){\r\n            var next_el = next_el.nextElementSibling;\r\n        }\r\n\r\n        //load more\r\n        if(next_el == null){\r\n            document.getElementById('medialoaderwrapper').classList.remove('hidden');\r\n\r\n            document.getElementById('paged').value = parseInt(document.getElementById('paged').value)+1;\r\n            load_more(el.dataset.index, true);\r\n        }else{\r\n            showImage(next_el.dataset.index);\r\n        }\r\n    }\r\n\r\n    if(target.id == 'loadmoremedia'){\r\n        ev.preventDefault();\r\n\t\tev.stopPropagation();\r\n        //find the last image\r\n        var media = document.querySelectorAll('.cell');\r\n\r\n        document.getElementById('paged').value = parseInt(document.getElementById('paged').value)+1;\r\n\r\n        load_more(media[media.length-1].firstChild.dataset.index, false);\r\n\r\n        showLoader(target, false);\r\n    }\r\n\r\n    if(target.matches('.buttonwrapper .description')){\r\n        display_message(target.dataset.description);\r\n    }\r\n\r\n    // media type selector\r\n    if(target.matches('.media-type-selector')){\r\n        if(target.checked){\r\n            document.querySelectorAll('.cell.'+target.value).forEach(el=>el.classList.remove('hidden'));\r\n\r\n            // remove all more than the maximum\r\n            var visible_cells   = document.querySelectorAll('.cell:not(.hidden)');\r\n            var amount          = document.querySelector('#media-amount').value;\r\n            for (let i = amount; i < visible_cells.length; i++) { \r\n                visible_cells[i].remove();\r\n            }\r\n        }else{\r\n            document.querySelectorAll('.cell.'+target.value).forEach(el=>el.classList.add('hidden'));\r\n\r\n            var media = document.querySelectorAll('.cell');\r\n            // load more of the remaining types untill we reach the maximum\r\n            var visible_cells   = document.querySelectorAll('.cell:not(.hidden)');\r\n            load_more(media[media.length-1].dataset.index, false, visible_cells.length);\r\n        }\r\n    }\r\n\r\n    if(target.matches('.mediabuttons .search')){\r\n        ev.preventDefault();\r\n\t\tev.stopPropagation();\r\n        mediaSearch(target);\r\n    }\r\n\r\n    if(target.matches('.download')){\r\n        ev.preventDefault();\r\n        var answer = await Swal.fire({\r\n            title: 'Warning',\r\n            html: \"Downloading of materials is only allowed for use in presentations. <br>You should not share this file with others as it may contain privacy sensitive information\",\r\n            showCancelButton: true,\r\n            confirmButtonText: 'I promise not to share this file',\r\n            confirmButtonColor: \"#bd2919\"\r\n        });\r\n    \r\n        //swap and/or\r\n        if (answer.isConfirmed) {\r\n            console.log(target.querySelector('a'));\r\n            target.querySelector('a').click();\r\n        }\r\n    }\r\n});\r\n\r\ndocument.addEventListener('change', ev=>{\r\n    var target= ev.target;\r\n\r\n    if(target.id=='media-amount'){\r\n        //reset page count\r\n        document.getElementById('paged').value = 1;\r\n\r\n        //Check how many we have currently\r\n        var media       = document.querySelectorAll('.cell');\r\n        var curAmount   = media.length;\r\n\r\n        // We need to add more\r\n        if(target.value > curAmount){\r\n            var start   = parseInt(media[media.length-1].dataset.index);\r\n            load_more(start, false, curAmount);\r\n        // We need to remove some\r\n        }else if(target.value < curAmount){\r\n            var i = 1;\r\n            document.querySelectorAll('.cell, .large-image').forEach(el=>{\r\n                if(i > target.value){\r\n                    el.remove()\r\n                }\r\n\r\n                if(el.matches('.cell')){\r\n                    i++;\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction handleTouchStart(evt) {\r\n    const firstTouch = evt.touches[0];                                      \r\n    xDown = firstTouch.clientX;                                      \r\n    yDown = firstTouch.clientY;                                      \r\n};                                                \r\n                                                                           \r\nfunction handleTouchMove(evt) {\r\n    if ( ! xDown || ! yDown ) {\r\n        return;\r\n    }\r\n\r\n    var xUp = evt.touches[0].clientX;                                    \r\n    var yUp = evt.touches[0].clientY;\r\n\r\n    var xDiff = xDown - xUp;\r\n    var yDiff = yDown - yUp;\r\n                                                                        \r\n    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {\r\n        var el = document.querySelector('.large-image:not(.hidden)');\r\n        if ( xDiff > 0 ) {\r\n            /* right swipe */\r\n            var next_el = el.nextElementSibling.nextElementSibling;\r\n        } else {\r\n            /* left swipe */\r\n            var next_el = el.previousElementSibling.previousElementSibling;\r\n        }\r\n        showImage(next_el.dataset.index);\r\n    }\r\n    /* reset values */\r\n    xDown = null;\r\n    yDown = null;                                             \r\n};\r\n\r\n\r\nvar xDown = null;                                                        \r\nvar yDown = null;\r\ndocument.addEventListener('touchstart', handleTouchStart);        \r\ndocument.addEventListener('touchmove', handleTouchMove);"],"names":["showImage","index","document","querySelectorAll","forEach","el","classList","add","querySelector","remove","async","load_more","showfirst","skipAmount","amount","value","types","push","formData","FormData","append","response","fetchRestApi","insertAdjacentHTML","nextElementSibling","dataset","cells","length","getElementById","display_message","mediaSearch","target","searchstring","closest","innerHTML","console","log","addEventListener","event","keyCode","ev","parent","matches","preventDefault","stopPropagation","iframe","src","previousElementSibling","next_el","parseInt","id","media","firstChild","showLoader","description","checked","visible_cells","i","Swal","fire","title","html","showCancelButton","confirmButtonText","confirmButtonColor","isConfirmed","click","curAmount","xDown","yDown","evt","firstTouch","touches","clientX","clientY","xUp","yUp","xDiff","yDiff","Math","abs"],"sourceRoot":""}