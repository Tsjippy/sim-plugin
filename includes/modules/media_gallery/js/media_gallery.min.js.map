{"version":3,"file":"media_gallery.min.js","mappings":"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","sources":["webpack://mediagallery/./media_gallery.js"],"sourcesContent":["function showImage(index){\r\n    //hide all containers\r\n    document.querySelectorAll('.large-image:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\r\n    //show new one\r\n    document.querySelector('.large-image[data-index=\"'+index+'\"]').classList.remove('hidden');\r\n}\r\n\r\nfunction load_more(index, showfirst, skipAmount){\r\n    var formData\t= new FormData();\r\n\tformData.append('_wpnonce', sim.restnonce);\r\n\r\n    var amount  = document.querySelector('#media-amount').value;\r\n\r\n    if(amount == skipAmount) return;\r\n\r\n    formData.append('amount', amount);\r\n    formData.append('page', document.querySelector('#paged').value);\r\n    formData.append('skipAmount', skipAmount);\r\n    var types   = [];\r\n    document.querySelectorAll('.media-type-selector:checked').forEach(el=>types.push(el.value));\r\n    formData.append('types', types);\r\n    formData.append('startIndex', index+1);\r\n\t\r\n\tfetch(\r\n\t\tsim.base_url+'/wp-json/sim/v1/load_more_media', \r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t\tbody: formData\r\n\t\t}\r\n\t).then(response => response.json())\r\n\t.then(response => {\r\n        document.querySelectorAll('#medialoaderwrapper:not(.hidden), .loaderwrapper:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\r\n        if(response == false){\r\n            display_message('All media are loaded', 'info');\r\n            document.getElementById('loadmoremedia').classList.add('hidden');\r\n        }else{\r\n            document.querySelector('.mediawrapper').insertAdjacentHTML('beforeEnd', response);\r\n\r\n            if(showfirst){\r\n                var el      = document.querySelector('[data-index=\"'+index+'\"]');\r\n                var next_el = el.nextElementSibling.nextElementSibling;\r\n\r\n                showImage(next_el.dataset.index);\r\n            }\r\n\r\n            //hide the load more button if the last cell has no next button\r\n            var cells = document.querySelectorAll('.large-image');\r\n            if(cells[cells.length-1].querySelector('.nextbtn') == null){\r\n                document.getElementById('loadmoremedia').classList.add('hidden');\r\n            }\r\n        }       \r\n\t})\r\n\t.catch(err => console.error(err));\r\n}\r\n\r\nfunction mediaSearch(target){\r\n    var formData\t= new FormData();\r\n    formData.append('_wpnonce', sim.restnonce);\r\n\r\n    var amount      = document.querySelector('#media-amount').value;\r\n    formData.append('amount', amount);\r\n\r\n    var types   = [];\r\n    document.querySelectorAll('.media-type-selector:checked').forEach(el=>types.push(el.value));\r\n    formData.append('types', types);\r\n\r\n    var searchstring= target.closest('.mediabuttons').querySelector('.searchtext').value;\r\n    formData.append('search', searchstring);\r\n    \r\n    fetch(\r\n        sim.base_url+'/wp-json/sim/v1/media_search', \r\n        {\r\n            method: 'POST',\r\n            credentials: 'same-origin',\r\n            body: formData\r\n        }\r\n    ).then(response => response.json())\r\n    .then(response => {\r\n        if(response == false){\r\n            display_message('Nothing found', 'warning');\r\n        }else{\r\n            document.querySelector('.mediawrapper').innerHTML = response;\r\n        }       \r\n    })\r\n    .catch(err => console.error(err));\r\n}\r\n\r\ndocument.querySelectorAll('.searchtext').forEach(el=>{\r\n    el.addEventListener(\"keyup\", function(event){\r\n        if (event.keyCode === 13) {\r\n            mediaSearch(event.target);\r\n        }\r\n    });\r\n});\r\n\r\ndocument.addEventListener('click', ev=>{\r\n    var target  = ev.target;\r\n    var parent  = target.closest('.large-image');\r\n\r\n    if(target.matches('.media-item')){\r\n        showImage(target.closest('.cell').dataset.index);\r\n    }\r\n\r\n    if(target.matches('.closebtn')){\r\n        parent.classList.add('hidden');\r\n\r\n        //stop any video's\r\n        var iframe  = parent.querySelector( 'iframe');\r\n        if(iframe != null){\r\n            iframe.src  = iframe.src;\r\n        }\r\n    }\r\n\r\n    if(target.matches('.prevbtn')){\r\n        var el      = target.closest('.large-image');\r\n        var prev_el = el.previousElementSibling.previousElementSibling;\r\n\r\n        showImage(prev_el.dataset.index);\r\n    }\r\n\r\n    if(target.matches('.nextbtn')){\r\n        var el      = target.closest('.large-image');\r\n        var next_el = el.nextElementSibling;\r\n        if(next_el != null){\r\n            var next_el = next_el.nextElementSibling;\r\n        }\r\n\r\n        //load more\r\n        if(next_el == null){\r\n            document.getElementById('medialoaderwrapper').classList.remove('hidden');\r\n\r\n            document.getElementById('paged').value = parseInt(document.getElementById('paged').value)+1;\r\n            load_more(el.dataset.index, true);\r\n        }else{\r\n            showImage(next_el.dataset.index);\r\n        }\r\n    }\r\n\r\n    if(target.id == 'loadmoremedia'){\r\n        //find the last image\r\n        var media = document.querySelectorAll('.cell');\r\n\r\n        document.getElementById('paged').value = parseInt(document.getElementById('paged').value)+1;\r\n\r\n        load_more(media[media.length-1].firstChild.dataset.index, false);\r\n\r\n        showLoader(target, false);\r\n    }\r\n\r\n    if(target.matches('.buttonwrapper .description')){\r\n        display_message(target.dataset.description);\r\n    }\r\n\r\n    // media type selector\r\n    if(target.matches('.media-type-selector')){\r\n        if(target.checked){\r\n            document.querySelectorAll('.cell.'+target.value).forEach(el=>el.classList.remove('hidden'));\r\n\r\n            // remove all more than the maximum\r\n            var visible_cells   = document.querySelectorAll('.cell:not(.hidden)');\r\n            var amount          = document.querySelector('#media-amount').value;\r\n            for (let i = amount; i < visible_cells.length; i++) { \r\n                visible_cells[i].remove();\r\n            }\r\n        }else{\r\n            document.querySelectorAll('.cell.'+target.value).forEach(el=>el.classList.add('hidden'));\r\n\r\n            var media = document.querySelectorAll('.cell');\r\n            // load more of the remaining types untill we reach the maximum\r\n            var visible_cells   = document.querySelectorAll('.cell:not(.hidden)');\r\n            load_more(media[media.length-1].dataset.index, false, visible_cells.length);\r\n        }\r\n    }\r\n\r\n    if(target.matches('.mediabuttons .search')){\r\n        mediaSearch(target);\r\n    }\r\n});\r\n\r\ndocument.addEventListener('change', ev=>{\r\n    var target= ev.target;\r\n\r\n    if(target.id=='media-amount'){\r\n        //reset page count\r\n        document.getElementById('paged').value = 1;\r\n\r\n        //Check how many we have currently\r\n        var media       = document.querySelectorAll('.cell');\r\n        var curAmount   = media.length;\r\n\r\n        // We need to add more\r\n        if(target.value > curAmount){\r\n            var start   = parseInt(media[media.length-1].dataset.index);\r\n            load_more(start, false, curAmount);\r\n        // We need to remove some\r\n        }else if(target.value < curAmount){\r\n            var i = 1;\r\n            document.querySelectorAll('.cell, .large-image').forEach(el=>{\r\n                if(i > target.value){\r\n                    el.remove()\r\n                }\r\n\r\n                if(el.matches('.cell')){\r\n                    i++;\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\nfunction handleTouchStart(evt) {\r\n    const firstTouch = evt.touches[0];                                      \r\n    xDown = firstTouch.clientX;                                      \r\n    yDown = firstTouch.clientY;                                      \r\n};                                                \r\n                                                                           \r\nfunction handleTouchMove(evt) {\r\n    if ( ! xDown || ! yDown ) {\r\n        return;\r\n    }\r\n\r\n    var xUp = evt.touches[0].clientX;                                    \r\n    var yUp = evt.touches[0].clientY;\r\n\r\n    var xDiff = xDown - xUp;\r\n    var yDiff = yDown - yUp;\r\n                                                                        \r\n    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {\r\n        var el = document.querySelector('.large-image:not(.hidden)');\r\n        if ( xDiff > 0 ) {\r\n            /* right swipe */\r\n            var next_el = el.nextElementSibling.nextElementSibling;\r\n        } else {\r\n            /* left swipe */\r\n            var next_el = el.previousElementSibling.previousElementSibling;\r\n        }\r\n        showImage(next_el.dataset.index);\r\n    }\r\n    /* reset values */\r\n    xDown = null;\r\n    yDown = null;                                             \r\n};\r\n\r\n\r\nvar xDown = null;                                                        \r\nvar yDown = null;\r\ndocument.addEventListener('touchstart', handleTouchStart);        \r\ndocument.addEventListener('touchmove', handleTouchMove);"],"names":["showImage","index","document","querySelectorAll","forEach","el","classList","add","querySelector","remove","load_more","showfirst","skipAmount","formData","FormData","append","sim","restnonce","amount","value","types","push","fetch","base_url","method","credentials","body","then","response","json","display_message","getElementById","insertAdjacentHTML","nextElementSibling","dataset","cells","length","catch","err","console","error","mediaSearch","target","searchstring","closest","innerHTML","addEventListener","event","keyCode","ev","parent","matches","iframe","src","previousElementSibling","next_el","parseInt","id","media","firstChild","showLoader","description","checked","visible_cells","i","curAmount","xDown","yDown","evt","firstTouch","touches","clientX","clientY","xUp","yUp","xDiff","yDiff","Math","abs"],"sourceRoot":""}