(()=>{function e(e){document.querySelectorAll(".large-image:not(.hidden)").forEach((e=>e.classList.add("hidden")));let t=document.querySelector(`.large-image[data-index="${e}"]`),a=t.querySelector(".image img");null!=a&&null!=a.dataset.full&&(a.src=a.dataset.full),t.classList.remove("hidden")}async function t(t,a,l=0){let n=document.getElementById("loadmoremedia");null!=n&&n.classList.add("hidden");var o=document.querySelector("#media-amount").value;if(o!=l){var d=[];document.querySelectorAll(".media-type-selector:checked").forEach((e=>d.push(e.value)));var r=[];document.querySelectorAll(".media-cat-selector:checked").forEach((e=>r.push(e.value)));var c=new FormData;c.append("amount",o),c.append("page",document.querySelector("#paged").value),c.append("skipAmount",l),c.append("types",d),c.append("categories",r),c.append("startIndex",t+1);var i=await FormSubmit.fetchRestApi("media_gallery/load_more_media",c);if(document.getElementById("medialoaderwrapper").classList.add("hidden"),i){null!=n&&n.classList.remove("hidden"),document.querySelector(".mediawrapper").insertAdjacentHTML("beforeEnd",i),a&&e(document.querySelector(`[data-index="${t}"]`).nextElementSibling.nextElementSibling.dataset.index);var u=document.querySelectorAll(".large-image");null==u[u.length-1].querySelector(".nextbtn")&&document.getElementById("loadmoremedia").classList.add("hidden")}else Main.displayMessage("All media are loaded","info");null!=n&&n.parentNode.querySelector(".loaderwrapper").remove()}}async function a(e){var t=document.querySelector("#media-amount").value,a=[];document.querySelectorAll(".media-type-selector:checked").forEach((e=>a.push(e.value)));var l=e.closest(".mediabuttons").querySelector(".searchtext").value,n=new FormData;n.append("amount",t),n.append("types",a),n.append("search",l);var o=await FormSubmit.fetchRestApi("media_gallery/media_search",n);o?document.querySelector(".mediawrapper").innerHTML=o:Main.displayMessage("Nothing found","warning")}console.log("Media galery js loaded"),document.querySelectorAll(".searchtext").forEach((e=>{e.addEventListener("keyup",(function(e){13===e.keyCode&&a(e.target)}))})),document.addEventListener("click",(async l=>{var n=l.target,o=n.closest(".large-image");if(n.matches(".media-item"))l.preventDefault(),l.stopPropagation(),e(n.closest(".cell").dataset.index);else if(n.matches(".closebtn")){o.classList.add("hidden");var d=o.querySelector("iframe");null!=d&&(d.src=d.src)}else n.matches(".prevbtn")?e(n.closest(".large-image").previousElementSibling.previousElementSibling.dataset.index):n.matches(".nextbtn")?function(a){let l=a.closest(".large-image"),n=l.nextElementSibling;null!=n&&(n=n.nextElementSibling),null==n?(document.getElementById("medialoaderwrapper").classList.remove("hidden"),document.getElementById("paged").value=parseInt(document.getElementById("paged").value)+1,t(l.dataset.index,!0)):e(n.dataset.index)}(n):"loadmoremedia"==n.id?(l.preventDefault(),l.stopPropagation(),function(e){let a=document.querySelectorAll(".cell");document.getElementById("paged").value=parseInt(document.getElementById("paged").value)+1,t(a[a.length-1].dataset.index,!1),Main.showLoader(e,!1)}(n)):n.matches(".buttonwrapper .description")?Main.displayMessage(atob(n.dataset.description)):n.matches(".media-type-selector")?function(e){let a,l=document.querySelector("#media-amount").value;if(e.checked||0==document.querySelectorAll(".media-type-selector:checked").length){document.querySelectorAll(`.cell.${e.value}.hidden`).forEach((e=>e.classList.remove("hidden"))),e.checked&&document.querySelectorAll(".media-type-selector:not(:checked)").forEach((e=>{document.querySelectorAll(`.cell.${e.value}:not(.hidden)`).forEach((e=>e.classList.add("hidden")))})),a=document.querySelectorAll(".cell:not(.hidden)");for(let e=l;e<a.length;e++)document.querySelector(`.mediawrapper [data-index="${a[e].dataset.index}"`).remove()}else document.querySelectorAll(`.cell.${e.value}`).forEach((e=>e.classList.add("hidden")));let n=document.querySelectorAll(".cell"),o=document.querySelectorAll(".cell:not(.hidden)").length;if(o<l){let e="";document.querySelectorAll(".media-type-selector:checked").forEach((t=>{""!=e&&(e+=" and "),e+=t.value+"s"})),Main.showLoader(document.getElementById("loadmoremedia"),!1,"Loading "+e);let a=0;n.length>0&&(a=n[n.length-1].dataset.index),t(a,!1,o)}}(n):n.matches(".mediabuttons .search")?(l.preventDefault(),l.stopPropagation(),a(n)):n.matches(".download")?(l.preventDefault(),async function(e){let t={title:"Warning",html:"Downloading of materials is only allowed for use in presentations. <br>You should not share this file with others as it may contain privacy sensitive information",showCancelButton:!0,confirmButtonText:"I promise not to share this file",confirmButtonColor:"#bd2919"};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),(await Swal.fire(t)).isConfirmed&&e.querySelector("a").click()}(n)):n.matches(".media-cat-selector")?async function(e){document.querySelector(".mediawrapper").innerHTML="";let t=Main.showLoader(document.querySelector(".mediawrapper"),!1,"Loading");var a=document.querySelector("#media-amount").value,l=[];document.querySelectorAll(".media-type-selector:checked").forEach((e=>l.push(e.value)));var n=[];document.querySelectorAll(".media-cat-selector:checked").forEach((e=>n.push(e.value)));var o=new FormData;o.append("amount",a),o.append("types",l),o.append("categories",n);var d=await FormSubmit.fetchRestApi("media_gallery/change_cats",o);d&&(document.querySelector(".mediawrapper").innerHTML=d),t.remove()}():(n.id="category-options")&&n.closest(".mediagallery-wrapper").querySelector(".media-categories").classList.toggle("hidden")})),document.addEventListener("change",(e=>{var a=e.target;if("media-amount"==a.id){document.getElementById("paged").value=1;var l=document.querySelectorAll(".cell"),n=l.length;if(a.value>n)t(parseInt(l[l.length-1].dataset.index),!1,n),Main.showLoader(document.getElementById("loadmoremedia"),!1,"Loading more...");else if(a.value<n){var o=1;document.querySelectorAll(".cell, .large-image").forEach((e=>{o>a.value&&e.remove(),e.matches(".cell")&&o++}))}}}));var l=null,n=null;document.addEventListener("touchstart",(function(e){const t=e.touches[0];l=t.clientX,n=t.clientY})),document.addEventListener("touchmove",(function(t){if(l&&n){var a=t.touches[0].clientX,o=t.touches[0].clientY,d=l-a,r=n-o;if(Math.abs(d)>Math.abs(r)){var c=document.querySelector(".large-image:not(.hidden)");e((d>0?c.nextElementSibling.nextElementSibling:c.previousElementSibling.previousElementSibling).dataset.index)}l=null,n=null}}))})();
//# sourceMappingURL=media_gallery.min.js.map