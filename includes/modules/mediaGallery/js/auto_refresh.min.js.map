{"version":3,"file":"auto_refresh.min.js","mappings":"MAAAA,SAASC,iBAAiB,oBAAoB,KAC1CC,QAAQC,IAAI,wCACZH,SAASI,iBAAiB,0BAA0BC,SAAQC,IACxDC,EAAmBD,GAAS,EAAK,GACpC,IAIL,IAAIC,EAAuBC,eAAeF,EAASG,GAAM,GACrD,IAAIC,EAAUC,SAASL,EAAQM,QAAQF,OAEvC,GAAoB,iBAAX,EACL,OAGJ,IAAIG,EAAcP,EAElB,IAAIG,EAAM,CACN,IAAIK,EAAW,IAAIC,SACnBD,EAASE,OAAO,QAASV,EAAQM,QAAQK,OACzCH,EAASE,OAAO,SAAUV,EAAQF,iBAAiB,kBAAkBc,QACrEJ,EAASE,OAAO,aAAcV,EAAQM,QAAQO,YAC9CL,EAASE,OAAO,QAASN,GACzBI,EAASE,OAAO,QAASV,EAAQc,cAAc,wBAAwBC,aACvEP,EAASE,OAAO,QAASV,EAAQgB,MAAMC,YACvCT,EAASE,OAAO,OAAQV,EAAQM,QAAQY,MACxC,IAAIC,QAAiBC,WAAWC,aAAa,mCAAoCb,GAAU,GAE3F,GAAGW,EAAS,CAER,IAAIG,EAAM5B,SAAS6B,cAAc,OACjCD,EAAIE,UAAcL,EAClBZ,EAAkBe,EAAIR,cAAc,0BAEpC,IAAIW,EAAUlB,EAAWT,iBAAiB,OACtC4B,EAAUD,EAAKb,OACnBa,EAAK1B,SAAQ4B,IACTA,EAAIC,gBAAgB,WACpBD,EAAIhC,iBAAiB,QAAQ,KACzB+B,IAIc,IAAXA,GAEC1B,EAAQ6B,YAAYtB,EACxB,IAEJoB,EAAIG,IAAIH,EAAIG,MAEpB,CACJ,CAEAC,WACI9B,EACM,IAANG,EACAG,EAER,C","sources":["webpack://mediagallery/./auto_refresh.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', () => {   \r\n    console.log('Auto refresh media gallery.js loaded');\r\n    document.querySelectorAll('.media-gallery-article').forEach(gallery => {\r\n        reloadMediaGallery(gallery, true);\r\n    })\r\n});\r\n\r\n\r\nlet reloadMediaGallery   = async function(gallery, first=false){\r\n    let speed   = parseInt(gallery.dataset.speed);\r\n\r\n    if(typeof(speed) != 'number'){\r\n        return;\r\n    }\r\n\r\n    let newGallery  = gallery\r\n\r\n    if(!first){\r\n        var formData = new FormData();\r\n        formData.append('types', gallery.dataset.types);\r\n        formData.append('amount', gallery.querySelectorAll('.media-gallery').length);\r\n        formData.append('categories', gallery.dataset.categories);\r\n        formData.append('speed', speed);\r\n        formData.append('title', gallery.querySelector('.media-gallery-title').textContent);\r\n        formData.append('color', gallery.style.background);\r\n        formData.append('desc', gallery.dataset.desc);\r\n        var response = await FormSubmit.fetchRestApi('media_gallery/show_media_gallery', formData, false);\r\n\r\n        if(response){\r\n            // convert the html to a node so we can pass it on to the next iteration\r\n            let div = document.createElement('div');\r\n            div.innerHTML   = response;\r\n            newGallery      = div.querySelector('.media-gallery-article');\r\n\r\n            let imgs    = newGallery.querySelectorAll('img');\r\n            let amount  = imgs.length;\r\n            imgs.forEach(img=>{\r\n                img.removeAttribute('loading');\r\n                img.addEventListener('load', () => {\r\n                    amount--;\r\n\r\n                    //console.log('Current amount is '+amount);\r\n\r\n                    if(amount === 0){\r\n                        //console.log('Updating ');\r\n                        gallery.replaceWith(newGallery);\r\n                    }\r\n                });\r\n                img.src=img.src\r\n            });\r\n        }\r\n    }\r\n\r\n    setTimeout(\r\n        reloadMediaGallery,\r\n        speed*1000,\r\n        newGallery\r\n    );\r\n}"],"names":["document","addEventListener","console","log","querySelectorAll","forEach","gallery","reloadMediaGallery","async","first","speed","parseInt","dataset","newGallery","formData","FormData","append","types","length","categories","querySelector","textContent","style","background","desc","response","FormSubmit","fetchRestApi","div","createElement","innerHTML","imgs","amount","img","removeAttribute","replaceWith","src","setTimeout"],"sourceRoot":""}