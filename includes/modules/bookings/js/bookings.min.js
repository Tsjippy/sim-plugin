(()=>{function e(e,t=!1){t||(e.querySelector(".booking-startdate").value="",e.querySelector(".calendar.day.startdate").classList.remove("startdate"),e.querySelectorAll(".available.unavailable").forEach((e=>e.classList.remove("unavailable"))),e.querySelector(".booking-date-label-wrapper.enddate").classList.add("disabled")),e.querySelector(".booking-enddate").value="",e.querySelector(".calendar.day.enddate").classList.remove("enddate"),e.querySelectorAll(".inbetween").forEach((e=>e.classList.remove("inbetween")))}document.addEventListener("DOMContentLoaded",(()=>{console.log("Bookings.js loaded"),document.querySelectorAll(".booking-subject-selector").forEach((e=>e.addEventListener("change",(e=>{Main.showModal(document.querySelector(`[name="${e.target.value}-modal"]`))})))),document.querySelectorAll(".admin-booking-subject-selector").forEach((e=>e.addEventListener("change",(e=>{document.querySelector(`.bookings-wrap[data-subject="${e.target.value}"]`).classList.toggle("hidden")})))),document.querySelectorAll(".tables-wrapper").forEach((e=>{offset=e.getBoundingClientRect().x,e.style.marginLeft=`-${offset}px`}))})),document.addEventListener("click",(t=>{let a=t.target,o=a.closest(".modal");null!=a.closest("dt")&&(a=a.closest("dt")),a.matches(".action.reset")&&e(o),a.matches(".prevnext")&&async function(e){let t=e.closest(".bookings-wrap"),a=t.querySelector(`.month-container[data-month="${e.dataset.month}"][data-year="${e.dataset.year}"]`);if(null!=e.closest(".prev")?t.querySelectorAll(".calendar.table .month-container:not(.hidden)")[1].classList.add("hidden"):t.querySelectorAll(".calendar.table .month-container:not(.hidden)")[0].classList.add("hidden"),null==a){let a=new FormData;a.append("month",e.dataset.month),a.append("year",e.dataset.year),a.append("subject",e.closest(".bookings-wrap").dataset.subject),a.append("shortcodeid",e.closest(".bookings-wrap").dataset.shortcodeid);let o=document.createElement("DIV");o.setAttribute("class","loaderwrapper");let l=document.createElement("IMG");l.setAttribute("src",sim.loadingGif),o.insertAdjacentElement("beforeEnd",l),t.querySelector(".calendar.table").insertAdjacentElement("beforeEnd",o);let n=await FormSubmit.fetchRestApi("bookings/get_next_month",a);n&&(o.outerHTML=n.month,t.querySelector(".navigators .navigator:not(.hidden)").classList.add("hidden"),t.querySelector(".navigators").insertAdjacentHTML("beforeEnd",n.navigator),t.querySelector(".booking.details-wrapper").insertAdjacentHTML("beforeEnd",n.details))}else t.querySelector(".navigators .navigator:not(.hidden)").classList.add("hidden"),console.log(t),console.log(e),t.querySelector(`.navigator[data-month="${e.dataset.month}"][data-year="${e.dataset.year}"]`).classList.remove("hidden"),a.classList.remove("hidden")}(a),a.matches('.change-booking-date, [name="booking-startdate"], [name="booking-enddate"]')&&function(e){let t="",a=document.querySelector(".booking-subject-selector");t=null==a?".booking.modal":`[name="${a.value}-modal"]`,document.querySelector(t).classList.remove("hidden")}(),a.matches(".action.confirm")&&function(t){let a=t.closest(".modal"),o=t.closest("form").querySelector('[name="booking-startdate"]'),l=t.closest("form").querySelector('[name="booking-enddate"]');o.value=a.querySelector(".booking-startdate").dataset.isodate,l.value=a.querySelector(".booking-enddate").dataset.isodate,o.closest(".selected-booking-dates").classList.remove("hidden"),Main.hideModals(),t.closest("form").querySelector(".change-booking-date").textContent="Change",e(a)}(a),a.matches(".bookings-wrap .available:not(.unavailable)")&&function(t){let a=t.closest(".modal");if(null!=a){if(null!=a.querySelector(".calendar.day.startdate")&&null!=a.querySelector(".calendar.day.enddate")){let o=!1;t.matches(".inbetween")&&(o=!0),e(a,o)}if(null==a.querySelector(".calendar.day.startdate")){a.querySelector(".booking-startdate").value=t.dataset.date,a.querySelector(".booking-startdate").dataset.isodate=t.dataset.isodate,t.classList.add("startdate"),a.querySelectorAll(".booking-date-label-wrapper.disabled").forEach((e=>e.classList.remove("disabled")));let e=t.closest(".calendar.table").querySelectorAll("dt.calendar.day:not(.head, .unavailable)"),o=!1;for(i=0;i<e.length;++i)e[i]==t?o=!0:o&&e[i].matches(".booked:not(.available)")&&(o=!1),o||e[i].classList.add("unavailable")}else{a.querySelector(".booking-enddate").value=t.dataset.date,a.querySelector(".booking-enddate").dataset.isodate=t.dataset.isodate,t.classList.add("enddate"),t.closest(".calendar.table").querySelectorAll(".available.booked:not(.enddate, .startdate)").forEach((e=>e.classList.remove("booked")));let e=t.closest(".calendar.table").querySelectorAll("dt.calendar.day:not(.head)"),o=!0;for(i=0;i<e.length&&e[i]!=t;++i)o||e[i].classList.add("inbetween"),e[i].matches(".startdate")&&(o=!1);a.querySelectorAll(".actions .action.disabled").forEach((e=>e.classList.remove("disabled")))}}}(a),a.matches(".form.table-wrapper .booked")&&(a.closest(".bookings-wrap").querySelectorAll(".booking-detail-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),a.closest(".bookings-wrap").querySelector(`.booking-detail-wrapper[data-bookingid="${a.dataset.bookingid}"]`).classList.remove("hidden")),a.matches(".button.approve")?async function(e){let t=new FormData;t.append("id",e.dataset.id);let a=e.closest("tr");Main.showLoader(e.closest("td"));let o=await FormSubmit.fetchRestApi("bookings/approve",t);if(o){a.remove();let e=document.querySelector(`.bookings-wrap[data-subject='${o.subject}']`);for(let t=0;t<o.months.length;t++)e.querySelectorAll(`.month-container[data-month='${o.months[t]}'][data-year='${o.years[t]}']`).forEach((e=>e.outerHTML=o.html));e.querySelector(".booking.details-wrapper").insertAdjacentHTML("beforeEnd",o.details)}}(a):a.matches(".button.delete")&&async function(e){let t=new FormData;t.append("id",e.dataset.id);let a=e.closest("tr");Main.showLoader(e.closest("td"));let o=await FormSubmit.fetchRestApi("bookings/remove",t);o&&(a.remove(),Main.displayMessage(o))}(a)}))})();
//# sourceMappingURL=bookings.min.js.map