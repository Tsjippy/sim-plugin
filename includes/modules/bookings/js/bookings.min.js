(()=>{function e(e,t=!1,a=!0){t||(e.querySelector(".booking-startdate").value="",e.querySelectorAll(".calendar.day.startdate").forEach((e=>e.classList.remove("startdate"))),e.querySelectorAll(".available.unavailable").forEach((e=>e.classList.remove("unavailable"))),e.querySelector(".booking-date-label-wrapper.enddate").classList.add("disabled")),e.querySelector(".booking-enddate").value="",e.querySelectorAll(".calendar.day.enddate").forEach((e=>e.classList.remove("enddate"))),e.querySelectorAll(".inbetween").forEach((e=>e.classList.remove("inbetween"))),a||(e.querySelectorAll(".room-selector").forEach((e=>e.checked=!1)),e.querySelectorAll(".room-selector").length>1&&e.querySelectorAll(".roomwrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))))}document.addEventListener("DOMContentLoaded",(()=>{console.log("Bookings.js loaded"),document.querySelectorAll(".booking-subject-selector").forEach((e=>e.addEventListener("change",(e=>{Main.showModal(document.querySelector(`[name="${e.target.value}-modal"]`))})))),document.querySelectorAll(".admin-booking-subject-selector").forEach((e=>e.addEventListener("change",(e=>{document.querySelector(`.bookings-wrap[data-subject="${e.target.value}"]`).classList.toggle("hidden")})))),document.querySelectorAll(".tables-wrapper").forEach((e=>{offset=e.getBoundingClientRect().x,e.style.marginLeft=`-${offset}px`})),document.querySelectorAll(".booking-detail tr.actions").forEach((e=>e.addEventListener("submissionArchived",(e=>{let t=e.target.closest(".booking-detail-wrapper"),a=t.dataset.bookingid;document.querySelectorAll(`.calendar.day.booked[data-bookingid="${a}"]`).forEach((e=>{e.classList.remove("booked"),e.classList.add("available")})),t.remove(),Main.displayMessage("Succesfully archived")}))))})),document.addEventListener("click",(t=>{let a=t.target,o=a.closest(".modal");null!=a.closest("dt")&&(a=a.closest("dt")),a.matches(".action.reset")?e(o,!1,!1):a.matches(".available.unavailable")?e(o):a.matches(".prevnext")?async function(e){let t,a=e.closest(".bookings-wrap"),o=a.querySelectorAll(`.month-container[data-month="${e.dataset.month}"][data-year="${e.dataset.year}"]`);if(null!=e.closest(".prev")?(t="prev",a.querySelectorAll(".calendar.table .month-container:not(.hidden)").forEach(((e,t)=>{t%2!=0&&e.classList.add("hidden")}))):(t="next",a.querySelectorAll(".calendar.table .month-container:not(.hidden)").forEach(((e,t)=>{t%2==0&&e.classList.add("hidden")}))),0==o.length){let o=new FormData;o.append("month",e.dataset.month),o.append("year",e.dataset.year),o.append("subject",a.dataset.subject),o.append("formid",a.dataset.formid),o.append("type",t),null!=a.dataset.elid&&o.append("elid",a.dataset.elid),null!=a.dataset.shortcodeid&&o.append("shortcode_id",a.dataset.shortcodeid);let l=document.createElement("DIV");l.setAttribute("class","loaderwrapper");let r=document.createElement("IMG");r.setAttribute("src",sim.loadingGif),l.insertAdjacentElement("beforeEnd",r);let s="";s="prev"==t?"afterBegin":"beforeEnd",a.querySelectorAll(".calendar.table .roomwrapper>div").forEach((e=>{let t=l.cloneNode(!0);e.insertAdjacentElement(s,t)}));let d=await FormSubmit.fetchRestApi("bookings/get_next_month",o);d&&(a.querySelectorAll(".roomwrapper").forEach(((e,t)=>{e.querySelector(".loaderwrapper").outerHTML=d.months[t]})),a.querySelector(".navigators .navigator:not(.hidden)").classList.add("hidden"),a.querySelector(".navigators").insertAdjacentHTML("beforeEnd",d.navigator),a.querySelector(".booking.details-wrapper").insertAdjacentHTML("beforeEnd",d.details))}else console.log(o),a.querySelector(".navigators .navigator:not(.hidden)").classList.add("hidden"),console.log(a),console.log(e),a.querySelector(`.navigator[data-month="${e.dataset.month}"][data-year="${e.dataset.year}"]`).classList.remove("hidden"),o.forEach((e=>e.classList.remove("hidden")))}(a):a.matches('.change-booking-date, [name="booking-startdate"], [name="booking-enddate"]')?function(e){let t,a=document.querySelector(".booking-subject-selector:checked");null==a?(t=".booking.modal",console.log(t)):(t=`[name="${a.value}-modal"]`,console.log(t)),Main.showModal(document.querySelector(t))}():a.matches(".action.confirm")&&function(t){let a=t.closest(".modal");t.closest("form").querySelectorAll(".selected-booking-dates .clone_div").forEach(((e,t)=>{t>0&&e.remove()}));let o=t.closest("form").querySelector(".selected-booking-dates"),l=o.querySelector(".clone_div");a.querySelectorAll(".startdate").forEach(((e,t)=>{let r=l;t>0&&(r=FormFunctions.cloneNode(l));let s=r.querySelector('[name^="booking-startdate"]'),d=r.querySelector('[name^="booking-enddate"]'),n=r.querySelector('[name^="booking-room"]'),c=e.closest(".roomwrapper").dataset.room;s.value=e.dataset.isodate,d.value=a.querySelectorAll(".day.enddate")[t].dataset.isodate,null==c?(n.closest("div").classList.add("hidden"),n.value=""):(n.closest("div").classList.remove("hidden"),n.value=c),o.insertAdjacentElement("beforeEnd",r),FormFunctions.fixNumbering(o)})),o.classList.remove("hidden"),Main.hideModals(),t.closest("form").querySelector(".change-booking-date").textContent="Change",t.closest("form").querySelector(".change-booking-date").classList.remove("hidden"),e(a,!1,!1)}(a),a.matches(".bookings-wrap .available:not(.unavailable)")?function(t){let a=t.closest(".modal");if(null==a)return;let o=t.closest(".roomwrapper");if(null!=o.querySelector(".calendar.day.startdate")&&null!=o.querySelector(".calendar.day.enddate")){let o=!1;t.matches(".inbetween")&&(o=!0),e(a,o)}if(null==o.querySelector(".calendar.day.startdate")){if(t.matches(".first-day"))return void Main.displayMessage("You can only select this day as the last day of your stay!","error");a.querySelector(".booking-startdate").value=t.dataset.date,a.querySelector(".booking-startdate").dataset.isodate=t.dataset.isodate,t.classList.add("startdate"),o.querySelectorAll(".booking-date-label-wrapper.disabled").forEach((e=>e.classList.remove("disabled")));let e=o.querySelectorAll("dt.calendar.day:not(.head, .unavailable)"),l=!1;for(i=0;i<e.length;++i)e[i]==t?l=!0:l&&e[i].matches(".booked:not(.available)")&&(l=!1),l||e[i].classList.add("unavailable")}else{if(t.matches(".last-day"))return void Main.displayMessage("You can only select this day as the first day of your stay!","error");a.querySelector(".booking-enddate").value=t.dataset.date,a.querySelector(".booking-enddate").dataset.isodate=t.dataset.isodate,t.classList.add("enddate");let l=o.querySelectorAll("dt.calendar.day:not(.head)"),r=!0;for(i=0;i<l.length&&l[i]!=t;++i)r||l[i].classList.add("inbetween"),l[i].matches(".startdate")&&(r=!1);if(t.closest(".calendar.table").querySelectorAll(".inbetween.first-day, .inbetween.last-day").length>0)return Main.displayMessage("You can not book this period as it is overlapping an existing booking!","error"),void e(a);a.querySelectorAll(".actions .action.disabled").forEach((e=>e.classList.remove("disabled")))}}(a):a.matches(".form.table-wrapper .booked")?(a.closest(".bookings-wrap").querySelectorAll(".booking-detail-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),a.closest(".bookings-wrap").querySelectorAll(`.booking-detail-wrapper[data-bookingid="${a.dataset.bookingid}"]`).forEach((e=>{e.classList.remove("hidden"),e.scrollIntoView({block:"center"})}))):a.matches(".button.approve")?async function(e){let t=new FormData;t.append("id",e.dataset.id);let a=e.closest("tr");Main.showLoader(e.closest("td"));let o=await FormSubmit.fetchRestApi("bookings/approve",t);if(o){1==a.closest("tbody").rows.length?a.closest("table").remove():a.remove();let e=document.querySelector(`.bookings-wrap[data-subject='${o.subject}']`);for(let t=0;t<o.months.length;t++)e.querySelectorAll(`.month-container[data-month='${o.months[t]}'][data-year='${o.years[t]}']`).forEach((e=>e.outerHTML=o.html));e.querySelector(".booking.details-wrapper").insertAdjacentHTML("beforeEnd",o.details)}}(a):a.matches(".button.delete")?async function(e){let t=new FormData;t.append("id",e.dataset.id);let a=e.closest("tr");Main.showLoader(e.closest("td"));let o=await FormSubmit.fetchRestApi("bookings/remove",t);o&&(1==a.closest("tbody").rows.length?a.closest("table").remove():a.remove(),Main.displayMessage(o))}(a):a.matches(".room-selector")&&function(e){let t=e.closest(".modal");null==t&&(t=e.closest(".booking.overview")),null!=t&&(t.querySelectorAll(".booking-date-wrapper.hidden").forEach((e=>e.classList.remove("hidden"))),t.querySelectorAll(".navigators.hidden").forEach((e=>e.classList.remove("hidden"))),t.querySelectorAll(`[data-room="${e.value}"]`).forEach((e=>e.classList.toggle("hidden"))))}(a)}))})();
//# sourceMappingURL=bookings.min.js.map