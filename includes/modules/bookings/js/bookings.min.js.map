{"version":3,"file":"bookings.min.js","mappings":"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","sources":["webpack://bookings/./bookings.js"],"sourcesContent":["function reset(modal, onlyEnd=false){\r\n    if(!onlyEnd){\r\n        modal.querySelector('.booking-startdate').value     = '';\r\n        modal.querySelector('.calendar.day.startdate').classList.remove('startdate');\r\n        modal.querySelectorAll('.available.selected').forEach(dt=>dt.classList.remove('selected'));\r\n\r\n        modal.querySelector('.booking-date-label-wrapper.enddate').classList.add('disabled')\r\n    }\r\n    modal.querySelector('.booking-enddate').value       = '';\r\n    \r\n    modal.querySelector('.calendar.day.enddate').classList.remove('enddate');\r\n\r\n    modal.querySelectorAll('.inbetween').forEach(dt=>dt.classList.remove('inbetween'));    \r\n}\r\n\r\nasync function getMonth(target){\r\n    let wrapper         = target.closest('.bookings-wrap');\r\n    let monthContainer  = wrapper.querySelector(`.month-container[data-month=\"${target.dataset.month}\"][data-year=\"${target.dataset.year}\"]`);\r\n\r\n    // hide the first month\r\n    if(target.closest('.prev') != null){\r\n        wrapper.querySelectorAll('.calendar.table .month-container:not(.hidden)')[1].classList.add('hidden');\r\n    }else{\r\n        wrapper.querySelectorAll('.calendar.table .month-container:not(.hidden)')[0].classList.add('hidden');\r\n    }\r\n    \r\n\r\n    // month does not exist yet\r\n    if(monthContainer == null){\r\n        let formData    = new FormData();\r\n        formData.append('month', target.dataset.month);\r\n        formData.append('year', target.dataset.year);\r\n        formData.append('subject', target.closest('.bookings-wrap').dataset.subject);\r\n\r\n        let loaderWrapper\t= document.createElement(\"DIV\");\r\n        loaderWrapper.setAttribute('class','loaderwrapper');\r\n\r\n        let loader\t= document.createElement(\"IMG\");\r\n        loader.setAttribute(\"src\", sim.loadingGif);\r\n\r\n        loaderWrapper.insertAdjacentElement('beforeEnd', loader);\r\n        wrapper.querySelector('.calendar.table .month-container:not(.hidden)').parentNode.insertAdjacentElement('beforeEnd', loaderWrapper);\r\n            \r\n        let response = await FormSubmit.fetchRestApi('bookings/get_next_month', formData);\r\n\r\n        if(response){\r\n            loader.outerHTML                                = response.month;\r\n            // hide current navigator and add new one\r\n            wrapper.querySelector('.navigators .navigator:not(.hidden)').classList.add('hidden');\r\n            wrapper.querySelector('.navigators').insertAdjacentHTML('beforeEnd', response.navigator);\r\n        }\r\n    }else{\r\n        wrapper.querySelector('.navigators .navigator:not(.hidden)').classList.add('hidden');\r\n        wrapper.querySelector(`.navigator[data-month=\"${target.dataset.month}\"][data-year=\"${target.dataset.year}\"]`).classList.remove('hidden');\r\n        monthContainer.classList.remove('hidden');\r\n    }\r\n}\r\n\r\nfunction changeBookingData(target){\r\n    let selector    = '';\r\n    let el  = document.querySelector(`.booking-subject-selector`);\r\n    if(el == null){\r\n        selector    = '.booking.modal';\r\n    }else{\r\n        selector    = `[name=\"${el.value}-modal\"]`;\r\n    }\r\n    document.querySelector(selector).classList.remove('hidden');\r\n}\r\n\r\nfunction storeDates(target){\r\n    let startEl     = target.closest('form').querySelector('[name=\"booking-startdate\"]');\r\n    let endEl       = target.closest('form').querySelector('[name=\"booking-enddate\"]');\r\n\r\n    startEl.value   = modal.querySelector('.booking-startdate').dataset.isodate;\r\n    endEl.value     = modal.querySelector('.booking-enddate').dataset.isodate;\r\n\r\n    startEl.closest('.selected-booking-dates').classList.remove('hidden');\r\n\r\n    modal.classList.add('hidden');\r\n\r\n    target.closest('form').querySelector('.change-booking-date').textContent    = 'Change';\r\n\r\n    reset(modal);\r\n}\r\n\r\nfunction showDateSelectorModal(target){ \r\n    let modal   = target.closest('.modal');\r\n\r\n    // we already have an selection\r\n    if(modal.querySelector('.calendar.day.startdate') != null && modal.querySelector('.calendar.day.enddate') != null){\r\n        let onlyEnd = false;\r\n        if(target.matches('.inbetween')){\r\n            onlyEnd = true;\r\n        }\r\n        \r\n        reset(modal, onlyEnd);\r\n    }\r\n\r\n    if(modal.querySelector('.calendar.day.startdate') == null){\r\n        modal.querySelector('.booking-startdate').value             = target.dataset.date;\r\n        modal.querySelector('.booking-startdate').dataset.isodate   = target.dataset.isodate;\r\n\r\n        target.classList.add('startdate');\r\n        modal.querySelectorAll('.booking-date-label-wrapper.disabled').forEach(el=>el.classList.remove('disabled'));\r\n\r\n        // do not allow any date before the startdate to be the enddate\r\n        let dts     = target.closest('.calendar.table').querySelectorAll('dt.calendar.day:not(.head, .unavailable)');\r\n        let skip    = false;\r\n        for (i = 0; i < dts.length; ++i) {\r\n            // all dates after the selected date are available\r\n            if(dts[i] == target){\r\n                skip = true;\r\n            // until we encounter another selected date\r\n            }else if(skip && dts[i].matches('.selected')){\r\n                skip = false;\r\n            }\r\n\r\n            if(!skip){\r\n                dts[i].classList.add('selected');\r\n            }\r\n        }\r\n    }else{\r\n        // store enddate\r\n        modal.querySelector('.booking-enddate').value               = target.dataset.date;\r\n        modal.querySelector('.booking-enddate').dataset.isodate     = target.dataset.isodate;\r\n        target.classList.add('enddate');\r\n\r\n        // make other dates available again\r\n        target.closest('.calendar.table').querySelectorAll('.available.selected').forEach(dt=>dt.classList.remove('selected'));\r\n\r\n        // color the dates between start and end\r\n        let dts     = target.closest('.calendar.table').querySelectorAll('dt.calendar.day:not(.head)');\r\n        let skip    = true;\r\n        for (i = 0; i < dts.length; ++i) {\r\n            \r\n            // until we encounter another selected date\r\n            if(dts[i] == target){\r\n                break;\r\n            }\r\n\r\n            if(!skip){\r\n                dts[i].classList.add('inbetween');\r\n            }\r\n\r\n            // all dates after the selected date are available\r\n            if(dts[i].matches('.startdate')){\r\n                skip = false;\r\n            }\r\n        }\r\n\r\n        modal.querySelectorAll('.actions .action.disabled').forEach(el=>el.classList.remove('disabled'));\r\n    }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log(\"Bookings.js loaded\");\r\n\r\n    // show booking date selector\r\n    document.querySelectorAll(`.booking-subject-selector`).forEach(el=>el.addEventListener(`change`, (ev)=>{\r\n        document.querySelector(`[name=\"${ev.target.value}-modal\"]`).classList.remove('hidden');\r\n    }));\r\n\r\n    // show booking calendar\r\n    document.querySelectorAll(`.admin-booking-subject-selector`).forEach(el=>el.addEventListener(`change`, (ev)=>{\r\n        document.querySelector(`.bookings-wrap[data-subject=\"${ev.target.value}\"]`).classList.toggle('hidden');\r\n    }));\r\n\r\n    document.querySelectorAll(\".tables-wrapper\").forEach(wrapper=>{\r\n        offset\t= wrapper.getBoundingClientRect().x;\r\n        wrapper.style.marginLeft = `-${offset}px`;\r\n    });\r\n});\r\n\r\ndocument.addEventListener('click', (ev) => {\r\n    let target  = ev.target;\r\n    let modal   = target.closest('.modal');\r\n\r\n    if(target.closest('dt') != null){\r\n        target  = target.closest('dt');\r\n    }\r\n\r\n    if(target.matches('.action.reset')){\r\n        reset(modal);\r\n    }\r\n\r\n    if(target.matches('.prevnext')){\r\n        getMonth(target);\r\n    }\r\n\r\n    if(target.matches('.change-booking-date')){\r\n        changeBookingData(target);\r\n    }\r\n\r\n    if(target.matches('.action.confirm')){\r\n        storeDates(target);\r\n    }\r\n\r\n    if(target.matches('.bookings-wrap .available:not(.selected)')){\r\n        showDateSelectorModal(target);\r\n    }\r\n\r\n    if(target.matches('.form.table-wrapper .selected')){\r\n        // Show the details\r\n        target.closest('.bookings-wrap').querySelector(`.booking-detail-wrapper[data-bookingid=\"${target.dataset.bookingid}\"]`).classList.remove('hidden');\r\n    }\r\n\r\n    if(target.matches('.booking-detail .edit')){\r\n        console.log(target)\r\n    }\r\n});"],"names":["reset","modal","onlyEnd","querySelector","value","classList","remove","querySelectorAll","forEach","dt","add","storeDates","target","startEl","closest","endEl","dataset","isodate","textContent","document","addEventListener","console","log","el","ev","toggle","wrapper","offset","getBoundingClientRect","x","style","marginLeft","matches","async","monthContainer","month","year","formData","FormData","append","subject","loaderWrapper","createElement","setAttribute","loader","sim","loadingGif","insertAdjacentElement","parentNode","response","FormSubmit","fetchRestApi","outerHTML","insertAdjacentHTML","navigator","getMonth","selector","changeBookingData","date","dts","skip","i","length","showDateSelectorModal","bookingid"],"sourceRoot":""}