(()=>{"use strict";function e(e){let t=document.querySelector(".active");t.classList.remove("active"),t.outerHTML=e.html,Main.displayMessage(e.message),Main.hideModals()}function t(e="",t="",a="",l=""){let s,o,n,r,d,c,i=document.querySelector('[name="add_session"]');i.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),i.querySelector('[name="schedule_id"]').value=e.closest(".schedules_div").dataset.id,s=e.dataset.host_id,o=e.dataset.old_time,n=e.dataset.subject,r=e.dataset.location,d=e.dataset.host,c=e.dataset.event_id,i.querySelector('[name="date"]').value=t,i.querySelector('[name="starttime"]').value=a,i.querySelector('[name="endtime"]').value=l,i.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),i.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),null!=a&&(i.querySelector('[name="oldtime"]').value=a),null!=t&&(i.querySelector('[name="olddate"]').value=t),null!=c&&(i.querySelector('[name="event-id"]').value=c),null!=s&&(i.querySelector('[name="host_id"]').value=s),null!=n&&(i.querySelector('[name="subject"]').value=n),null!=r&&(i.querySelector('[name="location"]').value=r),null!=d&&(i.querySelector('[name="host"]').value=d),Main.showModal(i)}function a(e){let t,a,l,s,o,n=e.closest(".schedules_div").dataset.id,r=e.closest("table");null==r?(s=e.dataset.starttime,o=e.dataset.host_id,l=e.dataset.isodate):(t=r.tHead.rows[0],a=e.closest("td"),s=e.closest("tr").dataset.starttime,o=a.dataset.host,l=t.cells[a.cellIndex].dataset.isodate);var d=new FormData;return d.append("date",l),null!=o?d.append("host_id",o):d.append("host_id",sim.userId),d.append("starttime",s),d.append("schedule_id",n),d}async function l(e,t){let a={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(a.target=document.fullscreenElement),!!(await Swal.fire(a)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),Main.showLoader(t.firstChild),!0)}function s(e,t){if(t>1){for(var a=e.closest("tr"),l=e.cellIndex,s=1;s<t;s++)(a=a.nextElementSibling).cells[l].classList.add("hidden");e.rowSpan=t}}async function o(e){let t=e.closest("td"),s=t.classList.value,o=t.cellIndex,n=t.closest("tr"),r=t.closest("table").rows[0].cells[t.cellIndex].dataset.date,d=await async function(e,t){let s,o,n=e.closest(".schedules_div").dataset.target,r=a(e);if(s=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${n} on ${t}`:`Please confirm you do not want to be the host for ${n} on ${t} anymore`,o=await l(s,e.firstChild),o){Main.showLoader(e);var d=await FormSubmit.fetchRestApi("events/remove_host",r);Main.displayMessage(d)}return o}(e,r);if(d&&(n.querySelector(".loaderwrapper").outerHTML="<td>Available</td>",t=n.cells[o],t.classList.value=s,t.classList.remove("selected"),1==n.cells[0].rowSpan)){for(var c=1;c<e.rowSpan;c++)n=n.nextElementSibling,n.cells[o].classList.remove("hidden");e.rowSpan=1}}async function n(n,r,d){let c=n.target;if(c.matches(".meal.selected.own, .meal.selected.admin"))o(c);else if(c.matches(".meal.admin")){let e=c.closest("table"),t=c.closest("td"),a=e.rows[0].cells[t.cellIndex].dataset.isodate,l=c.closest("tr").dataset.starttime;!function(e,t="",a=""){e.classList.add("active");let l=document.querySelector('[name="add_host"]');l.querySelectorAll('input:not([type="hidden"], [type="radio"])').forEach((e=>e.value="")),l.querySelector('[name="date"]').value=t,l.querySelector('[name="starttime"]').value=a,l.querySelector('[name="schedule_id"]').value=e.closest(".schedules_div").dataset.id,l.classList.remove("hidden")}(c,a,l)}else if(c.matches(".meal:not(.admin, .selected)")){let t=c.closest("table"),s=c.closest("td");dateStr=t.rows[0].cells[s.cellIndex].dataset.date,c.classList.add("active"),async function(t,s){let o=`Please confirm you want to be the host for ${t.closest(".schedules_div").dataset.target} on ${s}`;if(await l(o,t.firstChild)){let l=a(t);null==t.closest("table")&&Main.showLoader(t);let s=await FormSubmit.fetchRestApi("events/add_host",l);s&&e(s)}}(c,dateStr)}else!async function(e,a,l){var n=document.querySelectorAll(".modal:not(.hidden)");if((a.length>0||e.classList.contains("orientation"))&&(null==n||0==n.length)){var r=a[0].node.cellIndex,d=a[0].node;for(const e of a)if(r!=e.node.cellIndex){let e={icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"};return null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),void l.target.closest(".sim-table")._selectable.clear()}if(d.classList.contains("selected")){let e=d.closest("table").rows[0].cells[d.cellIndex].dataset.isodate;d.closest("table").rows[0].cells[d.cellIndex].dataset.date,d.classList.add("active");let a=await async function(e,a,l){let s={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(s.target=document.fullscreenElement);var o=await Swal.fire(s);if(o.isConfirmed)t(e,a,e.dataset.starttime,e.dataset.endtime),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot";else if(o.isDenied)return o.isDenied}(d,e);a&&o(d)}else{let e=a[0].node,l=a[a.length-1].node;s(e,document.querySelectorAll(".ui-selected").length),e.matches(".selected")||Main.showLoader(e.firstChild);let o=e.closest("tr").dataset.starttime,n=e.dataset.endtime;null==n&&(n=l.closest("tr").dataset.endtime);let r=e.closest("table").rows[0].cells[e.cellIndex].dataset.isodate;e.classList.add("active"),t(e,r,o,n)}}}(c,r,n)}function r(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){(!Main.isMobileDevice()||e.rows.length<7)&&(null!=e._selectable&&e._selectable.destroy(),e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",n))})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}document.addEventListener("click",(function(e){let a=e.target;"add-session"==a.name?(console.log("click12"),e.stopPropagation(),t(a)):"add-host"==a.name&&(console.log("click13"),e.stopPropagation(),Main.showModal(a.closest(".schedules_div").querySelector(".add-host-mobile-wrapper")))})),document.addEventListener("DOMContentLoaded",(function(){console.log("Desktop-schedule.js loaded"),r()})),document.addEventListener("click",(function(t){let a=t.target;"add_schedule"==a.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),r())}(a)):"publish_schedule"==a.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t))}(a)):"add_recipe_keyword"==a.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(a)):a.matches(".close")&&null!=a.closest(".modal")&&"add_session"==a.closest(".modal").attributes.name.value?function(e){document.querySelectorAll(".ui-selected").forEach((e=>e.classList.remove("ui-selected","active","hidden"))),e.rowSpan=1}(document.querySelector("td.active")):a.classList.contains("keyword")?function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],l=e.closest("td"),s=a.cells[l.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,n=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(n.querySelector("form")),n.querySelector('[name="schedule_id"]').value=t.dataset.id,n.querySelector('[name="date"]').value=s,n.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(n.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),Main.showModal(n)}(a):a.classList.contains("publish")?(t.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):Main.showModal(t)}(a)):a.classList.contains("remove_schedule")?(t.stopPropagation(),async function(e){var t=e.dataset.schedule_id,a=new FormData;if(a.append("schedule_id",t),await l("Are you sure you want to remove this schedule",e.closest(".schedules_div"))){var s=await FormSubmit.fetchRestApi("events/remove_schedule",a);s&&(Main.displayMessage(s),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(a)):a.matches(".edit_schedule")?(t.stopPropagation(),function(e){let t=document.getElementById("edit_schedule_modal"),a=e.closest(".schedules_div"),l=a.querySelector("table.schedule"),s=l.closest(".schedules_div").dataset.id;t.querySelector('[name="schedule_id"]').value=s,t.querySelector('[name="target_id"]').value=l.dataset.target_id,t.querySelector('[name="target_name"]').value=l.dataset.target,t.querySelector('[name="schedule_info"]').value=a.querySelector(".table_title.sub-title").textContent,t.querySelector('[name="startdate"]').value=l.tHead.querySelector("tr").cells[1].dataset.isodate,t.querySelector('[name="enddate"]').value=l.tHead.querySelector("tr").cells[l.tHead.querySelector("tr").cells.length-1].dataset.isodate,t.querySelector('[name="skiplunch"]').checked=l.dataset.lunch,t.querySelector('[name="skiporientation"]').checked=l.rows.length<3,Main.showModal(t)}(a)):"add_host"!=a.name&&"add_timeslot"!=a.name||(t.stopPropagation(),async function(t){let a=t.closest("form");if(""!=a.querySelector('[name="oldtime"]').value){let e=document.querySelector("td.active");if(null!=e){e.classList.remove("ui-selected","active","selected"),e.removeAttribute("rowspan");let t=a.querySelector('[name="date"]').value,l=a.querySelector('[name="starttime"]').value,s=e.closest("table").tHead.querySelector(`[data-isodate="${t}"]`).cellIndex,o=e.closest("table").querySelector(`tr[data-starttime="${l}"]`).cells[s];o.classList.add("ui-selected","active","selected"),o.innerHTML=e.innerHTML,e.innerHTML="Available"}}var l=await FormSubmit.submitForm(t,"events/add_host");l&&(e(l),r())}(a))})),document.addEventListener("change",(function(e){let t=e.target;if("target_name"==t.name){var a=t.list.querySelector(`[value='${t.value}' i]`).dataset.value;t.closest("form").querySelector('[name="target_id"]').value=a}else if("host"==t.name){let e=t.list.querySelector(`[value="${t.value}"]`),a="";null!=e&&(a=e.dataset.userid),t.closest("form").querySelector('[name="host_id"]').value=a}if(t.matches('[name="add_session"] .time')){let e=document.querySelector("td.active");if(null==e)return;let a=e.closest("table");if("starttime"==t.name&&null==a.querySelector(`tr[data-starttime="${t.value}"]`)||"endtime"==t.name&&null==a.querySelector(`tr[data-endtime="${t.value}"]`))return;let l=t.closest("form"),o=new Date,n=l.querySelector('[name="starttime"]').value.split(":");n=new Date(o.getFullYear(),0,1,n[0],n[1]);let r=l.querySelector('[name="endtime"]').value.split(":");r=new Date(o.getFullYear(),0,1,r[0],r[1]);let d=(r-n)/1e3/60/15;if(n!=t.value){e.removeAttribute("rowspan"),e.classList.remove("ui-selected","active");let t=e.closest("table").querySelector('tr[data-starttime="'+l.querySelector('[name="starttime"]').value+'"]').cells[e.cellIndex];t.innerHTML=e.innerHTML,t.classList.add("ui-selected","active"),s(t,d)}else s(e,d)}}))})();
//# sourceMappingURL=desktop-schedule.min.js.map