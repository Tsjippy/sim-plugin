(()=>{"use strict";function e(e){let t=document.querySelector(".active");null!=t&&(t.classList.remove("active"),t.outerHTML=e.html),Main.displayMessage(e.message),Main.hideModals()}function t(e=""){let t,a,l,o,n,d,r,c,i,u,m,h,y,v,f=document.querySelector('[name="add_session"]'),p=f.querySelector("ul.listselectionlist");f.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),null!=p&&(p.innerHTML=""),null==e[0]?(a=e,n=a.dataset.starttime,d=a.dataset.endtime):(a=e[0].node,l=e[e.length-1].node,s(a,document.querySelectorAll(".ui-selected").length),a.matches(".selected")||Main.showLoader(a.firstChild)),f.querySelector('[name="schedule_id"]').value=a.closest(".schedules_div").dataset.id,n=a.closest("tr").dataset.starttime,d=a.dataset.endtime,null==d&&(d=l.closest("tr").dataset.endtime),o=a.closest("table").rows[0].cells[a.cellIndex].dataset.isodate,r=a.dataset.host_id,c=a.dataset.subject,i=a.dataset.location,u=a.dataset.host,m=a.dataset.session_id,null!=a.dataset.reminders&&(t=JSON.parse(a.dataset.reminders),f.querySelectorAll('[name="reminders[]"]').forEach((e=>{t.includes(e.value)?e.checked=!0:e.checked=!1}))),null!=a.dataset.atendees&&(h=JSON.parse(a.dataset.atendees)),null!=a.closest(".day-wrapper-mobile")?a.closest(".day-wrapper-mobile").classList.add("active"):a.classList.add("active"),f.querySelector('[name="date"]').value=o,f.querySelector('[name="starttime"]').value=n,f.querySelector('[name="endtime"]').value=d,f.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),f.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),null!=m&&(f.querySelector('[name="session-id"]').value=m),null!=r&&(f.querySelector('[name="host_id"]').value=r),null!=c&&(f.querySelector('[name="subject"]').value=c),null!=i&&(f.querySelector('[name="location"]').value=i),null!=u&&(f.querySelector("#host").value=u),null!=h&&h.forEach((e=>{y=document.createElement("li"),y.classList.add("listselection"),v='<button type="button" class="small remove-list-selection"><span class=\'remove-list-selection\'>Ã—</span></button>',"object"==typeof e?(v+=`<input type='hidden' name='others[]' value='${e.id}'>`,v+=`<span>${e.name}</span>`):(v+="<span>",v+=`<input type='text' name='others[]' value='${e}' readonly=readonly style='width:${e.length}ch'>`,v+="</span>"),y.innerHTML=v,p.appendChild(y)})),Main.showModal(f)}async function a(e,t){let a={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(a.target=document.fullscreenElement),!!(await Swal.fire(a)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),Main.showLoader(t.firstChild),!0)}function s(e,t){if(t>1){for(var a=e.closest("tr"),s=e.cellIndex,l=1;l<t;l++)(a=a.nextElementSibling).cells[s].classList.add("hidden");e.rowSpan=t}}function l(e){e.removeAttribute("rowspan");let t=e.closest("tr").nextElementSibling;if(null!=t)for(e=t.cells[e.cellIndex];e.matches(".hidden");)e.classList.remove("hidden"),t=t.nextElementSibling,e=t.cells[e.cellIndex]}async function o(e){let t=e.closest("td"),s=(t.classList.value,t.cellIndex),o=t.closest("tr"),n=t.closest("table").rows[0].cells[t.cellIndex].dataset.date,d=await async function(e,t){let s,l,o=e.closest(".schedules_div").dataset.target;if(s=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${o} on ${t}`:`Please confirm you do not want to be the host for ${o} on ${t} anymore`,l=await a(s,e.firstChild),l){let t=new FormData;t.append("session_id",e.dataset.session_id),Main.showLoader(e.firstChild);var n=await FormSubmit.fetchRestApi("events/remove_host",t);return Main.displayMessage(n.message),n.html}return l}(t,n);d&&(t.outerHTML=d,t=o.cells[s],l(t))}async function n(l,n,d){let r=l.target;if(r.matches(".meal.selected.own, .meal.selected.admin"))o(r);else if(r.matches(".meal.admin")){let e=r.closest("table"),t=r.closest("td"),a=e.rows[0].cells[t.cellIndex].dataset.isodate,s=r.closest("tr").dataset.starttime;!function(e,t="",a=""){e.classList.add("active");let s=document.querySelector('[name="add_host"]');s.querySelectorAll('input:not([type="hidden"], [type="radio"])').forEach((e=>e.value="")),s.querySelector('[name="date"]').value=t,s.querySelector('[name="starttime"]').value=a,s.querySelector('[name="schedule_id"]').value=e.closest(".schedules_div").dataset.id,s.classList.remove("hidden")}(r,a,s)}else if(r.matches(".meal:not(.admin, .selected)")){let t=r.closest("table"),s=r.closest("td"),l=t.rows[0].cells[s.cellIndex].dataset.date;r.classList.add("active"),async function(t,s){let l=`Please confirm you want to be the host for ${t.closest(".schedules_div").dataset.target} on ${s}`;if(await a(l,t.firstChild)){let a=function(e){let t,a,s,l,o,n=e.closest(".schedules_div").dataset.id,d=e.closest("table");null==d?(l=e.dataset.starttime,o=e.dataset.host_id,s=e.dataset.isodate):(t=d.tHead.rows[0],a=e.closest("td"),l=e.closest("tr").dataset.starttime,o=a.dataset.host,s=t.cells[a.cellIndex].dataset.isodate);var r=new FormData;return r.append("date",s),null!=o?r.append("host_id",o):r.append("host_id",sim.userId),r.append("starttime",l),r.append("schedule_id",n),r}(t);null==t.closest("table")&&Main.showLoader(t);let s=await FormSubmit.fetchRestApi("events/add_host",a);s&&e(s)}}(r,l)}else!async function(e,a,l){var n=document.querySelectorAll(".modal:not(.hidden)");if((a.length>0||e.classList.contains("orientation"))&&(null==n||0==n.length)){var d=a[0].node.cellIndex,r=a[0].node;for(const e of a)if(d!=e.node.cellIndex){let e={icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"};return null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),void l.target.closest(".sim-table")._selectable.clear()}if(r.dataset.oldvalue=r.innerHTML,r.classList.contains("selected")){r.closest("table").rows[0].cells[r.cellIndex].dataset.isodate,r.closest("table").rows[0].cells[r.cellIndex].dataset.date,r.classList.add("active");let e=await async function(e,a,s){let l={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(l.target=document.fullscreenElement);var o=await Swal.fire(l);if(o.isConfirmed)t(e,e.dataset.starttime,e.dataset.endtime),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot";else if(o.isDenied)return o.isDenied}(r);e&&o(r)}else{let e=a[0].node,l=a[a.length-1].node;s(e,document.querySelectorAll(".ui-selected").length),e.matches(".selected")||Main.showLoader(e.firstChild),e.closest("tr").dataset.starttime;let o=e.dataset.endtime;null==o&&(o=l.closest("tr").dataset.endtime),e.closest("table").rows[0].cells[e.cellIndex].dataset.isodate,e.classList.add("active"),t(a)}}}(r,n,l)}function d(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){(!Main.isMobileDevice()||e.rows.length<7)&&(null!=e._selectable&&e._selectable.destroy(),e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",n))})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}function r(e){document.querySelectorAll("td.active").forEach((e=>{e.innerHTML=e.dataset.oldvalue,e.classList.remove("active","ui-selected")}))}console.log("Desktop-schedule.js loaded"),document.addEventListener("DOMContentLoaded",(function(){d(),document.querySelector('[name="add_session"]').addEventListener("modalclosed",r)})),document.addEventListener("click",(function(t){let o=t.target;"add_schedule"==o.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");Main.hideModals(),t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),d())}(o)):"publish_schedule"==o.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t),document.querySelectorAll(".schedule.publish.warning").forEach((e=>e.remove())))}(o)):"add_recipe_keyword"==o.name?(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(o)):o.matches(".modal .close")&&"add_session"==o.closest(".modal").attributes.name.value?l(document.querySelector("td.active")):o.classList.contains("keyword")?function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],s=e.closest("td"),l=a.cells[s.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,n=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(n.querySelector("form")),n.querySelector('[name="schedule_id"]').value=t.dataset.id,n.querySelector('[name="date"]').value=l,n.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(n.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),Main.showModal(n)}(o):o.classList.contains("publish")?(t.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):Main.showModal(t)}(o)):o.classList.contains("remove_schedule")?(t.stopPropagation(),async function(e){var t=e.dataset.schedule_id,s=new FormData;if(s.append("schedule_id",t),await a("Are you sure you want to remove this schedule",e.closest(".schedules_div"))){var l=await FormSubmit.fetchRestApi("events/remove_schedule",s);l&&(Main.displayMessage(l),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(o)):o.matches(".edit_schedule")?(t.stopPropagation(),function(e){let t=document.getElementById("edit_schedule_modal"),a=e.closest(".schedules_div"),s=a.querySelector("table.schedule"),l=a.dataset.id;t.querySelector('[name="schedule_id"]').value=l,t.querySelector('[name="target_id"]').value=s.dataset.target_id,t.querySelector('[name="target_name"]').value=s.dataset.target,t.querySelector('[name="schedule_info"]').value=a.querySelector(".table_title.sub-title").textContent,t.querySelector('[name="startdate"]').value=s.tHead.querySelector("tr").cells[1].dataset.isodate,t.querySelector('[name="enddate"]').value=s.tHead.querySelector("tr").cells[s.tHead.querySelector("tr").cells.length-1].dataset.isodate,t.querySelector('[name="timeslotsize"]').value=a.dataset.slotsize,t.querySelector('[name="hidenames"]').checked=a.dataset.hidenames,t.querySelector('[name="skiplunch"]').checked=parseInt(s.dataset.skiplunch),t.querySelector('[name="skipdiner"]').checked=parseInt(s.dataset.skipdiner),t.querySelector('[name="skiporientation"]').checked=s.rows.length<3;let o=JSON.parse(s.dataset.adminroles);t.querySelectorAll('[name="admin-roles[]"]').forEach((e=>e.checked=o.includes(e.value)));let n=JSON.parse(s.dataset.viewroles);t.querySelectorAll('[name="view-roles[]"]').forEach((e=>e.checked=n.includes(e.value))),Main.showModal(t)}(o)):"add_host"!=o.name&&"add_timeslot"!=o.name||(t.stopPropagation(),async function(t){let a,o,n,r,c,i,u,m,h=t.closest("form"),y=h.querySelector('[name="session-id"]').value,v=h.querySelector('[name="date"]').value,f=h.querySelector('[name="starttime"]').value,p=h.querySelector('[name="endtime"]').value;c=document.querySelector("td.active"),Main.showLoader(c.firstChild);var S=await FormSubmit.submitForm(t,"events/add_host");S&&(o=c.closest("table"),a=c,n=c.closest("tr"),r=c.cellIndex,""!=y&&(i=c.dataset.starttime,m=c.dataset.endtime,u=o.rows[0].cells[1].dataset.isodate,u==v&&i==f&&m==p||(l(c),u==v&&i==f||(c.innerHTML="Available",n=o.querySelector(`tr[data-starttime="${f}"]`),r=o.rows[0].querySelector(`[data-isodate="${v}"]`).cellIndex,a=n.cells[r],c.classList.remove("ui-selected","active","selected"),a.classList.add("ui-selected","active","selected")))),e(S),c=n.cells[r],s(c,c.rowSpan),d())}(o))})),document.addEventListener("change",(function(e){let t=e.target;if("target_name"==t.name){var a=t.list.querySelector(`[value='${t.value}' i]`).dataset.value;t.closest("form").querySelector('[name="target_id"]').value=a}else if("host"==t.id){let e=t.list.querySelector(`[value="${t.value}"]`),a="";null!=e&&(a=e.dataset.userid),t.closest("form").querySelector('[name="host_id"]').value=a}}))})();
//# sourceMappingURL=desktop-schedule.min.js.map