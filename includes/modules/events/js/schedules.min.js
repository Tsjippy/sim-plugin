(()=>{function e(e,t){if(t>1){for(var a=e.closest("tr"),s=e.cellIndex,l=1;l<t;l++)(a=a.nextElementSibling).cells[s].classList.add("hidden");e.rowSpan=t}}function t(e){var t=document.querySelector("td.active");t.classList.remove("active"),t.outerHTML=e.html,Main.hideModals(),Main.displayMessage(e.message),o()}async function a(e){var t,a=l(e),s=e.closest("table"),o=s.dataset.target,n=e.closest("td"),d=s.rows[0].cells[n.cellIndex].dataset.date;if(t=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${o} on ${d}`:`Please confirm you do not want to be the host for ${o} on ${d} anymore`,await r(t)){Main.showLoader(n.firstChild);var c=await FormSubmit.fetchRestApi("events/remove_host",a);n.classList.remove("selected"),n.classList.remove("ui-selected"),n.innerHTML="Available";var i=n.cellIndex,u=n.closest("tr");if(1==u.cells[0].rowSpan){for(var m=1;m<e.rowSpan;m++)(u=u.nextElementSibling).cells[i].classList.remove("hidden");e.rowSpan=1}Main.displayMessage(c)}}function s(t){var a=document.querySelector('[name="add_session"]'),s=t[0].node;s.classList.add("active"),e(s,document.querySelectorAll(".ui-selected").length),s.matches(".selected")||Main.showLoader(s.firstChild);var l=s.dataset.endtime,r=s.closest("table"),o=r.rows[0].cells[s.cellIndex].dataset.isodate;a.querySelectorAll('input:not([type="hidden"])').forEach((e=>e.value="")),a.querySelector('[name="schedule_id"]').value=r.dataset.id,a.querySelector('[name="date"]').value=o,a.querySelector('[name="olddate"]').value=o,a.querySelector('[name="starttime"]').value=s.closest("tr").dataset.starttime,a.querySelector('[name="endtime"]').value=l,a.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),a.querySelector('[name="add_timeslot"]').classList.add("update_schedule");let n=s.dataset.host_id,d=s.dataset.time,c=s.dataset.subject,i=s.dataset.location,u=s.dataset.host;null!=n&&(a.querySelector('[name="host_id"]').value=n),null!=d&&(a.querySelector('[name="oldtime"]').value=d),null!=c&&(a.querySelector('[name="subject"]').value=c),null!=i&&(a.querySelector('[name="location"]').value=i),null!=u&&(a.querySelector('[name="host"]').value=u),a.classList.remove("hidden")}function l(e){var t=e.closest("table"),a=t.dataset.id,s=t.tHead.rows[0],l=e.closest("td"),r=s.cells[l.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,n=new FormData;return n.append("date",r),null!=l.dataset.host?n.append("host",l.dataset.host):n.append("host_id",sim.userId),n.append("starttime",o),n.append("schedule_id",a),n}async function r(e){return!!(await Swal.fire({title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"})).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?Main.showLoader(target.closest(".schedules_div")):Main.showLoader(target.firstChild),!0)}function o(){Main.isMobileDevice()||document.querySelectorAll(".sim-table.schedule").forEach((function(e){null!=e._selectable&&e._selectable.destroy(),e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",n)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}function n(e,o,n){target=e.target,target.matches(".meal.selected.own, .meal.selected.admin")?a(target):target.matches(".meal.admin")?function(){target.classList.add("active");var e=target.closest("table"),t=target.closest("td"),a=e.rows[0].cells[t.cellIndex].dataset.isodate,s=target.closest("tr").dataset.starttime,l=target.closest(".schedules_wrapper").querySelector('[name="add_host"]');l.querySelectorAll('input:not([type="hidden"])').forEach((e=>e.value="")),l.querySelector('[name="schedule_id"]').value=e.dataset.id,l.querySelector('[name="date"]').value=a,l.querySelector('[name="starttime"]').value=s,l.classList.remove("hidden")}():target.matches(".meal:not(.admin, .selected)")?async function(e){var a=e.closest("table"),s=e.closest("td"),o=`Please confirm you want to be the host for ${a.dataset.target} on ${a.rows[0].cells[s.cellIndex].dataset.date}`;if(await r(o)){e.classList.add("active");var n=l(e),d=await FormSubmit.fetchRestApi("events/add_host",n);d&&t(d)}}(target):function(e,t,l){var r=document.querySelectorAll(".modal:not(.hidden)");if((t.length>0||e.classList.contains("orientation"))&&(null==r||0==r.length)){var o=t[0].node.cellIndex,n=t[0].node;for(const e of t)if(o!=e.node.cellIndex)return Swal.fire({icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"}),void l.target.closest(".sim-table")._selectable.clear();n.classList.contains("selected")?async function(e){var t=await Swal.fire({title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"}),l=e[0].node;t.isConfirmed?(s(e),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot"):t.isDenied&&a(l)}(t):s(t)}}(target,o,e)}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),o()})),document.addEventListener("click",(function(e){target=e.target,"add_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),o())}(target)):"publish_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t))}(target)):"add_recipe_keyword"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(target)):"add_host"==target.name||"add_timeslot"==target.name?(e.stopPropagation(),async function(e){let a=e.closest("form");if(""!=a.querySelector('[name="oldtime"]').value){let e=document.querySelector("td.active");e.classList.remove("ui-selected","active","selected"),e.removeAttribute("rowspan");let t=a.querySelector('[name="date"]').value,s=a.querySelector('[name="starttime"]').value,l=e.closest("table").tHead.querySelector(`[data-isodate="${t}"]`).cellIndex,r=e.closest("table").querySelector(`tr[data-starttime="${s}"]`).cells[l];r.classList.add("ui-selected","active","selected"),r.innerHTML=e.innerHTML,e.innerHTML="Available"}var s=await FormSubmit.submitForm(e,"events/add_host");s&&t(s)}(target)):target.matches(".close")&&null!=target.closest(".modal")&&"add_session"==target.closest(".modal").attributes.name.value&&(console.log(target),function(e){document.querySelectorAll(".ui-selected").forEach((e=>e.classList.remove("ui-selected","active","hidden"))),e.rowSpan=1}(document.querySelector("td.active"))),target.classList.contains("keyword")&&function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],s=e.closest("td"),l=a.cells[s.cellIndex].dataset.isodate,r=e.closest("tr").dataset.starttime,o=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(o.querySelector("form")),o.querySelector('[name="schedule_id"]').value=t.dataset.id,o.querySelector('[name="date"]').value=l,o.querySelector('[name="starttime"]').value=r,"Enter recipe keyword"!=e.textContent&&(o.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),o.classList.remove("hidden")}(target),target.classList.contains("publish")?(e.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):t.classList.remove("hidden")}(target)):target.classList.contains("remove_schedule")?(e.stopPropagation(),async function(e){var t=e.dataset.schedule_id,a=new FormData;if(a.append("schedule_id",t),await r("Are you sure you want to remove this schedule")){var s=await FormSubmit.fetchRestApi("events/remove_schedule",a);s&&(Main.displayMessage(s),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target)):target.matches(".edit_schedule")&&(e.stopPropagation(),function(e){let t=document.getElementById("edit_schedule_modal"),a=e.closest(".schedules_div"),s=a.querySelector("table.schedule");t.querySelector('[name="target_id"]').value=s.dataset.id,t.querySelector('[name="target_name"]').value=s.dataset.target,t.querySelector('[name="schedule_info"]').value=a.querySelector(".table_title.sub-title").textContent,t.querySelector('[name="startdate"]').value=s.tHead.querySelector("tr").cells[1].dataset.isodate,t.querySelector('[name="enddate"]').value=s.tHead.querySelector("tr").cells[s.tHead.querySelector("tr").cells.length-1].dataset.isodate,t.querySelector('[name="skiplunch"]').checked=s.dataset.lunch,t.querySelector('[name="skiporientation"]').checked=s.rows.length<3,t.classList.remove("hidden")}(target))})),document.addEventListener("change",(function(t){if(target=t.target,"target_name"==target.name){var a=target.list.querySelector(`[value='${target.value}' i]`).dataset.value;target.closest("form").querySelector('[name="target_id"]').value=a}else if("host"==target.name){let e=target.list.querySelector(`[value="${target.value}"]`),t="";null!=e&&(t=e.dataset.userid),target.closest("form").querySelector('[name="host_id"]').value=t}if(target.matches('[name="add_session"] .time')){let t=document.querySelector("td.active"),a=t.closest("table");if("starttime"==target.name&&null==a.querySelector(`tr[data-starttime="${target.value}"]`)||"endtime"==target.name&&null==a.querySelector(`tr[data-endtime="${target.value}"]`))return;let s=target.closest("form"),l=new Date,r=s.querySelector('[name="starttime"]').value.split(":");r=new Date(l.getFullYear(),0,1,r[0],r[1]);let o=s.querySelector('[name="endtime"]').value.split(":");o=new Date(l.getFullYear(),0,1,o[0],o[1]);let n=(o-r)/1e3/60/15;if(r!=target.value){t.removeAttribute("rowspan"),t.classList.remove("ui-selected","active");let a=t.closest("table").querySelector('tr[data-starttime="'+s.querySelector('[name="starttime"]').value+'"]').cells[t.cellIndex];a.innerHTML=t.innerHTML,a.classList.add("ui-selected","active"),e(a,n)}else e(t,n)}}))})();
//# sourceMappingURL=schedules.min.js.map