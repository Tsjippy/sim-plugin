(()=>{function e(e,t){if(t>1){for(var a=e.closest("tr"),l=e.cellIndex,s=1;s<t;s++)(a=a.nextElementSibling).cells[l].classList.add("hidden");e.rowSpan=t}}function t(e){var t=document.querySelector("td.active");t.classList.remove("active"),t.outerHTML=e.html,Main.hideModals(),Main.displayMessage(e.message),r()}async function a(e){var t,a=s(e),l=e.closest("table"),r=l.dataset.target,n=e.closest("td"),c=l.rows[0].cells[n.cellIndex].dataset.date;if(t=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${r} on ${c}`:`Please confirm you do not want to be the host for ${r} on ${c} anymore`,await o(t)){Main.showLoader(n.firstChild);var d=await FormSubmit.fetchRestApi("events/remove_host",a);n.classList.remove("selected"),n.classList.remove("ui-selected"),n.innerHTML="Available";var i=n.cellIndex,u=n.closest("tr");if(1==u.cells[0].rowSpan){for(var m=1;m<e.rowSpan;m++)(u=u.nextElementSibling).cells[i].classList.remove("hidden");e.rowSpan=1}Main.displayMessage(d)}}function l(t){let a=document.querySelector('[name="add_session"]'),l=t[0].node,s=t[t.length-1].node;l.classList.add("active"),e(l,document.querySelectorAll(".ui-selected").length),l.matches(".selected")||Main.showLoader(l.firstChild);let o=l.dataset.endtime;null==o&&(o=s.closest("tr").dataset.endtime);let r=l.closest("table"),n=r.rows[0].cells[l.cellIndex].dataset.isodate;a.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),a.querySelector('[name="schedule_id"]').value=r.dataset.id,a.querySelector('[name="date"]').value=n,a.querySelector('[name="olddate"]').value=n,a.querySelector('[name="starttime"]').value=l.closest("tr").dataset.starttime,a.querySelector('[name="endtime"]').value=o,a.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),a.querySelector('[name="add_timeslot"]').classList.add("update_schedule");let c=l.dataset.host_id,d=l.dataset.time,i=l.dataset.subject,u=l.dataset.location,m=l.dataset.host;null!=c&&(a.querySelector('[name="host_id"]').value=c),null!=d&&(a.querySelector('[name="oldtime"]').value=d),null!=i&&(a.querySelector('[name="subject"]').value=i),null!=u&&(a.querySelector('[name="location"]').value=u),null!=m&&(a.querySelector('[name="host"]').value=m),Main.showModal(a)}function s(e){var t=e.closest("table"),a=t.dataset.id,l=t.tHead.rows[0],s=e.closest("td"),o=l.cells[s.cellIndex].dataset.isodate,r=e.closest("tr").dataset.starttime,n=new FormData;return n.append("date",o),null!=s.dataset.host?n.append("host",s.dataset.host):n.append("host_id",sim.userId),n.append("starttime",r),n.append("schedule_id",a),n}async function o(e){let t={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(t.target=document.fullscreenElement),!!(await Swal.fire(t)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?Main.showLoader(target.closest(".schedules_div")):Main.showLoader(target.firstChild),!0)}function r(){Main.isMobileDevice()||document.querySelectorAll(".sim-table.schedule").forEach((function(e){null!=e._selectable&&e._selectable.destroy(),e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",n)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}function n(e,r,n){target=e.target,target.matches(".meal.selected.own, .meal.selected.admin")?a(target):target.matches(".meal.admin")?function(){target.classList.add("active");var e=target.closest("table"),t=target.closest("td"),a=e.rows[0].cells[t.cellIndex].dataset.isodate,l=target.closest("tr").dataset.starttime,s=target.closest(".schedules_wrapper").querySelector('[name="add_host"]');s.querySelectorAll('input:not([type="hidden"])').forEach((e=>e.value="")),s.querySelector('[name="schedule_id"]').value=e.dataset.id,s.querySelector('[name="date"]').value=a,s.querySelector('[name="starttime"]').value=l,s.classList.remove("hidden")}():target.matches(".meal:not(.admin, .selected)")?async function(e){var a=e.closest("table"),l=e.closest("td"),r=`Please confirm you want to be the host for ${a.dataset.target} on ${a.rows[0].cells[l.cellIndex].dataset.date}`;if(await o(r)){e.classList.add("active");var n=s(e),c=await FormSubmit.fetchRestApi("events/add_host",n);c&&t(c)}}(target):function(e,t,s){var o=document.querySelectorAll(".modal:not(.hidden)");if((t.length>0||e.classList.contains("orientation"))&&(null==o||0==o.length)){var r=t[0].node.cellIndex,n=t[0].node;for(const e of t)if(r!=e.node.cellIndex){let e={icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"};return null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),void s.target.closest(".sim-table")._selectable.clear()}n.classList.contains("selected")?async function(e){let t={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);var s=await Swal.fire(t),o=e[0].node;s.isConfirmed?(l(e),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot"):s.isDenied&&a(o)}(t):l(t)}}(target,r,e)}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),r()})),document.addEventListener("click",(function(e){target=e.target,console.log(target),"add_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),r())}(target)):"publish_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t))}(target)):"add_recipe_keyword"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(target)):"add_host"==target.name||"add_timeslot"==target.name?(e.stopPropagation(),async function(e){let a=e.closest("form");if(""!=a.querySelector('[name="oldtime"]').value){let e=document.querySelector("td.active");e.classList.remove("ui-selected","active","selected"),e.removeAttribute("rowspan");let t=a.querySelector('[name="date"]').value,l=a.querySelector('[name="starttime"]').value,s=e.closest("table").tHead.querySelector(`[data-isodate="${t}"]`).cellIndex,o=e.closest("table").querySelector(`tr[data-starttime="${l}"]`).cells[s];o.classList.add("ui-selected","active","selected"),o.innerHTML=e.innerHTML,e.innerHTML="Available"}var l=await FormSubmit.submitForm(e,"events/add_host");l&&t(l)}(target)):target.matches(".close")&&null!=target.closest(".modal")&&"add_session"==target.closest(".modal").attributes.name.value&&(console.log(target),function(e){document.querySelectorAll(".ui-selected").forEach((e=>e.classList.remove("ui-selected","active","hidden"))),e.rowSpan=1}(document.querySelector("td.active"))),target.classList.contains("keyword")&&function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],l=e.closest("td"),s=a.cells[l.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,r=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(r.querySelector("form")),r.querySelector('[name="schedule_id"]').value=t.dataset.id,r.querySelector('[name="date"]').value=s,r.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(r.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),Main.showModal(r)}(target),target.classList.contains("publish")?(e.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):Main.showModal(t)}(target)):target.classList.contains("remove_schedule")?(e.stopPropagation(),async function(e){var t=e.dataset.schedule_id,a=new FormData;if(a.append("schedule_id",t),await o("Are you sure you want to remove this schedule")){var l=await FormSubmit.fetchRestApi("events/remove_schedule",a);l&&(Main.displayMessage(l),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target)):target.matches(".edit_schedule")&&(e.stopPropagation(),function(e){let t=document.getElementById("edit_schedule_modal"),a=e.closest(".schedules_div"),l=a.querySelector("table.schedule");t.querySelector('[name="target_id"]').value=l.dataset.id,t.querySelector('[name="target_name"]').value=l.dataset.target,t.querySelector('[name="schedule_info"]').value=a.querySelector(".table_title.sub-title").textContent,t.querySelector('[name="startdate"]').value=l.tHead.querySelector("tr").cells[1].dataset.isodate,t.querySelector('[name="enddate"]').value=l.tHead.querySelector("tr").cells[l.tHead.querySelector("tr").cells.length-1].dataset.isodate,t.querySelector('[name="skiplunch"]').checked=l.dataset.lunch,t.querySelector('[name="skiporientation"]').checked=l.rows.length<3,Main.showModal(t)}(target))})),document.addEventListener("change",(function(t){if(target=t.target,"target_name"==target.name){var a=target.list.querySelector(`[value='${target.value}' i]`).dataset.value;target.closest("form").querySelector('[name="target_id"]').value=a}else if("host"==target.name){let e=target.list.querySelector(`[value="${target.value}"]`),t="";null!=e&&(t=e.dataset.userid),target.closest("form").querySelector('[name="host_id"]').value=t}if(target.matches('[name="add_session"] .time')){let t=document.querySelector("td.active"),a=t.closest("table");if("starttime"==target.name&&null==a.querySelector(`tr[data-starttime="${target.value}"]`)||"endtime"==target.name&&null==a.querySelector(`tr[data-endtime="${target.value}"]`))return;let l=target.closest("form"),s=new Date,o=l.querySelector('[name="starttime"]').value.split(":");o=new Date(s.getFullYear(),0,1,o[0],o[1]);let r=l.querySelector('[name="endtime"]').value.split(":");r=new Date(s.getFullYear(),0,1,r[0],r[1]);let n=(r-o)/1e3/60/15;if(o!=target.value){t.removeAttribute("rowspan"),t.classList.remove("ui-selected","active");let a=t.closest("table").querySelector('tr[data-starttime="'+l.querySelector('[name="starttime"]').value+'"]').cells[t.cellIndex];a.innerHTML=t.innerHTML,a.classList.add("ui-selected","active"),e(a,n)}else e(t,n)}}))})();
//# sourceMappingURL=schedules.min.js.map