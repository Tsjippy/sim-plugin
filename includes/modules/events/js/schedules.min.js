(()=>{function e(e){var t=document.querySelector('table[data-id="'+e.schedule_id+'"]'),a=t.querySelector('[data-isodate="'+e.date+'"]').cellIndex;return t.querySelector('tr[data-starttime="'+e.starttime+'"]').cells[a]}function t(e){var t=document.querySelector('[name="update_schedule_nonce"]').value;table=e.closest("table"),schedule_id=table.dataset.id;var a=table.tHead.rows[0],l=e.closest("td"),o=a.cells[l.cellIndex].dataset.isodate,s=e.closest("tr").dataset.starttime,n=new FormData;return n.append("date",o),null!=l.dataset.host?n.append("host",l.dataset.host):n.append("host",sim.userid),n.append("starttime",s),n.append("update_schedule_nonce",t),n.append("schedule_id",schedule_id),n}function a(e){var a=t(e);table=e.closest("table");var o=table.dataset.target,s=e.closest("td"),n=table.rows[0].cells[s.cellIndex].dataset.date;if(e.textContent.toLowerCase().includes("you")){var r="Please confirm you do not want to be the host for "+o+" on "+n+" anymore";a.append("action","remove_host"),l(r,a)}else e.classList.contains("admin")&&(r="Please confirm host removal for "+o+" on "+n,a.append("action","remove_host"),l(r,a))}function l(e,t){Swal.fire({title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then((e=>{e.isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?showLoader(target.closest(".schedules_div")):showLoader(target.firstChild),sendAJAX(t))}))}function o(e,o,n){if(target=e.target,target.matches(".meal.selected"))a(target);else if(target.matches(".meal"))!function(e){var a=t(e);table=e.closest("table");var o=table.dataset.target,s=e.closest("td"),n=table.rows[0].cells[s.cellIndex].dataset.date;if(e.textContent.toLowerCase().includes("available"))if(e.classList.contains("admin")){var r=table.rows[0].cells[s.cellIndex].dataset.isodate,d=e.closest("tr").dataset.starttime,c=e.closest(".schedules_wrapper").querySelector('[name="add_host"]');c.querySelector('[name="schedule_id"]').value=table.dataset.id,c.querySelector('[name="date"]').value=r,c.querySelector('[name="starttime"]').value=d,c.classList.remove("hidden")}else{var i="Please confirm you want to be the host for "+o+" on "+n;a.append("action","add_host"),l(i,a)}}(target);else{var r=document.querySelectorAll(".modal:not(.hidden)");if((o.length>0||target.classList.contains("orientation"))&&(null==r||0==r.length)){var d=o[0].node.cellIndex,c=o[0].node;for(const t of o)if(d!=t.node.cellIndex)return Swal.fire({icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"}),void e.target.closest(".sim-table")._selectable.clear();c.classList.contains("selected")?function(e){Swal.fire({title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"}).then((t=>{var l=e[0].node;if(t.isConfirmed){s(e);var o=document.querySelector('[name="add_session"]'),n=target.closest("tr").rowIndex+target.rowSpan-1,r=target.closest("table").rows[n].dataset.endtime;o.querySelector('[name="subject"]').value=l.querySelector(".subject").textContent,o.querySelector('[name="endtime"]').value=r;var d=l.querySelector(".location").textContent;"Add location"!=d&&(o.querySelector('[name="location"]').value=d);var c=l.dataset.host;null!=c&&(el=o.querySelector('[name="host"]'),null!=el&&(el.value=c),el.selectedOptions[0].defaultSelected=!0,el._niceselect.update(),el.selectedOptions[0].defaultSelected=!1),o.querySelector('[name="add_timeslot"]').textContent="Update time slot"}else t.isDenied&&a(l)}))}(o):s(o)}}}function s(e){var t=document.querySelector('[name="add_session"]'),a=e[0].node,l=e[e.length-1].node.closest("tr").dataset.endtime;table=a.closest("table");var o=table.rows[0].cells[a.cellIndex].dataset.isodate;t.querySelector('[name="schedule_id"]').value=table.dataset.id,t.querySelector('[name="date"]').value=o,t.querySelector('[name="olddate"]').value=o,t.querySelector('[name="starttime"]').value=a.closest("tr").dataset.starttime,t.querySelector('[name="endtime"]').value=l,t.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),t.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),t.classList.remove("hidden")}function n(){isMobileDevice()||document.querySelectorAll(".sim-table.schedule").forEach((function(e){e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",o)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table").forEach((function(e){var t=!0;"dinner"!=tr.dataset.starttime&&"lunch"!=tr.dataset.starttime&&(tr.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),1==t&&tr.classList.add("hidden"))}))}()}window.schedule_host_added=function(t,a){if(t.status>=200&&t.status<400){e(a).outerHTML=a.cell_html;var l=e(a);if(l.rowSpan>1){var o=l.closest("tr"),s=l.cellIndex;for(i=1;i<l.rowSpan;i++)(o=o.nextElementSibling).cells[s].classList.add("hidden")}hide_modals()}},window.schedule_host_removed=function(t,a){if(t.status>=200&&t.status<400){var l=e(a);l.classList.remove("selected"),l.classList.remove("ui-selected"),l.innerHTML="Available";var o=l.cellIndex,s=l.closest("tr");if(1==s.cells[0].rowSpan){for(i=1;i<l.rowSpan;i++)(s=s.nextElementSibling).cells[o].classList.remove("hidden");l.rowSpan=1}}},window.schedule_add_menu=function(t,a){t.status>=200&&t.status<400&&(e(a).querySelector(".keyword").textContent=a.menu),hide_modals()},window.add_schedule=function(e,t){e.status>=200&&e.status<400&&(document.querySelectorAll(".schedules_wrapper").forEach((e=>e.outerHTML=t.html)),n())},document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),n()})),document.addEventListener("click",(function(e){target=e.target,target.classList.contains("remove_schedule")&&function(e){schedule_id=e.dataset.schedule_id;var t=document.querySelector('[name="remove_schedule_nonce"]').value,a=new FormData;a.append("action","remove_schedule"),a.append("schedule_id",schedule_id),a.append("remove_schedule_nonce",t),l("Are you sure you want to remove this schedule?",a)}(target),target.classList.contains("publish")&&function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="select_schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),showLoader(e,!0)):t.classList.remove("hidden")}(target),target.classList.contains("keyword")&&function(e){table=e.closest("table"),schedule_id=table.dataset.id;var t=table.tHead.rows[0],a=e.closest("td"),l=t.cells[a.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime;recipe_modal=document.querySelector('[name="add_recipe_keyword"]'),recipe_modal.querySelector('[name="schedule_id"]').value=table.dataset.id,recipe_modal.querySelector('[name="date"]').value=l,recipe_modal.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(recipe_modal.querySelector('[name="recipe_keyword"]').value=e.textContent),recipe_modal.classList.remove("hidden")}(target),target.classList.contains("timeslot")})),document.addEventListener("change",(function(e){if(target=e.target,"target_name"==target.name){var t=target.list.querySelector("[value='"+target.value+"' i]").dataset.value;target.closest("form").querySelector('[name="target_id"]').value=t}}))})();
//# sourceMappingURL=schedules.min.js.map