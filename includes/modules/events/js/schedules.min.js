(()=>{function e(e){var t=document.querySelector("td.active");if(t.classList.remove("active"),t.rowSpan>1){var a=t.closest("tr"),s=t.cellIndex;for(i=1;i<t.rowSpan;i++)(a=a.nextElementSibling).cells[s].classList.add("hidden")}t.outerHTML=e.html,hide_modals(),o(),display_message(e.message)}async function t(e){var t=s(e);table=e.closest("table");var a=table.dataset.target,o=e.closest("td"),r=table.rows[0].cells[o.cellIndex].dataset.date;if(e.classList.contains("orientation"))var n="Are you sure you want to remove this orientation session";else n=e.classList.contains("admin")?`Please confirm host removal for ${a} on ${r}`:`Please confirm you do not want to be the host for ${a} on ${r} anymore`;if(await l(n)){showLoader(o.firstChild);var d=await fetchRestApi("events/remove_host",t);o.classList.remove("selected"),o.classList.remove("ui-selected"),o.innerHTML="Available";var c=o.cellIndex,u=o.closest("tr");if(1==u.cells[0].rowSpan){for(i=1;i<e.rowSpan;i++)(u=u.nextElementSibling).cells[c].classList.remove("hidden");e.rowSpan=1}display_message(d)}}function a(e){var t=document.querySelector('[name="add_session"]'),a=e[0].node,s=e[e.length-1].node;a.classList.add("active"),a.rowSpan=document.querySelectorAll(".ui-selected").length;var l=s.closest("tr").dataset.endtime;table=a.closest("table");var o=table.rows[0].cells[a.cellIndex].dataset.isodate;t.querySelector('[name="schedule_id"]').value=table.dataset.id,t.querySelector('[name="date"]').value=o,t.querySelector('[name="olddate"]').value=o,t.querySelector('[name="starttime"]').value=a.closest("tr").dataset.starttime,t.querySelector('[name="endtime"]').value=l,t.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),t.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),t.classList.remove("hidden")}function s(e){table=e.closest("table"),schedule_id=table.dataset.id;var t=table.tHead.rows[0],a=e.closest("td"),s=t.cells[a.cellIndex].dataset.isodate,l=e.closest("tr").dataset.starttime,o=new FormData;return o.append("date",s),null!=a.dataset.host?o.append("host",a.dataset.host):o.append("host",sim.userid),o.append("starttime",l),o.append("schedule_id",schedule_id),o}async function l(e){return!!(await Swal.fire({title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"})).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?showLoader(target.closest(".schedules_div")):showLoader(target.firstChild),!0)}function o(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",r)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table").forEach((function(e){var t=!0;"dinner"!=tr.dataset.starttime&&"lunch"!=tr.dataset.starttime&&(tr.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),1==t&&tr.classList.add("hidden"))}))}()}function r(o,r,n){if(target=o.target,target.matches(".meal.selected"))t(target);else if(target.matches(".meal.admin"))!function(){target.classList.add("active"),table=target.closest("table");var e=target.closest("td"),t=table.rows[0].cells[e.cellIndex].dataset.isodate,a=target.closest("tr").dataset.starttime,s=target.closest(".schedules_wrapper").querySelector('[name="add_host"]');s.querySelector('[name="schedule_id"]').value=table.dataset.id,s.querySelector('[name="date"]').value=t,s.querySelector('[name="starttime"]').value=a,s.classList.remove("hidden")}();else if(target.matches(".meal:not(.admin)"))!async function(t){table=t.closest("table");var a=t.closest("td"),o=`Please confirm you want to be the host for ${table.dataset.target} on ${table.rows[0].cells[a.cellIndex].dataset.date}`;if(await l(o)){t.classList.add("active");var r=s(t),n=await fetchRestApi("events/add_host",r);n&&e(n)}}(target);else{var d=document.querySelectorAll(".modal:not(.hidden)");if((r.length>0||target.classList.contains("orientation"))&&(null==d||0==d.length)){var c=r[0].node.cellIndex,i=r[0].node;for(const e of r)if(c!=e.node.cellIndex)return Swal.fire({icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"}),void o.target.closest(".sim-table")._selectable.clear();i.classList.contains("selected")?async function(e){var s=await Swal.fire({title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"}),l=e[0].node;if(s.isConfirmed){a(e);var o=document.querySelector('[name="add_session"]'),r=target.closest("tr").rowIndex+target.rowSpan-1,n=target.closest("table").rows[r].dataset.endtime;o.querySelector('[name="subject"]').value=l.querySelector(".subject").textContent,o.querySelector('[name="endtime"]').value=n;var d=l.querySelector(".location").textContent;"Add location"!=d&&(o.querySelector('[name="location"]').value=d);var c=l.dataset.host;null!=c&&(el=o.querySelector('[name="host"]'),null!=el&&(el.value=c),el.selectedOptions[0].defaultSelected=!0,el._niceselect.update(),el.selectedOptions[0].defaultSelected=!1),o.querySelector('[name="add_timeslot"]').textContent="Update time slot"}else s.isDenied&&t(l)}(r):a(r)}}}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),o()})),document.addEventListener("click",(function(t){target=t.target,"add_schedule"==target.name&&async function(e){var t=await submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,display_message(t.message),o())}(target),target.classList.contains("remove_schedule")&&async function(e){schedule_id=e.dataset.schedule_id;var t=new FormData;if(t.append("schedule_id",schedule_id),await l("Are you sure you want to remove this schedule")){var a=await fetchRestApi("events/remove_schedule",t);a&&(display_message(a),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target),target.classList.contains("publish")&&function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),showLoader(e,!0)):t.classList.remove("hidden")}(target),"publish_schedule"==target.name&&async function(e){response=await submitForm(e,"events/publish_schedule"),response&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),hide_modals(),display_message(response))}(target),target.classList.contains("keyword")&&function(e){e.classList.add("active"),table=e.closest("table"),schedule_id=table.dataset.id;var t=table.tHead.rows[0],a=e.closest("td"),s=t.cells[a.cellIndex].dataset.isodate,l=e.closest("tr").dataset.starttime;recipe_modal=document.querySelector('[name="recipe_keyword_modal"]'),formReset(recipe_modal.querySelector("form")),recipe_modal.querySelector('[name="schedule_id"]').value=table.dataset.id,recipe_modal.querySelector('[name="date"]').value=s,recipe_modal.querySelector('[name="starttime"]').value=l,"Enter recipe keyword"!=e.textContent&&(recipe_modal.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),recipe_modal.classList.remove("hidden")}(target),"add_recipe_keyword"==target.name&&async function(e){var t=await submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),hide_modals(),display_message(t)}(target),"add_host"!=target.name&&"add_timeslot"!=target.name||async function(t){var a=await submitForm(t,"events/add_host");a&&e(a)}(target)})),document.addEventListener("change",(function(e){if(target=e.target,"target_name"==target.name){var t=target.list.querySelector("[value='"+target.value+"' i]").dataset.value;target.closest("form").querySelector('[name="target_id"]').value=t}}))})();
//# sourceMappingURL=schedules.min.js.map