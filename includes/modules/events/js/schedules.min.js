(()=>{function e(e){var t=document.querySelector("td.active");if(t.classList.remove("active"),t.rowSpan>1)for(var a=t.closest("tr"),s=t.cellIndex,o=1;o<t.rowSpan;o++)(a=a.nextElementSibling).cells[s].classList.add("hidden");t.outerHTML=e.html,Main.hideModals(),n(),Main.displayMessage(e.message)}async function t(e){var t,a=o(e),s=e.closest("table"),n=s.dataset.target,l=e.closest("td"),d=s.rows[0].cells[l.cellIndex].dataset.date;if(t=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${n} on ${d}`:`Please confirm you do not want to be the host for ${n} on ${d} anymore`,await r(t)){Main.showLoader(l.firstChild);var i=await FormSubmit.fetchRestApi("events/remove_host",a);l.classList.remove("selected"),l.classList.remove("ui-selected"),l.innerHTML="Available";var c=l.cellIndex,u=l.closest("tr");if(1==u.cells[0].rowSpan){for(var m=1;m<e.rowSpan;m++)(u=u.nextElementSibling).cells[c].classList.remove("hidden");e.rowSpan=1}Main.displayMessage(i)}}function a(e){var t=document.querySelector('[name="add_session"]'),a=e[0].node,s=e[e.length-1].node;a.classList.add("active"),a.rowSpan=document.querySelectorAll(".ui-selected").length;var o=s.closest("tr").dataset.endtime,r=a.closest("table"),n=r.rows[0].cells[first_cell.cellIndex].dataset.isodate;t.querySelector('[name="schedule_id"]').value=r.dataset.id,t.querySelector('[name="date"]').value=n,t.querySelector('[name="olddate"]').value=n,t.querySelector('[name="starttime"]').value=a.closest("tr").dataset.starttime,t.querySelector('[name="endtime"]').value=o,t.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),t.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),t.classList.remove("hidden")}async function s(e){var s=await Swal.fire({title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"}),o=e[0].node;if(s.isConfirmed){a(e);var r=document.querySelector('[name="add_session"]'),n=target.closest("tr").rowIndex+target.rowSpan-1,l=target.closest("table").rows[n].dataset.firstCell;r.querySelector('[name="subject"]').value=o.querySelector(".subject").textContent,r.querySelector('[name="endtime"]').value=l;var d=first_cell.querySelector(".location").textContent;"Add location"!=d&&(r.querySelector('[name="location"]').value=d);var i=o.dataset.host;if(null!=i){let e=r.querySelector('[name="host"]');null!=e&&(e.value=i),e.selectedOptions[0].defaultSelected=!0,e._niceselect.update(),e.selectedOptions[0].defaultSelected=!1}r.querySelector('[name="add_timeslot"]').textContent="Update time slot"}else s.isDenied&&t(o)}function o(e){var t=e.closest("table"),a=t.dataset.id,s=t.tHead.rows[0],o=e.closest("td"),r=s.cells[o.cellIndex].dataset.isodate,n=e.closest("tr").dataset.starttime,l=new FormData;return l.append("date",r),null!=o.dataset.host?l.append("host",o.dataset.host):l.append("host",sim.userId),l.append("starttime",n),l.append("schedule_id",a),l}async function r(e){return!!(await Swal.fire({title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"})).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?Main.showLoader(target.closest(".schedules_div")):Main.showLoader(target.firstChild),!0)}function n(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",l)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}function l(n,l,d){target=n.target,target.matches(".meal.selected")?t(target):target.matches(".meal.admin")?function(){target.classList.add("active");var e=target.closest("table"),t=target.closest("td"),a=e.rows[0].cells[t.cellIndex].dataset.isodate,s=target.closest("tr").dataset.starttime,o=target.closest(".schedules_wrapper").querySelector('[name="add_host"]');o.querySelector('[name="schedule_id"]').value=e.dataset.id,o.querySelector('[name="date"]').value=a,o.querySelector('[name="starttime"]').value=s,o.classList.remove("hidden")}():target.matches(".meal:not(.admin)")?async function(t){var a=t.closest("table"),s=t.closest("td"),n=`Please confirm you want to be the host for ${a.dataset.target} on ${a.rows[0].cells[s.cellIndex].dataset.date}`;if(await r(n)){t.classList.add("active");var l=o(t),d=await FormSubmit.fetchRestApi("events/add_host",l);d&&e(d)}}(target):function(e,t,o){var r=document.querySelectorAll(".modal:not(.hidden)");if((t.length>0||e.classList.contains("orientation"))&&(null==r||0==r.length)){var n=t[0].node.cellIndex,l=t[0].node;for(const e of t)if(n!=e.node.cellIndex)return Swal.fire({icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"}),void o.target.closest(".sim-table")._selectable.clear();l.classList.contains("selected")?s(t):a(t)}}(target,l,n)}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),n()})),document.addEventListener("click",(function(t){target=t.target,"add_schedule"==target.name&&(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),n())}(target)),target.classList.contains("remove_schedule")&&(t.stopPropagation(),async function(e){var t=e.dataset.schedule_id,a=new FormData;if(a.append("schedule_id",t),await r("Are you sure you want to remove this schedule")){var s=await FormSubmit.fetchRestApi("events/remove_schedule",a);s&&(Main.displayMessage(s),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target)),target.classList.contains("publish")&&(t.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):t.classList.remove("hidden")}(target)),"publish_schedule"==target.name&&(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t))}(target)),target.classList.contains("keyword")&&function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],s=e.closest("td"),o=a.cells[s.cellIndex].dataset.isodate,r=e.closest("tr").dataset.starttime,n=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(n.querySelector("form")),n.querySelector('[name="schedule_id"]').value=t.dataset.id,n.querySelector('[name="date"]').value=o,n.querySelector('[name="starttime"]').value=r,"Enter recipe keyword"!=e.textContent&&(n.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),n.classList.remove("hidden")}(target),"add_recipe_keyword"==target.name&&(t.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(target)),"add_host"!=target.name&&"add_timeslot"!=target.name||(t.stopPropagation(),async function(t){var a=await FormSubmit.submitForm(t,"events/add_host");a&&e(a)}(target))})),document.addEventListener("change",(function(e){if(target=e.target,"target_name"==target.name){var t=target.list.querySelector("[value='"+target.value+"' i]").dataset.value;target.closest("form").querySelector('[name="target_id"]').value=t}}))})();
//# sourceMappingURL=schedules.min.js.map