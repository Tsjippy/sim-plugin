(()=>{function e(e,t){if(t>1){for(var a=e.closest("tr"),s=e.cellIndex,l=1;l<t;l++)(a=a.nextElementSibling).cells[s].classList.add("hidden");e.rowSpan=t}}async function t(e){var t=e.closest("table");let s,l;if(null!=t){var o=e.closest("td");s=t.closest(".schedules_div").dataset.target,l=t.rows[0].cells[o.cellIndex].dataset.date}else s=e.closest(".schedules_div").dataset.target,l=e.dataset.date;var d=`Please confirm you want to be the host for ${s} on ${l}`;if(await n(d)){var i=r(e);e.classList.add("active"),null!=e.closest(".session-wrapper-mobile ")&&e.closest(".session-wrapper-mobile ").classList.add("active"),null==t&&Main.showLoader(e);var c=await FormSubmit.fetchRestApi("events/add_host",i);c&&a(c)}}function a(e){var t=document.querySelector(".active");t.classList.remove("active"),t.outerHTML=e.html,Main.displayMessage(e.message),d(),Main.hideModals()}async function s(e){let t,a,s,l,o,d,i;var c=e.closest("table");if(null!=c?(t=r(e),a=c.closest(".schedules_div").dataset.target,s=e.closest("td"),l=c.rows[0].cells[s.cellIndex].dataset.date):(console.log(e),t=r(e),a=e.closest(".schedules_div").dataset.target,l=e.dataset.date),o=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${a} on ${l}`:`Please confirm you do not want to be the host for ${a} on ${l} anymore`,i=await n(o),i){null!=c?Main.showLoader(s.firstChild):(d=e.closest(".session-wrapper-mobile"),Main.showLoader(e));var u=await FormSubmit.fetchRestApi("events/remove_host",t);if(null!=c){s.classList.remove("selected"),s.classList.remove("ui-selected"),s.innerHTML="Available";var m=s.cellIndex,h=s.closest("tr");if(1==h.cells[0].rowSpan){for(var v=1;v<e.rowSpan;v++)(h=h.nextElementSibling).cells[m].classList.remove("hidden");e.rowSpan=1}}else d.remove();Main.displayMessage(u)}}function l(t=""){let a,s,l,o,r,n,d,i,c,u=document.querySelector('[name="add_session"]');if(u.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),null==t[0])a=t,s=a.dataset.isodate,l=a.dataset.starttime,o=a.dataset.endtime,u.querySelector('[name="schedule_id"]').value=t.closest(".schedules_div").dataset.id;else{a=t[0].node;let r=t[t.length-1].node;e(a,document.querySelectorAll(".ui-selected").length),a.matches(".selected")||Main.showLoader(a.firstChild),l=a.closest("tr").dataset.starttime,o=a.dataset.endtime,null==o&&(o=r.closest("tr").dataset.endtime),s=a.closest("table").rows[0].cells[a.cellIndex].dataset.isodate}r=a.dataset.host_id,n=a.dataset.old_time,d=a.dataset.subject,i=a.dataset.location,c=a.dataset.host,sessionId=a.dataset.session_id,null!=target.closest(".day-wrapper-mobile")?target.closest(".day-wrapper-mobile").classList.add("active"):a.classList.add("active"),u.querySelector('[name="date"]').value=s,u.querySelector('[name="starttime"]').value=l,u.querySelector('[name="endtime"]').value=o,u.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),u.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),null!=l&&(u.querySelector('[name="oldtime"]').value=l),null!=s&&(u.querySelector('[name="olddate"]').value=s),null!=r&&(u.querySelector('[name="host_id"]').value=r),null!=d&&(u.querySelector('[name="subject"]').value=d),null!=i&&(u.querySelector('[name="location"]').value=i),null!=c&&(u.querySelector('[name="host"]').value=c),Main.showModal(u)}async function o(e){let t={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);var a=await Swal.fire(t);let o;o=null==e[0]?e:e[0].node,a.isConfirmed?(l(e),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot"):a.isDenied&&s(o)}function r(e){var t=e.closest("table");let a,s,l,o,r,n;null==t?(a=e.closest(".schedules_div").dataset.id,r=e.dataset.starttime,n=e.dataset.host_id,o=e.dataset.isodate):(a=t.closest(".schedules_div").dataset.id,s=t.tHead.rows[0],l=e.closest("td"),o=s.cells[l.cellIndex].dataset.isodate,r=e.closest("tr").dataset.starttime,n=l.dataset.host);var d=new FormData;return d.append("date",o),null!=n?d.append("host_id",n):d.append("host_id",sim.userId),d.append("starttime",r),d.append("schedule_id",a),d}async function n(e){let t={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(t.target=document.fullscreenElement),!!(await Swal.fire(t)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?Main.showLoader(target.closest(".schedules_div")):Main.showLoader(target.firstChild),!0)}function d(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){(!Main.isMobileDevice()||e.rows.length<7)&&(null!=e._selectable&&e._selectable.destroy(),e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",i))})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table tr").forEach((function(e){var t=!0;"dinner"!=e.dataset.starttime&&"lunch"!=e.dataset.starttime&&(e.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),t&&e.classList.add("hidden"))}))}()}function i(e,a,r){target=e.target,target.matches(".meal.selected.own, .meal.selected.admin")?s(target):target.matches(".meal.admin")?function(e){let t=e.closest("table");e.classList.add("active");let a=document.querySelector('[name="add_host"]');if(null!=t){let s=e.closest("td"),l=t.rows[0].cells[s.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime;a.querySelector('[name="date"]').value=l,a.querySelector('[name="starttime"]').value=o}a.querySelectorAll('input:not([type="hidden"], [type="radio"])').forEach((e=>e.value="")),a.querySelector('[name="schedule_id"]').value=e.closest(".schedules_div").dataset.id,a.classList.remove("hidden")}(target):target.matches(".meal:not(.admin, .selected)")?t(target):function(e,t,a){var s=document.querySelectorAll(".modal:not(.hidden)");if((t.length>0||e.classList.contains("orientation"))&&(null==s||0==s.length)){var r=t[0].node.cellIndex,n=t[0].node;for(const e of t)if(r!=e.node.cellIndex){let e={icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"};return null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),void a.target.closest(".sim-table")._selectable.clear()}n.classList.contains("selected")?o(t):l(t)}}(target,a,e)}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),d()})),document.addEventListener("click",(function(e){target=e.target,"add_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,Main.displayMessage(t.message),d())}(target)):"publish_schedule"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/publish_schedule");t&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),Main.hideModals(),Main.displayMessage(t))}(target)):"add_recipe_keyword"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),Main.hideModals(),Main.displayMessage(t)}(target)):"add_host"==target.name||"add_timeslot"==target.name?(e.stopPropagation(),async function(e){let t=e.closest("form");if(""!=t.querySelector('[name="oldtime"]').value){let e=document.querySelector("td.active");if(null!=e){e.classList.remove("ui-selected","active","selected"),e.classList.add("available"),e.removeAttribute("rowspan");let a=t.querySelector('[name="date"]').value,s=t.querySelector('[name="starttime"]').value,l=e.closest("table").tHead.querySelector(`[data-isodate="${a}"]`).cellIndex,o=e.closest("table").querySelector(`tr[data-starttime="${s}"]`).cells[l];o.classList.add("ui-selected","active","selected"),e.classList.remove("available"),o.innerHTML=e.innerHTML,e.innerHTML="Available"}}var s=await FormSubmit.submitForm(e,"events/add_host");s&&a(s)}(target)):target.matches(".close")&&null!=target.closest(".modal")&&"add_session"==target.closest(".modal").attributes.name.value?function(e){document.querySelectorAll(".ui-selected").forEach((e=>e.classList.remove("ui-selected","active","hidden"))),e.rowSpan=1}(document.querySelector("td.active")):"add-session"==target.name?(e.stopPropagation(),l(target)):"add-host"==target.name?(e.stopPropagation(),Main.showModal(target.closest(".schedules_div").querySelector(".add-host-mobile-wrapper"))):"add_host_mobile"==target.name?(e.stopPropagation(),async function(e){var t=await FormSubmit.submitForm(e,"events/add_host");t&&Main.displayMessage(t),Main.hideModals()}(target)):null!=target.closest(".remove-host-mobile")?(e.stopPropagation(),s(target.closest(".remove-host-mobile"))):null!=target.closest(".edit-session-mobile")?o(target.closest(".edit-session-mobile")):null!=target.closest(".add-me-as-host")&&t(target.closest(".add-me-as-host")),target.classList.contains("keyword")&&function(e){e.classList.add("active");var t=e.closest("table"),a=t.tHead.rows[0],s=e.closest("td"),l=a.cells[s.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,r=document.querySelector('[name="recipe_keyword_modal"]');FormSubmit.formReset(r.querySelector("form")),r.querySelector('[name="schedule_id"]').value=t.dataset.id,r.querySelector('[name="date"]').value=l,r.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(r.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),Main.showModal(r)}(target),target.classList.contains("publish")?(e.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),Main.showLoader(e,!0)):Main.showModal(t)}(target)):target.classList.contains("remove_schedule")?(e.stopPropagation(),async function(e){var t=e.dataset.schedule_id,a=new FormData;if(a.append("schedule_id",t),await n("Are you sure you want to remove this schedule")){var s=await FormSubmit.fetchRestApi("events/remove_schedule",a);s&&(Main.displayMessage(s),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target)):target.matches(".edit_schedule")&&(e.stopPropagation(),function(e){let t=document.getElementById("edit_schedule_modal"),a=e.closest(".schedules_div"),s=a.querySelector("table.schedule");t.querySelector('[name="schedule_id"]').value=s.dataset.id,t.querySelector('[name="target_id"]').value=s.dataset.target_id,t.querySelector('[name="target_name"]').value=s.dataset.target,t.querySelector('[name="schedule_info"]').value=a.querySelector(".table_title.sub-title").textContent,t.querySelector('[name="startdate"]').value=s.tHead.querySelector("tr").cells[1].dataset.isodate,t.querySelector('[name="enddate"]').value=s.tHead.querySelector("tr").cells[s.tHead.querySelector("tr").cells.length-1].dataset.isodate,t.querySelector('[name="skiplunch"]').checked=s.dataset.lunch,t.querySelector('[name="skiporientation"]').checked=s.rows.length<3,Main.showModal(t)}(target))})),document.addEventListener("change",(function(t){if(target=t.target,"target_name"==target.name){var a=target.list.querySelector(`[value='${target.value}' i]`).dataset.value;target.closest("form").querySelector('[name="target_id"]').value=a}else if("host"==target.name){let e=target.list.querySelector(`[value="${target.value}"]`),t="";null!=e&&(t=e.dataset.userid),target.closest("form").querySelector('[name="host_id"]').value=t}else"starttime"==target.name&&"radio"==target.type&&("12:00"==target.value?(target.closest("form").querySelector(".lunch.select-wrapper").classList.remove("hidden"),target.closest("form").querySelector(".diner.select-wrapper").classList.add("hidden")):(target.closest("form").querySelector(".diner.select-wrapper").classList.remove("hidden"),target.closest("form").querySelector(".lunch.select-wrapper").classList.add("hidden")));if(target.matches('[name="add_session"] .time')){let t=document.querySelector("td.active");if(null==t)return;let a=t.closest("table");if("starttime"==target.name&&null==a.querySelector(`tr[data-starttime="${target.value}"]`)||"endtime"==target.name&&null==a.querySelector(`tr[data-endtime="${target.value}"]`))return;let s=target.closest("form"),l=new Date,o=s.querySelector('[name="starttime"]').value.split(":");o=new Date(l.getFullYear(),0,1,o[0],o[1]);let r=s.querySelector('[name="endtime"]').value.split(":");r=new Date(l.getFullYear(),0,1,r[0],r[1]);let n=(r-o)/1e3/60/15;if(o!=target.value){t.removeAttribute("rowspan"),t.classList.remove("ui-selected","active");let a=t.closest("table").querySelector('tr[data-starttime="'+s.querySelector('[name="starttime"]').value+'"]').cells[t.cellIndex];a.innerHTML=t.innerHTML,a.classList.add("ui-selected","active"),e(a,n)}else e(t,n)}}))})();
//# sourceMappingURL=schedules.min.js.map