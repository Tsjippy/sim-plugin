(()=>{function e(e){var t=document.querySelector("td.active");if(t.classList.remove("active"),t.rowSpan>1){var a=t.closest("tr"),s=t.cellIndex;for(i=1;i<t.rowSpan;i++)(a=a.nextElementSibling).cells[s].classList.add("hidden")}t.outerHTML=e.html,main.hideModals(),l(),main.displayMessage(e.message)}async function t(e){var t=s(e);table=e.closest("table");var a=table.dataset.target,l=e.closest("td"),r=table.rows[0].cells[l.cellIndex].dataset.date;if(e.classList.contains("orientation"))var n="Are you sure you want to remove this orientation session";else n=e.classList.contains("admin")?`Please confirm host removal for ${a} on ${r}`:`Please confirm you do not want to be the host for ${a} on ${r} anymore`;if(await o(n)){main.showLoader(l.firstChild);var d=await formsubmit.fetchRestApi("events/remove_host",t);l.classList.remove("selected"),l.classList.remove("ui-selected"),l.innerHTML="Available";var c=l.cellIndex,u=l.closest("tr");if(1==u.cells[0].rowSpan){for(i=1;i<e.rowSpan;i++)(u=u.nextElementSibling).cells[c].classList.remove("hidden");e.rowSpan=1}main.displayMessage(d)}}function a(e){var t=document.querySelector('[name="add_session"]'),a=e[0].node,s=e[e.length-1].node;a.classList.add("active"),a.rowSpan=document.querySelectorAll(".ui-selected").length;var o=s.closest("tr").dataset.endtime;table=a.closest("table");var l=table.rows[0].cells[a.cellIndex].dataset.isodate;t.querySelector('[name="schedule_id"]').value=table.dataset.id,t.querySelector('[name="date"]').value=l,t.querySelector('[name="olddate"]').value=l,t.querySelector('[name="starttime"]').value=a.closest("tr").dataset.starttime,t.querySelector('[name="endtime"]').value=o,t.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),t.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),t.classList.remove("hidden")}function s(e){table=e.closest("table"),schedule_id=table.dataset.id;var t=table.tHead.rows[0],a=e.closest("td"),s=t.cells[a.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime,l=new FormData;return l.append("date",s),null!=a.dataset.host?l.append("host",a.dataset.host):l.append("host",sim.userid),l.append("starttime",o),l.append("schedule_id",schedule_id),l}async function o(e){return!!(await Swal.fire({title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"})).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),target.classList.contains("remove_schedule")?main.showLoader(target.closest(".schedules_div")):main.showLoader(target.firstChild),!0)}function l(){document.querySelectorAll(".sim-table.schedule").forEach((function(e){e._selectable=new Selectable({filter:".orientation.admin",appendTo:e.querySelector("tbody"),lasso:{border:"none",backgroundColor:"none"}}),e._selectable.on("end",r)})),function(){if(window.innerWidth>800)return!1;document.querySelectorAll(".sim-table").forEach((function(e){var t=!0;"dinner"!=tr.dataset.starttime&&"lunch"!=tr.dataset.starttime&&(tr.querySelectorAll("td").forEach((function(e,a){a>0&&"Available"!=e.textContent&&" "!=e.textContent&&(t=!1)})),1==t&&tr.classList.add("hidden"))}))}()}function r(l,r,n){if(target=l.target,target.matches(".meal.selected"))t(target);else if(target.matches(".meal.admin"))!function(){target.classList.add("active"),table=target.closest("table");var e=target.closest("td"),t=table.rows[0].cells[e.cellIndex].dataset.isodate,a=target.closest("tr").dataset.starttime,s=target.closest(".schedules_wrapper").querySelector('[name="add_host"]');s.querySelector('[name="schedule_id"]').value=table.dataset.id,s.querySelector('[name="date"]').value=t,s.querySelector('[name="starttime"]').value=a,s.classList.remove("hidden")}();else if(target.matches(".meal:not(.admin)"))!async function(t){table=t.closest("table");var a=t.closest("td"),l=`Please confirm you want to be the host for ${table.dataset.target} on ${table.rows[0].cells[a.cellIndex].dataset.date}`;if(await o(l)){t.classList.add("active");var r=s(t),n=await formsubmit.fetchRestApi("events/add_host",r);n&&e(n)}}(target);else{var d=document.querySelectorAll(".modal:not(.hidden)");if((r.length>0||target.classList.contains("orientation"))&&(null==d||0==d.length)){var i=r[0].node.cellIndex,c=r[0].node;for(const e of r)if(i!=e.node.cellIndex)return Swal.fire({icon:"error",title:"You can not select times on multiple days!",confirmButtonColor:"#bd2919"}),void l.target.closest(".sim-table")._selectable.clear();c.classList.contains("selected")?async function(e){var s=await Swal.fire({title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"}),o=e[0].node;if(s.isConfirmed){a(e);var l=document.querySelector('[name="add_session"]'),r=target.closest("tr").rowIndex+target.rowSpan-1,n=target.closest("table").rows[r].dataset.endtime;l.querySelector('[name="subject"]').value=o.querySelector(".subject").textContent,l.querySelector('[name="endtime"]').value=n;var d=o.querySelector(".location").textContent;"Add location"!=d&&(l.querySelector('[name="location"]').value=d);var i=o.dataset.host;null!=i&&(el=l.querySelector('[name="host"]'),null!=el&&(el.value=i),el.selectedOptions[0].defaultSelected=!0,el._niceselect.update(),el.selectedOptions[0].defaultSelected=!1),l.querySelector('[name="add_timeslot"]').textContent="Update time slot"}else s.isDenied&&t(o)}(r):a(r)}}}document.addEventListener("DOMContentLoaded",(function(){console.log("Schedule.js loaded"),l()})),document.addEventListener("click",(function(t){target=t.target,"add_schedule"==target.name&&(t.stopPropagation(),async function(e){var t=await formsubmit.submitForm(e,"events/add_schedule");t&&(e.closest(".schedules_wrapper").outerHTML=t.html,main.displayMessage(t.message),l())}(target)),target.classList.contains("remove_schedule")&&(t.stopPropagation(),async function(e){schedule_id=e.dataset.schedule_id;var t=new FormData;if(t.append("schedule_id",schedule_id),await o("Are you sure you want to remove this schedule")){var a=await formsubmit.fetchRestApi("events/remove_schedule",t);a&&(main.displayMessage(a),document.querySelector(".schedules_wrapper .loaderwrapper:not(.hidden)").remove())}}(target)),target.classList.contains("publish")&&(t.stopPropagation(),function(e){var t=e.closest(".schedules_div").querySelector(".publish_schedule");t.querySelector('[name="schedule_id"]').value=e.dataset.schedule_id,null!=e.dataset.target?(t.querySelector('[name="schedule_target"]').value=e.dataset.target,t.querySelector('[name="publish_schedule"]').click(),main.showLoader(e,!0)):t.classList.remove("hidden")}(target)),"publish_schedule"==target.name&&(t.stopPropagation(),async function(e){response=await formsubmit.submitForm(e,"events/publish_schedule"),response&&(document.querySelectorAll(".schedule_actions .loadergif").forEach((e=>e.classList.add("hidden"))),main.hideModals(),main.displayMessage(response))}(target)),target.classList.contains("keyword")&&function(e){e.classList.add("active"),table=e.closest("table"),schedule_id=table.dataset.id;var t=table.tHead.rows[0],a=e.closest("td"),s=t.cells[a.cellIndex].dataset.isodate,o=e.closest("tr").dataset.starttime;recipe_modal=document.querySelector('[name="recipe_keyword_modal"]'),formsubmit.formReset(recipe_modal.querySelector("form")),recipe_modal.querySelector('[name="schedule_id"]').value=table.dataset.id,recipe_modal.querySelector('[name="date"]').value=s,recipe_modal.querySelector('[name="starttime"]').value=o,"Enter recipe keyword"!=e.textContent&&(recipe_modal.querySelector('[name="recipe_keyword"]').value=e.textContent,document.querySelector('[name="add_recipe_keyword"]').textContent="Update recipe keywords"),recipe_modal.classList.remove("hidden")}(target),"add_recipe_keyword"==target.name&&(t.stopPropagation(),async function(e){var t=await formsubmit.submitForm(e,"events/add_menu");document.querySelector(".active").textContent=e.closest("form").querySelector('[name="recipe_keyword"]').value,document.querySelector(".active").classList.remove("active"),main.hideModals(),main.displayMessage(t)}(target)),"add_host"!=target.name&&"add_timeslot"!=target.name||(t.stopPropagation(),async function(t){var a=await formsubmit.submitForm(t,"events/add_host");a&&e(a)}(target))})),document.addEventListener("change",(function(e){if(target=e.target,"target_name"==target.name){var t=target.list.querySelector("[value='"+target.value+"' i]").dataset.value;target.closest("form").querySelector('[name="target_id"]').value=t}}))})();
//# sourceMappingURL=schedules.min.js.map