(()=>{async function e(e,t,a){s.searchParams.set("month",t),s.searchParams.set("yr",a),window.history.pushState({},"",s),document.querySelectorAll("#monthview .events-wrap:not(hidden)").forEach((e=>e.classList.add("hidden")));var r=document.querySelector('.events-wrap[data-date="'+a+"-"+t+'"]');if(null==r){e.closest(".calendar-wrap").insertAdjacentHTML("beforeEnd",'<img class="loader" src="'+sim.loading_gif+'" style="margin-left: auto;margin-right: auto;display: block;">');var o=new FormData;o.append("month",t),o.append("year",a);var l=await formsubmit.fetchRestApi("events/get_month_html",o);l&&(e.closest(".calendar-wrap").querySelector(".loader").remove(),document.querySelector("#monthview").insertAdjacentHTML("beforeEnd",l))}else r.classList.remove("hidden");document.querySelector("div.month_selector .current").textContent=document.querySelector("select.month_selector").options[t-1].text,document.querySelector("div.year_selector .current").textContent=a}async function t(e,t,a){s.searchParams.set("yr",a),s.searchParams.set("week",t),window.history.pushState({},"",s),document.querySelectorAll("#weekview .events-wrap:not(hidden)").forEach((e=>e.classList.add("hidden")));var r=document.querySelector('.events-wrap[data-weeknr="'+t+'"]');if(null==r){e.closest(".calendar-wrap").insertAdjacentHTML("beforeEnd",`<img class="loader" src="${sim.loading_gif}" style="margin-left: auto;margin-right: auto;display: block;">`);var o=new FormData;o.append("wknr",t),o.append("year",a);var l=await formsubmit.fetchRestApi("events/get_week_html",o);l&&(e.closest(".calendar-wrap").querySelector(".loader").remove(),document.querySelector("#weekview").insertAdjacentHTML("beforeEnd",l))}else r.classList.remove("hidden");document.querySelector("div.week_selector .current").textContent=t,document.querySelector("div.year_selector .current").textContent=a}async function a(e,t="",a=""){""==t&&""==a||(document.querySelectorAll("#listview article").forEach((e=>e.remove())),s.searchParams.set("yr",a),s.searchParams.set("month",t),window.history.pushState({},"",s)),document.getElementById("listview").insertAdjacentHTML("beforeEnd",'<img class="loader" src="'+sim.loading_gif+'" style="margin-left: auto;margin-right: auto;display: block;">');var r=new FormData;r.append("offset",e),r.append("month",t),r.append("year",a);var o=await formsubmit.fetchRestApi("events/get_list_html",r);o&&(document.querySelector("#listview").querySelector(".loader").remove(),document.querySelector("#listview").insertAdjacentHTML("beforeEnd",o))}const s=new URL(window.location);var r=null,o=null;document.addEventListener("DOMContentLoaded",(function(){console.log("Events.js loaded")})),document.addEventListener("click",(function(a){var r=a.target;if(r.classList.contains("prevnext")){var o=r.dataset.month,l=r.dataset.weeknr,c=r.dataset.year;null!=o?e(r,o,c):null!=l&&t(r,l,c)}if(r.classList.contains("calendar-day")){a.stopPropagation();var n=r.dataset.date;document.querySelectorAll(".event-details-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),r.closest(".events-wrap").querySelector('.event-details-wrapper[data-date="'+n+'"]').classList.remove("hidden"),document.querySelectorAll(".calendar-day.selected").forEach((e=>e.classList.remove("selected"))),r.classList.add("selected")}if(r.classList.contains("calendar-hour")){a.stopPropagation(),n=r.dataset.date;var d=r.dataset.starttime;document.querySelectorAll(".event-details-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden")));var i=r.closest(".events-wrap").querySelector('.event-details-wrapper[data-date="'+n+'"][data-starttime="'+d+'"]');null==i?r.closest(".events-wrap").querySelector('.event-details-wrapper[data-date="empty"]').classList.remove("hidden"):(i.classList.remove("hidden"),document.querySelectorAll(".calendar-hour.selected").forEach((e=>e.classList.remove("selected"))),r.classList.add("selected"),main.isMobileDevice()?window.scrollTo(0,i.offsetTop):window.scrollTo(0,i.offsetHeight))}if(r.classList.contains("viewselector")){a.stopPropagation();var u=r.closest(".search-form");"weekview"!=r.dataset.type&&"monthview"!=r.dataset.type||(u.querySelector("div.week_selector").classList.toggle("hidden"),u.querySelector("div.month_selector").classList.toggle("hidden")),document.querySelectorAll(".viewselector.selected").forEach((e=>e.classList.remove("selected"))),r.classList.add("selected"),document.querySelectorAll(".calendarview").forEach((e=>e.classList.add("hidden"))),document.getElementById(r.dataset.type).classList.remove("hidden"),s.searchParams.set("view",r.dataset.type.replace("view","")),window.history.pushState({},"",s)}"add_calendar"==r.id&&document.getElementById("calendaraddingoptions").classList.toggle("hidden"),r.classList.contains("calendarurl")&&(a.stopPropagation(),""!=r.textContent&&(navigator.clipboard.writeText(r.textContent),Swal.fire({icon:"success",title:"Copied "+r.textContent,showConfirmButton:!1,timer:1500})))})),document.addEventListener("change",(function(r){var o=r.target;if(o.classList.contains("week_selector")){r.stopPropagation();var l=o.closest(".date-search").querySelector(".year_selector").value;"weekview"==document.querySelector(".viewselector.selected").dataset.type?t(o,o.value,l):"listview"==document.querySelector(".viewselector.selected").dataset.type&&a(0,o.value,l),s.searchParams.set("week",o.value)}if(o.classList.contains("month_selector")&&(r.stopPropagation(),l=o.closest(".date-search").querySelector(".year_selector").value,"monthview"==document.querySelector(".viewselector.selected").dataset.type?e(o,o.value,l):"listview"==document.querySelector(".viewselector.selected").dataset.type&&a(0,o.value,l),s.searchParams.set("month",o.value)),o.classList.contains("year_selector")){r.stopPropagation();var c=o.closest(".date-search").querySelector(".month_selector").value;if("monthview"==document.querySelector(".viewselector.selected").dataset.type)e(o,c,o.value);else if("listview"==document.querySelector(".viewselector.selected").dataset.type)a(0,c,o.value);else if("weekview"==document.querySelector(".viewselector.selected").dataset.type){var n=o.closest(".date-search").querySelector(".week_selector").value;t(o,n,o.value)}s.searchParams.set("yr",o.value)}window.history.pushState({},"",s)})),window.onscroll=function(){var e=document.documentElement;e.scrollTop+window.innerHeight>=e.offsetHeight-2&&"listview"==document.querySelector(".viewselector.selected").dataset.type&&null==document.querySelector("#listview .loader")&&a(document.querySelector("#listview").querySelectorAll("article").length)},document.addEventListener("touchstart",(function(e){const t=e.touches[0];r=t.clientX,o=t.clientY})),document.addEventListener("touchmove",(function(a){if(r&&o){var s=a.touches[0].clientX,l=a.touches[0].clientY,c=r-s,n=o-l;if(Math.abs(c)>Math.abs(n)){var d=document.querySelector(".viewselector.selected").dataset.type;if(c>0)var i=a.target.closest(".events-wrap").querySelector(".next a");else i=a.target.closest(".events-wrap").querySelector(".prev a");var u=i.dataset.month,v=i.dataset.weeknr,m=i.dataset.year;"weekview"==d?t(a.target,v,m):"monthview"==d&&e(i,u,m)}r=null,o=null}}))})();
//# sourceMappingURL=events.min.js.map