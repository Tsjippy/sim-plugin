{"version":3,"file":"schedules.min.js","mappings":"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","sources":["webpack://events/./schedules.js"],"sourcesContent":["/**\r\n *\r\n * Submits the new schedule form via rest API and adds the new schedule to the screen.\r\n *\r\n * @listens to button click if button has name add_schedule\r\n *\r\n * @param {Object} target     The clicked button.\r\n *\r\n * @return nothing\r\n*/ \r\nasync function addSchedule(target){\r\n\tvar response = await FormSubmit.submitForm(target, 'events/add_schedule');\r\n\r\n\tif(response){\r\n\t\ttarget.closest('.schedules_wrapper').outerHTML=response.html;\r\n\t\t\r\n\t\tMain.displayMessage(response.message);\r\n\r\n\t\tadd_selectable();\r\n\t}\r\n}\r\n\r\nfunction ShowPublishScheduleModal(target){\r\n\tvar modal\t\t\t= target.closest('.schedules_div').querySelector('.publish_schedule');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value = target.dataset[\"schedule_id\"];;\r\n\tif(target.dataset.target != null){\r\n\t\tmodal.querySelector('[name=\"schedule_target\"]').value = target.dataset.target;\r\n\t\tmodal.querySelector('[name=\"publish_schedule\"]').click();\r\n\t\tMain.showLoader(target,true);\r\n\t}else{\r\n\t\tmodal.classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nasync function publishSchedule(target){\r\n\tresponse\t= await FormSubmit.submitForm(target, 'events/publish_schedule');\r\n\r\n\tif(response){\r\n\t\tdocument.querySelectorAll('.schedule_actions .loadergif').forEach(el=>el.classList.add('hidden'));\r\n\t\t\r\n\t\tMain.hideModals();\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\n// Removes an existing schedule\r\nasync function removeSchedule(target){\r\n\tvar scheduleId\t\t= target.dataset[\"schedule_id\"];\r\n\tvar text \t\t\t= \"Are you sure you want to remove this schedule\";\r\n\tvar formData \t\t= new FormData();\r\n\tformData.append('schedule_id', scheduleId);\r\n\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\tif(confirmed){\r\n\t\tvar response\t= await FormSubmit.fetchRestApi('events/remove_schedule', formData);\r\n\r\n\t\tif(response){\r\n\t\t\tMain.displayMessage(response);\r\n\r\n\t\t\tdocument.querySelector('.schedules_wrapper .loaderwrapper:not(.hidden)').remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//shows the modal to select a user as host\r\nfunction showAddHostModal(){\r\n\ttarget.classList.add('active');\r\n\ttable\t\t\t\t\t\t\t\t\t\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t\t\t\t\t\t\t\t\t= target.closest('td');\r\n\tvar date\t\t\t\t\t\t\t\t\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t\t\t\t\t\t\t\t\t= target.closest('tr').dataset.starttime;\r\n\tvar modal\t\t\t\t\t\t\t\t\t\t\t= target.closest('.schedules_wrapper').querySelector('[name=\"add_host\"]');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t= startTime;\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\n// Add a new host when the host form is submitted\r\nasync function addHost(target){\r\n\tvar response \t= await FormSubmit.submitForm(target, 'events/add_host');\r\n\r\n\tif(response){\r\n\t\taddHostHtml(response);\r\n\t}\r\n}\r\n\r\n// Add current user as host\r\nasync function addCurrentUserAsHost(target){\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar scheduleOwner\t= table.dataset.target;\r\n\tvar dateStr\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\t\r\n\tvar text \t\t\t= `Please confirm you want to be the host for ${scheduleOwner} on ${dateStr}`;\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\ttarget.classList.add('active');\r\n\r\n\t\tvar formData\t\t= loadHostFormdata(target);\r\n\r\n\t\tvar response\t= await FormSubmit.fetchRestApi('events/add_host', formData);\r\n\r\n\t\tif(response){\r\n\t\t\taddHostHtml(response);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Show the new host in the schedule\r\nfunction addHostHtml(response){\r\n\tvar target_cell\t\t\t= document.querySelector('td.active');\r\n\ttargetCell.classList.remove('active');\r\n\r\n\tif(targetCell.rowSpan>1){\r\n\t\tvar row\t\t= targetCell.closest('tr');\r\n\t\tvar index\t= targetCell.cellIndex;\r\n\t\t//Loop over the next cells to add the hidden attribute\r\n\t\tfor (i = 1; i < targetCell.rowSpan; i++) {\r\n\t\t\trow = row.nextElementSibling;\r\n\t\t\trow.cells[index].classList.add('hidden');\r\n\t\t}\r\n\t}\r\n\r\n\ttargetCell.outerHTML\t= response.html;\r\n\r\n\tMain.hideModals();\r\n\r\n\tadd_selectable();\r\n\r\n\tMain.displayMessage(response.message);\r\n}\r\n\r\n// Remove a host\r\nasync function removeHost(target){\r\n\tvar formData\t\t= loadHostFormdata(target);\r\n\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar scheduleOwner\t= table.dataset.target;\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar dateStr\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\r\n\tif(target.classList.contains('orientation')){\r\n\t\tvar text \t= `Are you sure you want to remove this orientation session`;\r\n\t}else if(target.classList.contains('admin')){\r\n\t\tvar text \t= `Please confirm host removal for ${scheduleOwner} on ${dateStr}`;\r\n\t}else{\r\n\t\tvar text \t= `Please confirm you do not want to be the host for ${scheduleOwner} on ${dateStr} anymore`;\r\n\t}\r\n\r\n\tvar confirmed\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\tMain.showLoader(cell.firstChild);\r\n\r\n\t\tvar response = await FormSubmit.fetchRestApi('events/remove_host', formData);\r\n\r\n\t\t//Remove cell class\r\n\t\tcell.classList.remove('selected');\r\n\t\tcell.classList.remove('ui-selected');\r\n\r\n\t\t//Set cell text\r\n\t\tcell.innerHTML\t= 'Available';\r\n\t\tvar index\t\t= cell.cellIndex;\r\n\t\tvar row\t\t\t= cell.closest('tr');\r\n\r\n\t\t//only remove rowspan if the first cell of a row has no rowspan\r\n\t\tif(row.cells[0].rowSpan==1){\r\n\t\t\t//Loop over the next cells to remove the hidden attribute\r\n\t\t\tfor (i = 1; i < target.rowSpan; i++) {\r\n\t\t\t\trow = row.nextElementSibling;\r\n\t\t\t\trow.cells[index].classList.remove('hidden');\r\n\t\t\t}\r\n\r\n\t\t\t//Reset the rowSpan\r\n\t\t\ttarget.rowSpan = 1;\r\n\t\t}\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nfunction showTimeslotModal(selected){\r\n\tvar modal \t\t\t= document.querySelector('[name=\"add_session\"]');\r\n\tvar firstCell\t\t= selected[0].node;\r\n\tvar lastCell\t\t= selected[selected.length-1].node;\r\n\r\n\tfirstCell.classList.add('active');\r\n\tfirstCell.rowSpan\t= document.querySelectorAll('.ui-selected').length;\r\n\tvar endTime\t\t\t= lastCell.closest('tr').dataset.endtime;\r\n\ttable\t\t\t\t= firstCell.closest('table');\r\n\tvar date\t\t\t= table.rows[0].cells[first_cell.cellIndex].dataset.isodate;\r\n\t\r\n\t//Fill the modal values\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t\t= date;\r\n\tmodal.querySelector('[name=\"olddate\"]').value \t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t\t= firstCell.closest('tr').dataset.starttime;\r\n\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endTime;\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.remove('add_schedule_row');\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.add('update_schedule');\r\n\t\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\nasync function editTimeSlot(selected){\r\n\tvar answer = await Swal.fire({\r\n\t\ttitle: 'What do you want to do?',\r\n\t\ttext: \"Do you want to edit or remove this timeslot?\",\r\n\t\tshowDenyButton: true,\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonText: 'Edit timeslot',\r\n\t\tdenyButtonText: 'Remove timeslot',\r\n\t});\r\n\t\r\n\tvar firstCell\t= selected[0].node;\r\n\r\n\t//swap and/or\r\n\tif (answer.isConfirmed) {\r\n\t\t// Show modal and prefill the default fields\r\n\t\tshowTimeslotModal(selected);\r\n\r\n\t\t// also prefill the other fields\r\n\t\tvar modal \t\t= document.querySelector('[name=\"add_session\"]');\r\n\t\tvar endRow\t\t= target.closest('tr').rowIndex + target.rowSpan - 1;\r\n\t\tvar endTime\t\t= target.closest('table').rows[endrow].dataset.firstCell;\t\t\t\r\n\t\tmodal.querySelector('[name=\"subject\"]').value\t\t\t= firstCell.querySelector('.subject').textContent;\r\n\t\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endTime;\r\n\r\n\t\t//Fill locationfield\r\n\t\tvar locationtText = first_cell.querySelector('.location').textContent;\r\n\t\tif(locationtText != 'Add location'){\r\n\t\t\tmodal.querySelector('[name=\"location\"]').value\t\t\t= locationtText;\r\n\t\t}\r\n\t\t\r\n\t\t//Fill userfield\r\n\t\tvar userid = firstCell.dataset.host;\r\n\t\tif(userid != null){\r\n\t\t\tel = modal.querySelector('[name=\"host\"]');\r\n\t\t\tif(el != null){\r\n\t\t\t\tel.value\t= userid;\r\n\t\t\t}\r\n\t\t\tel.selectedOptions[0].defaultSelected=true;\r\n\t\t\tel._niceselect.update();\r\n\t\t\tel.selectedOptions[0].defaultSelected=false;\r\n\t\t}\r\n\t\t\r\n\t\t//change button text\r\n\t\tmodal.querySelector('[name=\"add_timeslot\"]').textContent\t= 'Update time slot';\r\n\t//add new rule after this one\r\n\t}else if (answer.isDenied) {\r\n\t\tremoveHost(firstCell);\r\n\t}\r\n}\r\n\r\n// Show the modal to add a recipe keyword\r\nfunction showRecipeModal(target){\r\n\ttarget.classList.add('active');\r\n\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tscheduleId\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\t//Fill the modal with the values of the clickes schedule\r\n\trecipeModal = document.querySelector('[name=\"recipe_keyword_modal\"]');\r\n\r\n\tFormSubmit.formReset(recipeModal.querySelector('form'));\r\n\r\n\trecipeModal.querySelector('[name=\"schedule_id\"]').value \t= table.dataset[\"id\"];\r\n\trecipeModal.querySelector('[name=\"date\"]').value \t\t\t= date;\r\n\trecipeModal.querySelector('[name=\"starttime\"]').value \t\t= startTime;\r\n\r\n\tif(target.textContent != 'Enter recipe keyword'){\r\n\t\trecipeModal.querySelector('[name=\"recipe_keyword\"]').value\t= target.textContent;\r\n\t\tdocument.querySelector('[name=\"add_recipe_keyword\"]').textContent\t= 'Update recipe keywords';\r\n\t}\r\n\t\r\n\trecipeModal.classList.remove('hidden');\r\n}\r\n\r\n//submit the recipe form\r\nasync function submitRecipe(target){\r\n\tvar response = await FormSubmit.submitForm(target, 'events/add_menu');\r\n\r\n\tdocument.querySelector('.active').textContent\t= target.closest('form').querySelector('[name=\"recipe_keyword\"]').value;\r\n\r\n\tdocument.querySelector('.active').classList.remove('active');\r\n\r\n\tMain.hideModals();\r\n\r\n\tMain.displayMessage(response);\r\n}\r\n\r\nfunction loadHostFormdata(target){\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tscheduleId\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\tvar formData\t\t= new FormData();\r\n\tformData.append('date',date);\r\n\tif(cell.dataset.host != null){\r\n\t\tformData.append('host',cell.dataset.host);\r\n\t}else{\r\n\t\tformData.append('host',sim.userId);\r\n\t}\r\n\t\r\n\tformData.append('starttime', startTime);\r\n\tformData.append('schedule_id', scheduleId);\r\n\r\n\treturn formData;\r\n}\r\n\r\nasync function checkConfirmation(text){\r\n\tvar result = await Swal.fire({\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: text+\"?\",\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: 'Yes'\r\n\t});\r\n\t\r\n\t\tif (result.isConfirmed) {\r\n\t\t\tdocument.querySelectorAll('.modal:not(.hidden)').forEach(modal=>modal.classList.add('hidden'));\r\n\t\t\t//display loading gif\r\n\t\t\tif(target.classList.contains('remove_schedule')){\r\n\t\t\t\tMain.showLoader(target.closest('.schedules_div'));\r\n\t\t\t}else{\r\n\t\t\t\tMain.showLoader(target.firstChild);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n}\r\n\r\n//hide empty rows on mobile\r\nfunction hideRows() {\r\n\t//only run for smaller screens\r\n\tif (window.innerWidth > 800) return false;\r\n\t\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table').forEach(function(table){\r\n\t\tvar emptyRow = true;\r\n\t\t\r\n\t\t//DO not hide lunch or dinner rows\r\n\t\tif(tr.dataset.starttime != 'dinner' && tr.dataset.starttime != 'lunch'){\r\n\t\t\t//loop over all table cells to see if there is a cell with content\r\n\t\t\ttr.querySelectorAll('td').forEach(function(cell,index){\r\n\t\t\t\tif(index>0 && cell.textContent != 'Available' && cell.textContent != ' '){\r\n\t\t\t\t\temptyRow = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//If non of the cells have content\r\n\t\t\tif(emptyRow ){\r\n\t\t\t\t//hide the row\r\n\t\t\t\ttr.classList.add('hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction add_selectable(){\r\n\t//Add selectable on non-mobile devices\r\n\t//if(!isMobileDevice()){\r\n\t\t//loop over all the schedule tables\r\n\t\tdocument.querySelectorAll('.sim-table.schedule').forEach(function(table){\r\n\t\t\t//Load selectable and attach it to the table\r\n\t\t\ttable._selectable = new Selectable({\r\n\t\t\t   filter:\t\t\".orientation.admin\",\r\n\t\t\t   appendTo:\ttable.querySelector(\"tbody\"),\r\n\t\t\t   lasso: {\r\n\t\t\t\t\tborder: \"none\",\r\n\t\t\t\t\tbackgroundColor: \"none\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//Run the function afterSelect when selection is final\r\n\t\t\ttable._selectable.on('end', afterSelect);\r\n\t\t});\r\n\t//}\r\n\r\n\thideRows();\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"Schedule.js loaded\");\r\n\t\r\n\tadd_selectable();\r\n});\r\n\r\ndocument.addEventListener('click',function(event){\r\n\ttarget = event.target;\r\n\t\r\n\tif(target.name == 'add_schedule'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\taddSchedule(target);\r\n\t}\r\n\r\n\tif(target.classList.contains('remove_schedule')){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tremoveSchedule(target);\r\n\t}\r\n\r\n\t//publish the schedule\r\n\tif(target.classList.contains('publish')){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tShowPublishScheduleModal(target);\r\n\t}\r\n\r\n\tif(target.name == 'publish_schedule'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tpublishSchedule(target);\r\n\t}\r\n\t\r\n\tif(target.classList.contains('keyword')){\r\n\t\tshowRecipeModal(target);\r\n\t}\r\n\r\n\tif(target.name == 'add_recipe_keyword'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tsubmitRecipe(target);\r\n\t}\r\n\r\n\tif(target.name == 'add_host' || target.name == 'add_timeslot'){\r\n\t\tevent.stopPropagation();\r\n\t\t\r\n\t\taddHost(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener('change',function(event){\r\n\ttarget = event.target;\r\n\t//Direct table actions\r\n\tif(target.name=='target_name'){\r\n\t\tvar userid = target.list.querySelector(\"[value='\"+target.value+\"' i]\").dataset.value;\r\n\r\n\t\ttarget.closest('form').querySelector('[name=\"target_id\"]').value\t= userid;\r\n\t}\r\n});\r\n\r\n//Do something with selected items\r\nfunction afterSelect(e, selected, unselected){\r\n\ttarget = e.target;\r\n\r\n\t//remove a meal host\r\n\tif(target.matches('.meal.selected')){\r\n\t\tremoveHost(target);\r\n\t//Add a host\r\n\t}else if(target.matches('.meal.admin')){\r\n\t\tshowAddHostModal();\r\n\t//orientation slot\r\n\t}else if(target.matches('.meal:not(.admin)')){\r\n\t\taddCurrentUserAsHost(target);\r\n\t}else{\r\n\t\t//we have selected something and there are no open modals\r\n\t\tvar openModals\t= document.querySelectorAll('.modal:not(.hidden)');\r\n\t\tif((selected.length > 0 || target.classList.contains('orientation')) && (openModals == null || openModals.length == 0) ){\t\r\n\t\t\t//check if selection is valid\r\n\t\t\tvar columnNr\t= selected[0].node.cellIndex;\r\n\t\t\tvar firstCell\t= selected[0].node;\r\n\r\n\t\t\tfor (const selection of selected){\r\n\t\t\t\tif(columnNr != selection.node.cellIndex){\r\n\t\t\t\t\tSwal.fire({\r\n\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\ttitle: \"You can not select times on multiple days!\",\r\n\t\t\t\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\t\t\t});\r\n\t\t\t\t\te.target.closest('.sim-table')._selectable.clear();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t//We are dealing with a cell with a value\r\n\t\t\tif(firstCell.classList.contains('selected')){\r\n\t\t\t\teditTimeSlot(selected);\r\n\t\t\t}else{\r\n\t\t\t\tshowTimeslotModal(selected);\r\n\t\t\t}\r\n\t\t} \r\n\t}\r\n};"],"names":["addHostHtml","response","document","querySelector","targetCell","classList","remove","rowSpan","row","closest","index","cellIndex","i","nextElementSibling","cells","add","outerHTML","html","Main","hideModals","add_selectable","displayMessage","message","async","removeHost","target","formData","loadHostFormdata","table","scheduleOwner","dataset","cell","dateStr","rows","date","contains","text","checkConfirmation","showLoader","firstChild","FormSubmit","fetchRestApi","innerHTML","showTimeslotModal","selected","modal","firstCell","node","lastCell","length","querySelectorAll","endTime","endtime","first_cell","isodate","value","starttime","scheduleId","heading","tHead","startTime","FormData","append","host","sim","userId","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","forEach","_selectable","Selectable","filter","appendTo","lasso","border","backgroundColor","on","afterSelect","window","innerWidth","emptyRow","tr","textContent","hideRows","e","unselected","matches","showAddHostModal","addCurrentUserAsHost","openModals","columnNr","selection","clear","answer","showDenyButton","denyButtonText","rowIndex","endrow","locationtText","userid","el","selectedOptions","defaultSelected","_niceselect","update","isDenied","editTimeSlot","addEventListener","console","log","event","name","stopPropagation","submitForm","addSchedule","removeSchedule","click","ShowPublishScheduleModal","publishSchedule","recipeModal","formReset","showRecipeModal","submitRecipe","addHost","list"],"sourceRoot":""}