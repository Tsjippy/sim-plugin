{"version":3,"file":"schedules.min.js","mappings":"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","sources":["webpack://events/./schedules.js"],"sourcesContent":["/**\r\n *\r\n * Submits the new schedule form via rest API and adds the new schedule to the screen.\r\n *\r\n * @listens to button click if button has name add_schedule\r\n *\r\n * @param {Object} target     The clicked button.\r\n *\r\n * @return nothing\r\n*/ \r\nasync function addSchedule(target){\r\n\tvar response = await FormSubmit.submitForm(target, 'events/add_schedule');\r\n\r\n\tif(response){\r\n\t\ttarget.closest('.schedules_wrapper').outerHTML=response.html;\r\n\t\t\r\n\t\tMain.displayMessage(response.message);\r\n\r\n\t\taddSelectable();\r\n\t}\r\n}\r\n\r\nfunction ShowPublishScheduleModal(target){\r\n\tvar modal\t\t\t= target.closest('.schedules_div').querySelector('.publish_schedule');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value = target.dataset[\"schedule_id\"];\r\n\tif(target.dataset.target != null){\r\n\t\tmodal.querySelector('[name=\"schedule_target\"]').value = target.dataset.target;\r\n\t\tmodal.querySelector('[name=\"publish_schedule\"]').click();\r\n\t\tMain.showLoader(target,true);\r\n\t}else{\r\n\t\tmodal.classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nasync function publishSchedule(target){\r\n\tvar response\t= await FormSubmit.submitForm(target, 'events/publish_schedule');\r\n\r\n\tif(response){\r\n\t\tdocument.querySelectorAll('.schedule_actions .loadergif').forEach(el=>el.classList.add('hidden'));\r\n\t\t\r\n\t\tMain.hideModals();\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\n// Removes an existing schedule\r\nasync function removeSchedule(target){\r\n\tvar scheduleId\t\t= target.dataset[\"schedule_id\"];\r\n\tvar text \t\t\t= \"Are you sure you want to remove this schedule\";\r\n\tvar formData \t\t= new FormData();\r\n\tformData.append('schedule_id', scheduleId);\r\n\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\tif(confirmed){\r\n\t\tvar response\t= await FormSubmit.fetchRestApi('events/remove_schedule', formData);\r\n\r\n\t\tif(response){\r\n\t\t\tMain.displayMessage(response);\r\n\r\n\t\t\tdocument.querySelector('.schedules_wrapper .loaderwrapper:not(.hidden)').remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction applyRowSpan(target, count){\r\n\tif(count > 1){\r\n\t\tvar row\t\t= target.closest('tr');\r\n\t\tvar index\t= target.cellIndex;\r\n\t\t//Loop over the next cells to add the hidden attribute\r\n\t\tfor (var i = 1; i < count; i++) {\r\n\t\t\trow = row.nextElementSibling;\r\n\t\t\trow.cells[index].classList.add('hidden');\r\n\t\t}\r\n\t\ttarget.rowSpan\t= count;\r\n\t}\r\n}\r\n\r\nfunction removeRowSpan(target){\r\n\tdocument.querySelectorAll('.ui-selected').forEach(el=>el.classList.remove('ui-selected', 'active', 'hidden'));\r\n\ttarget.rowSpan = 1;\r\n}\r\n\r\n//shows the modal to select a user as host\r\nfunction showAddHostModal(){\r\n\ttarget.classList.add('active');\r\n\tvar table\t\t\t\t\t\t\t\t\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t\t\t\t\t\t\t\t\t= target.closest('td');\r\n\tvar date\t\t\t\t\t\t\t\t\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t\t\t\t\t\t\t\t\t= target.closest('tr').dataset.starttime;\r\n\tvar modal\t\t\t\t\t\t\t\t\t\t\t= target.closest('.schedules_wrapper').querySelector('[name=\"add_host\"]');\r\n\t// Clear\r\n\tmodal.querySelectorAll('input:not([type=\"hidden\"])').forEach(el=>el.value='');\r\n\r\n\t// Add new values\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t= startTime;\r\n\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\n// Add a new host when the host form is submitted\r\nasync function addHost(target){\r\n\tvar response \t= await FormSubmit.submitForm(target, 'events/add_host');\r\n\r\n\tif(response){\r\n\t\taddHostHtml(response);\r\n\t}\r\n}\r\n\r\n// Add current user as host\r\nasync function addCurrentUserAsHost(target){\r\n\tvar table\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar scheduleOwner\t= table.dataset.target;\r\n\tvar dateStr\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\t\r\n\tvar text \t\t\t= `Please confirm you want to be the host for ${scheduleOwner} on ${dateStr}`;\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\ttarget.classList.add('active');\r\n\r\n\t\tvar formData\t\t= loadHostFormdata(target);\r\n\r\n\t\tvar response\t= await FormSubmit.fetchRestApi('events/add_host', formData);\r\n\r\n\t\tif(response){\r\n\t\t\taddHostHtml(response);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Show the new host in the schedule\r\nfunction addHostHtml(response){\r\n\tvar targetCell\t\t\t= document.querySelector('td.active');\r\n\ttargetCell.classList.remove('active');\r\n\ttargetCell.outerHTML\t= response.html;\r\n\r\n\tMain.hideModals();\r\n\r\n\tMain.displayMessage(response.message);\r\n\r\n\taddSelectable();\r\n}\r\n\r\n// Remove a host\r\nasync function removeHost(target){\r\n\tvar formData\t\t= loadHostFormdata(target);\r\n\r\n\tvar table\t\t\t= target.closest('table');\r\n\tvar scheduleOwner\t= table.dataset.target;\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar dateStr\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\tvar text;\r\n\r\n\tif(target.classList.contains('orientation')){\r\n\t\ttext \t= `Are you sure you want to remove this orientation session`;\r\n\t}else if(target.classList.contains('admin')){\r\n\t\ttext \t= `Please confirm host removal for ${scheduleOwner} on ${dateStr}`;\r\n\t}else{\r\n\t\ttext \t= `Please confirm you do not want to be the host for ${scheduleOwner} on ${dateStr} anymore`;\r\n\t}\r\n\r\n\tvar confirmed\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\tMain.showLoader(cell.firstChild);\r\n\r\n\t\tvar response = await FormSubmit.fetchRestApi('events/remove_host', formData);\r\n\r\n\t\t//Remove cell class\r\n\t\tcell.classList.remove('selected');\r\n\t\tcell.classList.remove('ui-selected');\r\n\r\n\t\t//Set cell text\r\n\t\tcell.innerHTML\t= 'Available';\r\n\t\tvar index\t\t= cell.cellIndex;\r\n\t\tvar row\t\t\t= cell.closest('tr');\r\n\r\n\t\t//only remove rowspan if the first cell of a row has no rowspan\r\n\t\tif(row.cells[0].rowSpan==1){\r\n\t\t\t//Loop over the next cells to remove the hidden attribute\r\n\t\t\tfor (var i = 1; i < target.rowSpan; i++) {\r\n\t\t\t\trow = row.nextElementSibling;\r\n\t\t\t\trow.cells[index].classList.remove('hidden');\r\n\t\t\t}\r\n\r\n\t\t\t//Reset the rowSpan\r\n\t\t\ttarget.rowSpan = 1;\r\n\t\t}\r\n\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nfunction showTimeslotModal(selected){\r\n\tvar modal \t\t\t= document.querySelector('[name=\"add_session\"]');\r\n\tvar firstCell\t\t= selected[0].node;\r\n\tvar lastCell\t\t= selected[selected.length-1].node;\r\n\r\n\tfirstCell.classList.add('active');\r\n\tlet rowCount\t\t= document.querySelectorAll('.ui-selected').length;\r\n\tapplyRowSpan(firstCell, rowCount);\r\n\r\n\t// Only show loader when the cell is empty\r\n\tif(!firstCell.matches('.selected')){\r\n\t\tMain.showLoader(firstCell.firstChild);\r\n\t}\r\n\r\n\tvar endTime\t\t\t= lastCell.closest('tr').dataset.endtime;\r\n\tvar table\t\t\t= firstCell.closest('table');\r\n\tvar date\t\t\t= table.rows[0].cells[firstCell.cellIndex].dataset.isodate;\r\n\t\r\n\t// Clear\r\n\tmodal.querySelectorAll('input:not([type=\"hidden\"])').forEach(el=>el.value='')\r\n\r\n\t//Fill the modal values\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t\t= date;\r\n\tmodal.querySelector('[name=\"olddate\"]').value \t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t\t= firstCell.closest('tr').dataset.starttime;\r\n\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endTime;\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.remove('add_schedule_row');\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.add('update_schedule');\r\n\r\n\tlet hostId\t\t\t= firstCell.dataset.host_id;\r\n\tlet subject\t\t\t= firstCell.dataset.subject;\r\n\tlet location\t\t= firstCell.dataset.location;\r\n\tlet hostName\t\t= firstCell.dataset.host;\r\n\r\n\tif(hostId\t!= undefined){\r\n\t\tmodal.querySelector('[name=\"host_id\"]').value\t\t\t= hostId;\r\n\t}\r\n\r\n\tif(subject\t!= undefined){\r\n\t\tmodal.querySelector('[name=\"subject\"]').value\t\t\t= subject;\r\n\t}\r\n\r\n\tif(location\t!= undefined){\r\n\t\tmodal.querySelector('[name=\"location\"]').value\t\t\t= location;\r\n\t}\r\n\r\n\tif(hostName\t!= undefined){\r\n\t\tmodal.querySelector('[name=\"host\"]').value\t\t\t\t= hostName;\r\n\t}\r\n\t\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\nasync function editTimeSlot(selected){\r\n\tvar answer = await Swal.fire({\r\n\t\ttitle: 'What do you want to do?',\r\n\t\ttext: \"Do you want to edit or remove this timeslot?\",\r\n\t\tshowDenyButton: true,\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonText: 'Edit timeslot',\r\n\t\tdenyButtonText: 'Remove timeslot',\r\n\t});\r\n\t\r\n\tvar firstCell\t= selected[0].node;\r\n\r\n\t//swap and/or\r\n\tif (answer.isConfirmed) {\r\n\t\t// Show modal and prefill the default fields\r\n\t\tshowTimeslotModal(selected);\r\n\t\t\r\n\t\t//change button text\r\n\t\tvar modal \t\t\t= document.querySelector('[name=\"add_session\"]');\r\n\t\tmodal.querySelector('[name=\"add_timeslot\"]').textContent\t= 'Update time slot';\r\n\t//add new rule after this one\r\n\t}else if (answer.isDenied) {\r\n\t\tremoveHost(firstCell);\r\n\t}\r\n}\r\n\r\n// Show the modal to add a recipe keyword\r\nfunction showRecipeModal(target){\r\n\ttarget.classList.add('active');\r\n\r\n\tvar table\t\t\t= target.closest('table');\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\t//Fill the modal with the values of the clickes schedule\r\n\tvar recipeModal \t= document.querySelector('[name=\"recipe_keyword_modal\"]');\r\n\r\n\tFormSubmit.formReset(recipeModal.querySelector('form'));\r\n\r\n\trecipeModal.querySelector('[name=\"schedule_id\"]').value \t= table.dataset[\"id\"];\r\n\trecipeModal.querySelector('[name=\"date\"]').value \t\t\t= date;\r\n\trecipeModal.querySelector('[name=\"starttime\"]').value \t\t= startTime;\r\n\r\n\tif(target.textContent != 'Enter recipe keyword'){\r\n\t\trecipeModal.querySelector('[name=\"recipe_keyword\"]').value\t= target.textContent;\r\n\t\tdocument.querySelector('[name=\"add_recipe_keyword\"]').textContent\t= 'Update recipe keywords';\r\n\t}\r\n\t\r\n\trecipeModal.classList.remove('hidden');\r\n}\r\n\r\n//submit the recipe form\r\nasync function submitRecipe(target){\r\n\tvar response = await FormSubmit.submitForm(target, 'events/add_menu');\r\n\r\n\tdocument.querySelector('.active').textContent\t= target.closest('form').querySelector('[name=\"recipe_keyword\"]').value;\r\n\r\n\tdocument.querySelector('.active').classList.remove('active');\r\n\r\n\tMain.hideModals();\r\n\r\n\tMain.displayMessage(response);\r\n}\r\n\r\nfunction loadHostFormdata(target){\r\n\tvar table\t\t\t= target.closest('table');\r\n\tvar scheduleId\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar startTime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\tvar formData\t\t= new FormData();\r\n\tformData.append('date',date);\r\n\tif(cell.dataset.host != null){\r\n\t\tformData.append('host', cell.dataset.host);\r\n\t}else{\r\n\t\tformData.append('host_id', sim.userId);\r\n\t}\r\n\t\r\n\tformData.append('starttime', startTime);\r\n\tformData.append('schedule_id', scheduleId);\r\n\r\n\treturn formData;\r\n}\r\n\r\nasync function checkConfirmation(text){\r\n\tvar result = await Swal.fire({\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: text+\"?\",\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: 'Yes'\r\n\t});\r\n\t\r\n\t\tif (result.isConfirmed) {\r\n\t\t\tdocument.querySelectorAll('.modal:not(.hidden)').forEach(modal=>modal.classList.add('hidden'));\r\n\t\t\t//display loading gif\r\n\t\t\tif(target.classList.contains('remove_schedule')){\r\n\t\t\t\tMain.showLoader(target.closest('.schedules_div'));\r\n\t\t\t}else{\r\n\t\t\t\tMain.showLoader(target.firstChild);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n}\r\n\r\n//hide empty rows on mobile\r\nfunction hideRows() {\r\n\t//only run for smaller screens\r\n\tif (window.innerWidth > 800) return false;\r\n\t\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table tr').forEach(function(tr){\r\n\t\tvar emptyRow = true;\r\n\t\t\r\n\t\t//DO not hide lunch or dinner rows\r\n\t\tif(tr.dataset.starttime != 'dinner' && tr.dataset.starttime != 'lunch'){\r\n\t\t\t//loop over all table cells to see if there is a cell with content\r\n\t\t\ttr.querySelectorAll('td').forEach(function(cell,index){\r\n\t\t\t\tif(index>0 && cell.textContent != 'Available' && cell.textContent != ' '){\r\n\t\t\t\t\temptyRow = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//If non of the cells have content\r\n\t\t\tif(emptyRow ){\r\n\t\t\t\t//hide the row\r\n\t\t\t\ttr.classList.add('hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction addSelectable(){\r\n\t//Add selectable on non-mobile devices\r\n\t//if(!isMobileDevice()){\r\n\t\t//loop over all the schedule tables\r\n\t\tdocument.querySelectorAll('.sim-table.schedule').forEach(function(table){\r\n\t\t\tif(table._selectable != undefined){\r\n\t\t\t\ttable._selectable.destroy();\r\n\t\t\t}\r\n\r\n\t\t\t//Load selectable and attach it to the table\r\n\t\t\ttable._selectable = new Selectable({\r\n\t\t\t   filter:\t\t\".orientation.admin\",\r\n\t\t\t   appendTo:\ttable.querySelector(\"tbody\"),\r\n\t\t\t   lasso: {\r\n\t\t\t\t\tborder: \"none\",\r\n\t\t\t\t\tbackgroundColor: \"none\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//Run the function afterSelect when selection is final\r\n\t\t\ttable._selectable.on('end', afterSelect);\r\n\t\t});\r\n\t//}\r\n\r\n\thideRows();\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"Schedule.js loaded\");\r\n\t\r\n\taddSelectable();\r\n});\r\n\r\ndocument.addEventListener('click',function(event){\r\n\ttarget = event.target;\r\n\r\n\tif(target.name == 'add_schedule'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\taddSchedule(target);\r\n\t}else if(target.name == 'publish_schedule'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tpublishSchedule(target);\r\n\t}else if(target.name == 'add_recipe_keyword'){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tsubmitRecipe(target);\r\n\t}else if(target.name == 'add_host' || target.name == 'add_timeslot'){\r\n\t\tevent.stopPropagation();\r\n\t\t\r\n\t\taddHost(target);\r\n\t}else if(target.matches('.close') && target.closest('.modal') != null && target.closest('.modal').attributes.name.value == 'add_session'){\r\n\t\tremoveRowSpan(document.querySelector('td.active'));\r\n\t}\r\n\t\r\n\tif(target.classList.contains('keyword')){\r\n\t\tshowRecipeModal(target);\r\n\t}\r\n\r\n\t//publish the schedule\r\n\tif(target.classList.contains('publish')){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tShowPublishScheduleModal(target);\r\n\t}else if(target.classList.contains('remove_schedule')){\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tremoveSchedule(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener('change', function(event){\r\n\r\n\ttarget = event.target;\r\n\r\n\t//Direct table actions\r\n\tif(target.name=='target_name'){\r\n\t\tvar userid = target.list.querySelector(`[value='${target.value}' i]`).dataset.value;\r\n\r\n\t\ttarget.closest('form').querySelector('[name=\"target_id\"]').value\t= userid;\r\n\t}else if(target.name == 'host'){\r\n\t\tlet host\t= target.list.querySelector(`[value=\"${target.value}\"]`);\r\n\t\tlet userId\t= '';\r\n\t\tif(host != null){\r\n\t\t\tuserId\t= host.dataset.userid;\r\n\t\t}\r\n\r\n\t\ttarget.closest('form').querySelector('[name=\"host_id\"]').value\t= userId;\r\n\t}\r\n});\r\n\r\nfunction checkIfValidSelection(target, selected, e){\r\n\t//we have selected something and there are no open modals\r\n\tvar openModals\t= document.querySelectorAll('.modal:not(.hidden)');\r\n\tif((selected.length > 0 || target.classList.contains('orientation')) && (openModals == null || openModals.length == 0) ){\t\r\n\t\t//check if selection is valid\r\n\t\tvar columnNr\t= selected[0].node.cellIndex;\r\n\t\tvar firstCell\t= selected[0].node;\r\n\r\n\t\tfor (const selection of selected){\r\n\t\t\tif(columnNr != selection.node.cellIndex){\r\n\t\t\t\tSwal.fire({\r\n\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\ttitle: \"You can not select times on multiple days!\",\r\n\t\t\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\t\t});\r\n\t\t\t\te.target.closest('.sim-table')._selectable.clear();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//We are dealing with a cell with a value\r\n\t\tif(firstCell.classList.contains('selected')){\r\n\t\t\teditTimeSlot(selected);\r\n\t\t}else{\r\n\t\t\tshowTimeslotModal(selected);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//Do something with selected items\r\nfunction afterSelect(e, selected, _unselected){\r\n\ttarget = e.target;\r\n\r\n\t//remove a meal host\r\n\tif(target.matches('.meal.selected.own, .meal.selected.admin')){\r\n\t\tremoveHost(target);\r\n\t//Add a host\r\n\t}else if(target.matches('.meal.admin')){\r\n\t\tshowAddHostModal();\r\n\t//orientation slot\r\n\t}else if(target.matches('.meal:not(.admin, .selected)')){\r\n\t\taddCurrentUserAsHost(target);\r\n\t}else{\r\n\t\tcheckIfValidSelection(target, selected, e); \r\n\t}\r\n}"],"names":["addHostHtml","response","targetCell","document","querySelector","classList","remove","outerHTML","html","Main","hideModals","displayMessage","message","addSelectable","async","removeHost","target","text","formData","loadHostFormdata","table","closest","scheduleOwner","dataset","cell","dateStr","rows","cells","cellIndex","date","contains","checkConfirmation","showLoader","firstChild","FormSubmit","fetchRestApi","innerHTML","index","row","rowSpan","i","nextElementSibling","showTimeslotModal","selected","modal","firstCell","node","lastCell","length","add","count","applyRowSpan","querySelectorAll","matches","endTime","endtime","isodate","forEach","el","value","starttime","hostId","host_id","subject","location","hostName","host","undefined","scheduleId","heading","tHead","startTime","FormData","append","sim","userId","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","_selectable","destroy","Selectable","filter","appendTo","lasso","border","backgroundColor","on","afterSelect","window","innerWidth","tr","emptyRow","textContent","hideRows","e","_unselected","showAddHostModal","addCurrentUserAsHost","openModals","columnNr","selection","clear","answer","showDenyButton","denyButtonText","isDenied","editTimeSlot","checkIfValidSelection","addEventListener","console","log","event","name","stopPropagation","submitForm","addSchedule","publishSchedule","submitRecipe","addHost","attributes","removeRowSpan","recipeModal","formReset","showRecipeModal","click","ShowPublishScheduleModal","removeSchedule","userid","list"],"sourceRoot":""}