{"version":3,"file":"schedules.min.js","mappings":"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","sources":["webpack://events/./schedules.js"],"sourcesContent":["//Function to update the schedule table with the new values after the AJAX request was succesfull\r\nwindow['schedule_host_added'] = function(result,responsdata){\r\n\tif (result.status >= 200 && result.status < 400) {\r\n\t\tget_target_cell(responsdata).outerHTML\t= responsdata.cell_html;\r\n\r\n\t\tvar target_cell\t\t\t= get_target_cell(responsdata);\r\n\t\tif(target_cell.rowSpan>1){\r\n\t\t\tvar row\t\t= target_cell.closest('tr');\r\n\t\t\tvar index\t= target_cell.cellIndex;\r\n\t\t\t//Loop over the next cells to add the hidden attribute\r\n\t\t\tfor (i = 1; i < target_cell.rowSpan; i++) {\r\n\t\t\t\trow = row.nextElementSibling;\r\n\t\t\t\trow.cells[index].classList.add('hidden');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thide_modals();\r\n\t}\r\n}\r\n\r\nwindow['schedule_host_removed'] = function(result,responsdata){\r\n\tif (result.status >= 200 && result.status < 400) {\r\n\t\tvar target_cell\t\t\t= get_target_cell(responsdata);\r\n\r\n\t\t//Remove cell class\r\n\t\ttarget_cell.classList.remove('selected');\r\n\t\ttarget_cell.classList.remove('ui-selected');\r\n\r\n\t\t//Set cell text\r\n\t\ttarget_cell.innerHTML = 'Available';\r\n\t\t\r\n\t\tvar index = target_cell.cellIndex;\r\n\t\t\r\n\t\tvar row = target_cell.closest('tr');\r\n\r\n\t\t//only remove rowspan if the first cell of a row has no rowspan\r\n\t\tif(row.cells[0].rowSpan==1){\r\n\t\t\t//Loop over the next cells to remove the hidden attribute\r\n\t\t\tfor (i = 1; i < target_cell.rowSpan; i++) {\r\n\t\t\t\trow = row.nextElementSibling;\r\n\t\t\t\trow.cells[index].classList.remove('hidden');\r\n\t\t\t}\r\n\r\n\t\t\t//Reset the rowSpan\r\n\t\t\ttarget_cell.rowSpan = 1;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nwindow['schedule_add_menu'] = function(result,responsdata){\r\n\tif (result.status >= 200 && result.status < 400) {\r\n\t\tvar target_cell\t\t\t\t\t\t\t\t\t\t= get_target_cell(responsdata);\r\n\t\ttarget_cell.querySelector('.keyword').textContent\t= responsdata.menu;\r\n\t}\r\n\r\n\thide_modals();\r\n}\r\n\r\nwindow['add_schedule'] = function(result,responsdata){\r\n\tif (result.status >= 200 && result.status < 400) {\r\n\t\tdocument.querySelectorAll('.schedules_wrapper').forEach(el=>el.outerHTML=responsdata.html);\r\n\r\n\t\tadd_selectable();\r\n\t}\r\n}\r\n\r\nfunction get_target_cell(responsdata){\r\n\tvar table\t\t= document.querySelector('table[data-id=\"'+responsdata.schedule_id+'\"]');\r\n\tvar cellIndex\t= table.querySelector('[data-isodate=\"'+responsdata.date+'\"]').cellIndex;\r\n\tvar target_cell\t= table.querySelector('tr[data-starttime=\"'+responsdata.starttime+'\"]').cells[cellIndex];\r\n\t\r\n\treturn target_cell;\r\n}\r\n\r\nfunction remove_schedule(target){\r\n\tschedule_id\t\t\t\t\t= target.dataset[\"schedule_id\"];\r\n\tvar remove_schedule_nonce\t= document.querySelector('[name=\"remove_schedule_nonce\"]').value;\r\n\t\t\r\n\tvar text \t\t\t= \"Are you sure you want to remove this schedule?\";\r\n\tvar formdata \t\t= new FormData();\r\n\tformdata.append('action','remove_schedule');\r\n\tformdata.append('schedule_id', schedule_id);\r\n\tformdata.append('remove_schedule_nonce',remove_schedule_nonce);\r\n\r\n\tcheck_confirmation(text, formdata);\r\n}\r\n\r\nfunction publish_schedule(target){\r\n\tvar modal\t\t\t= target.closest('.schedules_div').querySelector('.publish_schedule');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value = target.dataset[\"schedule_id\"];;\r\n\tif(target.dataset.target != null){\r\n\t\tmodal.querySelector('[name=\"select_schedule_target\"]').value = target.dataset.target;\r\n\t\tmodal.querySelector('[name=\"publish_schedule\"]').click();\r\n\t\tshowLoader(target,true);\r\n\t}else{\r\n\t\tmodal.classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nfunction show_recipe_modal(target){\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tschedule_id\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar starttime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\t//Fill the modal with the values of the clickes schedule\r\n\trecipe_modal = document.querySelector('[name=\"add_recipe_keyword\"]');\r\n\trecipe_modal.querySelector('[name=\"schedule_id\"]').value \t= table.dataset[\"id\"];\r\n\trecipe_modal.querySelector('[name=\"date\"]').value \t\t\t= date;\r\n\trecipe_modal.querySelector('[name=\"starttime\"]').value \t\t= starttime;\r\n\tif(target.textContent != 'Enter recipe keyword'){\r\n\t\trecipe_modal.querySelector('[name=\"recipe_keyword\"]').value\t= target.textContent;\r\n\t}\r\n\t\r\n\trecipe_modal.classList.remove('hidden');\r\n}\r\n\r\nfunction load_host_formdata(target){\r\n\tvar update_nonce\t= document.querySelector('[name=\"update_schedule_nonce\"]').value;\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tschedule_id\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar starttime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\tvar formdata\t\t= new FormData();\r\n\tformdata.append('date',date);\r\n\tif(cell.dataset.host != null){\r\n\t\tformdata.append('host',cell.dataset.host);\r\n\t}else{\r\n\t\tformdata.append('host',sim.userid);\r\n\t}\r\n\t\r\n\tformdata.append('starttime',starttime);\r\n\tformdata.append('update_schedule_nonce',update_nonce);\r\n\tformdata.append('schedule_id',schedule_id);\r\n\r\n\treturn formdata;\r\n}\r\n\r\nfunction add_meal_host(target){\r\n\tvar formdata\t\t= load_host_formdata(target);\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar scheduleowner\t= table.dataset.target;\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date_str\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\r\n\tif(target.textContent.toLowerCase().includes('available')){\r\n\t\t//Reserve for someone else\r\n\t\tif(target.classList.contains('admin')){\r\n\t\t\tvar date\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.isodate;\r\n\t\t\tvar starttime\t\t= target.closest('tr').dataset.starttime;\r\n\t\t\tvar modal\t\t\t= target.closest('.schedules_wrapper').querySelector('[name=\"add_host\"]');\r\n\t\t\tmodal.querySelector('[name=\"schedule_id\"]').value\t= table.dataset[\"id\"];\r\n\t\t\tmodal.querySelector('[name=\"date\"]').value\t\t\t= date;\r\n\t\t\tmodal.querySelector('[name=\"starttime\"]').value\t\t= starttime;\r\n\t\t\tmodal.classList.remove('hidden');\r\n\t\t//Reserve for current user\r\n\t\t}else{\r\n\t\t\tvar text \t= \"Please confirm you want to be the host for \"+scheduleowner+\" on \"+date_str;\r\n\t\t\tformdata.append('action','add_host');\r\n\t\t\tcheck_confirmation(text, formdata);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction remove_host(target){\r\n\tvar formdata\t= load_host_formdata(target);\r\n\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar scheduleowner\t= table.dataset.target;\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date_str\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\r\n\tif(target.textContent.toLowerCase().includes('you')){\r\n\t\tvar text \t= \"Please confirm you do not want to be the host for \"+scheduleowner+\" on \"+date_str+' anymore';\r\n\t\tformdata.append('action','remove_host');\r\n\t\tcheck_confirmation(text, formdata);\r\n\t}else if(target.classList.contains('admin')){\r\n\t\tvar text \t= \"Please confirm host removal for \"+scheduleowner+\" on \"+date_str;\r\n\t\tformdata.append('action','remove_host');\r\n\t\tcheck_confirmation(text, formdata);\r\n\t}\r\n}\r\n\r\nfunction add_schedule_event(target){\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar first_table_row\t= table.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= first_table_row.cells[cell.cellIndex].dataset.isodate;\r\n\tvar modal \t\t\t= document.querySelector('[name=\"add_session\"]');\r\n\tmodal.querySelector('[name=\"schedule_index\"]').value \t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"row_id\"]').value \t\t\t= target.closest('tr').rowIndex;\r\n\tmodal.querySelector('[name=\"cell_id\"]').value\t\t\t= target.closest('td').cellIndex;\r\n\tmodal.querySelector('[name=\"date\"]').value \t\t\t\t= date;\r\n\tmodal.querySelector('[name=\"olddate\"]').value \t\t\t= date;\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.add('add_schedule_row');\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.remove('update_schedule');\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\nfunction check_confirmation(text, formdata){\r\n\tSwal.fire({\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: text+\"?\",\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: 'Yes'\r\n\t}).then((result) => {\r\n\t\tif (result.isConfirmed) {\r\n\t\t\tdocument.querySelectorAll('.modal:not(.hidden)').forEach(modal=>modal.classList.add('hidden'));\r\n\t\t\t//display loading gif\r\n\t\t\tif(target.classList.contains('remove_schedule')){\r\n\t\t\t\tshowLoader(target.closest('.schedules_div'));\r\n\t\t\t}else{\r\n\t\t\t\tshowLoader(target.firstChild);\r\n\t\t\t}\r\n\t\t\tsendAJAX(formdata);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction remove_schedule_timeslot(target){\r\n\tmodal_form\t\t\t= target.closest('form');\r\n\tschedule_id\t\t\t= modal_form.querySelector('[name=\"schedule_index\"]').value;\r\n\r\n\tvar date\t\t= modal_form.querySelector('[name=\"date\"]').value;\r\n\tvar starttime\t= modal_form.querySelector('[name=\"starttime\"]').value;\r\n\tvar update_nonce= document.querySelector('[name=\"update_schedule_nonce\"]').value;\r\n\t\r\n\tvar text \t\t= \"Are you sure you want to remove this timeslot?\";\r\n\tvar formdata \t= new FormData();\r\n\tformdata.append('remove_timeslot','true');\r\n\tformdata.append('update_schedule_nonce',update_nonce);\r\n\tformdata.append('date',date);\r\n\tformdata.append('starttime',starttime);\r\n\tformdata.append('schedule_index',schedule_id);\r\n\tformdata.append('row_id',target.closest('row').rowIndex);\r\n\tformdata.append('cell_id',target.closest('td').cellIndex);\r\n\r\n\tcheck_confirmation(text, formdata);\r\n}\r\n\r\n//Do something with selected items\r\nfunction afterSelect(e, selected, unselected){\r\n\ttarget = e.target;\r\n\r\n\t//remove a meal host\r\n\tif(target.matches('.meal.selected')){\r\n\t\tremove_host(target);\r\n\t//Add a host\r\n\t}else if(target.matches('.meal')){\r\n\t\tadd_meal_host(target);\r\n\t//orientation slot\r\n\t}else{\r\n\t\t//we have selected something and there are no open modals\r\n\t\tvar open_modals\t= document.querySelectorAll('.modal:not(.hidden)');\r\n\t\tif((selected.length > 0 || target.classList.contains('orientation')) && (open_modals == null || open_modals.length == 0) ){\t\r\n\t\t\t//check if selection is valid\r\n\t\t\tvar column_nr\t= selected[0].node.cellIndex;\r\n\t\t\tvar first_cell\t= selected[0].node;\r\n\r\n\t\t\tfor (const selection of selected){\r\n\t\t\t\tif(column_nr != selection.node.cellIndex){\r\n\t\t\t\t\tSwal.fire({\r\n\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\ttitle: \"You can not select times on multiple days!\",\r\n\t\t\t\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\t\t\t});\r\n\t\t\t\t\te.target.closest('.sim-table')._selectable.clear();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t//We are dealing with a cell with a value\r\n\t\t\tif(first_cell.classList.contains('selected')){\r\n\t\t\t\tedit_time_slot(selected);\r\n\t\t\t}else{\r\n\t\t\t\tfill_timeslot_modal(selected);\r\n\t\t\t}\r\n\t\t} \r\n\t}\r\n};\r\n\r\nfunction fill_timeslot_modal(selected){\r\n\tvar modal \t\t= document.querySelector('[name=\"add_session\"]');\r\n\tvar first_cell\t= selected[0].node;\r\n\tvar last_cell\t= selected[selected.length-1].node;\r\n\tvar endtime\t\t= last_cell.closest('tr').dataset.endtime;\r\n\ttable\t\t\t= first_cell.closest('table');\r\n\tvar date\t\t= table.rows[0].cells[first_cell.cellIndex].dataset.isodate;\r\n\t\r\n\t//Fill the modal values\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t\t= date;\r\n\tmodal.querySelector('[name=\"olddate\"]').value \t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t\t= first_cell.closest('tr').dataset.starttime;\r\n\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endtime;\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.remove('add_schedule_row');\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.add('update_schedule');\r\n\t\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\nfunction edit_time_slot(selected){\r\n\tSwal.fire({\r\n\t\ttitle: 'What do you want to do?',\r\n\t\ttext: \"Do you want to edit or remove this timeslot?\",\r\n\t\tshowDenyButton: true,\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonText: 'Edit timeslot',\r\n\t\tdenyButtonText: 'Remove timeslot',\r\n\t}).then((result) => {\r\n\t\tvar first_cell\t= selected[0].node;\r\n\t\t//swap and/or\r\n\t\tif (result.isConfirmed) {\r\n\t\t\tfill_timeslot_modal(selected);\r\n\r\n\t\t\tvar modal \t\t= document.querySelector('[name=\"add_session\"]');\r\n\t\t\tvar endrow\t\t= target.closest('tr').rowIndex + target.rowSpan - 1;\r\n\t\t\tvar endtime\t\t= target.closest('table').rows[endrow].dataset.endtime;\t\t\t\r\n\t\t\t\r\n\t\t\tmodal.querySelector('[name=\"subject\"]').value\t\t\t= first_cell.querySelector('.subject').textContent;\r\n\t\t\t\r\n\t\t\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endtime;\r\n\r\n\t\t\t//Fill locationfield\r\n\t\t\tvar locationttext = first_cell.querySelector('.location').textContent;\r\n\t\t\tif(locationttext != 'Add location'){\r\n\t\t\t\tmodal.querySelector('[name=\"location\"]').value\t\t\t= locationttext;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//Fill userfield\r\n\t\t\tvar userid = first_cell.dataset.host;\r\n\t\t\tif(userid != null){\r\n\t\t\t\tel = modal.querySelector('[name=\"host\"]');\r\n\t\t\t\tif(el != null){\r\n\t\t\t\t\tel.value\t= userid;\r\n\t\t\t\t}\r\n\t\t\t\tel.selectedOptions[0].defaultSelected=true;\r\n\t\t\t\tel._niceselect.update();\r\n\t\t\t\tel.selectedOptions[0].defaultSelected=false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//change button text\r\n\t\t\tmodal.querySelector('[name=\"add_timeslot\"]').textContent\t= 'Update time slot';\r\n\t\t//add new rule after this one\r\n\t\t}else if (result.isDenied) {\r\n\t\t\tremove_host(first_cell);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//hide empty rows on mobile\r\nfunction hideRows() {\r\n\t//only run for smaller screens\r\n\tif (window.innerWidth > 800) return false;\r\n\t\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table').forEach(function(table){\r\n\t\tvar emptyrow = true;\r\n\t\t\r\n\t\t//DO not hide lunch or dinner rows\r\n\t\tif(tr.dataset.starttime != 'dinner' && tr.dataset.starttime != 'lunch'){\r\n\t\t\t//loop over all table cells to see if there is a cell with content\r\n\t\t\ttr.querySelectorAll('td').forEach(function(cell,index){\r\n\t\t\t\tif(index>0 && cell.textContent != 'Available' && cell.textContent != ' '){\r\n\t\t\t\t\temptyrow = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//If non of the cells have content\r\n\t\t\tif(emptyrow == true){\r\n\t\t\t\t//hide the row\r\n\t\t\t\ttr.classList.add('hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction add_selectable(){\r\n\t//Add selectable on non-mobile devices\r\n\t//if(!isMobileDevice()){\r\n\t\t//loop over all the schedule tables\r\n\t\tdocument.querySelectorAll('.sim-table.schedule').forEach(function(table){\r\n\t\t\t//Load selectable and attach it to the table\r\n\t\t\ttable._selectable = new Selectable({\r\n\t\t\t   filter:\t\t\".orientation.admin\",\r\n\t\t\t   appendTo:\ttable.querySelector(\"tbody\"),\r\n\t\t\t   lasso: {\r\n\t\t\t\t\tborder: \"none\",\r\n\t\t\t\t\tbackgroundColor: \"none\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//Run the function afterSelect when selection is final\r\n\t\t\ttable._selectable.on('end', afterSelect);\r\n\t\t});\r\n\t//}\r\n\r\n\thideRows();\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"Schedule.js loaded\");\r\n\t\r\n\tadd_selectable();\r\n});\r\n\r\ndocument.addEventListener('click',function(event){\r\n\ttarget = event.target;\r\n\t//Direct table actions\r\n\tif(target.classList.contains('remove_schedule')){\r\n\t\tremove_schedule(target);\r\n\t}\r\n\r\n\t//publish the schedule\r\n\tif(target.classList.contains('publish')){\r\n\t\tpublish_schedule(target);\r\n\t}\r\n\r\n\tif(target.classList.contains('keyword')){\r\n\t\tshow_recipe_modal(target);\r\n\t}\r\n\r\n\tif(target.classList.contains('timeslot')){\r\n\t\t//add_schedule_event(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener('change',function(event){\r\n\ttarget = event.target;\r\n\t//Direct table actions\r\n\tif(target.name=='target_name'){\r\n\t\tvar userid = target.list.querySelector(\"[value='\"+target.value+\"' i]\").dataset.value;\r\n\r\n\t\ttarget.closest('form').querySelector('[name=\"target_id\"]').value\t= userid;\r\n\t}\r\n});\r\n"],"names":["get_target_cell","responsdata","table","document","querySelector","schedule_id","cellIndex","date","starttime","cells","load_host_formdata","target","update_nonce","value","closest","dataset","heading","tHead","rows","cell","isodate","formdata","FormData","append","host","sim","userid","remove_host","scheduleowner","date_str","textContent","toLowerCase","includes","text","check_confirmation","classList","contains","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","then","result","isConfirmed","querySelectorAll","forEach","modal","add","showLoader","firstChild","sendAJAX","afterSelect","e","selected","unselected","matches","remove","add_meal_host","open_modals","length","column_nr","node","first_cell","selection","_selectable","clear","showDenyButton","denyButtonText","fill_timeslot_modal","endrow","rowIndex","rowSpan","endtime","locationttext","el","selectedOptions","defaultSelected","_niceselect","update","isDenied","edit_time_slot","add_selectable","Selectable","filter","appendTo","lasso","border","backgroundColor","on","window","innerWidth","emptyrow","tr","index","hideRows","status","outerHTML","cell_html","target_cell","row","i","nextElementSibling","hide_modals","innerHTML","menu","html","addEventListener","console","log","event","remove_schedule_nonce","remove_schedule","click","publish_schedule","recipe_modal","show_recipe_modal","name","list"],"sourceRoot":""}