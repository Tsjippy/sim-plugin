{"version":3,"file":"schedules.min.js","mappings":"MAiIA,SAASA,EAAYC,GACpB,IAAIC,EAAgBC,SAASC,cAAc,aAG3C,GAFAF,EAAYG,UAAUC,OAAO,UAE1BJ,EAAYK,QAAQ,EAAE,CACxB,IAAIC,EAAON,EAAYO,QAAQ,MAC3BC,EAAQR,EAAYS,UAExB,IAAKC,EAAI,EAAGA,EAAIV,EAAYK,QAASK,KACpCJ,EAAMA,EAAIK,oBACNC,MAAMJ,GAAOL,UAAUU,IAAI,UAIjCb,EAAYc,UAAYf,EAASgB,KAEjCC,cAEAC,IAEAC,gBAAgBnB,EAASoB,SAI1BC,eAAeC,EAAWC,GACzB,IAAIC,EAAYC,EAAiBF,GAEjCG,MAAWH,EAAOf,QAAQ,SAC1B,IAAImB,EAAgBD,MAAME,QAAQL,OAC9BM,EAASN,EAAOf,QAAQ,MACxBsB,EAAYJ,MAAMK,KAAK,GAAGlB,MAAMgB,EAAKnB,WAAWkB,QAAQI,KAE5D,GAAGT,EAAOnB,UAAU6B,SAAS,eAC5B,IAAIC,EAAQ,gEAERA,EADIX,EAAOnB,UAAU6B,SAAS,SACtB,mCAAmCN,QAAoBG,IAEvD,qDAAqDH,QAAoBG,YAKtF,SAFsBK,EAAkBD,GAE3B,CACZE,WAAWP,EAAKQ,YAEhB,IAAIrC,QAAiBsC,aAAa,qBAAsBd,GAGxDK,EAAKzB,UAAUC,OAAO,YACtBwB,EAAKzB,UAAUC,OAAO,eAGtBwB,EAAKU,UAAY,YACjB,IAAI9B,EAASoB,EAAKnB,UACdH,EAAQsB,EAAKrB,QAAQ,MAGzB,GAAyB,GAAtBD,EAAIM,MAAM,GAAGP,QAAW,CAE1B,IAAKK,EAAI,EAAGA,EAAIY,EAAOjB,QAASK,KAC/BJ,EAAMA,EAAIK,oBACNC,MAAMJ,GAAOL,UAAUC,OAAO,UAInCkB,EAAOjB,QAAU,EAGlBa,gBAAgBnB,IAIlB,SAASwC,EAAkBC,GAC1B,IAAIC,EAAWxC,SAASC,cAAc,wBAClCwC,EAAcF,EAAS,GAAGG,KAC1BC,EAAaJ,EAASA,EAASK,OAAO,GAAGF,KAE7CD,EAAWvC,UAAUU,IAAI,UACzB6B,EAAWrC,QAAUJ,SAAS6C,iBAAiB,gBAAgBD,OAC/D,IAAIE,EAAYH,EAAUrC,QAAQ,MAAMoB,QAAQoB,QAChDtB,MAAWiB,EAAWnC,QAAQ,SAC9B,IAAIwB,EAASN,MAAMK,KAAK,GAAGlB,MAAM8B,EAAWjC,WAAWkB,QAAQqB,QAG/DP,EAAMvC,cAAc,wBAAwB+C,MAASxB,MAAME,QAAY,GACvEc,EAAMvC,cAAc,iBAAiB+C,MAAWlB,EAChDU,EAAMvC,cAAc,oBAAoB+C,MAAWlB,EACnDU,EAAMvC,cAAc,sBAAsB+C,MAAUP,EAAWnC,QAAQ,MAAMoB,QAAQuB,UACrFT,EAAMvC,cAAc,oBAAoB+C,MAAUF,EAClDN,EAAMvC,cAAc,yBAAyBC,UAAUC,OAAO,oBAC9DqC,EAAMvC,cAAc,yBAAyBC,UAAUU,IAAI,mBAE3D4B,EAAMtC,UAAUC,OAAO,UA8FxB,SAASoB,EAAiBF,GACzB,IAAI6B,EAAelD,SAASC,cAAc,kCAAkC+C,MAC5ExB,MAAWH,EAAOf,QAAQ,SAC1B6C,YAAgB3B,MAAME,QAAY,GAClC,IAAI0B,EAAY5B,MAAM6B,MAAMxB,KAAK,GAC7BF,EAASN,EAAOf,QAAQ,MACxBwB,EAASsB,EAAQzC,MAAMgB,EAAKnB,WAAWkB,QAAQqB,QAC/CE,EAAa5B,EAAOf,QAAQ,MAAMoB,QAAQuB,UAE1C3B,EAAY,IAAIgC,SAYpB,OAXAhC,EAASiC,OAAO,OAAOzB,GACC,MAArBH,EAAKD,QAAQ8B,KACflC,EAASiC,OAAO,OAAO5B,EAAKD,QAAQ8B,MAEpClC,EAASiC,OAAO,OAAOE,IAAIC,QAG5BpC,EAASiC,OAAO,YAAYN,GAC5B3B,EAASiC,OAAO,wBAAwBL,GACxC5B,EAASiC,OAAO,cAAcJ,aAEvB7B,EAGRH,eAAec,EAAkBD,GAW/B,eAVkB2B,KAAKC,KAAK,CAC5BC,MAAO,gBACP7B,KAAMA,EAAK,IACX8B,KAAM,UACNC,kBAAkB,EAClBC,mBAAoB,UACpBC,kBAAmB,OACnBC,kBAAmB,SAGRC,cACVnE,SAAS6C,iBAAiB,uBAAuBuB,SAAQ5B,GAAOA,EAAMtC,UAAUU,IAAI,YAEjFS,OAAOnB,UAAU6B,SAAS,mBAC5BG,WAAWb,OAAOf,QAAQ,mBAE1B4B,WAAWb,OAAOc,aAGZ,GAiCV,SAASnB,IAIPhB,SAAS6C,iBAAiB,uBAAuBuB,SAAQ,SAAS5C,GAEjEA,EAAM6C,YAAc,IAAIC,WAAW,CAChCC,OAAS,qBACTC,SAAUhD,EAAMvB,cAAc,SAC9BwE,MAAO,CACRC,OAAQ,OACRC,gBAAiB,UAKnBnD,EAAM6C,YAAYO,GAAG,MAAOC,MA1C/B,WAEC,GAAIC,OAAOC,WAAa,IAAK,OAAO,EAGpC/E,SAAS6C,iBAAiB,cAAcuB,SAAQ,SAAS5C,GACxD,IAAIwD,GAAW,EAGY,UAAxBC,GAAGvD,QAAQuB,WAAiD,SAAxBgC,GAAGvD,QAAQuB,YAEjDgC,GAAGpC,iBAAiB,MAAMuB,SAAQ,SAASzC,EAAKpB,GAC5CA,EAAM,GAAyB,aAApBoB,EAAKuD,aAAkD,KAApBvD,EAAKuD,cACrDF,GAAW,MAKE,GAAZA,GAEFC,GAAG/E,UAAUU,IAAI,cA0BpBuE,GAqDD,SAASN,EAAYO,EAAG7C,EAAU8C,GAIjC,GAHAhE,OAAS+D,EAAE/D,OAGRA,OAAOiE,QAAQ,kBACjBlE,EAAWC,aAEN,GAAGA,OAAOiE,QAAQ,gBAtYzB,WACCjE,OAAOnB,UAAUU,IAAI,UACrBY,MAAmBH,OAAOf,QAAQ,SAClC,IAAIqB,EAAiBN,OAAOf,QAAQ,MAChCwB,EAAiBN,MAAMK,KAAK,GAAGlB,MAAMgB,EAAKnB,WAAWkB,QAAQqB,QAC7DE,EAAqB5B,OAAOf,QAAQ,MAAMoB,QAAQuB,UAClDT,EAAkBnB,OAAOf,QAAQ,sBAAsBL,cAAc,qBACzEuC,EAAMvC,cAAc,wBAAwB+C,MAAQxB,MAAME,QAAY,GACtEc,EAAMvC,cAAc,iBAAiB+C,MAAUlB,EAC/CU,EAAMvC,cAAc,sBAAsB+C,MAASC,EACnDT,EAAMtC,UAAUC,OAAO,UA6XtBoF,QAEK,GAAGlE,OAAOiE,QAAQ,sBAjXzBnE,eAAoCE,GACnCG,MAAWH,EAAOf,QAAQ,SAC1B,IAAIqB,EAASN,EAAOf,QAAQ,MAIxB0B,EAAU,8CAHMR,MAAME,QAAQL,aAClBG,MAAMK,KAAK,GAAGlB,MAAMgB,EAAKnB,WAAWkB,QAAQI,OAK5D,SAFuBG,EAAkBD,GAE5B,CACZX,EAAOnB,UAAUU,IAAI,UAErB,IAAIU,EAAYC,EAAiBF,GAE7BvB,QAAiBsC,aAAa,kBAAmBd,GAElDxB,GACFD,EAAYC,IAiWb0F,CAAqBnE,YACjB,CAEJ,IAAIoE,EAAczF,SAAS6C,iBAAiB,uBAC5C,IAAIN,EAASK,OAAS,GAAKvB,OAAOnB,UAAU6B,SAAS,kBAAmC,MAAf0D,GAA6C,GAAtBA,EAAY7C,QAAc,CAEzH,IAAI8C,EAAYnD,EAAS,GAAGG,KAAKlC,UAC7BiC,EAAaF,EAAS,GAAGG,KAE7B,IAAK,MAAMiD,KAAapD,EACvB,GAAGmD,GAAaC,EAAUjD,KAAKlC,UAO9B,OANAmD,KAAKC,KAAK,CACTE,KAAM,QACND,MAAO,6CACPG,mBAAoB,iBAErBoB,EAAE/D,OAAOf,QAAQ,cAAc+D,YAAYuB,QAM1CnD,EAAWvC,UAAU6B,SAAS,YAlRpCZ,eAA4BoB,GAC3B,IAAIsD,QAAelC,KAAKC,KAAK,CAC5BC,MAAO,0BACP7B,KAAM,+CACN8D,gBAAgB,EAChB/B,kBAAkB,EAClBG,kBAAmB,gBACnB6B,eAAgB,oBAGbtD,EAAaF,EAAS,GAAGG,KAG7B,GAAImD,EAAO1B,YAAa,CAEvB7B,EAAkBC,GAGlB,IAAIC,EAAUxC,SAASC,cAAc,wBACjC+F,EAAU3E,OAAOf,QAAQ,MAAM2F,SAAW5E,OAAOjB,QAAU,EAC3D0C,EAAWzB,OAAOf,QAAQ,SAASuB,KAAKmE,GAAQtE,QAAQoB,QAC5DN,EAAMvC,cAAc,oBAAoB+C,MAAUP,EAAWxC,cAAc,YAAYiF,YACvF1C,EAAMvC,cAAc,oBAAoB+C,MAAUF,EAGlD,IAAIoD,EAAgBzD,EAAWxC,cAAc,aAAaiF,YACtC,gBAAjBgB,IACF1D,EAAMvC,cAAc,qBAAqB+C,MAAUkD,GAIpD,IAAIxC,EAASjB,EAAWf,QAAQ8B,KACnB,MAAVE,IACFyC,GAAK3D,EAAMvC,cAAc,iBAChB,MAANkG,KACFA,GAAGnD,MAAQU,GAEZyC,GAAGC,gBAAgB,GAAGC,iBAAgB,EACtCF,GAAGG,YAAYC,SACfJ,GAAGC,gBAAgB,GAAGC,iBAAgB,GAIvC7D,EAAMvC,cAAc,yBAAyBiF,YAAc,wBAElDW,EAAOW,UAChBpF,EAAWqB,GAqOTgE,CAAalE,GAEbD,EAAkBC,KAtFtBvC,SAAS0G,iBAAiB,oBAAmB,WAC5CC,QAAQC,IAAI,sBAEZ5F,OAGDhB,SAAS0G,iBAAiB,SAAQ,SAASG,GAC1CxF,OAASwF,EAAMxF,OAEG,gBAAfA,OAAOyF,MA9ZX3F,eAA2BE,GAC1B,IAAIvB,QAAiBiH,WAAW1F,EAAOf,QAAQ,QAAS,uBAErDR,IACFuB,EAAOf,QAAQ,sBAAsBO,UAAUf,EAASgB,KAExDG,gBAAgBnB,EAASoB,SAEzBF,KAuZAgG,CAAY3F,QAGVA,OAAOnB,UAAU6B,SAAS,oBA7X9BZ,eAA+BE,GAC9B8B,YAAkB9B,EAAOK,QAAqB,YAC9C,IAAIuF,EAAwBjH,SAASC,cAAc,kCAAkC+C,MAGjF1B,EAAa,IAAIgC,SAMrB,GALAhC,EAASiC,OAAO,cAAeJ,aAC/B7B,EAASiC,OAAO,wBAAwB0D,GACxC3F,EAASiC,OAAO,WAAYE,IAAIyD,iBAETjF,EANT,iDAOD,CACZ,IAAIkF,QAAeC,MAClB3D,IAAI4D,SAAS,yCACb,CACCC,OAAQ,OACRC,YAAa,cACbC,KAAMlG,IAIJxB,QAAiBqH,EAAOM,OAEzBN,EAAOO,IACTzG,gBAAgBnB,GAEhBE,SAASC,cAAc,kDAAkDE,WAEzEwG,QAAQgB,MAAM7H,GACdmB,gBAAgBnB,EAAU,WAiW3B8H,CAAgBvG,QAIdA,OAAOnB,UAAU6B,SAAS,YA3Z9B,SAAkCV,GACjC,IAAImB,EAAUnB,EAAOf,QAAQ,kBAAkBL,cAAc,qBAC7DuC,EAAMvC,cAAc,wBAAwB+C,MAAQ3B,EAAOK,QAAqB,YACpD,MAAzBL,EAAOK,QAAQL,QACjBmB,EAAMvC,cAAc,4BAA4B+C,MAAQ3B,EAAOK,QAAQL,OACvEmB,EAAMvC,cAAc,6BAA6B4H,QACjD3F,WAAWb,GAAO,IAElBmB,EAAMtC,UAAUC,OAAO,UAoZvB2H,CAAyBzG,QAGR,oBAAfA,OAAOyF,MAnZX3F,eAA+BE,GAC9BvB,eAAiBiH,WAAW1F,EAAOf,QAAQ,QAAS,2BAEjDR,WACFE,SAAS6C,iBAAiB,gCAAgCuB,SAAQ+B,GAAIA,EAAGjG,UAAUU,IAAI,YAEvFG,cAEAE,gBAAgBnB,WA4YhBiI,CAAgB1G,QAGdA,OAAOnB,UAAU6B,SAAS,YAtK9B,SAAyBV,GACxBA,EAAOnB,UAAUU,IAAI,UAErBY,MAAWH,EAAOf,QAAQ,SAC1B6C,YAAgB3B,MAAME,QAAY,GAClC,IAAI0B,EAAY5B,MAAM6B,MAAMxB,KAAK,GAC7BF,EAASN,EAAOf,QAAQ,MACxBwB,EAASsB,EAAQzC,MAAMgB,EAAKnB,WAAWkB,QAAQqB,QAC/CE,EAAa5B,EAAOf,QAAQ,MAAMoB,QAAQuB,UAG9C+E,aAAehI,SAASC,cAAc,iCAEtCgI,UAAUD,aAAa/H,cAAc,SAErC+H,aAAa/H,cAAc,wBAAwB+C,MAASxB,MAAME,QAAY,GAC9EsG,aAAa/H,cAAc,iBAAiB+C,MAAWlB,EACvDkG,aAAa/H,cAAc,sBAAsB+C,MAAUC,EAElC,wBAAtB5B,EAAO6D,cACT8C,aAAa/H,cAAc,2BAA2B+C,MAAQ3B,EAAO6D,YACrElF,SAASC,cAAc,+BAA+BiF,YAAc,0BAGrE8C,aAAa9H,UAAUC,OAAO,UA+I7B+H,CAAgB7G,QAGC,sBAAfA,OAAOyF,MA9IX3F,eAA4BE,GAC3B,IAAIvB,QAAiBiH,WAAW1F,EAAOf,QAAQ,QAAS,mBAExDN,SAASC,cAAc,WAAWiF,YAAc7D,EAAOf,QAAQ,QAAQL,cAAc,2BAA2B+C,MAEhHhD,SAASC,cAAc,WAAWC,UAAUC,OAAO,UAEnDY,cAEAE,gBAAgBnB,GAsIfqI,CAAa9G,QAGI,YAAfA,OAAOyF,MAAqC,gBAAfzF,OAAOyF,MAjWxC3F,eAAuBE,GACtB,IAAI+G,EAAQ/G,EAAOf,QAAQ,QACvBR,QAAkBiH,WAAWqB,EAAM,mBAEpCtI,GACFD,EAAYC,GA6VZuI,CAAQhH,WAIVrB,SAAS0G,iBAAiB,UAAS,SAASG,GAG3C,GAFAxF,OAASwF,EAAMxF,OAEC,eAAbA,OAAOyF,KAAoB,CAC7B,IAAIpD,EAASrC,OAAOiH,KAAKrI,cAAc,WAAWoB,OAAO2B,MAAM,QAAQtB,QAAQsB,MAE/E3B,OAAOf,QAAQ,QAAQL,cAAc,sBAAsB+C,MAAQU,O","sources":["webpack://events/./schedules.js"],"sourcesContent":["/**\r\n *\r\n * Submits the new schedule form via rest API and adds the new schedule to the screen.\r\n *\r\n * @listens to button click if button has name add_schedule\r\n *\r\n * @param {Object} target     The clicked button.\r\n *\r\n * @return nothing\r\n*/ \r\nasync function addSchedule(target){\r\n\tvar response = await submitForm(target.closest('form'), 'events/add_schedule');\r\n\r\n\tif(response){\r\n\t\ttarget.closest('.schedules_wrapper').outerHTML=response.html;\r\n\t\t\r\n\t\tdisplay_message(response.message);\r\n\r\n\t\tadd_selectable();\r\n\t}\r\n}\r\n\r\nfunction ShowPublishScheduleModal(target){\r\n\tvar modal\t\t\t= target.closest('.schedules_div').querySelector('.publish_schedule');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value = target.dataset[\"schedule_id\"];;\r\n\tif(target.dataset.target != null){\r\n\t\tmodal.querySelector('[name=\"schedule_target\"]').value = target.dataset.target;\r\n\t\tmodal.querySelector('[name=\"publish_schedule\"]').click();\r\n\t\tshowLoader(target,true);\r\n\t}else{\r\n\t\tmodal.classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nasync function publishSchedule(target){\r\n\tresponse\t= await submitForm(target.closest('form'), 'events/publish_schedule');\r\n\r\n\tif(response){\r\n\t\tdocument.querySelectorAll('.schedule_actions .loadergif').forEach(el=>el.classList.add('hidden'));\r\n\t\t\r\n\t\thide_modals();\r\n\r\n\t\tdisplay_message(response);\r\n\t}\r\n}\r\n\r\n// Removes an existing schedule\r\nasync function remove_schedule(target){\r\n\tschedule_id\t\t\t\t\t= target.dataset[\"schedule_id\"];\r\n\tvar remove_schedule_nonce\t= document.querySelector('[name=\"remove_schedule_nonce\"]').value;\r\n\t\t\r\n\tvar text \t\t\t= \"Are you sure you want to remove this schedule\";\r\n\tvar formdata \t\t= new FormData();\r\n\tformdata.append('schedule_id', schedule_id);\r\n\tformdata.append('remove_schedule_nonce',remove_schedule_nonce);\r\n\tformdata.append('_wpnonce', sim.restnonce);\r\n\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\tif(confirmed){\r\n\t\tvar result = await fetch(\r\n\t\t\tsim.base_url+'/wp-json/sim/v1/events/remove_schedule',\r\n\t\t\t{\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tcredentials: 'same-origin',\r\n\t\t\t\tbody: formdata\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tvar response\t= await result.json();\r\n\r\n\t\tif(result.ok){\r\n\t\t\tdisplay_message(response);\r\n\r\n\t\t\tdocument.querySelector('.schedules_wrapper .loaderwrapper:not(.hidden)').remove();\r\n\t\t}else{\r\n\t\t\tconsole.error(response);\r\n\t\t\tdisplay_message(response, 'error');\r\n\t\t};\r\n\t}\r\n}\r\n\r\n//shows the modal to select a user as host\r\nfunction showAddHostModal(){\r\n\ttarget.classList.add('active');\r\n\ttable\t\t\t\t\t\t\t\t\t\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t\t\t\t\t\t\t\t\t= target.closest('td');\r\n\tvar date\t\t\t\t\t\t\t\t\t\t\t= table.rows[0].cells[cell.cellIndex].dataset.isodate;\r\n\tvar starttime\t\t\t\t\t\t\t\t\t\t= target.closest('tr').dataset.starttime;\r\n\tvar modal\t\t\t\t\t\t\t\t\t\t\t= target.closest('.schedules_wrapper').querySelector('[name=\"add_host\"]');\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t= starttime;\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\n// Add a new host when the host form is submitted\r\nasync function addHost(target){\r\n\tvar form\t\t= target.closest('form');\r\n\tvar response \t= await submitForm(form, 'events/add_host');\r\n\r\n\tif(response){\r\n\t\taddHostHtml(response);\r\n\t}\r\n}\r\n\r\n// Add current user as host\r\nasync function addCurrentUserAsHost(target){\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar scheduleowner\t= table.dataset.target;\r\n\tvar date_str\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\t\r\n\tvar text \t\t\t= `Please confirm you want to be the host for ${scheduleowner} on ${date_str}`;\r\n\tvar confirmed\t\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\ttarget.classList.add('active');\r\n\r\n\t\tvar formdata\t\t= loadHostFormdata(target);\r\n\r\n\t\tvar response\t= await fetchRestApi('events/add_host', formdata);\r\n\r\n\t\tif(response){\r\n\t\t\taddHostHtml(response);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Show the new host in the schedule\r\nfunction addHostHtml(response){\r\n\tvar target_cell\t\t\t= document.querySelector('td.active');\r\n\ttarget_cell.classList.remove('active');\r\n\r\n\tif(target_cell.rowSpan>1){\r\n\t\tvar row\t\t= target_cell.closest('tr');\r\n\t\tvar index\t= target_cell.cellIndex;\r\n\t\t//Loop over the next cells to add the hidden attribute\r\n\t\tfor (i = 1; i < target_cell.rowSpan; i++) {\r\n\t\t\trow = row.nextElementSibling;\r\n\t\t\trow.cells[index].classList.add('hidden');\r\n\t\t}\r\n\t}\r\n\r\n\ttarget_cell.outerHTML\t= response.html;\r\n\r\n\thide_modals();\r\n\r\n\tadd_selectable();\r\n\r\n\tdisplay_message(response.message);\r\n}\r\n\r\n// Remove a host\r\nasync function removeHost(target){\r\n\tvar formdata\t\t= loadHostFormdata(target);\r\n\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tvar scheduleowner\t= table.dataset.target;\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date_str\t\t= table.rows[0].cells[cell.cellIndex].dataset.date;\r\n\r\n\tif(target.classList.contains('orientation')){\r\n\t\tvar text \t= `Are you sure you want to remove this orientation session`;\r\n\t}else if(target.classList.contains('admin')){\r\n\t\tvar text \t= `Please confirm host removal for ${scheduleowner} on ${date_str}`;\r\n\t}else{\r\n\t\tvar text \t= `Please confirm you do not want to be the host for ${scheduleowner} on ${date_str} anymore`;\r\n\t}\r\n\r\n\tvar confirmed\t= await checkConfirmation(text);\r\n\r\n\tif(confirmed){\r\n\t\tshowLoader(cell.firstChild);\r\n\r\n\t\tvar response = await fetchRestApi('events/remove_host', formdata);\r\n\r\n\t\t//Remove cell class\r\n\t\tcell.classList.remove('selected');\r\n\t\tcell.classList.remove('ui-selected');\r\n\r\n\t\t//Set cell text\r\n\t\tcell.innerHTML\t= 'Available';\r\n\t\tvar index\t\t= cell.cellIndex;\r\n\t\tvar row\t\t\t= cell.closest('tr');\r\n\r\n\t\t//only remove rowspan if the first cell of a row has no rowspan\r\n\t\tif(row.cells[0].rowSpan==1){\r\n\t\t\t//Loop over the next cells to remove the hidden attribute\r\n\t\t\tfor (i = 1; i < target.rowSpan; i++) {\r\n\t\t\t\trow = row.nextElementSibling;\r\n\t\t\t\trow.cells[index].classList.remove('hidden');\r\n\t\t\t}\r\n\r\n\t\t\t//Reset the rowSpan\r\n\t\t\ttarget.rowSpan = 1;\r\n\t\t}\r\n\r\n\t\tdisplay_message(response);\r\n\t}\r\n}\r\n\r\nfunction showTimeslotModal(selected){\r\n\tvar modal \t\t\t= document.querySelector('[name=\"add_session\"]');\r\n\tvar first_cell\t\t= selected[0].node;\r\n\tvar last_cell\t\t= selected[selected.length-1].node;\r\n\r\n\tfirst_cell.classList.add('active');\r\n\tfirst_cell.rowSpan\t= document.querySelectorAll('.ui-selected').length;\r\n\tvar endtime\t\t\t= last_cell.closest('tr').dataset.endtime;\r\n\ttable\t\t\t\t= first_cell.closest('table');\r\n\tvar date\t\t\t= table.rows[0].cells[first_cell.cellIndex].dataset.isodate;\r\n\t\r\n\t//Fill the modal values\r\n\tmodal.querySelector('[name=\"schedule_id\"]').value\t\t= table.dataset[\"id\"];\r\n\tmodal.querySelector('[name=\"date\"]').value\t\t\t\t= date;\r\n\tmodal.querySelector('[name=\"olddate\"]').value \t\t\t= date;\r\n\tmodal.querySelector('[name=\"starttime\"]').value\t\t\t= first_cell.closest('tr').dataset.starttime;\r\n\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endtime;\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.remove('add_schedule_row');\r\n\tmodal.querySelector('[name=\"add_timeslot\"]').classList.add('update_schedule');\r\n\t\r\n\tmodal.classList.remove('hidden');\r\n}\r\n\r\nasync function editTimeSlot(selected){\r\n\tvar answer = await Swal.fire({\r\n\t\ttitle: 'What do you want to do?',\r\n\t\ttext: \"Do you want to edit or remove this timeslot?\",\r\n\t\tshowDenyButton: true,\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonText: 'Edit timeslot',\r\n\t\tdenyButtonText: 'Remove timeslot',\r\n\t});\r\n\t\r\n\tvar first_cell\t= selected[0].node;\r\n\r\n\t//swap and/or\r\n\tif (answer.isConfirmed) {\r\n\t\t// Show modal and prefill the default fields\r\n\t\tshowTimeslotModal(selected);\r\n\r\n\t\t// also prefill the other fields\r\n\t\tvar modal \t\t= document.querySelector('[name=\"add_session\"]');\r\n\t\tvar endrow\t\t= target.closest('tr').rowIndex + target.rowSpan - 1;\r\n\t\tvar endtime\t\t= target.closest('table').rows[endrow].dataset.endtime;\t\t\t\r\n\t\tmodal.querySelector('[name=\"subject\"]').value\t\t\t= first_cell.querySelector('.subject').textContent;\r\n\t\tmodal.querySelector('[name=\"endtime\"]').value\t\t\t= endtime;\r\n\r\n\t\t//Fill locationfield\r\n\t\tvar locationttext = first_cell.querySelector('.location').textContent;\r\n\t\tif(locationttext != 'Add location'){\r\n\t\t\tmodal.querySelector('[name=\"location\"]').value\t\t\t= locationttext;\r\n\t\t}\r\n\t\t\r\n\t\t//Fill userfield\r\n\t\tvar userid = first_cell.dataset.host;\r\n\t\tif(userid != null){\r\n\t\t\tel = modal.querySelector('[name=\"host\"]');\r\n\t\t\tif(el != null){\r\n\t\t\t\tel.value\t= userid;\r\n\t\t\t}\r\n\t\t\tel.selectedOptions[0].defaultSelected=true;\r\n\t\t\tel._niceselect.update();\r\n\t\t\tel.selectedOptions[0].defaultSelected=false;\r\n\t\t}\r\n\t\t\r\n\t\t//change button text\r\n\t\tmodal.querySelector('[name=\"add_timeslot\"]').textContent\t= 'Update time slot';\r\n\t//add new rule after this one\r\n\t}else if (answer.isDenied) {\r\n\t\tremoveHost(first_cell);\r\n\t}\r\n}\r\n\r\n// Show the modal to add a recipe keyword\r\nfunction showRecipeModal(target){\r\n\ttarget.classList.add('active');\r\n\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tschedule_id\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar starttime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\t//Fill the modal with the values of the clickes schedule\r\n\trecipe_modal = document.querySelector('[name=\"recipe_keyword_modal\"]');\r\n\r\n\tformReset(recipe_modal.querySelector('form'));\r\n\r\n\trecipe_modal.querySelector('[name=\"schedule_id\"]').value \t= table.dataset[\"id\"];\r\n\trecipe_modal.querySelector('[name=\"date\"]').value \t\t\t= date;\r\n\trecipe_modal.querySelector('[name=\"starttime\"]').value \t\t= starttime;\r\n\r\n\tif(target.textContent != 'Enter recipe keyword'){\r\n\t\trecipe_modal.querySelector('[name=\"recipe_keyword\"]').value\t= target.textContent;\r\n\t\tdocument.querySelector('[name=\"add_recipe_keyword\"]').textContent\t= 'Update recipe keywords';\r\n\t}\r\n\t\r\n\trecipe_modal.classList.remove('hidden');\r\n}\r\n\r\n//submit the recipe form\r\nasync function submitRecipe(target){\r\n\tvar response = await submitForm(target.closest('form'), 'events/add_menu');\r\n\r\n\tdocument.querySelector('.active').textContent\t= target.closest('form').querySelector('[name=\"recipe_keyword\"]').value;\r\n\r\n\tdocument.querySelector('.active').classList.remove('active');\r\n\r\n\thide_modals();\r\n\r\n\tdisplay_message(response);\r\n}\r\n\r\nfunction loadHostFormdata(target){\r\n\tvar update_nonce\t= document.querySelector('[name=\"update_schedule_nonce\"]').value;\r\n\ttable\t\t\t\t= target.closest('table');\r\n\tschedule_id\t\t\t= table.dataset[\"id\"];\r\n\tvar heading\t\t\t= table.tHead.rows[0];\r\n\tvar cell\t\t\t= target.closest('td');\r\n\tvar date\t\t\t= heading.cells[cell.cellIndex].dataset.isodate;\r\n\tvar starttime\t\t= target.closest('tr').dataset.starttime;\r\n\r\n\tvar formdata\t\t= new FormData();\r\n\tformdata.append('date',date);\r\n\tif(cell.dataset.host != null){\r\n\t\tformdata.append('host',cell.dataset.host);\r\n\t}else{\r\n\t\tformdata.append('host',sim.userid);\r\n\t}\r\n\t\r\n\tformdata.append('starttime',starttime);\r\n\tformdata.append('update_schedule_nonce',update_nonce);\r\n\tformdata.append('schedule_id',schedule_id);\r\n\r\n\treturn formdata;\r\n}\r\n\r\nasync function checkConfirmation(text){\r\n\tvar result = await Swal.fire({\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: text+\"?\",\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: 'Yes'\r\n\t});\r\n\t\r\n\t\tif (result.isConfirmed) {\r\n\t\t\tdocument.querySelectorAll('.modal:not(.hidden)').forEach(modal=>modal.classList.add('hidden'));\r\n\t\t\t//display loading gif\r\n\t\t\tif(target.classList.contains('remove_schedule')){\r\n\t\t\t\tshowLoader(target.closest('.schedules_div'));\r\n\t\t\t}else{\r\n\t\t\t\tshowLoader(target.firstChild);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n}\r\n\r\n//hide empty rows on mobile\r\nfunction hideRows() {\r\n\t//only run for smaller screens\r\n\tif (window.innerWidth > 800) return false;\r\n\t\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table').forEach(function(table){\r\n\t\tvar emptyrow = true;\r\n\t\t\r\n\t\t//DO not hide lunch or dinner rows\r\n\t\tif(tr.dataset.starttime != 'dinner' && tr.dataset.starttime != 'lunch'){\r\n\t\t\t//loop over all table cells to see if there is a cell with content\r\n\t\t\ttr.querySelectorAll('td').forEach(function(cell,index){\r\n\t\t\t\tif(index>0 && cell.textContent != 'Available' && cell.textContent != ' '){\r\n\t\t\t\t\temptyrow = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//If non of the cells have content\r\n\t\t\tif(emptyrow == true){\r\n\t\t\t\t//hide the row\r\n\t\t\t\ttr.classList.add('hidden');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction add_selectable(){\r\n\t//Add selectable on non-mobile devices\r\n\t//if(!isMobileDevice()){\r\n\t\t//loop over all the schedule tables\r\n\t\tdocument.querySelectorAll('.sim-table.schedule').forEach(function(table){\r\n\t\t\t//Load selectable and attach it to the table\r\n\t\t\ttable._selectable = new Selectable({\r\n\t\t\t   filter:\t\t\".orientation.admin\",\r\n\t\t\t   appendTo:\ttable.querySelector(\"tbody\"),\r\n\t\t\t   lasso: {\r\n\t\t\t\t\tborder: \"none\",\r\n\t\t\t\t\tbackgroundColor: \"none\"\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//Run the function afterSelect when selection is final\r\n\t\t\ttable._selectable.on('end', afterSelect);\r\n\t\t});\r\n\t//}\r\n\r\n\thideRows();\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"Schedule.js loaded\");\r\n\t\r\n\tadd_selectable();\r\n});\r\n\r\ndocument.addEventListener('click',function(event){\r\n\ttarget = event.target;\r\n\t\r\n\tif(target.name == 'add_schedule'){\r\n\t\taddSchedule(target);\r\n\t}\r\n\r\n\tif(target.classList.contains('remove_schedule')){\r\n\t\tremove_schedule(target);\r\n\t}\r\n\r\n\t//publish the schedule\r\n\tif(target.classList.contains('publish')){\r\n\t\tShowPublishScheduleModal(target);\r\n\t}\r\n\r\n\tif(target.name == 'publish_schedule'){\r\n\t\tpublishSchedule(target);\r\n\t}\r\n\t\r\n\tif(target.classList.contains('keyword')){\r\n\t\tshowRecipeModal(target);\r\n\t}\r\n\r\n\tif(target.name == 'add_recipe_keyword'){\r\n\t\tsubmitRecipe(target);\r\n\t}\r\n\r\n\tif(target.name == 'add_host' || target.name == 'add_timeslot'){\r\n\t\taddHost(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener('change',function(event){\r\n\ttarget = event.target;\r\n\t//Direct table actions\r\n\tif(target.name=='target_name'){\r\n\t\tvar userid = target.list.querySelector(\"[value='\"+target.value+\"' i]\").dataset.value;\r\n\r\n\t\ttarget.closest('form').querySelector('[name=\"target_id\"]').value\t= userid;\r\n\t}\r\n});\r\n\r\n//Do something with selected items\r\nfunction afterSelect(e, selected, unselected){\r\n\ttarget = e.target;\r\n\r\n\t//remove a meal host\r\n\tif(target.matches('.meal.selected')){\r\n\t\tremoveHost(target);\r\n\t//Add a host\r\n\t}else if(target.matches('.meal.admin')){\r\n\t\tshowAddHostModal();\r\n\t//orientation slot\r\n\t}else if(target.matches('.meal:not(.admin)')){\r\n\t\taddCurrentUserAsHost(target);\r\n\t}else{\r\n\t\t//we have selected something and there are no open modals\r\n\t\tvar open_modals\t= document.querySelectorAll('.modal:not(.hidden)');\r\n\t\tif((selected.length > 0 || target.classList.contains('orientation')) && (open_modals == null || open_modals.length == 0) ){\t\r\n\t\t\t//check if selection is valid\r\n\t\t\tvar column_nr\t= selected[0].node.cellIndex;\r\n\t\t\tvar first_cell\t= selected[0].node;\r\n\r\n\t\t\tfor (const selection of selected){\r\n\t\t\t\tif(column_nr != selection.node.cellIndex){\r\n\t\t\t\t\tSwal.fire({\r\n\t\t\t\t\t\ticon: 'error',\r\n\t\t\t\t\t\ttitle: \"You can not select times on multiple days!\",\r\n\t\t\t\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\t\t\t});\r\n\t\t\t\t\te.target.closest('.sim-table')._selectable.clear();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t//We are dealing with a cell with a value\r\n\t\t\tif(first_cell.classList.contains('selected')){\r\n\t\t\t\teditTimeSlot(selected);\r\n\t\t\t}else{\r\n\t\t\t\tshowTimeslotModal(selected);\r\n\t\t\t}\r\n\t\t} \r\n\t}\r\n};"],"names":["addHostHtml","response","target_cell","document","querySelector","classList","remove","rowSpan","row","closest","index","cellIndex","i","nextElementSibling","cells","add","outerHTML","html","hide_modals","add_selectable","display_message","message","async","removeHost","target","formdata","loadHostFormdata","table","scheduleowner","dataset","cell","date_str","rows","date","contains","text","checkConfirmation","showLoader","firstChild","fetchRestApi","innerHTML","showTimeslotModal","selected","modal","first_cell","node","last_cell","length","querySelectorAll","endtime","isodate","value","starttime","update_nonce","schedule_id","heading","tHead","FormData","append","host","sim","userid","Swal","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","isConfirmed","forEach","_selectable","Selectable","filter","appendTo","lasso","border","backgroundColor","on","afterSelect","window","innerWidth","emptyrow","tr","textContent","hideRows","e","unselected","matches","showAddHostModal","addCurrentUserAsHost","open_modals","column_nr","selection","clear","answer","showDenyButton","denyButtonText","endrow","rowIndex","locationttext","el","selectedOptions","defaultSelected","_niceselect","update","isDenied","editTimeSlot","addEventListener","console","log","event","name","submitForm","addSchedule","remove_schedule_nonce","restnonce","result","fetch","base_url","method","credentials","body","json","ok","error","remove_schedule","click","ShowPublishScheduleModal","publishSchedule","recipe_modal","formReset","showRecipeModal","submitRecipe","form","addHost","list"],"sourceRoot":""}