(()=>{"use strict";function e(e){let t=document.querySelector(".active");null!=t&&(t.classList.remove("active"),t.outerHTML=e.html),Main.displayMessage(e.message),Main.hideModals()}async function t(e,t){let s,l,o=e.closest(".schedules_div").dataset.target;if(s=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${o} on ${t}`:`Please confirm you do not want to be the host for ${o} on ${t} anymore`,l=await a(s,e.firstChild),l){let t=new FormData;t.append("session_id",e.dataset.session_id),Main.showLoader(e.firstChild);var d=await FormSubmit.fetchRestApi("events/remove_host",t);return Main.displayMessage(d.message),d.html}return l}function s(e=""){let t,s,a,l,o,d,i,n,r,c,u,m,h,p,y=document.querySelector('[name="add_session"]'),v=y.querySelector("ul.listselectionlist");y.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),null!=v&&(v.innerHTML=""),null==e[0]?(s=e,o=s.dataset.starttime,d=s.dataset.endtime):(s=e[0].node,a=e[e.length-1].node,function(e,t){if(t>1){for(var s=e.closest("tr"),a=e.cellIndex,l=1;l<t;l++)(s=s.nextElementSibling).cells[a].classList.add("hidden");e.rowSpan=t}}(s,document.querySelectorAll(".ui-selected").length),s.matches(".selected")||Main.showLoader(s.firstChild)),y.querySelector('[name="schedule_id"]').value=s.closest(".schedules_div").dataset.id,o=s.closest("tr").dataset.starttime,d=s.dataset.endtime,null==d&&(d=a.closest("tr").dataset.endtime),l=s.closest("table").rows[0].cells[s.cellIndex].dataset.isodate,i=s.dataset.host_id,n=s.dataset.subject,r=s.dataset.location,c=s.dataset.host,u=s.dataset.session_id,null!=s.dataset.reminders&&(t=JSON.parse(s.dataset.reminders),y.querySelectorAll('[name="reminders[]"]').forEach((e=>{t.includes(e.value)?e.checked=!0:e.checked=!1}))),null!=s.dataset.atendees&&(m=JSON.parse(s.dataset.atendees)),null!=s.closest(".day-wrapper-mobile")?s.closest(".day-wrapper-mobile").classList.add("active"):s.classList.add("active"),y.querySelector('[name="date"]').value=l,y.querySelector('[name="starttime"]').value=o,y.querySelector('[name="endtime"]').value=d,y.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),y.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),null!=u&&(y.querySelector('[name="session-id"]').value=u),null!=i&&(y.querySelector('[name="host_id"]').value=i),null!=n&&(y.querySelector('[name="subject"]').value=n),null!=r&&(y.querySelector('[name="location"]').value=r),null!=c&&(y.querySelector("#host").value=c),null!=m&&m.forEach((e=>{h=document.createElement("li"),h.classList.add("listselection"),p='<button type="button" class="small remove-list-selection"><span class=\'remove-list-selection\'>Ã—</span></button>',"object"==typeof e?(p+=`<input type='hidden' name='others[]' value='${e.id}'>`,p+=`<span>${e.name}</span>`):(p+="<span>",p+=`<input type='text' name='others[]' value='${e}' readonly=readonly style='width:${e.length}ch'>`,p+="</span>"),h.innerHTML=p,v.appendChild(h)})),Main.showModal(y)}async function a(e,t){let s={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(s.target=document.fullscreenElement),!!(await Swal.fire(s)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),Main.showLoader(t.firstChild),!0)}async function l(t,s=!1){var a=await FormSubmit.submitForm(t,"events/add_host");a&&(s?(document.querySelectorAll(".active").forEach((e=>{e.classList.remove("active"),e.outerHTML=a.html[e.dataset.isodate]})),Main.displayMessage(a.message),Main.hideModals()):e(a),Main.displayMessage(a.message)),Main.hideModals()}console.log("Mobile-schedule.js loaded"),document.addEventListener("click",(async function(o){let d=o.target;if(null!=d.closest(".add-me-as-host"))d=d.closest(".add-me-as-host"),d.closest(".day-wrapper-mobile").classList.add("active"),async function(t,s){let l=`Please confirm you want to be the host for ${t.closest(".schedules_div").dataset.target} on ${s}`;if(await a(l,t.firstChild)){let s=function(e){let t,s,a,l,o,d=e.closest(".schedules_div").dataset.id,i=e.closest("table");null==i?(l=e.dataset.starttime,o=e.dataset.host_id,a=e.dataset.isodate):(t=i.tHead.rows[0],s=e.closest("td"),l=e.closest("tr").dataset.starttime,o=s.dataset.host,a=t.cells[s.cellIndex].dataset.isodate);var n=new FormData;return n.append("date",a),null!=o?n.append("host_id",o):n.append("host_id",sim.userId),n.append("starttime",l),n.append("schedule_id",d),n}(t);null==t.closest("table")&&Main.showLoader(t);let a=await FormSubmit.fetchRestApi("events/add_host",s);a&&e(a)}}(d.closest(".add-me-as-host"),d.dataset.date);else if(null!=d.closest(".remove-host-mobile")){o.stopPropagation(),d=d.closest(".remove-host-mobile");let e=d.closest(".session-wrapper-mobile"),s=e.closest(".day-wrapper-mobile"),a=e.matches(".meal"),l=await t(d,d.dataset.date);l&&(a?s.outerHTML=l:e.remove())}else if("add_host_mobile"==d.name)o.stopPropagation(),l(d,!0);else if(null!=d.closest(".edit-session-mobile")){d=d.closest(".edit-session-mobile"),d.closest(".day-wrapper-mobile").classList.add("active");let e=d.closest(".session-wrapper-mobile"),a=await async function(e,t,a){let l={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(l.target=document.fullscreenElement);var o=await Swal.fire(l);if(o.isConfirmed)s(e,e.dataset.starttime,e.dataset.endtime),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot";else if(o.isDenied)return o.isDenied}(d,d.dataset.isodate,d.dataset.date);a&&(t(e,d.dataset.date),e.remove())}else"add_host"==d.name||"add_timeslot"==d.name?(o.stopPropagation(),l(d)):"add-session"==d.name?(o.stopPropagation(),s(d)):"add-host"==d.name&&(o.stopPropagation(),Main.showModal(d.closest(".schedules_div").querySelector(".add-host-mobile-wrapper")))})),document.addEventListener("change",(function(e){let t=e.target;if("starttime"==t.name&&"radio"==t.type)"12:00"==t.value?(t.closest("form").querySelector(".lunch.select-wrapper").classList.remove("hidden"),t.closest("form").querySelector(".diner.select-wrapper").classList.add("hidden")):(t.closest("form").querySelector(".diner.select-wrapper").classList.remove("hidden"),t.closest("form").querySelector(".lunch.select-wrapper").classList.add("hidden"));else if(t.matches('.schedules_wrapper [name="add_session"] [name="date"]')){let e=t.closest("form"),s=e.querySelector('[name="schedule_id"').value;e.querySelectorAll(".active").forEach((e=>e.classList.remove("active")));let a=document.querySelector(`.schedules_div[data-id='${s}'] .day-wrapper-mobile[data-isodate='${t.value}']`);null!=a&&a.classList.add("active")}else if(t.matches('.add-host-mobile-wrapper [name="date[]"]')){let e=t.closest("form"),s=e.querySelector('[name="schedule_id"').value;e.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),e.querySelectorAll('[name="date[]"]:checked ').forEach((e=>{let t=document.querySelector(`.schedules_div[data-id='${s}'] .day-wrapper-mobile[data-isodate='${e.value}']`);null!=t&&t.classList.add("active")}))}}))})();
//# sourceMappingURL=mobile-schedule.min.js.map