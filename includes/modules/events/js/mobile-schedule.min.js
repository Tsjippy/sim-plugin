(()=>{"use strict";function e(e){let t=document.querySelector(".active");null!=t&&(t.classList.remove("active"),t.outerHTML=e.html),Main.displayMessage(e.message),Main.hideModals()}async function t(e,t){let s,l,o=e.closest(".schedules_div").dataset.target;if(s=e.classList.contains("orientation")?"Are you sure you want to remove this orientation session":e.classList.contains("admin")?`Please confirm host removal for ${o} on ${t}`:`Please confirm you do not want to be the host for ${o} on ${t} anymore`,l=await a(s,e.firstChild),l){let t=new FormData;t.append("session_id",e.dataset.session_id),Main.showLoader(e.firstChild);var d=await FormSubmit.fetchRestApi("events/remove_host",t);return Main.displayMessage(d.message),d.html}return l}function s(e=""){let t,s,a,l,o,d,i,n,r,c,u,m,h=document.querySelector('[name="add_session"]'),p=h.querySelector("ul.listselectionlist");if(h.querySelectorAll('input:not([type="hidden"], [type="checkbox"], [type="radio"])').forEach((e=>e.value="")),null!=p&&(p.innerHTML=""),null==e[0])t=e,a=t.dataset.starttime,l=t.dataset.endtime,h.querySelector('[name="schedule_id"]').value=e.closest(".schedules_div").dataset.id;else{t=e[0].node;let s=e[e.length-1].node,o=document.querySelectorAll(".ui-selected").length;applyRowSpan(t,o),t.matches(".selected")||Main.showLoader(t.firstChild),a=t.closest("tr").dataset.starttime,l=t.dataset.endtime,null==l&&(l=s.closest("tr").dataset.endtime)}s=t.closest("table").rows[0].cells[t.cellIndex].dataset.isodate,o=t.dataset.host_id,d=t.dataset.subject,i=t.dataset.location,n=t.dataset.host,r=t.dataset.session_id,null!=t.dataset.atendees&&(c=JSON.parse(t.dataset.atendees)),null!=t.closest(".day-wrapper-mobile")?t.closest(".day-wrapper-mobile").classList.add("active"):t.classList.add("active"),h.querySelector('[name="date"]').value=s,h.querySelector('[name="starttime"]').value=a,h.querySelector('[name="endtime"]').value=l,h.querySelector('[name="add_timeslot"]').classList.remove("add_schedule_row"),h.querySelector('[name="add_timeslot"]').classList.add("update_schedule"),null!=r&&(h.querySelector('[name="session-id"]').value=r),null!=o&&(h.querySelector('[name="host_id"]').value=o),null!=d&&(h.querySelector('[name="subject"]').value=d),null!=i&&(h.querySelector('[name="location"]').value=i),null!=n&&(h.querySelector('[name="host"]').value=n),null!=c&&(c.forEach((e=>{u=document.createElement("li"),u.classList.add("listselection"),m='<button type="button" class="small remove-list-selection"><span class=\'remove-list-selection\'>Ã—</span></button>',"object"==typeof e?(m+=`<input type='hidden' name='others_[]' value='${e.id}'>`,m+=`<span>${e.name}</span>`):(m+="<span>",m+=`<input type='text' name='others_[]' value='${e}' readonly=readonly style='width:${e.length}ch'>`,m+="</span>"),u.innerHTML=m})),p.appendChild(u)),Main.showModal(h)}async function a(e,t){let s={title:"Are you sure?",text:e+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes"};return null!=document.fullscreenElement&&(s.target=document.fullscreenElement),!!(await Swal.fire(s)).isConfirmed&&(document.querySelectorAll(".modal:not(.hidden)").forEach((e=>e.classList.add("hidden"))),Main.showLoader(t.firstChild),!0)}async function l(t,s=!1){var a=await FormSubmit.submitForm(t,"events/add_host");a&&(s?(document.querySelectorAll(".active").forEach((e=>{e.classList.remove("active"),e.outerHTML=a.html[e.dataset.isodate]})),Main.displayMessage(a.message),Main.hideModals()):e(a),Main.displayMessage(a.message)),Main.hideModals()}console.log("Mobile-schedule.js loaded"),document.addEventListener("click",(async function(o){let d=o.target;if(null!=d.closest(".add-me-as-host"))d=d.closest(".add-me-as-host"),d.closest(".day-wrapper-mobile").classList.add("active"),async function(t,s){let l=`Please confirm you want to be the host for ${t.closest(".schedules_div").dataset.target} on ${s}`;if(await a(l,t.firstChild)){let s=function(e){let t,s,a,l,o,d=e.closest(".schedules_div").dataset.id,i=e.closest("table");null==i?(l=e.dataset.starttime,o=e.dataset.host_id,a=e.dataset.isodate):(t=i.tHead.rows[0],s=e.closest("td"),l=e.closest("tr").dataset.starttime,o=s.dataset.host,a=t.cells[s.cellIndex].dataset.isodate);var n=new FormData;return n.append("date",a),null!=o?n.append("host_id",o):n.append("host_id",sim.userId),n.append("starttime",l),n.append("schedule_id",d),n}(t);null==t.closest("table")&&Main.showLoader(t);let a=await FormSubmit.fetchRestApi("events/add_host",s);a&&e(a)}}(d.closest(".add-me-as-host"),d.dataset.date);else if(null!=d.closest(".remove-host-mobile")){o.stopPropagation(),d=d.closest(".remove-host-mobile");let e=d.closest(".session-wrapper-mobile"),s=e.closest(".day-wrapper-mobile"),a=e.matches(".meal"),l=await t(d,d.dataset.date);l&&(a?s.outerHTML=l:e.remove())}else if("add_host_mobile"==d.name)o.stopPropagation(),l(d,!0);else if(null!=d.closest(".edit-session-mobile")){d=d.closest(".edit-session-mobile"),d.closest(".day-wrapper-mobile").classList.add("active");let e=d.closest(".session-wrapper-mobile"),a=await async function(e,t,a){let l={title:"What do you want to do?",text:"Do you want to edit or remove this timeslot?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Edit timeslot",denyButtonText:"Remove timeslot"};null!=document.fullscreenElement&&(l.target=document.fullscreenElement);var o=await Swal.fire(l);if(o.isConfirmed)s(e,e.dataset.starttime,e.dataset.endtime),document.querySelector('[name="add_session"]').querySelector('[name="add_timeslot"]').textContent="Update time slot";else if(o.isDenied)return o.isDenied}(d,d.dataset.isodate,d.dataset.date);a&&(t(e,d.dataset.date),e.remove())}else"add_host"==d.name||"add_timeslot"==d.name?(o.stopPropagation(),l(d)):"add-session"==d.name?(o.stopPropagation(),s(d)):"add-host"==d.name&&(o.stopPropagation(),Main.showModal(d.closest(".schedules_div").querySelector(".add-host-mobile-wrapper")))})),document.addEventListener("change",(function(e){let t=e.target;if("starttime"==t.name&&"radio"==t.type)"12:00"==t.value?(t.closest("form").querySelector(".lunch.select-wrapper").classList.remove("hidden"),t.closest("form").querySelector(".diner.select-wrapper").classList.add("hidden")):(t.closest("form").querySelector(".diner.select-wrapper").classList.remove("hidden"),t.closest("form").querySelector(".lunch.select-wrapper").classList.add("hidden"));else if(t.matches('.schedules_wrapper [name="add_session"] [name="date"]')){let e=t.closest("form"),s=e.querySelector('[name="schedule_id"').value;e.querySelectorAll(".active").forEach((e=>e.classList.remove("active")));let a=document.querySelector(`.schedules_div[data-id='${s}'] .day-wrapper-mobile[data-isodate='${t.value}']`);null!=a&&a.classList.add("active")}else if(t.matches('.add-host-mobile-wrapper [name="date[]"]')){let e=t.closest("form"),s=e.querySelector('[name="schedule_id"').value;e.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),e.querySelectorAll('[name="date[]"]:checked ').forEach((e=>{let t=document.querySelector(`.schedules_div[data-id='${s}'] .day-wrapper-mobile[data-isodate='${e.value}']`);null!=t&&t.classList.add("active")}))}}))})();
//# sourceMappingURL=mobile-schedule.min.js.map