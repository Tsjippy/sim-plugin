{"version":3,"file":"logout.min.js","mappings":"mBAWAA,eAAeC,EAAOC,GAClBA,EAAMC,kBACND,EAAME,iBAET,IAAIC,EAASH,EAAMG,OAEnB,GAAgB,UAAbA,EAAOC,IAA0C,UAAxBD,EAAOE,WAAWD,GAAe,CAGtD,GClBPE,SAASC,iBAAiB,kDAAkDC,SAAQC,GAAIA,EAAGC,UAAUC,OAAO,aAC5GL,SAASM,cAAc,QAAQF,UAAUC,OAAO,oBAChDL,SAASM,cAAc,yCAAyCC,aAAe,QDgBrD,oBAAV,KAAsB,CAC3B,IAAIC,EAAU,CACVC,SAAU,aAAaC,IAAIC,YAAY,KACvCC,MAAO,iBACPC,mBAAmB,EACnBC,YAAa,CACTC,KAAM,cAIdC,KAAKC,KAAKT,GAGd,IAAIU,EAAW,IAAIC,SACtBD,EAASE,OAAO,WAAYV,IAAIW,WAE7B,IAAIC,QAAeC,MACfb,IAAIc,SAAS,+BACb,CACIC,OAAQ,OACRC,YAAa,cACbC,KAAMT,IAIVU,QAAiBN,EAAOO,OAEzBP,EAAOQ,IACNC,gBAAgBH,EAAS,WAAW,GAAO,GAG3CI,SAASC,KAAOvB,IAAIc,WAEpBU,QAAQC,MAAMP,GACdG,gBAAgBH,EAAU,WAnDtC5B,SAASoC,iBAAiB,oBAAmB,WAC5CF,QAAQG,IAAI,oBAEZrC,SAASC,iBAAiB,WAAWC,SAAQC,IACtCA,EAAGiC,iBAAiB,QAAS3C,U","sources":["webpack://login/./logout.js","webpack://login/./shared.js"],"sourcesContent":["import {closeMobileMenu} from './shared.js';\r\n\r\n//Logout user\r\ndocument.addEventListener(\"DOMContentLoaded\",function() {\r\n\tconsole.log(\"logout.js loaded\");\r\n\r\n\tdocument.querySelectorAll('.logout').forEach(el=>{\r\n        el.addEventListener('click', logout);\r\n    });\r\n});\r\n\r\nasync function logout(event){\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n\r\n\tvar target = event.target;\r\n    \r\n\tif(target.id == \"logout\" || target.parentNode.id == \"logout\"){\r\n        closeMobileMenu();\r\n\r\n        if(typeof(Swal) != 'undefined'){\r\n            var options = {\r\n                iconHtml: '<img src=\"'+sim.loading_gif+'\">',\r\n                title: 'Logging out...',\r\n                showConfirmButton: false,\r\n                customClass: {\r\n                    icon: 'no-border'\r\n                }\r\n            };\r\n            \r\n            Swal.fire(options);\r\n        }\r\n\r\n        var formdata\t= new FormData();\r\n\t    formdata.append('_wpnonce', sim.restnonce);\r\n\r\n        var result = await fetch(\r\n            sim.base_url+'/wp-json/sim/v1/login/logout',\r\n            {\r\n                method: 'POST',\r\n                credentials: 'same-origin',\r\n                body: formdata\r\n            }\r\n        );\r\n    \r\n        var response\t= await result.json();\r\n\r\n        if(result.ok){\r\n            display_message(response,'success', false, true);\r\n\r\n            //redirect to homepage\r\n            location.href\t= sim.base_url;\r\n        }else{\r\n            console.error(response);\r\n            display_message(response, 'error');\r\n        };\r\n    }\r\n}\r\n","export function closeMobileMenu(){\r\n\t//close mobile menu\r\n\tdocument.querySelectorAll('#site-navigation, #mobile-menu-control-wrapper').forEach(el=>el.classList.remove('toggled'));\r\n\tdocument.querySelector('body').classList.remove('mobile-menu-open');\r\n\tdocument.querySelector(\"#mobile-menu-control-wrapper > button\").ariaExpanded = 'false';\r\n}\r\n\r\n// get response from rest api server\r\nexport async function fetchRestApi(url, formdata){\r\n\tformdata.append('_wpnonce', sim.restnonce);\r\n\r\n\tvar result = await fetch(\r\n\t\tsim.base_url+'/wp-json/sim/v1/login/'+url,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t\tbody: formdata\r\n\t\t}\r\n\t);\r\n\r\n\tvar response\t= await result.json();\r\n\r\n\tif(result.ok){\r\n\t\treturn response;\r\n\t}else{\r\n\t\tconsole.error(response);\r\n\t\tdisplay_message(response.message, 'error');\r\n\t\treturn false;\r\n\t};\r\n}\r\n\r\n// Predefined fetch function\r\nexport const fetchEndpoint = (data, url, header) => {\r\n\treturn fetch(\r\n\t\turl,\r\n\t\t{\r\n\t\t  method: 'POST',\r\n\t\t  credentials: 'same-origin',\r\n\t\t  redirect: 'error',\r\n\t\t  headers: {\r\n\t\t\t'Content-Type': 'application/json',\r\n\t\t\t'Accept': 'application/json',\r\n\t\t\t...header\r\n\t\t  },\r\n\t\t  body: JSON.stringify(data),\r\n\t\t}\r\n\t);\r\n} \r\n\r\n// Decodes a Base64Url string\r\nconst base64UrlDecode = (input) => {\r\ninput = input\r\n\t.replace(/-/g, '+')\r\n\t.replace(/_/g, '/');\r\n\r\nconst pad = input.length % 4;\r\nif (pad) {\r\n\tif (pad === 1) {\r\n\tthrow new Error('InvalidLengthError: Input base64url string is the wrong length to determine padding');\r\n\t}\r\n\tinput += new Array(5-pad).join('=');\r\n}\r\n\r\nreturn window.atob(input);\r\n};\r\n\r\n// Converts an array of bytes into a Base64Url string\r\nconst arrayToBase64String = (a) => btoa(String.fromCharCode(...a));\r\n\r\n// Prepares the public key options object returned by the Webauthn Framework\r\nexport const preparePublicKeyOptions = publicKey => {\r\n//Convert challenge from Base64Url string to Uint8Array\r\npublicKey.challenge = Uint8Array.from(\r\n\tbase64UrlDecode(publicKey.challenge),\r\n\tc => c.charCodeAt(0)\r\n);\r\n\r\n//Convert the user ID from Base64 string to Uint8Array\r\nif (publicKey.user !== undefined) {\r\n\tpublicKey.user = {\r\n\t...publicKey.user,\r\n\tid: Uint8Array.from(\r\n\t\twindow.atob(publicKey.user.id),\r\n\t\tc => c.charCodeAt(0)\r\n\t),\r\n\t};\r\n}\r\n\r\n//If excludeCredentials is defined, we convert all IDs to Uint8Array\r\nif (publicKey.excludeCredentials !== undefined) {\r\n\tpublicKey.excludeCredentials = publicKey.excludeCredentials.map(\r\n\t\tdata => {\r\n\t\treturn {\r\n\t\t\t...data,\r\n\t\t\tid: Uint8Array.from(\r\n\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t),\r\n\t\t};\r\n\t\t}\r\n\t);\r\n}\r\n\r\nif (publicKey.allowCredentials !== undefined) {\r\n\tpublicKey.allowCredentials = publicKey.allowCredentials.map(\r\n\t\tdata => {\r\n\t\treturn {\r\n\t\t\t...data,\r\n\t\t\tid: Uint8Array.from(\r\n\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t),\r\n\t\t};\r\n\t\t}\r\n\t);\r\n}\r\n\r\nreturn publicKey;\r\n};\r\n\r\n// Prepares the public key credentials object returned by the authenticator\r\nexport const preparePublicKeyCredentials = data => {\r\nconst publicKeyCredential = {\r\n\tid: data.id,\r\n\ttype: data.type,\r\n\trawId: arrayToBase64String(new Uint8Array(data.rawId)),\r\n\tresponse: {\r\n\tclientDataJSON: arrayToBase64String(\r\n\t\tnew Uint8Array(data.response.clientDataJSON)\r\n\t),\r\n\t},\r\n};\r\n\r\nif (data.response.attestationObject !== undefined) {\r\n\tpublicKeyCredential.response.attestationObject = arrayToBase64String(\r\n\t\tnew Uint8Array(data.response.attestationObject)\r\n\t);\r\n}\r\n\r\nif (data.response.authenticatorData !== undefined) {\r\n\tpublicKeyCredential.response.authenticatorData = arrayToBase64String(\r\n\t\tnew Uint8Array(data.response.authenticatorData)\r\n\t);\r\n}\r\n\r\nif (data.response.signature !== undefined) {\r\n\tpublicKeyCredential.response.signature = arrayToBase64String(\r\n\t\tnew Uint8Array(data.response.signature)\r\n\t);\r\n}\r\n\r\nif (data.response.userHandle !== undefined) {\r\n\tpublicKeyCredential.response.userHandle = arrayToBase64String(\r\n\t\tnew Uint8Array(data.response.userHandle)\r\n\t);\r\n}\r\n\r\nreturn publicKeyCredential;\r\n};\r\n  "],"names":["async","logout","event","stopPropagation","preventDefault","target","id","parentNode","document","querySelectorAll","forEach","el","classList","remove","querySelector","ariaExpanded","options","iconHtml","sim","loading_gif","title","showConfirmButton","customClass","icon","Swal","fire","formdata","FormData","append","restnonce","result","fetch","base_url","method","credentials","body","response","json","ok","display_message","location","href","console","error","addEventListener","log"],"sourceRoot":""}