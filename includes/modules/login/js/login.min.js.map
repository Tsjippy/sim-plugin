{"version":3,"file":"login.min.js","mappings":"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","sources":["webpack://login/./shared.js","webpack://login/./login.js"],"sourcesContent":["export function closeMobileMenu(){\r\n\t//close mobile menu\r\n\tdocument.querySelectorAll('#site-navigation, #mobile-menu-control-wrapper').forEach(el=>el.classList.remove('toggled'));\r\n\tdocument.querySelector('body').classList.remove('mobile-menu-open');\r\n\tdocument.querySelector(\"#mobile-menu-control-wrapper > button\").ariaExpanded = 'false';\r\n}\r\n\r\n// get response from rest api server\r\nexport async function fetchRestApi(url, formData, showErrors=true){\r\n\tlet response;\r\n\tformData.append('_wpnonce', sim.restNonce);\r\n\r\n\tlet result = await fetch(\r\n\t\t`${sim.baseUrl}/wp-json${sim.restApiPrefix}/login/${url}`,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t\tbody: formData\r\n\t\t}\r\n\t);\r\n\r\n\ttry{\r\n\t\tresponse\t= await result.json();\r\n\t}catch (error){\r\n\t\tconsole.error(result);\r\n\t\tconsole.error(error);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(result.ok){\r\n\t\treturn response;\r\n\t}else if(response.code == 'rest_cookie_invalid_nonce'){\r\n\t\tMain.displayMessage('Please refresh the page and try again!', 'error');\r\n\t\tconsole.error(response);\r\n\t\tconsole.error(`/login/${url}`);\r\n\t\treturn false;\r\n\t}else{\r\n\t\tconsole.error(response);\r\n\t\tif(showErrors){\r\n\t\t\tMain.displayMessage(response.message, 'error');\r\n\t\t}\r\n\t\tconsole.error(`/login/${url}`);\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// Decodes a Base64Url string\r\nconst base64UrlDecode = (input) => {\r\ninput = input\r\n\t.replace(/-/g, '+')\r\n\t.replace(/_/g, '/');\r\n\r\nconst pad = input.length % 4;\r\nif (pad) {\r\n\tif (pad === 1) {\r\n\tthrow new Error('InvalidLengthError: Input base64url string is the wrong length to determine padding');\r\n\t}\r\n\tinput += new Array(5-pad).join('=');\r\n}\r\n\r\nreturn window.atob(input);\r\n};\r\n\r\n// Converts an array of bytes into a Base64Url string\r\nconst arrayToBase64String = (a) => btoa(String.fromCharCode(...a));\r\n\r\n// Prepares the public key options object returned by the Webauthn Framework\r\nexport const preparePublicKeyOptions = publicKey => {\r\n\t//Convert challenge from Base64Url string to Uint8Array\r\n\tpublicKey.challenge = Uint8Array.from(\r\n\t\tbase64UrlDecode(publicKey.challenge),\r\n\t\tc => c.charCodeAt(0)\r\n\t);\r\n\r\n\t//Convert the user ID from Base64 string to Uint8Array\r\n\tif (publicKey.user !== undefined) {\r\n\t\tpublicKey.user = {\r\n\t\t...publicKey.user,\r\n\t\tid: Uint8Array.from(\r\n\t\t\twindow.atob(publicKey.user.id),\r\n\t\t\tc => c.charCodeAt(0)\r\n\t\t),\r\n\t\t};\r\n\t}\r\n\r\n\t//If excludeCredentials is defined, we convert all IDs to Uint8Array\r\n\tif (publicKey.excludeCredentials !== undefined) {\r\n\t\tpublicKey.excludeCredentials = publicKey.excludeCredentials.map(\r\n\t\t\tdata => {\r\n\t\t\treturn {\r\n\t\t\t\t...data,\r\n\t\t\t\tid: Uint8Array.from(\r\n\t\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tif (publicKey.allowCredentials !== undefined) {\r\n\t\tpublicKey.allowCredentials = publicKey.allowCredentials.map(\r\n\t\t\tdata => {\r\n\t\t\treturn {\r\n\t\t\t\t...data,\r\n\t\t\t\tid: Uint8Array.from(\r\n\t\t\t\t\tbase64UrlDecode(data.id),\r\n\t\t\t\t\tc => c.charCodeAt(0)\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\treturn publicKey;\r\n};\r\n\r\n// Prepares the public key credentials object returned by the authenticator\r\nexport const preparePublicKeyCredentials = data => {\r\n\tconst publicKeyCredential = {\r\n\t\tid: data.id,\r\n\t\ttype: data.type,\r\n\t\trawId: arrayToBase64String(new Uint8Array(data.rawId)),\r\n\t\tresponse: {\r\n\t\tclientDataJSON: arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.clientDataJSON)\r\n\t\t),\r\n\t\t},\r\n\t};\r\n\r\n\tif (data.response.attestationObject !== undefined) {\r\n\t\tpublicKeyCredential.response.attestationObject = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.attestationObject)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.authenticatorData !== undefined) {\r\n\t\tpublicKeyCredential.response.authenticatorData = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.authenticatorData)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.signature !== undefined) {\r\n\t\tpublicKeyCredential.response.signature = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.signature)\r\n\t\t);\r\n\t}\r\n\r\n\tif (data.response.userHandle !== undefined) {\r\n\t\tpublicKeyCredential.response.userHandle = arrayToBase64String(\r\n\t\t\tnew Uint8Array(data.response.userHandle)\r\n\t\t);\r\n\t}\r\n\r\n\treturn publicKeyCredential;\r\n};","import {\r\n\tcloseMobileMenu,\r\n    preparePublicKeyCredentials,\r\n    preparePublicKeyOptions,\r\n\tfetchRestApi\r\n} from './shared.js';\r\n\r\nwindow.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(\r\n\tresult => {\r\n\t  if (!result) {\r\n\t\tconsole.log(\"No platform authenticator found. If your OS does not come with one, try using devtools to set one up.\");\r\n\t  }\r\n\t}\r\n);\r\n\r\n//Add an event listener to the login or register button\r\nconsole.log(\"Login.js loaded\");\r\n\r\n//show loader\r\nasync function requestLogin(){\r\n\t//hide everything\r\n\tdocument.querySelectorAll('.authenticator_wrapper:not(.hidden)').forEach(el=>{\r\n\t\tel.classList.add('hidden');\r\n\t\tel.classList.add('current-method');\r\n\t});\r\n\t\r\n\t//show login message\r\n\tdocument.getElementById('logging_in_wrapper').classList.remove('hidden');\r\n\r\n\tvar form \t\t= document.getElementById('loginform');\r\n\tvar formData\t= new FormData(form);\r\n\tform.querySelectorAll('.hidden [required]').forEach(el=>{el.required = false});\r\n\tvar validity\t= form.reportValidity();\r\n\t//if not valid return\r\n\tif(!validity){\r\n\t\treturn;\r\n\t}\r\n\r\n\tawait Main.waitForInternet();\r\n\r\n\tvar response\t= await fetchRestApi('request_login', formData);\r\n\r\n\tif(response){\r\n\t\tdocument.querySelector('#logging_in_wrapper .status_message').textContent='Succesfully logged in, redirecting...';\r\n\r\n\t\tif(!response.startsWith('http')){\r\n\t\t\tlocation.reload();\r\n\t\t}else{\r\n\t\t\tlocation.href = response;\r\n\t\t}\r\n\t}else{\r\n\t\tdocument.getElementById('logging_in_wrapper').classList.add('hidden');\r\n\r\n\t\tdocument.querySelector('.current-method').classList.remove('hidden');\r\n\t}\r\n}\r\n\r\n// Send request to start webauthn\r\nasync function verifyWebauthn(methods){\t\r\n\t//show webauthn messages\r\n\tdocument.getElementById('webauthn_wrapper').classList.remove('hidden');\r\n\r\n\tvar username\t= document.getElementById('username').value;\r\n\r\n\ttry{\r\n\t\tvar formData\t\t\t= new FormData();\r\n\t\tformData.append('username', username);\r\n\r\n\t\tvar response\t\t\t= await fetchRestApi('auth_start', formData);\r\n\t\tif(!response){\r\n\t\t\tthrow new Error('auth_start failed');\r\n\t\t}\r\n\r\n\t\tvar publicKey\t\t\t= preparePublicKeyOptions(response);\r\n\r\n\t\t// Update message\r\n\t\tdocument.querySelector('#webauthn_wrapper .status_message').textContent\t= 'Waiting for biometric';\r\n\r\n\t\t// Verify on device\r\n\t\tvar credentials\t\t\t= await navigator.credentials.get({\tpublicKey });\r\n\r\n\t\t// Update message\r\n\t\tdocument.querySelector('#webauthn_wrapper .status_message').textContent\t= 'Verifying...';\r\n\r\n\t\t// Verify on the server\r\n\t\tconst publicKeyCredential \t= preparePublicKeyCredentials(credentials);\r\n\t\tformData\t\t\t\t\t= new FormData();\r\n\t\tformData.append('publicKeyCredential', JSON.stringify(publicKeyCredential));\r\n\t\tresponse\t\t\t\t\t= await fetchRestApi('auth_finish', formData);\r\n\t\tif(!response){\r\n\t\t\tthrow new Error('auth_finish failed');\r\n\t\t}\r\n\r\n\t\t//authentication success\r\n\t\trequestLogin();\r\n\t}catch (error){\r\n\t\tif(document.getElementById('logging_in_wrapper').classList.add('hidden'));\r\n\r\n\t\t//authentication failed\r\n\t\tdocument.querySelector('#webauthn_wrapper').classList.add('hidden');\r\n\r\n\t\tif(methods.length == 1){\r\n\t\t\tshowMessage('Authentication failed, please setup an additional login factor.');\r\n\t\t\trequestLogin();\r\n\t\t}else{\r\n\t\t\tvar message;\r\n\t\t\tif(error['message'] == \"No authenticator available\"){\r\n\t\t\t\tmessage = \"No biometric login for this device found. <br>Give verification code.\";\r\n\t\t\t}else{\r\n\t\t\t\tmessage = 'Web authentication failed, please give verification code.';\r\n\t\t\t\tmessage += '<button type=\"button\" class=\"button small\" id=\"retry_webauthn\" style=\"float:right;margin-top:-20px;\">Retry</button>';\r\n\t\t\t\tconsole.error('Authentication failure: '+error['message']);\r\n\t\t\t}\r\n\t\t\tshowMessage(message);\r\n\r\n\t\t\t//Show other 2fa fields\r\n\t\t\tshowTwoFaFields(methods);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Request email code for 2fa login\r\nasync function requestEmailCode(){\r\n\t//add new one\r\n\tvar loader\t\t\t\t= \"<img id='loader' src='\"+sim.loadingGif+\"' style='height:30px;margin-top:-6px;float:right;'>\";\r\n\tshowMessage(`Sending e-mail... ${loader}`);\r\n\r\n\tvar username\t= document.getElementById('username').value;\r\n\tvar formData\t= new FormData();\r\n\tformData.append('username',username);\r\n\r\n\tvar response\t= await fetchRestApi('request_email_code', formData, false);\r\n\t\r\n\tif(response){\r\n\t\tshowMessage(response);\r\n\t}else{\r\n\t\tshowMessage(`Sending e-mail failed`);\r\n\t}\r\n}\r\n\r\n// Check if a valid username and password is submitted\r\nasync function verifyCreds(){\r\n\tvar username\t= document.getElementById('username').value;\r\n\tvar password\t= document.getElementById('password').value;\r\n\r\n\t// Check if the fields are filled\r\n\tif(username != '' && password != ''){\r\n\t\tdocument.querySelector('#check_cred_wrapper .loadergif').classList.remove('hidden');\r\n\t}else{\r\n\t\tshowMessage('Please give an username and password!');\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Make sure we have a internet connection\r\n\tawait Main.waitForInternet();\r\n\r\n\tvar formData\t= new FormData();\r\n\tformData.append('username',username);\r\n\tformData.append('password',password);\r\n\r\n\tvar response\t= await fetchRestApi('check_cred', formData);\r\n\r\n \tif(response){\r\n\t\tif(response == 'false') {\r\n\t\t\tshowMessage('Invalid login, try again');\r\n\r\n\t\t\t// Password reset form\r\n\t\t\tdocument.getElementById('captcha-form').classList.remove('hidden');\r\n\t\t\t\r\n\t\t\t// hide loader\r\n\t\t\tdocument.querySelector('#check_cred_wrapper .loadergif').classList.add('hidden');\r\n\t\t} else {\r\n\t\t\taddMethods(response);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//request password reset e-mail\r\nasync function resetPassword(target){\r\n\tvar username\t= document.getElementById('username').value;\r\n\r\n\tif(username == ''){\r\n\t\tMain.displayMessage('Specify your username first','error');\r\n\t\treturn;\r\n\t}\r\n\tlet captchaForm\t= document.getElementById('captcha-form');\r\n\t//check if captcha visible\r\n\tif(captchaForm.classList.contains('hidden')){\r\n\t\tif(captcha.querySelector('iframe') == null){\r\n\t\t\tMain.displayMessage('Captcha failed to load, please refresh the page','error');\r\n\t\t}\r\n\r\n\t\t//show captcha\r\n\t\tcaptchaForm.classList.remove('hidden');\r\n\r\n\t\t//change button text\r\n\t\ttarget.text\t= 'Send password reset request';\r\n\t}else{\r\n\t\ttarget.classList.add('hidden');\r\n\t\tvar loader = Main.showLoader(target, false, 'Sending e-mail...   ');\r\n\r\n\t\tvar formData\t= new FormData();\r\n\t\tformData.append('username',username);\r\n\t\t\r\n\t\tvar response\t= await fetchRestApi('request_pwd_reset', formData);\r\n\r\n\t\tif (response) {\r\n\t\t\tMain.displayMessage(response,'success');\r\n\t\t}\r\n\r\n\t\tloader.remove();\r\n\t\ttarget.classList.remove('hidden');\r\n\t}\r\n}\r\n\r\n// request a new user account\r\nasync function requestAccount(target){\r\n\tvar form \t\t= target.closest('form');\r\n\r\n\t// Show loader\r\n\tform.querySelector('.loadergif').classList.remove('hidden');\r\n\r\n\tvar formData\t= new FormData(form);\r\n\r\n\tvar response\t= await fetchRestApi('request_user_account', formData);\r\n\t\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n\r\n\t// reset form \r\n\tform.reset();\r\n\r\n\t// Hide loader\r\n\tform.querySelector('.loadergif').classList.add('hidden');\r\n}\r\n\r\nfunction showMessage(message){\r\n\tdocument.querySelector(\"#login_wrapper .message\").innerHTML= DOMPurify.sanitize(message);\r\n}\r\n\r\nlet webauthnSupported\t= false;\r\nlet modal;\r\nlet credParsing\t\t\t= false;\r\nlet abortController;\r\n\r\nasync function processCredential(credential){\r\n\tif(credParsing){\r\n\t\treturn;\r\n\t}\r\n\tif (credential) {\r\n\t\tcredParsing\t= true;\r\n\t\tlet username = String.fromCodePoint(...new Uint8Array(credential.response.userHandle));\r\n\r\n\t\tdocument.querySelector('#webauthn_wrapper .status_message').textContent='Verifying credentials...';\r\n\r\n\t\t// Verify on the server\r\n\t\tconst publicKeyCredential \t= preparePublicKeyCredentials(credential);\r\n\t\tlet formData\t\t\t\t= new FormData();\r\n\t\tformData.append('publicKeyCredential', JSON.stringify(publicKeyCredential));\r\n\t\tlet response\t\t\t\t= await fetchRestApi('auth_finish', formData, false);\r\n\r\n\t\tif(response){\r\n\t\t\tshowMessage('Passkey login succesfull');\r\n\t\t}else{\r\n\t\t\tdocument.querySelector('#webauthn_wrapper .status_message').textContent='Please authenticate';\r\n\r\n\t\t\tdocument.getElementById('usercred_wrapper').classList.remove('hidden');\r\n\t\t\tdocument.getElementById('webauthn_wrapper').classList.add('hidden');\r\n\r\n\t\t\tshowMessage('Passkey login failed, try using your username and password');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//authentication success\r\n\t\trequestLogin();\r\n\r\n\t} else {\r\n\t\tconsole.log(\"Credential returned null\");\r\n\r\n\t\tdocument.getElementById('usercred_wrapper').classList.remove('hidden');\r\n\t\tdocument.getElementById('webauthn_wrapper').classList.add('hidden');\r\n\r\n\t\tshowMessage('Passkey login failed');\r\n\t}\r\n}\r\n\r\nlet startConditionalRequest = async (mediation) => {\r\n\tif (window.PublicKeyCredential && PublicKeyCredential.isConditionalMediationAvailable) {\r\n\t\tconsole.log(\"Conditional UI is understood by the browser\");\r\n\t\tif (!await window.PublicKeyCredential.isConditionalMediationAvailable()) {\r\n\t\t\tconsole.log(\"Conditional UI is understood by your browser but not available\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t} else {\r\n\t\tif (!navigator.credentials.conditionalMediationSupported) {\r\n\t\t\tconsole.log(\"Your browser does not implement Conditional UI (are you running the right chrome/safari version with the right flags?)\");\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"This browser understand the old version of Conditional UI feature detection\");\r\n\t\t}\r\n\t}\r\n\r\n\tif(abortController != undefined){\r\n\t\tabortController.abort('aborted');\r\n\t}\r\n\t\r\n\tabortController\t= new AbortController();\r\n\t\t\r\n\tabortController.onAbort\t= function(ev){\r\n\t\t//console.log(ev);\r\n\t}\r\n\tabortController.signal.onAbort\t= function(ev){\r\n\t\t//console.log(ev);\r\n\t}\r\n\r\n\tif(mediation != 'conditional'){\r\n\t\tdocument.getElementById('usercred_wrapper').classList.add('hidden');\r\n\t\tdocument.getElementById('webauthn_wrapper').classList.remove('hidden');\r\n\r\n\t\tshowMessage('Performing passkey login');\r\n\t}\r\n\r\n\ttry {\r\n\t\tlet formData\t\t\t= new FormData();\r\n\t\tformData.append('username', '');\r\n\r\n\t\tlet response\t\t\t= await fetchRestApi('auth_start', formData);\r\n\t\tif(!response){\r\n\t\t\tthrow new Error('auth_start failed');\r\n\t\t}\r\n\r\n\t\tlet publicKey\t\t\t= preparePublicKeyOptions(response);\r\n\r\n\t\tlet credential = await navigator.credentials.get({\r\n\t\t\tsignal: abortController.signal,\r\n\t\t\tpublicKey: {\r\n\t\t\t\tchallenge: publicKey.challenge,\r\n\t\t\t\thints: \"client-device\"\r\n\t\t\t},\r\n\t\t\t//mediation: 'silent',\r\n\t\t\t//mediation: 'conditional',\r\n\t\t\t//mediation: 'required',\r\n\t\t\tmediation: mediation\r\n\t\t});\r\n\r\n\t\tif(mediation == 'conditional'){\t\r\n\t\t\tdocument.getElementById('usercred_wrapper').classList.add('hidden');\r\n\t\t\tdocument.getElementById('webauthn_wrapper').classList.remove('hidden');\r\n\t\r\n\t\t\tshowMessage('Performing passkey login');\r\n\t\t}\r\n\t\t\r\n\t\tprocessCredential(credential);\r\n\r\n\t} catch (error) {\r\n\t\tif (error == \"aborted\") {\r\n\t\t\tconsole.log(\"request aborted\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(error.message.includes('A request is already pending.')){\r\n\t\t\tstartConditionalRequest(mediation);\r\n\t\t}\r\n\r\n\t\t// only do when login modal is open\r\n\t\tif(document.getElementById('usercred_wrapper').closest('.hidden') == null){\r\n\t\t\tdocument.getElementById('usercred_wrapper').classList.remove('hidden');\r\n\t\t\tdocument.getElementById('webauthn_wrapper').classList.add('hidden');\r\n\r\n\t\t\tshowMessage('Passkey login failed, try using your username and password');\r\n\t\t}\r\n\r\n\t\tconsole.log(error);\r\n\t}\r\n}\r\n\r\nfunction checkWebauthnAvailable(){\r\n\tif (window.PublicKeyCredential) {\r\n\t\tPublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((available) => {\r\n\t\t\tif (available) {\r\n\t\t\t\tconsole.log(\"Supported.\");\r\n\t\t\t\twebauthnSupported = true;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"WebAuthn supported, Platform Authenticator not supported.\");\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch((err) => {\r\n\t\t\tconsole.error(\"Something went wrong.\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t} else {\r\n\t\tconsole.log(\"Not supported.\");\r\n\t}\r\n}\r\n\r\n// Display the form for the 2fa email or authenticator code\r\nfunction showTwoFaFields(methods){\r\n\tif(methods.includes('email')){\r\n\t\trequestEmailCode();\r\n\t}\r\n\r\n\t//show 2fa fields\r\n\tfor(const element of methods){\r\n\t\tif(element == 'webauthn'){\r\n\t\t\t//do not show webauthn\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvar wrapper\t= document.getElementById(element+'_wrapper');\r\n\t\tif(wrapper != null){\r\n\t\t\twrapper.classList.remove('hidden');\r\n\t\t\twrapper.querySelectorAll('input').forEach(el=>window.setTimeout(() => el.focus(), 0));\r\n\t\t}\r\n\t}\r\n\r\n\t//enable login button\r\n\tdocument.querySelector(\"#login_button\").disabled\t\t\t= '';\r\n\t//show login button\r\n\tdocument.querySelector('#submit_login_wrapper').classList.remove('hidden');\r\n}\r\n\r\nfunction addMethods(result){\r\n\tdocument.querySelector('#check_cred_wrapper .loadergif').classList.add('hidden');\r\n\t\r\n\tif(typeof(result) == 'string' && result){\r\n\t\t//hide login form\r\n\t\tdocument.querySelectorAll(\"#usercred_wrapper, #captcha-form\").forEach(el=>el.classList.add('hidden'));\r\n\r\n\t\tdocument.getElementById('logging_in_wrapper').classList.remove('hidden');\r\n\r\n\t\tif(location.href != result){\r\n\t\t\t//redirect to the returned webpage\r\n\t\t\tlocation.href\t= result;\r\n\t\t}else{\r\n\t\t\t//close login modal\r\n\t\t\tMain.hideModals();\r\n\t\t}\r\n\t}else if(!result){\r\n\t\t//incorrect creds add message, but only once\r\n\t\tshowMessage('Invalid username or password!');\r\n\t}else if(typeof(result) == 'object'){\r\n\t\t//hide cred fields\r\n\t\tdocument.querySelectorAll(\"#usercred_wrapper, #captcha-form\").forEach(el=>el.classList.add('hidden'));\r\n\r\n\t\t//hide messsages\r\n\t\tshowMessage('');\r\n\r\n\t\tif(result.find(element => element == 'webauthn')){\r\n\t\t\tif(webauthnSupported){\r\n\t\t\t\t//correct creds and webauthn enabled\r\n\t\t\t\tverifyWebauthn(result);\r\n\t\t\t}else if(result.length == 1){\r\n\t\t\t\tshowMessage('You do not have a valid second login method for this device, please add one.');\r\n\t\t\t\trequestLogin();\r\n\t\t\t}else{\r\n\t\t\t\tshowTwoFaFields(result);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//correct creds and 2fa enabled\r\n\t\t\tshowTwoFaFields(result);\r\n\t\t}\r\n\t}else{\r\n\t\t//something went wrong, reload the page\r\n\t\tlocation.reload();\r\n\t}\r\n}\r\n\r\ndocument.addEventListener('keypress', function (e) {\r\n    if (e.key === 'Enter' && document.querySelector(\"#usercred_wrapper\") != null){\r\n\t\tif(!document.querySelector(\"#usercred_wrapper\").classList.contains('hidden')) {\r\n\t\t\tverifyCreds();\r\n\t\t}else if(!document.querySelector(\"#submit_login_wrapper\").classList.contains('hidden')){\r\n\t\t\trequestLogin();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport function togglePassworView(ev){\r\n\tvar target\t= ev.target;\r\n\r\n\tif(ev.target.tagName == 'IMG'){\r\n\t\ttarget\t= ev.target.parentNode;\r\n\t}\r\n\r\n\tif(target.dataset.toggle == '0'){\r\n\t\ttarget.title\t\t\t\t\t\t\t\t= 'Hide password';\r\n\t\ttarget.dataset.toggle\t\t\t\t\t\t= '1';\r\n\t\ttarget.innerHTML\t\t\t\t\t\t\t= target.innerHTML.replace('invisible', 'visible');\r\n\t\ttarget.closest('.password').querySelector('input[type=\"password\"]').type\t= 'text';\r\n\t}else{\r\n\t\ttarget.title\t\t\t\t\t\t\t\t= 'Show password';\r\n\t\ttarget.dataset.toggle\t\t\t\t\t\t= '0';\r\n\t\ttarget.innerHTML\t\t\t\t\t\t\t= target.innerHTML.replace('visible', 'invisible');\r\n\t\ttarget.closest('.password').querySelector('input[type=\"text\"]').type\t= 'password';\r\n\t}\r\n}\r\n\r\n// Show the modal with the login form\r\nfunction openLoginModal(){\r\n\t// Allready load the captcha for password reset so it is available when we need it\r\n\twaitForCaptcha();\r\n\r\n\t// Make sure the menu is closed\r\n\tcloseMobileMenu();\r\n\r\n\t//prevent page scrolling\r\n\tdocument.querySelector('body').style.overflowY = 'hidden';\r\n\r\n\tmodal\t= document.getElementById('login_modal');\r\n\r\n\t//reset form\r\n\tmodal.querySelectorAll('form > div:not(.hidden)').forEach(el=>el.classList.add('hidden'));\r\n\tmodal.querySelector('#usercred_wrapper').classList.remove('hidden');\r\n\r\n\tmodal.classList.remove('hidden');\r\n\r\n\twindow.setTimeout(() => modal.querySelector('#username').focus(), 0);\r\n}\r\n\r\nvar observer = new MutationObserver(function(mutations) {\r\n\tmutations.forEach(function(mutation) {\r\n\t\tif (mutation.attributeName === \"data-hcaptcha-response\" && document.querySelector('.h-captcha iframe').dataset.hcaptchaResponse.length > 1000) {\r\n\t\t\tresetPassword(document.querySelector('#captcha-form>a'));\r\n\t\t}\r\n\t});\r\n});\r\n\r\nfunction waitForCaptcha(){\r\n\t// Do not try to load if there is not even a h-captcha element\r\n\tif(document.querySelector('.h-captcha') == null) return;\r\n\r\n\t// Wait till the iframe is loaded before we attach the observer\r\n\tsetTimeout(function() {\r\n\t\tvar iframe\t= document.querySelector('.h-captcha iframe');\r\n\t\tif(iframe\t== null){\r\n\t\t\twaitForCaptcha();\r\n\t\t}else{\r\n\t\t\tobserver.observe(iframe, {\r\n\t\t\t\tattributes: true\r\n\t\t\t});\r\n\t\t}\r\n\t}, 1000);\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n\t//check if the current browser supports webauthn\r\n\tcheckWebauthnAvailable();\r\n});\r\n\r\ndocument.addEventListener(\"click\", function(event){\r\n\tvar target = event.target;\r\n\r\n\tif(target.matches('.login')){\r\n\t\t// Show modal with login form\r\n\t\topenLoginModal();\r\n\t}else if(target.id == 'check_cred'){\r\n\t\t// Check if a valid username and password is submitted\r\n\t\tverifyCreds();\r\n\t}else if(target.id == \"login_button\"){\r\n\t\t// Submit the login form when averything is ok\r\n\t\trequestLogin();\r\n\t}else if(target.closest('.toggle_pwd_view') != null){\r\n\t\ttogglePassworView(event);\r\n\t}else if(target.id == \"lost_pwd_link\"){\r\n\t\tresetPassword(target);\r\n\t}else if(target.id == 'retry_webauthn'){\r\n\t\tshowMessage('');\r\n\t\tverifyWebauthn([]);\r\n\t}else if(target.name == 'request_account'){\r\n\t\trequestAccount(target);\r\n\t}else if(target.closest(`[name='fingerprintpicture']`) != null){\r\n\t\tstartConditionalRequest('silent');\r\n\t}\r\n});\r\n\r\n//prevent zoom in on login form on a iphone\r\nconst addMaximumScaleToMetaViewport = () => {\r\n\tconst el = document.querySelector('meta[name=viewport]');\r\n  \r\n\tif (el !== null) {\r\n\t  let content = el.getAttribute('content');\r\n\t  let re = /maximum\\-scale=[0-9\\.]+/g;\r\n  \r\n\t  if (re.test(content)) {\r\n\t\t  content = content.replace(re, 'maximum-scale=1.0');\r\n\t  } else {\r\n\t\t  content = [content, 'maximum-scale=1.0'].join(', ')\r\n\t  }\r\n  \r\n\t  el.setAttribute('content', content);\r\n\t}\r\n};\r\n\r\nconst checkIsIOS = () =>/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\r\n\r\nif (checkIsIOS()) {\r\n\taddMaximumScaleToMetaViewport();\r\n}\r\n\r\ndocument.querySelectorAll('.login').forEach(el=>{\r\n\tel.classList.remove('hidden');\r\n});\r\n\r\nstartConditionalRequest('conditional');\r\n"],"names":["async","fetchRestApi","url","formData","showErrors","response","append","sim","restNonce","result","fetch","baseUrl","restApiPrefix","method","credentials","body","json","error","console","ok","code","Main","displayMessage","message","base64UrlDecode","input","pad","replace","length","Error","Array","join","window","atob","arrayToBase64String","a","btoa","String","fromCharCode","preparePublicKeyOptions","publicKey","challenge","Uint8Array","from","c","charCodeAt","undefined","user","id","excludeCredentials","map","data","allowCredentials","preparePublicKeyCredentials","publicKeyCredential","type","rawId","clientDataJSON","attestationObject","authenticatorData","signature","userHandle","requestLogin","document","querySelectorAll","forEach","el","classList","add","getElementById","remove","form","FormData","required","reportValidity","waitForInternet","querySelector","textContent","startsWith","location","href","reload","verifyWebauthn","methods","username","value","navigator","get","JSON","stringify","showMessage","showTwoFaFields","verifyCreds","password","hideModals","find","element","webauthnSupported","resetPassword","target","captchaForm","contains","captcha","text","loader","showLoader","innerHTML","DOMPurify","sanitize","PublicKeyCredential","isUserVerifyingPlatformAuthenticatorAvailable","then","log","modal","abortController","credParsing","startConditionalRequest","mediation","isConditionalMediationAvailable","conditionalMediationSupported","abort","AbortController","onAbort","ev","signal","credential","hints","fromCodePoint","processCredential","includes","closest","loadingGif","requestEmailCode","wrapper","setTimeout","focus","disabled","openLoginModal","waitForCaptcha","ariaExpanded","style","overflowY","addEventListener","e","key","observer","MutationObserver","mutations","mutation","attributeName","dataset","hcaptchaResponse","iframe","observe","attributes","available","catch","err","event","matches","tagName","parentNode","toggle","title","togglePassworView","name","reset","requestAccount","test","userAgent","MSStream","content","getAttribute","re","setAttribute","addMaximumScaleToMetaViewport"],"sourceRoot":""}