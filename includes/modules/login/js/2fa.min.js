(()=>{"use strict";const e=(e,t,r)=>fetch(t,{method:"POST",credentials:"same-origin",redirect:"error",headers:{"Content-Type":"application/json",Accept:"application/json",...r},body:JSON.stringify(e)}),t=e=>{const t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return window.atob(e)},r=e=>btoa(String.fromCharCode(...e));function n(e){var t=e.target;document.querySelectorAll(".twofa_option").forEach((e=>e.classList.add("hidden")));var r=document.getElementById("setup-"+t.value);r.classList.remove("hidden"),isMobileDevice()?r.querySelectorAll(".mobile.hidden").forEach((e=>e.classList.remove("hidden"))):r.querySelectorAll(".desktop.hidden").forEach((e=>e.classList.remove("hidden"))),t.closest("form").querySelector(".form_submit").classList.remove("hidden")}window.saved2fa=function(e,t){e.status>=200&&e.status<400&&document.querySelectorAll('[id^="setup-"]:not(.hidden)').forEach((e=>e.classList.add("hidden")))},document.addEventListener("DOMContentLoaded",(function(){console.log("2fa.js loaded"),null!=document.getElementById("webauthn_wrapper")&&(window.PublicKeyCredential?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((e=>{e?(console.log("Supported."),document.getElementById("webauthn_wrapper").classList.remove("hidden")):console.log("WebAuthn supported, Platform Authenticator not supported.")})).catch((e=>console.log("Something went wrong."))):console.log("Not supported.")),document.querySelectorAll(".twofa_option_checkbox").forEach((e=>e.addEventListener("click",n))),document.querySelectorAll(".remove_webauthn").forEach((e=>e.addEventListener("click",o))),document.querySelectorAll("#add_fingerprint").forEach((e=>e.addEventListener("click",s)))}));const a=(({actionUrl:n="/register",actionHeader:a={},optionsUrl:o="/register/options"},s={})=>async i=>{const d=await e(i,o,s),l=(e=>(e.challenge=Uint8Array.from(t(e.challenge),(e=>e.charCodeAt(0))),void 0!==e.user&&(e.user={...e.user,id:Uint8Array.from(window.atob(e.user.id),(e=>e.charCodeAt(0)))}),void 0!==e.excludeCredentials&&(e.excludeCredentials=e.excludeCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),void 0!==e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map((e=>({...e,id:Uint8Array.from(t(e.id),(e=>e.charCodeAt(0)))})))),e))(await d.json()),c=await navigator.credentials.create({publicKey:l});document.querySelector("#loader_wrapper .message").textContent="Saving authenticator...";const u=(e=>{const t={id:e.id,type:e.type,rawId:r(new Uint8Array(e.rawId)),response:{clientDataJSON:r(new Uint8Array(e.response.clientDataJSON))}};return void 0!==e.response.attestationObject&&(t.response.attestationObject=r(new Uint8Array(e.response.attestationObject))),void 0!==e.response.authenticatorData&&(t.response.authenticatorData=r(new Uint8Array(e.response.authenticatorData))),void 0!==e.response.signature&&(t.response.signature=r(new Uint8Array(e.response.signature))),void 0!==e.response.userHandle&&(t.response.userHandle=r(new Uint8Array(e.response.userHandle))),t})(c),p=await e(u,n,a);if(!p.ok)throw p;const m=await p.text();return""!==m?JSON.parse(m):m})({actionUrl:sim.base_url+"/wp-json/sim/v1/store_fingerprint",optionsUrl:sim.base_url+"/wp-json/sim/v1/fingerprint_options",actionHeader:{"X-WP-Nonce":sim.restnonce}},{"X-WP-Nonce":sim.restnonce});function o(e){var t=e.target,r=t.closest("table"),n=t.closest("tr"),a=new FormData;a.append("action","remove_web_authenticator"),a.append("key",t.dataset.key),showLoader(t,!0),fetch(sim.ajax_url,{method:"POST",credentials:"same-origin",body:a}).then((e=>{e.ok&&(2==r.rows.length?r.remove():n.remove()),e.text()})).then((e=>display_message(e)))}function s(e){var t=e.target.closest("#webauthn_wrapper").querySelector('[name="identifier"]').value;if(""!=t){document.getElementById("add_webauthn").classList.add("hidden");var r=`<div id="loader_wrapper" style='margin-bottom:20px;'><span class="message">Please authenticate...</span><img class="loadergif" src="${sim.loading_gif}" height="30px;"></div>`;document.getElementById("add_webauthn").insertAdjacentHTML("afterEnd",r),a({identifier:t}).then((e=>{var t=document.getElementById("webautn_devices_wrapper");null==t?document.getElementById("webauthn_wrapper").insertAdjacentHTML("beforeEnd",e):t.outerHTML=e,setTableLabel(),display_message("Registration success","success")})).catch((e=>{document.getElementById("add_webauthn").classList.remove("hidden"),display_message("Registration failure: "+e.message,"error"),console.error(e)})).finally((()=>{document.querySelector("#loader_wrapper").remove()}))}else display_message("Please specify a device name","error")}})();
//# sourceMappingURL=2fa.min.js.map