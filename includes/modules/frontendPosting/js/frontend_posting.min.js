(()=>{async function e(e){if(e.preventDefault(),parent=e.target.closest("#frontend_upload_form"),(await Swal.fire({title:"Are you sure?",text:"Are you sure you want to remove this "+frontendpost.postType+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed){var t=parent.querySelector('[name="post_id"]').value;e.target.closest("form").querySelector(".loadergif").classList.remove("hidden");var a=new FormData;a.append("post_id",t);var o=await FormSubmit.fetchRestApi("frontend_posting/remove_post",a);o&&Main.displayMessage(o)}}async function t(){var e=document.querySelector('[name="post_id"]');if(null!=e){var t=new FormData;t.append("postid",e.value),FormSubmit.fetchRestApi("frontend_posting/refresh_post_lock",t)}}function a(e){var t,a=document.getElementById("frontend_upload_form");t=null==e?location.search.replace("?type=",""):e.value;var o=a.querySelector('[name="submit_post"]');switch(document.querySelector('#postform [name="post_type"]').value=t,a.querySelectorAll(".replaceposttype").forEach((function(e){e.textContent=t})),null!=tinymce.activeEditor&&""!=tinymce.activeEditor.getContent()||(a.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),a.querySelector("#showallfields").classList.add("hidden")),a.querySelectorAll("#wp-post_content-media-buttons, .advancedpublishoptions, #advancedpublishoptionsbutton").forEach((e=>e.classList.remove("hidden"))),t){case"page":a.querySelectorAll(".page:not(.page-template-default)").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".post:not(.page), .recipe, .event, .location, .attachment").forEach((e=>e.classList.add("hidden")));break;case"post":a.querySelectorAll(".post").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".page:not(.post, .page-template-default), .recipe, .event, .location, .attachment").forEach((e=>e.classList.add("hidden")));break;case"location":a.querySelectorAll(".location").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".page, .post, .recipe, .event, .attachment").forEach((e=>e.classList.add("hidden"))),null!=tinymce.activeEditor&&""!=tinymce.activeEditor.getContent()||(a.querySelectorAll(".lite").forEach((function(e){e.classList.add("hidden")})),a.querySelector("#showallfields").classList.remove("hidden"));break;case"event":a.querySelectorAll(".event").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".post, .page, .recipe, .location, .attachment").forEach((e=>e.classList.add("hidden")));break;case"recipe":a.querySelectorAll(".recipe").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".post, .page, .event, .location, .attachment").forEach((e=>e.classList.add("hidden")));break;case"attachment":a.querySelectorAll(".attachment").forEach((e=>e.classList.remove("hidden"))),a.querySelectorAll(".post, .page, .event, .location, .recipe, #wp-post_content-media-buttons").forEach((e=>e.classList.add("hidden"))),a.querySelector('[name="signal_url"]').checked=!0;break;default:o.textContent=o.textContent.replace("page","post")}}async function o(e){var t=await FormSubmit.submitForm(e,"frontend_posting/submit_post");t&&Main.displayMessage(t)}document.addEventListener("DOMContentLoaded",(function(){console.log("Frontendposting.js loaded");var e=document.getElementById("minutes");null!=e&&setInterval((function(){e.innerHTML=parseInt(e.innerHTML)+1}),6e4),t(),setInterval(t,6e4),window.onbeforeunload=function(){null==document.getElementById("post_lock_warning")&&async function(){var e=document.querySelector('[name="post_id"]');if(null!=e){var t=new FormData;t.append("postid",e.value),await FormSubmit.fetchRestApi("frontend_posting/delete_post_lock",t)}}()},(location.search.includes("?type")||location.search.includes("?post_id"))&&a(document.querySelector('#postform [name="post_type"]'))})),document.addEventListener("click",(t=>{var a=t.target;if("submit_post"==a.name||null!=a.parentNode&&"submit_post"==a.parentNode.name)o(a);else if("draft_post"==a.name||null!=a.parentNode&&"draft_post"==a.parentNode.name)a.closest("form").querySelector('[name="post_status"]').value="draft",o(a);else if("delete_post"==a.name)e(t);else if("change_post_type"==a.name)!async function(e){var t=await FormSubmit.submitForm(e,"frontend_posting/change_post_type");t&&Main.displayMessage(t)}(a);else if("add-featured-image"==a.name)!function(e){e.preventDefault();var t=e.target.closest("#frontend_upload_form");"object"!=typeof file_frame?(file_frame=wp.media.frames.file_frame=wp.media({title:"Select featured image",button:{text:"Save featured image"},multiple:!1}),file_frame.on("select",(function(){var e=file_frame.state().get("selection").first().toJSON();t.querySelector('[name="post_image_id"]').value=e.id,document.getElementById("featured-image-div").classList.remove("hidden");var a=document.getElementById("featured_image_wrapper");null!=a.querySelector("img")&&a.querySelector("img").remove(),a.insertAdjacentHTML("beforeEnd",'<img width="150" height="150" src="'+e.url+'">'),t.querySelectorAll('[name="add-featured-image"]').forEach((function(e){e.innerHTML=e.innerHTML.replace("Add","Replace")}))})),file_frame.open()):file_frame.open()}(t);else if("showallfields"==a.id)!function(e){var t=e.closest("#frontend_upload_form");t.querySelector("#showallfields").classList.contains("show")?(t.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),e.classList.remove("show"),e.classList.add("hide"),e.textContent="Only show required fields"):(t.querySelectorAll(".lite").forEach((function(e){e.classList.add("hidden")})),e.classList.add("show"),e.classList.remove("hide"),e.textContent="Show all fields")}(a);else if("advancedpublishoptionsbutton"==a.id){let e=a.closest("form").querySelector(".advancedpublishoptions");e.classList.contains("hidden")?(e.classList.remove("hidden"),a.querySelector("span").textContent="Hide"):(e.classList.add("hidden"),a.querySelector("span").textContent="Show")}else if("signal"==a.name){let e=a.closest("#signalmessage").querySelector(".signalmessagetype");a.checked?e.classList.remove("hidden"):e.classList.add("hidden")}else if("enable_event_repeat"==a.name){document.querySelector(".repeat_wrapper").classList.toggle("hidden");var r=a.parentNode.querySelector('[name="event[repeated]"]');"yes"==r.value?r.value="":r.value="yes"}else"event[repeat][repeat_type]"==a.name?(a.closest(".event").querySelectorAll(".repeat_type_option").forEach((e=>{e.querySelector(".repeat_type_option_specifics").classList.add("hidden")})),a.closest(".repeat_type_option").querySelector(".repeat_type_option_specifics").classList.remove("hidden")):"insert-media-button"==a.id&&void 0===wp.media.frame&&setTimeout((function(){wp.media.frame.on("insert",(function(){var e=wp.media.frame.state().get("selection").first().toJSON();[".txt",".doc",".rtf"].some((t=>e.url.includes(t)))&&Swal.fire({title:"Question",text:"Do you want to insert the contents of this file into the post?",icon:"question",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes please",cancelButtonText:"No thanks",hideClass:{popup:""}}).then((t=>{Swal.fire({title:"Please wait...",html:"<IMG src='"+sim.loadingGif+"' width=100 height=100>",showConfirmButton:!1,showClass:{backdrop:"swal2-noanimation",popup:"",icon:""}}),t.isConfirmed&&async function(e){var t=new FormData;t.append("attachment_id",e);var a=await FormSubmit.fetchRestApi("frontend_posting/get_attachment_contents",t);if(a){var o=tinyMCE.activeEditor.getContent();tinymce.activeEditor.setContent(o+a),Swal.close()}}(e.id)}))}))}),100);if(a.classList.contains("selectall")&&a.closest(".selector_wrapper").querySelectorAll('input[type="checkbox"]').forEach((e=>e.checked=a.checked)),a.matches(".remove_featured_image")){var n=document.getElementById("featured-image-div");n.classList.add("hidden"),n.querySelector("img").remove(),document.querySelector('[name="add-featured-image"]').textContent="Add featured image"}a.classList.contains("add_cat")&&document.getElementById("add_"+a.dataset.type+"_type").classList.remove("hidden"),null!=a.closest(".repeat_type_option")&&(document.querySelectorAll(".repeat_type_option_specifics:not(.hidden)").forEach((e=>e.classList.add("hidden"))),a.closest(".repeat_type_option").querySelector(".repeat_type_option_specifics").classList.remove("hidden")),a.matches(".add_category .form_submit")&&async function(e){var t,a,o=await FormSubmit.submitForm(e,"frontend_posting/add_category");if(o){var r=e.closest("form").querySelector('[name="cat_parent"]').value,n=e.closest("form").querySelector('[name="post_type"]').value,l=e.closest("form").querySelector('[name="cat_name"]').value;if(""==r)t=document.getElementById(n+"_parenttypes"),a="";else{t=document.getElementById(n+"_childtypes"),a='data-parent="'+parent_cat+'"';var s=document.querySelector("."+n+'type[value="'+parent_cat+'"]');s.checked||s.click()}var c=`\n\t\t<div class="infobox" ${a}>\n\t\t\t<input type="checkbox" class="${n}type" id="${n}type[]" value="${o.id}" checked>\n\t\t\t<label class="option-label category-select">${l}</label>\n\t\t</div>\n\t\t`;t.insertAdjacentHTML("afterBegin",c),Main.hideModals(),Main.displayMessage(`Succesfully added the ${l} category`)}}(a),a.matches("button.show-diff")&&a.parentNode.querySelector(".post-diff-wrapper").classList.toggle("hidden")})),document.addEventListener("change",(e=>{var t=e.target;if("post_type_selector"==t.id?a(t):"event[allday]"==t.name?function(e){let t=e.closest(".event").querySelector('[name="event[starttime]"]'),a=e.closest(".event").querySelector('[name="event[endtime]"]'),o=e.closest(".event").querySelector('[name="enddate_label"]');e.checked?(t.classList.add("hidden"),a.classList.add("hidden"),o.classList.add("hidden"),t.value="00:00",a.value="23:59"):(t.classList.remove("hidden"),a.classList.remove("hidden"),o.classList.remove("hidden"),t.value="",a.value="")}(t):"event[startdate]"==t.name?function(e){let t=e.closest(".event").querySelector('[name="event[enddate]"]'),a=new Date(e.value),o=new Date(t.value);(""==t.value||a>o)&&(t.value=e.value);var r=new Date(a.getFullYear(),a.getMonth(),1).getDay(),n=a.getDate()+r-1,l=Math.floor(n/7);document.querySelectorAll('.weeks [name="event[repeat][weeks][]"]')[l].checked=!0,document.querySelector(".repeatdatetype span.monthday").textContent=a.getUTCDate()}(t):"event[repeat][datetype]"==t.name?function(e){var t=e.closest(".repeat_wrapper");t.querySelectorAll(".repeatinterval, .days, .weeks, .months").forEach((e=>e.classList.replace("hide","hidden"))),"samedate"==e.value?t.querySelectorAll(".repeatinterval").forEach((e=>e.classList.replace("hidden","hide"))):"monthly"==t.querySelector('[name="event[repeat][type]"]').value?(t.querySelectorAll(".days, .weeks, .months, .months h4.checkbox, .days h4.radio, .weeks h4.radio").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelectorAll(".days h4.checkbox, .weeks h4.checkbox").forEach((e=>e.classList.replace("hide","hidden"))),t.querySelectorAll('.months input[type="radio"]').forEach((e=>e.type="checkbox")),t.querySelectorAll('.days input[type="checkbox"], .weeks input[type="checkbox"]').forEach((e=>e.type="radio"))):(t.querySelectorAll(".days, .weeks, .months, .days h4.radio, .weeks h4.radio, .months h4.radio").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelectorAll(".days h4.checkbox, .weeks h4.checkbox, .months h4.checkbox").forEach((e=>e.classList.replace("hide","hidden"))),t.querySelectorAll('.days input[type="checkbox"], .weeks input[type="checkbox"], .months input[type="checkbox"]').forEach((e=>e.type="radio")))}(t):"event[repeat][type]"==t.name&&function(e){let t=e.closest(".repeat_wrapper");switch(t.querySelectorAll(".hide").forEach((e=>e.classList.replace("hide","hidden"))),e.value){case"daily":t.querySelectorAll(".repeatinterval, .days, .days h4.checkbox, .pattern-wrapper, .days .selectall_wrapper, .daily").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelector("#repeattype").textContent="days";break;case"weekly":t.querySelectorAll(".repeatinterval, .weeks, .weeks h4.checkbox, .weeks .selectall_wrapper, .pattern-wrapper, .weekly, .days").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelector("#repeattype").textContent="week(s)",t.querySelectorAll('.weeks input[type="radio"]').forEach((e=>e.type="checkbox"));break;case"monthly":t.querySelectorAll(".repeatdatetype, .pattern-wrapper, .monthly, .months, .weeks, .days").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelector("#repeattype").textContent="month(s)",t.querySelector(".monthoryeartext").textContent="On a certain day and week of a month",t.querySelector(".monthoryear").textContent="a month";break;case"yearly":t.querySelectorAll(".repeatdatetype, .pattern-wrapper, .yearly, .months, .weeks, .days").forEach((e=>e.classList.replace("hidden","hide"))),t.querySelector("#repeattype").textContent="year(s)",t.querySelector(".monthoryeartext").textContent="On a certain day, week and month of a year";var a=new Date(document.querySelector('[name="event[startdate]"]').value);t.querySelector(".monthoryear").textContent=a.toLocaleString("en",{month:"long"})+" every year";break;case"custom_days":t.querySelectorAll(".custom_dates_selector").forEach((e=>e.classList.replace("hidden","hide")))}}(t),null!=t.list){var o=t.list.querySelector("[value='"+t.value+"' i]");if(null!=o){var r=o.dataset.value,n=t.closest("label").querySelector(".datalistvalue");null!=n&&(n.value=r)}}t.classList.contains("parent_cat")&&function(e){var t=e.closest(".infobox").dataset.parent,a=e.closest(".categories");e.checked?a.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.remove("hidden"),a.querySelector("#subcategorylabel").classList.remove("hidden")})):null==t&&null==a.querySelector('.childtypes input[type="checkbox"]:checked')&&(a.querySelector("#subcategorylabel").classList.add("hidden"),a.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.add("hidden")})))}(t)}))})();
//# sourceMappingURL=frontend_posting.min.js.map