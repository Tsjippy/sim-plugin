(()=>{var e={908:function(e){e.exports=function(){"use strict";(function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var n=(new Date).getTime(),o=Math.max(0,16-(n-e)),r=window.setTimeout(function(){t(n+o)},o);return e=n+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}(),function(e){try{return new CustomEvent("test"),!1}catch(e){}function t(t,i){i=i||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(t,i.bubbles,i.cancelable,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n}t.prototype=Event.prototype,e.MouseEvent=t}(window);var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),i=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function t(i,n,o,r){e(this,t);var s=this;function a(e){e.stopPropagation(),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",l),s.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{handle:s}}))}function l(e){e.stopPropagation(),s.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:e.clientX,mouseY:e.clientY}}))}this.position=i,this.constraints=n,this.cursor=o,this.eventBus=r,this.el=document.createElement("div"),this.el.className="croppr-handle",this.el.style.cursor=o,this.el.addEventListener("mousedown",function(e){e.stopPropagation(),document.addEventListener("mouseup",a),document.addEventListener("mousemove",l),s.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:s}}))})},r=function(){function i(t,n,o,r){e(this,i),this.x1=t,this.y1=n,this.x2=o,this.y2=r}return t(i,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.x1=null==e?this.x1:e,this.y1=null==t?this.y1:t,this.x2=null==i?this.x2:i,this.y2=null==n?this.y2:n,this}},{key:"width",value:function(){return Math.abs(this.x2-this.x1)}},{key:"height",value:function(){return Math.abs(this.y2-this.y1)}},{key:"resize",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],n=this.x1+this.width()*i[0],o=this.y1+this.height()*i[1];return this.x1=n-e*i[0],this.y1=o-t*i[1],this.x2=this.x1+e,this.y2=this.y1+t,this}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i=this.width()*e,n=this.height()*e;return this.resize(i,n,t),this}},{key:"move",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.width(),n=this.height();return e=null===e?this.x1:e,t=null===t?this.y1:t,this.x1=e,this.y1=t,this.x2=e+i,this.y2=t+n,this}},{key:"getRelativePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return[this.width()*e[0],this.height()*e[1]]}},{key:"getAbsolutePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return[this.x1+this.width()*e[0],this.y1+this.height()*e[1]]}},{key:"constrainToRatio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"height";if(null!==e){switch(this.width(),this.height(),i){case"height":default:this.resize(this.width(),this.width()*e,t);break;case"width":this.resize(1*this.height()/e,this.height(),t)}return this}}},{key:"constrainToBoundary",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],o=this.getAbsolutePoint(i),r=n(o,2),s=r[0],a=r[1],l=s,u=a,d=e-s,h=t-a,c=-2*i[0]+1,p=-2*i[1]+1,v=null,m=null;switch(c){case-1:v=l;break;case 0:v=2*Math.min(l,d);break;case 1:v=d}switch(p){case-1:m=u;break;case 0:m=2*Math.min(u,h);break;case 1:m=h}if(this.width()>v){var g=v/this.width();this.scale(g,i)}if(this.height()>m){var f=m/this.height();this.scale(f,i)}return this}},{key:"constrainToSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(r&&(r>1?(e=1*t/r,n*=r):r<1&&(t=e*r,i=1*n/r)),e&&this.width()>e){var s=e,a=null===r?this.height():t;this.resize(s,a,o)}if(t&&this.height()>t){var l=null===r?this.width():e,u=t;this.resize(l,u,o)}if(i&&this.width()<i){var d=i,h=null===r?this.height():n;this.resize(d,h,o)}if(n&&this.height()<n){var c=null===r?this.width():i,p=n;this.resize(c,p,o)}return this}}]),i}();function s(e){e.preventDefault();var t=e.changedTouches[0];t.target.dispatchEvent(new MouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],{bubbles:!0,cancelable:!0,view:window,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY}))}var a=[{position:[0,0],constraints:[1,0,0,1],cursor:"nw-resize"},{position:[.5,0],constraints:[1,0,0,0],cursor:"n-resize"},{position:[1,0],constraints:[1,1,0,0],cursor:"ne-resize"},{position:[1,.5],constraints:[0,1,0,0],cursor:"e-resize"},{position:[1,1],constraints:[0,1,1,0],cursor:"se-resize"},{position:[.5,1],constraints:[0,0,1,0],cursor:"s-resize"},{position:[0,1],constraints:[0,0,1,1],cursor:"sw-resize"},{position:[0,.5],constraints:[0,0,0,1],cursor:"w-resize"}],l=function(){function i(t,n){var o=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e(this,i),this.options=i.parseOptions(n||{}),!t.nodeName&&null==(t=document.querySelector(t)))throw"Unable to find element.";if(!t.getAttribute("src"))throw"Image src not provided.";this._initialized=!1,this._restore={parent:t.parentNode,element:t},r||(0===t.width||0===t.height?t.onload=function(){o.initialize(t)}:this.initialize(t))}return t(i,[{key:"initialize",value:function(e){this.createDOM(e),this.options.convertToPixels(this.cropperEl),this.attachHandlerEvents(),this.attachRegionEvents(),this.attachOverlayEvents(),this.box=this.initializeBox(this.options),this.redraw(),this._initialized=!0,null!==this.options.onInitialize&&this.options.onInitialize(this)}},{key:"createDOM",value:function(e){var t;this.containerEl=document.createElement("div"),this.containerEl.className="croppr-container",this.eventBus=this.containerEl,(t=this.containerEl).addEventListener("touchstart",s),t.addEventListener("touchend",s),t.addEventListener("touchmove",s),this.cropperEl=document.createElement("div"),this.cropperEl.className="croppr",this.imageEl=document.createElement("img"),this.imageEl.setAttribute("src",e.getAttribute("src")),this.imageEl.setAttribute("alt",e.getAttribute("alt")),this.imageEl.className="croppr-image",this.imageClippedEl=this.imageEl.cloneNode(),this.imageClippedEl.className="croppr-imageClipped",this.regionEl=document.createElement("div"),this.regionEl.className="croppr-region",this.overlayEl=document.createElement("div"),this.overlayEl.className="croppr-overlay";var i=document.createElement("div");i.className="croppr-handleContainer",this.handles=[];for(var n=0;n<a.length;n++){var r=new o(a[n].position,a[n].constraints,a[n].cursor,this.eventBus);this.handles.push(r),i.appendChild(r.el)}this.cropperEl.appendChild(this.imageEl),this.cropperEl.appendChild(this.imageClippedEl),this.cropperEl.appendChild(this.regionEl),this.cropperEl.appendChild(this.overlayEl),this.cropperEl.appendChild(i),this.containerEl.appendChild(this.cropperEl),e.parentElement.replaceChild(this.containerEl,e)}},{key:"setImage",value:function(e){var t=this;return this.imageEl.onload=function(){t.box=t.initializeBox(t.options),t.redraw()},this.imageEl.src=e,this.imageClippedEl.src=e,this}},{key:"destroy",value:function(){this._restore.parent.replaceChild(this._restore.element,this.containerEl)}},{key:"initializeBox",value:function(e){var t=e.startSize.width,i=e.startSize.height,n=new r(0,0,t,i);n.constrainToRatio(e.aspectRatio,[.5,.5]);var o=e.minSize,s=e.maxSize;n.constrainToSize(s.width,s.height,o.width,o.height,[.5,.5],e.aspectRatio);var a=this.cropperEl.offsetWidth,l=this.cropperEl.offsetHeight;n.constrainToBoundary(a,l,[.5,.5]);var u=this.cropperEl.offsetWidth/2-n.width()/2,d=this.cropperEl.offsetHeight/2-n.height()/2;return n.move(u,d),n}},{key:"redraw",value:function(){var e=this,t=Math.round(this.box.width()),i=Math.round(this.box.height()),n=Math.round(this.box.x1),o=Math.round(this.box.y1),r=Math.round(this.box.x2),s=Math.round(this.box.y2);window.requestAnimationFrame(function(){e.regionEl.style.transform="translate("+n+"px, "+o+"px)",e.regionEl.style.width=t+"px",e.regionEl.style.height=i+"px",e.imageClippedEl.style.clip="rect("+o+"px, "+r+"px, "+s+"px, "+n+"px)";for(var a=e.box.getAbsolutePoint([.5,.5]),l=a[0]-e.cropperEl.offsetWidth/2>>31,u=a[1]-e.cropperEl.offsetHeight/2>>31,d=-2*((l^u)+u+u+4)+8,h=0;h<e.handles.length;h++){var c=e.handles[h],p=c.el.offsetWidth,v=c.el.offsetHeight,m=n+t*c.position[0]-p/2,g=o+i*c.position[1]-v/2;c.el.style.transform="translate("+Math.round(m)+"px, "+Math.round(g)+"px)",c.el.style.zIndex=d==h?5:4}})}},{key:"attachHandlerEvents",value:function(){var e=this.eventBus;e.addEventListener("handlestart",this.onHandleMoveStart.bind(this)),e.addEventListener("handlemove",this.onHandleMoveMoving.bind(this)),e.addEventListener("handleend",this.onHandleMoveEnd.bind(this))}},{key:"attachRegionEvents",value:function(){var e=this.eventBus;function t(t){t.stopPropagation(),e.dispatchEvent(new CustomEvent("regionmove",{detail:{mouseX:t.clientX,mouseY:t.clientY}}))}function i(n){n.stopPropagation(),document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",t),e.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:n.clientX,mouseY:n.clientY}}))}this.regionEl.addEventListener("mousedown",function(n){n.stopPropagation(),document.addEventListener("mouseup",i),document.addEventListener("mousemove",t),e.dispatchEvent(new CustomEvent("regionstart",{detail:{mouseX:n.clientX,mouseY:n.clientY}}))}),e.addEventListener("regionstart",this.onRegionMoveStart.bind(this)),e.addEventListener("regionmove",this.onRegionMoveMoving.bind(this)),e.addEventListener("regionend",this.onRegionMoveEnd.bind(this))}},{key:"attachOverlayEvents",value:function(){var e=this,t=null;function i(t){t.stopPropagation(),e.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:t.clientX,mouseY:t.clientY}}))}function n(o){o.stopPropagation(),document.removeEventListener("mouseup",n),document.removeEventListener("mousemove",i),1!==e.box.width()||1!==e.box.height()?e.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{mouseX:o.clientX,mouseY:o.clientY}})):e.box=t}this.overlayEl.addEventListener("mousedown",function(o){o.stopPropagation(),document.addEventListener("mouseup",n),document.addEventListener("mousemove",i);var s=e.cropperEl.getBoundingClientRect(),a=o.clientX-s.left,l=o.clientY-s.top;t=e.box,e.box=new r(a,l,a+1,l+1),e.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:e.handles[4]}}))})}},{key:"onHandleMoveStart",value:function(e){var t=e.detail.handle,i=[1-t.position[0],1-t.position[1]],o=this.box.getAbsolutePoint(i),r=n(o,2),s=r[0],a=r[1];this.activeHandle={handle:t,originPoint:i,originX:s,originY:a},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}},{key:"onHandleMoveMoving",value:function(e){var t=e.detail,i=t.mouseX,n=t.mouseY,o=this.cropperEl.getBoundingClientRect();i-=o.left,n-=o.top,i<0?i=0:i>o.width&&(i=o.width),n<0?n=0:n>o.height&&(n=o.height);var s=this.activeHandle.originPoint.slice(),a=this.activeHandle.originX,l=this.activeHandle.originY,u=this.activeHandle.handle,d=1===u.constraints[0],h=1===u.constraints[1],c=1===u.constraints[2],p=1===u.constraints[3],v=(p||h)&&(d||c),m=p||h?a:this.box.x1,g=p||h?a:this.box.x2,f=d||c?l:this.box.y1,y=d||c?l:this.box.y2;m=p?i:m,g=h?i:g,f=d?n:f,y=c?n:y;var w=!1,E=!1;if((p||h)&&(w=p?i>a:i<a),(d||c)&&(E=d?n>l:n<l),w){var b=m;m=g,g=b,s[0]=1-s[0]}if(E){var x=f;f=y,y=x,s[1]=1-s[1]}var S=new r(m,f,g,y);if(this.options.aspectRatio){var M=this.options.aspectRatio,C=!1;v?C=n>S.y1+M*S.width()||n<S.y2-M*S.width():(d||c)&&(C=!0);var _=C?"width":"height";S.constrainToRatio(M,s,_)}var z=this.options.minSize,L=this.options.maxSize;S.constrainToSize(L.width,L.height,z.width,z.height,s,this.options.aspectRatio);var q=this.cropperEl.offsetWidth,k=this.cropperEl.offsetHeight;S.constrainToBoundary(q,k,s),this.box=S,this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue())}},{key:"onHandleMoveEnd",value:function(e){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}},{key:"onRegionMoveStart",value:function(e){var t=e.detail,i=t.mouseX,n=t.mouseY,o=this.cropperEl.getBoundingClientRect();i-=o.left,n-=o.top,this.currentMove={offsetX:i-this.box.x1,offsetY:n-this.box.y1},null!==this.options.onCropStart&&this.options.onCropStart(this.getValue())}},{key:"onRegionMoveMoving",value:function(e){var t=e.detail,i=t.mouseX,n=t.mouseY,o=this.currentMove,r=o.offsetX,s=o.offsetY,a=this.cropperEl.getBoundingClientRect();i-=a.left,n-=a.top,this.box.move(i-r,n-s),this.box.x1<0&&this.box.move(0,null),this.box.x2>a.width&&this.box.move(a.width-this.box.width(),null),this.box.y1<0&&this.box.move(null,0),this.box.y2>a.height&&this.box.move(null,a.height-this.box.height()),this.redraw(),null!==this.options.onCropMove&&this.options.onCropMove(this.getValue())}},{key:"onRegionMoveEnd",value:function(e){null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue())}},{key:"getValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e&&(e=this.options.returnMode),"real"==e){var t=this.imageEl.naturalWidth,i=this.imageEl.naturalHeight,n=this.imageEl.getBoundingClientRect(),o=t/n.width,r=i/n.height;return{x:Math.round(this.box.x1*o),y:Math.round(this.box.y1*r),width:Math.round(this.box.width()*o),height:Math.round(this.box.height()*r)}}if("ratio"==e){var s=this.imageEl.getBoundingClientRect(),a=s.width,l=s.height;return{x:u(this.box.x1/a,3),y:u(this.box.y1/l,3),width:u(this.box.width()/a,3),height:u(this.box.height()/l,3)}}if("raw"==e)return{x:Math.round(this.box.x1),y:Math.round(this.box.y1),width:Math.round(this.box.width()),height:Math.round(this.box.height())}}}],[{key:"parseOptions",value:function(e){var t=null,i={width:null,height:null},n={width:null,height:null},o={width:100,height:100,unit:"%"},r="real",s=null,a=null,l=null,u=null,d=null;void 0!==e.aspectRatio&&("number"==typeof e.aspectRatio?d=e.aspectRatio:e.aspectRatio instanceof Array&&(d=e.aspectRatio[1]/e.aspectRatio[0]));var h=null;void 0!==e.maxSize&&null!==e.maxSize&&(h={width:e.maxSize[0]||null,height:e.maxSize[1]||null,unit:e.maxSize[2]||"px"});var c=null;void 0!==e.minSize&&null!==e.minSize&&(c={width:e.minSize[0]||null,height:e.minSize[1]||null,unit:e.minSize[2]||"px"});var p=null;void 0!==e.startSize&&null!==e.startSize&&(p={width:e.startSize[0]||null,height:e.startSize[1]||null,unit:e.startSize[2]||"%"});var v=null;"function"==typeof e.onInitialize&&(v=e.onInitialize);var m=null;"function"==typeof e.onCropStart&&(m=e.onCropStart);var g=null;"function"==typeof e.onCropEnd&&(g=e.onCropEnd);var f=null;"function"==typeof e.onUpdate&&(console.warn("Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead."),f=e.onUpdate),"function"==typeof e.onCropMove&&(f=e.onCropMove);var y=null;if(void 0!==e.returnMode){var w=e.returnMode.toLowerCase();if(-1===["real","ratio","raw"].indexOf(w))throw"Invalid return mode.";y=w}var E=function(e,t){return null!==e?e:t};return{aspectRatio:E(d,t),maxSize:E(h,i),minSize:E(c,n),startSize:E(p,o),returnMode:E(y,r),onInitialize:E(v,s),onCropStart:E(m,a),onCropMove:E(f,l),onCropEnd:E(g,u),convertToPixels:function(e){for(var t=e.offsetWidth,i=e.offsetHeight,n=["maxSize","minSize","startSize"],o=0;o<n.length;o++){var r=n[o];null!==this[r]&&("%"==this[r].unit&&(null!==this[r].width&&(this[r].width=this[r].width/100*t),null!==this[r].height&&(this[r].height=this[r].height/100*i)),delete this[r].unit)}}}}}]),i}();function u(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}var d=function(n){function o(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e(this,o),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,i,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,n),t(o,[{key:"getValue",value:function(e){return i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"getValue",this).call(this,e)}},{key:"setImage",value:function(e){return i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setImage",this).call(this,e)}},{key:"destroy",value:function(){return i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"destroy",this).call(this)}},{key:"moveTo",value:function(e,t){return this.box.move(e,t),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:"resizeTo",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[.5,.5];return this.box.resize(e,t,i),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:"scaleBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[.5,.5];return this.box.scale(e,t),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}},{key:"reset",value:function(){return this.box=this.initializeBox(this.options),this.redraw(),null!==this.options.onCropEnd&&this.options.onCropEnd(this.getValue()),this}}]),o}(l);return d}()}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=i(908),t=i.n(e);async function n(e){const i=document.getElementById("edit-image-modal"),n=i.querySelector(".file-input"),o=i.querySelectorAll(".filter button"),r=i.querySelector(".filter-info .name"),s=i.querySelector(".filter-info .value"),a=i.querySelector(".slider input"),l=i.querySelectorAll(".rotate button"),u=i.querySelector(".reset-filter"),d=i.querySelector(".choose-img"),h=i.querySelector(".save-img"),c=i.querySelector(".image-zoom");let p,v="100",m="100",g="0",f="0",y=0,w=1,E=1,b=i.querySelector(".preview-img img");function x(){i._cropper=new(t())(".preview-img img",{startSize:[50,50,"%"]}),p=i._cropper.imageClippedEl}i.currentFileName=e.name,b.onload=x,i.querySelector(".preview-img img").src=URL.createObjectURL(e);const S=()=>{p.style.transform=`rotate(${y}deg) scale(${w}, ${E})`,p.style.filter=`brightness(${v}%) saturate(${m}%) invert(${g}%) grayscale(${f}%)`};o.forEach(e=>{e.addEventListener("click",()=>{i.querySelector(".active").classList.remove("active"),e.classList.add("active"),r.innerText=e.innerText,"brightness"===e.id?(a.max="200",a.value=v,s.innerText=`${v}%`):"saturation"===e.id?(a.max="200",a.value=m,s.innerText=`${m}%`):"inversion"===e.id?(a.max="100",a.value=g,s.innerText=`${g}%`):(a.max="100",a.value=f,s.innerText=`${f}%`)})}),l.forEach(e=>{e.addEventListener("click",()=>{"left"===e.id?y-=90:"right"===e.id?y+=90:"horizontal"===e.id?w=1===w?-1:1:E=1===E?-1:1,S()})});const M=()=>{v="100",m="100",g="0",f="0",y=0,w=1,E=1,o[0].click(),S()},C=function(){i._cropper.destroy(),i.querySelector(".preview-img").innerHTML='<img src="" alt="preview-img" class=\'hidden\'>',M()};return a.addEventListener("input",()=>{s.innerText=`${a.value}%`;const e=i.querySelector(".filter .active");"brightness"===e.id?v=a.value:"saturation"===e.id?m=a.value:"inversion"===e.id?g=a.value:f=a.value,S()}),u.addEventListener("click",M),h.addEventListener("click",async t=>{const n=i._cropper.getValue(),o=n.x,r=n.y,s=n.width,a=n.height,l=document.createElement("canvas"),u=l.getContext("2d");let d=0,h=0;l.width=s,l.height=a,0!==y&&(90==y?(l.width=a,l.height=s,u.translate(a/2,a/2),u.rotate(y*Math.PI/180),u.translate(-a/2,-a/2)):-90==y?(l.width=a,l.height=s,u.translate(a/2,s/2),u.rotate(y*Math.PI/180),u.translate(-s/2,-a/2)):(u.translate(l.width/2,l.height/2),u.rotate(y*Math.PI/180),u.translate(-l.width/2,-l.height/2))),-1==w&&(d=-s),-1==E&&(h=-a),u.scale(w,E),u.filter=`brightness(${v}%) saturate(${m}%) invert(${g}%) grayscale(${f}%)`,u.drawImage(b,o,r,s,a,d,h,s,a);let c=e.name.split(".").pop(),p=e.name.replace(`.${c}`,".webp");l.toBlob(function(e){document.querySelector("#edit-image-modal .save-img").file=new File([e],p),Main.hideModals()},"image/webp")}),n.addEventListener("change",()=>{i.classList.add("disable");let e=n.files[0];e&&(C(),b=i.querySelector(".preview-img img"),b.onload=x,b.src=URL.createObjectURL(e),p.addEventListener("load",()=>{u.click(),i.classList.remove("disable")}))}),d.addEventListener("click",()=>n.click()),c.addEventListener("input",()=>{i._cropper.reset();let e=c.value/100,t=i._cropper.imageClippedEl.width*e,n=i._cropper.imageClippedEl.height*e;i._cropper.resizeTo(t,n),c.parentNode.querySelector("output").value=c.value}),Main.showModal(i),new Promise(async function(t,n){let o=0;for(;!i.matches(".hidden");)o++,o>600&&n("Took too long"),await new Promise(e=>setTimeout(e,1e3));C(),null!=i.querySelector(".save-img").file?t(i.querySelector(".save-img").file):t(e)})}console.log("Image edit js loaded"),console.log("Fileupload.js loaded");let o=0,r="",s="";function a(e){e.closest(".upload_div").querySelectorAll(".loader_wrapper").forEach(e=>{e.classList.remove("hidden"),e.querySelectorAll(".loader_text").forEach(e=>{e.textContent="Preparing upload",e.classList.add("upload-message")})}),r.insertAdjacentHTML("beforeEnd",' \n\t<div id="progress-wrapper" class="hidden">\n\t\t<progress id="upload_progress" value="0" max="100"></progress>\n\t\t<span id="progress_percentage">   0%</span>\n\t</div>\n\t')}function l(e,t){let i=`\n\t<div class='document'>\n\t\t<input type='hidden' name='${r.querySelector(".file_upload").name.replace("_files","")}' value='${t}' data-pending='true'>\n\t\t${e}\n\t\t${Main.showLoader(null,!1,50,"",!0)}\n\t</div>`;return r.querySelector(".documentpreview").insertAdjacentHTML("beforeend",i),r.querySelector(".documentpreview .document")}function u(e){if(e.lengthComputable){var t=e.total,i=100*e.loaded/t;i=Math.round(10*i)/10,document.querySelectorAll("#upload_progress").forEach(e=>e.value=i),document.querySelectorAll("#progress_percentage").forEach(e=>e.textContent=`   ${i}%`),i>=99&&(document.getElementById("progress-wrapper").classList.add("hidden"),r.querySelectorAll(".loader_text").forEach(e=>{e.textContent=o>1?"Processing documents":"Processing document"}))}}function d(e){let t=e.target;4==t.readyState&&(t.status>=200&&t.status<400?function(e){let t=JSON.parse(e),i="";for(const e of t){i=e.url;let t=sim.baseUrl+"/"+i,n="",o="";if(null!=e.id&&(s+=` data-libraryid="${e.id}"`),n=null==e.id?t:e.id,null!=i.toLowerCase().match(/\.(jpe|jpeg|jpg|gif|png|webp)/))t+=`?version=${Math.floor(1e3*Math.random())}`,o=`<a class="fileupload" href="${t}"><img src="${t}" alt="picture" style="height:150px;"></a>`;else if(null!=i.toLowerCase().match(/\.pdf/))o=`<object data='${t}' \n\t\t\t\t\ttype='application/pdf' \n\t\t\t\t\twidth='100%' height='400px'>\n\t\t\t\t</object>`;else{let e=t.split("/")[t.split("/").length-1];o=`<a class="fileupload" href="${t}">${e}</a>`}o+=`<button type="button" class="remove_document button" data-url="${i}" ${s}>X</button>`,l(o,n)}if(1==t.length){let e=i.split("/")[i.split("/").length-1];Main.displayMessage(`The file ${e} has been uploaded succesfully.`,"success",!0)}else Main.displayMessage("The files have been uploaded succesfully.","success",!0);r.querySelector(".file_upload").multiple||r.querySelector(".upload_div").classList.add("hidden");const n=new Event("uploadfinished");r.dispatchEvent(n),document.querySelectorAll(".file_upload.active").forEach(e=>e.classList.remove("active"))}(t.responseText):(console.error(t.responseText),Main.displayMessage(JSON.parse(t.responseText).error,"error")),document.querySelectorAll(".loader_wrapper").forEach(function(e){e.classList.add("hidden")}),r.querySelector(".file_upload").value="",document.querySelectorAll(".button.form_submit[disabled]").forEach(e=>e.disabled=!1))}async function h(e){var t,i=new vimeoUploader.VimeoUpload(e),n=await i.tusUploader();if(!n)return r.querySelector(".file_upload").value="",document.getElementById("progress-wrapper").remove(),document.querySelector(".loader_wrapper:not(.hidden)").classList.add("hidden"),!1;t=o>1?"s":"",n.options.onProgress=function(e,i){var n=(e/i*100).toFixed(2);document.getElementById("upload_progress").value=n,document.getElementById("progress_percentage").textContent=`   ${n}%`,n>98&&(document.querySelector(".upload-message").textContent="Processing video"+t,document.getElementById("progress-wrapper").classList.add("hidden"))},n.options.onSuccess=async function(){let t=i.storedEntry.postId,n=new FormData;n.append("post_id",t);let o=new XMLHttpRequest;o.open("POST",`${sim.baseUrl}/wp-json${sim.restApiPrefix}/vimeo/add_uploaded_vimeo`,!1),o.send(n),document.getElementById("progress-wrapper").remove();var s=l(`\n\t\t<div class="vimeo-wrapper">\n\t\t\t<div class='vimeo-embed-container loading'>\n\t\t\t\t<iframe src='https://player.vimeo.com/video/${i.storedEntry.vimeoId}' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><br>\n\t\t\t</div>\n\t\t</div>`,t);document.querySelector(".loader_wrapper:not(.hidden)").classList.add("hidden"),Main.displayMessage(`The file ${e.name} has been uploaded succesfully.`,"success",!0),r.querySelector(".file_upload").multiple||r.querySelector(".upload_div").classList.add("hidden"),r.querySelector(".file_upload").value="",i.urlStorage.removeUpload(i.storedEntry.urlStorageKey);var a=document.getElementById("postform");null!=a&&(a.querySelector('[name="update"]').value="true",a.querySelector('[name="post_id"]').value=t);for(var u="";!u.ok;)await new Promise(e=>setTimeout(e,1e4)),u=await fetch(`https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/${i.storedEntry.vimeoId}`,{method:"GET"});var d=await u.json();s.querySelector(".vimeo-wrapper").innerHTML=DOMPurify.sanitize(d.html)},n.options.onError=function(e){console.error("Failed because: "+e)},document.querySelector(".upload-message").textContent="Uploading video"+t+" to Vimeo",document.getElementById("progress-wrapper").classList.remove("hidden"),n.start()}document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".modal.edit-image.hidden");null!=e&&document.body.append(e)}),window.addEventListener("click",function(e){var t=e.target;t.matches(".remove_document")&&(e.preventDefault(),async function(e){let t=new FormData;for(let i in e.dataset)""!=e.dataset[i]&&t.append(i,e.dataset[i]);e.style.display="none",e.parentNode.classList.add("removethisdocument"),e.parentNode.querySelector(".remove_document_loader").classList.remove("hidden");let i=await FormSubmit.fetchRestApi("remove_document",t);if(i){let t=e.closest(".document");r=t.closest(".file_upload_wrap"),t.querySelector(".remove_document_loader").classList.add("hidden");try{r.querySelector(".upload_div").classList.remove("hidden")}catch{document.querySelector('[name="post_image_id"]').value=""}t.remove(),r.querySelectorAll(".file_url").forEach((e,t)=>{e.name=e.name.replace(/(\d)/g,t)}),Main.displayMessage(i)}}(t))}),window.addEventListener("change",e=>{let t=e.target;t.className.includes("file_upload")&&(e.preventDefault(),async function(e){e.classList.add("active");let t="";if(r=e.closest(".file_upload_wrap"),o=e.files.length,o<0)return void Main.displayMessage("Please select some files before hitting the uplad button!","error");let i=e.closest("form");null!=i&&(i.querySelector(".button.form_submit").disabled=!0);let l=new FormData;l.append("action","upload_files"),s="",e.parentNode.querySelectorAll("input").forEach(e=>{l.append(e.name,e.value),"file"==e.type||e.name.includes("fileupload")||(s+=`data-${e.name}="${e.value}"`)});for(let t=0;t<o;t++){let i=e.files[t],o=i.type.split("/")[0];if("video"==o&&"object"==typeof vimeoUploader)a(e),await h(i);else{if(i.size>sim.maxFileSize)return Main.displayMessage("File too big, max file size is "+parseInt(sim.maxFileSize)/1024/1024+"MB","error"),void(e.value="");"image"==o&&e.matches(".should-edit")?(i=await n(i),l.append("files[]",i)):l.append("files[]",i)}}if(null==l.get("files[]"))return e.closest("form").querySelector(".button.form_submit").disabled=!1,void e.classList.remove("active");let c=new XMLHttpRequest;c.onreadystatechange=d,c.upload.addEventListener("progress",u,!1),c.open("POST",sim.ajaxUrl,!0),a(e),o>1&&(t="s"),e.closest(".upload_div").querySelector(".loader_text").textContent="Uploading document"+t,document.getElementById("progress-wrapper").classList.remove("hidden"),c.send(l)}(t))})})()})();
//# sourceMappingURL=fileupload.min.js.map