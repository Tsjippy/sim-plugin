!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.fileupload=t():e.fileupload=t()}(self,(function(){return(()=>{function e(e){if(e.lengthComputable){var t=e.total,a=100*e.loaded/t;a=Math.round(10*a)/10,document.getElementById("upload_progress").value=a,document.getElementById("progress_percentage").textContent="   "+a+"%",a>=99&&(document.getElementById("upload_progress").remove(),document.getElementById("progress_percentage").remove(),file_upload_wrap.querySelectorAll(".uploadmessage").forEach((e=>{totalfiles>1?e.textContent="Processing documents":e.textContent="Processing document"})))}}return console.log("Fileupload.js loaded"),null!=window.tinyMCE&&(sim=tinyMCEPopup.getWindowArg("sim")),window.afterdocumentremove=function(e,t){var a=document.querySelector('.remove_document[data-url="'+t.url+'"').closest(".document"),l=a.closest(".file_upload_wrap");if(a.querySelector(".remove_document_loader").classList.add("hidden"),e.status>=200&&e.status<400){try{l.querySelector(".upload_div").classList.remove("hidden")}catch{document.querySelector('[name="post_image_id"]').value=""}a.remove(),re=new RegExp("(.*)[0-9](.*)","g"),l.querySelectorAll(".file_url").forEach(((e,t)=>{e.name=e.name.replace(re,"$1"+t+"$2")}))}},window.addEventListener("click",(function(e){var t=e.target;t.className.includes("remove_document")&&function(e){var t=new FormData;for(var a in t.append("action","remove_document"),e.dataset)""!=e.dataset[a]&&t.append(a,e.dataset[a]);e.style.display="none",e.parentNode.classList.add("removethisdocument"),e.parentNode.querySelector(".remove_document_loader").classList.remove("hidden"),sendAJAX(t)}(t)})),window.addEventListener("change",(t=>{var a=t.target;a.className.includes("file_upload")&&function(t){file_upload_wrap=t.closest(".file_upload_wrap");var a=new FormData;if(a.append("action","upload_files"),dataset_string="",t.parentNode.querySelectorAll("input").forEach((function(e){a.append(e.name,e.value),dataset_string+="data-"+e.name+'="'+e.value+'" '})),totalfiles=t.files.length,totalfiles>0){for(var l=0;l<totalfiles;l++){if(t.files[l].size>sim.max_file_size)return display_message("File to big, max file size is "+parseInt(sim.max_file_size)/1024/1024+"MB","error"),void(t.value="");a.append("files[]",t.files[l])}var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<400?function(e){null!=file_upload_wrap.closest(".mce-container")&&window.tinyMCE.activeEditor.windowManager.close();for(var t=JSON.parse(e),a=0;a<t.length;a++){var l=t[a].url;null!=t[a].id&&(dataset_string+=' data-libraryid="'+t[a].id+'"');var o=l.split("/")[l.split("/").length-1],r=sim.base_url+"/"+l;if(null==t[a].id)var n=r;else n=t[a].id;if(null!=file_upload_wrap.closest(".mce-container"))window.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,'<p><a href="'+r+'">'+o+"</a></p>");else{var s="<div class='document'>";s+="<input type='hidden' name='"+file_upload_wrap.querySelector(".file_upload").name.replace("_files","")+"' value='"+n+"'>",null!=l.toLowerCase().match(/\.(jpe|jpeg|jpg|gif|png)$/)?s+='<a class="fileupload" href="'+r+'"><img src="'+r+'" alt="picture" style="width:150px;height:150px;"></a>':s+='<a class="fileupload" href="'+r+'">'+o+"</a>",s+='<button type="button" class="remove_document button" data-url="'+l+'" '+dataset_string+">X</button>",s+='<img class="remove_document_loader hidden" src="'+sim.loading_gif+'" style="height:40px;">',file_upload_wrap.querySelector(".documentpreview").insertAdjacentHTML("beforeend",s+"</div>")}}1==t.length?display_message("The file "+o+" has been uploaded succesfully.","success",!0):display_message("The files have been uploaded succesfully.","success",!0),0==file_upload_wrap.querySelector(".file_upload").multiple&&file_upload_wrap.querySelector(".upload_div").classList.add("hidden")}(o.responseText):display_message(JSON.parse(o.responseText).error,"error"),document.querySelectorAll(".loadergif_wrapper").forEach((function(e){e.classList.add("hidden")})),file_upload_wrap.querySelector(".file_upload").value="")},o.upload.addEventListener("progress",e,!1),o.open("POST",sim.ajax_url,!0),t.closest(".upload_div").querySelectorAll(".loadergif_wrapper").forEach((e=>{e.classList.remove("hidden"),e.querySelectorAll(".uploadmessage").forEach((e=>{totalfiles>1?e.textContent="Uploading documents":e.textContent="Uploading document"}))}));var r=document.createElement("progress");r.id="upload_progress",r.value="0",r.max="100",file_upload_wrap.appendChild(r);var n=document.createElement("span");n.id="progress_percentage",n.textContent="   0%",file_upload_wrap.appendChild(n),o.send(a)}else alert("Please select some files before hitting the uplad button!")}(a)})),{}})()}));
//# sourceMappingURL=fileupload.min.js.map