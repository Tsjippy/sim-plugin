!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.FormSubmit=r():e.FormSubmit=r()}(self,(()=>(()=>{"use strict";var e={d:(r,t)=>{for(var o in t)e.o(t,o)&&!e.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:t[o]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};function t(e){e.reset(),e.querySelectorAll(".loadergif").forEach((e=>e.classList.add("hidden"))),e.querySelectorAll(".multistepcontrols .form_submit").forEach((e=>e.classList.add("hidden"))),e.querySelectorAll("[required]").forEach((e=>{e.required=!1})),e.querySelectorAll(".file_upload").forEach((e=>e.value="")),e.querySelectorAll(".upload_div.hidden").forEach((e=>e.classList.remove("hidden"))),e.querySelectorAll("select").forEach((e=>e._niceselect.update())),document.querySelectorAll(".documentpreview .document").forEach((e=>e.remove())),null!=e.querySelector(".formstep")&&(e.querySelectorAll(".multistepcontrols .step.finish").forEach((e=>e.classList.remove("finish"))),FormFunctions.showTab(0,e))}async function o(e,r){let t=e.closest("form"),o=!0;if(t.querySelectorAll(".hidden [required], select[required], .nice-select-search[required], .stephidden [required]").forEach((e=>{e.required=!1})),t.querySelectorAll("[disabled][required]").forEach((e=>{e.disabled=!1,e.classList.add("was-disabled")})),o=t.reportValidity(),o){e.closest(".submit_wrapper").querySelectorAll(".loadergif").forEach((e=>e.classList.remove("hidden"))),"undefined"!=typeof tinymce&&tinymce.get().forEach((e=>{e.hidden||e.save()}));let o=new FormData(t);t.querySelectorAll(".was-disabled").forEach((e=>{e.disabled=!0,e.classList.remove("was-disabled")})),"true"==t.dataset.addempty&&t.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach((e=>{o.has(e.name)||o.append(e.name,"")}));try{location.search.split("?")[1].split("&").forEach((e=>{let r=e.split("=");"formbuilder"!=r[0]&&"main_tab"!=r[0]&&"second_tab"!=r[0]&&o.append(r[0],r[1])}))}catch{}let a=await s(r,o);return t.querySelectorAll(".submit_wrapper .loadergif").forEach((e=>e.classList.add("hidden"))),l(),a}return t.querySelectorAll(":invalid").forEach((e=>{null!=e.validationMessage&&Main.displayMessage(`${e.name} has an error:\n${e.validationMessage}`,"error").then((r=>{t.querySelectorAll(".formstep:not(.stephidden)").forEach((e=>e.classList.add("stephidden"))),e.closest(".stephidden").classList.remove("stephidden"),e.focus(),e.scrollIntoView(),e.focus()}))})),!1}function l(e=""){console.log(e),document.querySelectorAll("[data-pending]").forEach((e=>{e.removeAttribute("data-pending")})),document.querySelectorAll("form input:not([type=radio], [type=checkbox]), form textarea").forEach((e=>{e.defaultValue=e.value})),document.querySelectorAll("form input[type=radio], form input[type=checkbox]").forEach((e=>{e.checked&&(e.defaultChecked=!0)})),document.querySelectorAll("form select").forEach((e=>{e.options[e.selectedIndex].defaultSelected=!0}))}async function s(e,r="",t=!0){let o;""==r&&(r=new FormData),r.append("_wpnonce",sim.restNonce);try{o=await fetch(`${sim.baseUrl}/wp-json/sim/v2/${e}`,{method:"POST",credentials:"same-origin",body:r})}catch(e){console.error(e)}let l=await o.text();try{let e=JSON.parse(l);return o.ok?e:"rest_cookie_invalid_nonce"==e.code?(Main.displayMessage("Please refresh the page and try again!","error"),!1):(console.error(e),Main.displayMessage(e.message,"error"),!1)}catch(r){if(console.error(r),console.error(o),console.error(l),o.ok)t&&Main.displayMessage("Problem parsing the json, refresh the page or try again.","error"),console.error(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}`),console.error(l);else{let r="<div id='response-details' class=\"modal hidden\" style='z-index:9999999999;'>";r+="<div class=\"modal-content\" style='max-width: min(1000px,100%);'>",r+='<span class="close">&times;</span>',r+=l,r+="</div>",r+="</div>",document.querySelector("body").insertAdjacentHTML("afterBegin",r),Main.displayMessage(`Error loading url ${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}<br><button class='button small' id='error-details' onclick='(function(){ document.getElementById("response-details").classList.remove("hidden"); })();'>Details</button><br><div class='hidden response-message'>${l}</div>`,"error")}return!1}}return e.r(r),e.d(r,{fetchRestApi:()=>s,formReset:()=>t,markComplete:()=>l,submitForm:()=>o}),console.log("formsubmit loaded"),document.querySelectorAll("form.sim_form").forEach((e=>e.addEventListener("submit",l))),window.addEventListener("beforeunload",(e=>{document.querySelectorAll("[data-pending]").forEach((r=>{console.log(`${r.defaultValue} - ${r.value}`),e.preventDefault(),e.returnValue="test2"})),document.querySelectorAll("form.sim_form input:not([type=radio], [type=checkbox]), form textarea").forEach((r=>{r.defaultValue!=r.value&&(console.log(`${r.defaultValue} - ${r.value}`),e.preventDefault(),e.returnValue="test2")})),document.querySelectorAll("form.sim_form input[type=radio], form input[type=checkbox]").forEach((r=>{r.defaultChecked!=r.checked&&(console.log(`${r.defaultValue} - ${r.value}`),e.preventDefault(),e.returnValue="test2")})),document.querySelectorAll("form.sim_form select").forEach((r=>{0==r.selectedIndex||null==r.options[r.selectedIndex]||r.options[r.selectedIndex].defaultSelected||(console.log(r),console.log(r.options[r.selectedIndex].defaultSelected),e.preventDefault(),e.returnValue="test2")}))})),r})()));
//# sourceMappingURL=FormSubmit.min.js.map