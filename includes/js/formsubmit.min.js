!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormSubmit=t():e.FormSubmit=t()}(self,()=>(()=>{"use strict";var e={d:(t,l)=>{for(var r in l)e.o(l,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:l[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function l(e){e.reset(),e.querySelectorAll(".loader-wrapper").forEach(e=>e.classList.add("hidden")),e.querySelectorAll(".multistepcontrols .form-submit").forEach(e=>e.classList.add("hidden")),e.querySelectorAll("[required]").forEach(e=>{e.required=!1}),e.querySelectorAll(".file_upload").forEach(e=>e.value=""),e.querySelectorAll(".upload-div.hidden").forEach(e=>e.classList.remove("hidden")),document.querySelectorAll(".documentpreview .document").forEach(e=>e.remove()),null!=e.querySelector(".formstep")&&(e.querySelectorAll(".multistepcontrols .step.finish").forEach(e=>e.classList.remove("finish")),FormFunctions.showTab(0,e))}async function r(e,t,l=""){let r=e.closest("form"),a=!0;if(r.querySelectorAll(".hidden [required], select[required], .nice-select-search[required], .step-hidden [required]").forEach(e=>{e.required=!1}),r.querySelectorAll(".list-selection-list").forEach(e=>e.closest(".option-wrapper").querySelector("input[type='text']").required=!1),r.querySelectorAll("[disabled][required]").forEach(e=>{e.disabled=!1,e.classList.add("was-disabled")}),a=r.reportValidity(),a){let a=e.innerHTML,n=a.split(" ")[0];"e"==n.charAt(n.length-1)?n="i"==n.charAt(n.length-2)?n.substring(0,n.length-2)+"y":n.substring(0,n.length-1):n.charAt(n.length-2)!=n.charAt(n.length-1)&&(n+=n.substring(n.length-1,n.length)),n+="ing...",e.innerHTML=Main.showLoader(null,!1,20,n,!0,!0),"undefined"!=typeof tinymce&&tinymce.get().forEach(e=>{e.hidden||e.save()}),document.querySelectorAll("select[multiple]:not([name$=\\[\\]])").forEach(e=>{console.error(`Multi select ${e.name} should have [] at the end. I have fixed it for now`),e.name=e.name+"[]"});let i=new FormData(r);""!=l&&i.append("extra",l),r.querySelectorAll(".was-disabled").forEach(e=>{e.disabled=!0,e.classList.remove("was-disabled")}),1==r.dataset.addEmpty&&r.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach(e=>{i.has(e.name)||i.append(e.name,"")});try{location.search.split("?")[1].split("&").forEach(e=>{let t=e.split("=");"formbuilder"!=t[0]&&"main-tab"!=t[0]&&"second-tab"!=t[0]&&i.append(t[0],t[1])})}catch{}let c=await s(t,i);return e.innerHTML=a,1!=r.dataset.reset&&o(),c}return r.querySelectorAll(":invalid").forEach(e=>{null!=e.validationMessage&&Main.displayMessage(`${e.name} has an error:\n${e.validationMessage}`,"error").then(t=>{r.querySelectorAll(".formstep:not(.step-hidden)").forEach(e=>e.classList.add("step-hidden")),null!=e.closest(".step-hidden")&&e.closest(".step-hidden").classList.remove("step-hidden"),e.focus(),e.scrollIntoView(),e.focus()})}),!1}function o(){document.querySelectorAll("[data-pending]").forEach(e=>{e.removeAttribute("data-pending")}),document.querySelectorAll("form input:not([type=radio], [type=checkbox]), form textarea").forEach(e=>{e.defaultValue=e.value}),document.querySelectorAll("form input[type=radio], form input[type=checkbox]").forEach(e=>{e.checked&&(e.defaultChecked=!0)}),document.querySelectorAll("form select").forEach(e=>{-1!=e.selectedIndex&&null!=e.options[e.selectedIndex]&&(e.options[e.selectedIndex].defaultSelected=!0)})}async function s(e,t="",l=!0){let r;""==t&&(t=new FormData),t.append("_wpnonce",sim.restNonce);try{r=await fetch(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}`,{method:"POST",credentials:"same-origin",body:t})}catch(e){console.error(e)}let o=await r.text();try{let t=JSON.parse(o);return r.ok?t:"rest_cookie_invalid_nonce"==t.code?(Main.displayMessage("Please refresh the page and try again!","error"),!1):(console.error(e),console.error(t),null==t.data||403==t.data.status?Main.displayMessage(t.message):Main.displayMessage(t.message+"\n"+JSON.stringify(t.data),"error"),!1)}catch(t){if(console.error(t),console.error(r),console.error(o),r.ok)l&&Main.displayMessage("Problem parsing the json, refresh the page or try again.","error"),console.error(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}`),console.error(o);else{let t="<div id='response-details' class=\"modal hidden\" style='z-index:9999999999;'>";t+="<div class=\"modal-content\" style='max-width: min(1000px,100%);'>",t+='<span class="close">&times;</span>',t+=o,t+="</div>",t+="</div>",document.querySelector("body").insertAdjacentHTML("afterBegin",t),Main.displayMessage(`Error loading url ${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}<br><button class='button small' id='error-details' onclick='(function(){ document.getElementById("response-details").classList.remove("hidden"); })();'>Details</button><br><div class='hidden response-message'>${o}</div>`,"error")}return!1}}e.r(t),e.d(t,{fetchRestApi:()=>s,formReset:()=>l,markComplete:()=>o,submitForm:()=>r}),console.log("formsubmit loaded"),document.querySelectorAll("form.sim-form-wrapper").forEach(e=>e.addEventListener("submit",o)),window.addEventListener("beforeunload",e=>{null==document.querySelector(".loader-wrapper:not(.hidden)")&&(document.querySelectorAll("[data-pending]").forEach(t=>{console.log(t),console.log(`${t.defaultValue} - ${t.value}`),e.preventDefault()}),document.querySelectorAll("form.sim-form-wrapper input:not([type=radio], [type=checkbox]), form textarea").forEach(t=>{t.defaultValue!=t.value&&(console.log(t),console.log(`${t.defaultValue} - ${t.value}`),e.preventDefault())}),document.querySelectorAll("form.sim-form-wrapper input[type=radio], form input[type=checkbox]").forEach(t=>{t.defaultChecked!=t.checked&&(console.log(t),console.log(`${t.defaultChecked} - ${t.checked}`),e.preventDefault())}),document.querySelectorAll("form.sim-form-wrapper select").forEach(t=>{0==t.selectedIndex||null==t.options[t.selectedIndex]||t.options[t.selectedIndex].defaultSelected||(console.log(t),console.log(t.options[t.selectedIndex].defaultSelected),e.preventDefault())}))}),document.addEventListener("focusout",e=>{e.target.matches(":invalid:not(select)")&&e.target.reportValidity()}),document.addEventListener("input",e=>{e.target.matches(":invalid"),e.target.matches(".datalistinput.multiple")&&(null!=e.target.list&&null!=e.target.list.querySelector(`[value="${e.target.value}"]`)?n(e.target):e.target.closest(".multi-text-input-wrapper").querySelector(".add-list-selection").classList.remove("hidden"))}),document.addEventListener("click",e=>{e.target.matches(".selected-name")?(e.target.closest(".option-wrapper").querySelector("input[type='text']").value=e.target.closest(".list-selection").querySelector("input").value,e.target.closest(".option-wrapper").querySelector(".add-list-selection").classList.remove("hidden"),e.target.closest(".list-selection").remove(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()):e.target.matches(".remove-list-selection")?e.target.closest(".list-selection").remove():e.target.matches(".add-list-selection")&&n(e.target.closest(".multi-text-input-wrapper").querySelector(".datalistinput"))}),document.addEventListener("keyup",function(e){["Enter","NumpadEnter"].includes(e.key)&&null==a.Shift&&document.activeElement.matches(".datalistinput")&&n(document.activeElement),delete a[e.key]});let a={};function n(e){if(e.closest(".multi-text-input-wrapper").querySelector(".add-list-selection").classList.add("hidden"),""==e.value)return;let t=document.createElement("li");t.classList.add("list-selection");let l,r,o,s='<button type="button" class="small remove-list-selection"><span class=\'remove-list-selection\'>Ã—</span></button>';null!=e.list&&(l=e.list.querySelector(`[value="${e.value}"]`)),null!=l&&null!=l.dataset.value?(r=l.dataset.value,o=e.value):(r=e.value,o=e.value),s+=`<input type='hidden' class='no-reset' class='no-reset' name='${e.id}[]' value='${r}'>`,s+=`<span class='selected-name'>${o}</span>`,t.innerHTML=s,e.closest(".option-wrapper").querySelector(".list-selection-list").appendChild(t),e.value=""}return document.addEventListener("keydown",e=>{a[e.key]=!0}),t})());
//# sourceMappingURL=FormSubmit.min.js.map