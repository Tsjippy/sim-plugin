!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormSubmit=t():e.FormSubmit=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var l in r)e.o(r,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:r[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e){e.reset(),e.querySelectorAll(".loadergif").forEach((e=>e.classList.add("hidden"))),e.querySelectorAll(".multistepcontrols .form_submit").forEach((e=>e.classList.add("hidden"))),e.querySelectorAll("[required]").forEach((e=>{e.required=!1})),e.querySelectorAll(".file_upload").forEach((e=>e.value="")),e.querySelectorAll(".upload_div.hidden").forEach((e=>e.classList.remove("hidden"))),e.querySelectorAll("select").forEach((e=>e._niceselect.update())),document.querySelectorAll(".documentpreview .document").forEach((e=>e.remove())),null!=e.querySelector(".formstep")&&(e.querySelectorAll(".multistepcontrols .step.finish").forEach((e=>e.classList.remove("finish"))),FormFunctions.showTab(0,e))}async function l(e,t,r=""){let l=e.closest("form"),s=!0;if(l.querySelectorAll(".hidden [required], select[required], .nice-select-search[required], .stephidden [required]").forEach((e=>{e.required=!1})),l.querySelectorAll("[disabled][required]").forEach((e=>{e.disabled=!1,e.classList.add("was-disabled")})),s=l.reportValidity(),s){e.closest(".submit_wrapper").querySelectorAll(".loadergif").forEach((e=>e.classList.remove("hidden"))),"undefined"!=typeof tinymce&&tinymce.get().forEach((e=>{e.hidden||e.save()}));let s=new FormData(l);""!=r&&s.append("extra",r),l.querySelectorAll(".was-disabled").forEach((e=>{e.disabled=!0,e.classList.remove("was-disabled")})),"true"==l.dataset.addempty&&l.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach((e=>{s.has(e.name)||s.append(e.name,"")}));try{location.search.split("?")[1].split("&").forEach((e=>{let t=e.split("=");"formbuilder"!=t[0]&&"main_tab"!=t[0]&&"second_tab"!=t[0]&&s.append(t[0],t[1])}))}catch{}document.querySelectorAll("select[multiple]").forEach((e=>{s.set(e.name,Array.from(e.selectedOptions,(e=>e.value)))}));let n=await a(t,s);return l.querySelectorAll(".submit_wrapper .loadergif").forEach((e=>e.classList.add("hidden"))),"true"!=l.dataset.reset&&o(),n}return l.querySelectorAll(":invalid").forEach((e=>{null!=e.validationMessage&&Main.displayMessage(`${e.name} has an error:\n${e.validationMessage}`,"error").then((t=>{l.querySelectorAll(".formstep:not(.stephidden)").forEach((e=>e.classList.add("stephidden"))),e.closest(".stephidden").classList.remove("stephidden"),e.focus(),e.scrollIntoView(),e.focus()}))})),!1}function o(){document.querySelectorAll("[data-pending]").forEach((e=>{e.removeAttribute("data-pending")})),document.querySelectorAll("form input:not([type=radio], [type=checkbox]), form textarea").forEach((e=>{e.defaultValue=e.value})),document.querySelectorAll("form input[type=radio], form input[type=checkbox]").forEach((e=>{e.checked&&(e.defaultChecked=!0)})),document.querySelectorAll("form select").forEach((e=>{-1!=e.selectedIndex&&null!=e.options[e.selectedIndex]&&(e.options[e.selectedIndex].defaultSelected=!0)}))}async function a(e,t="",r=!0){let l;""==t&&(t=new FormData),t.append("_wpnonce",sim.restNonce);try{l=await fetch(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}`,{method:"POST",credentials:"same-origin",body:t})}catch(e){console.error(e)}let o=await l.text();try{let e=JSON.parse(o);return l.ok?e:"rest_cookie_invalid_nonce"==e.code?(Main.displayMessage("Please refresh the page and try again!","error"),!1):(console.error(e),null==e.data?Main.displayMessage(e.message):Main.displayMessage(e.message+"\n"+JSON.stringify(e.data),"error"),!1)}catch(t){if(console.error(t),console.error(l),console.error(o),l.ok)r&&Main.displayMessage("Problem parsing the json, refresh the page or try again.","error"),console.error(`${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}`),console.error(o);else{let t="<div id='response-details' class=\"modal hidden\" style='z-index:9999999999;'>";t+="<div class=\"modal-content\" style='max-width: min(1000px,100%);'>",t+='<span class="close">&times;</span>',t+=o,t+="</div>",t+="</div>",document.querySelector("body").insertAdjacentHTML("afterBegin",t),Main.displayMessage(`Error loading url ${sim.baseUrl}/wp-json${sim.restApiPrefix}/${e}<br><button class='button small' id='error-details' onclick='(function(){ document.getElementById("response-details").classList.remove("hidden"); })();'>Details</button><br><div class='hidden response-message'>${o}</div>`,"error")}return!1}}function s(e){if(e.closest(".multi-text-input-wrapper").querySelector(".add-list-selection").classList.add("hidden"),""==e.value)return;let t=document.createElement("li");t.classList.add("listselection");let r,l,o='<button type="button" class="small remove-list-selection"><span class=\'remove-list-selection\'>Ã—</span></button>',a=e.list.querySelector(`[value="${e.value}"]`);null!=a&&null!=a.dataset.value?(r=a.dataset.value,l=e.value):(r=e.value,l=e.value),o+=`<input type='hidden' name='${e.id}[]' value='${r}'>`,o+=`<span class='selectedname'>${l}</span>`,t.innerHTML=o,e.closest(".optionwrapper").querySelector(".listselectionlist").appendChild(t),e.value=""}return e.r(t),e.d(t,{fetchRestApi:()=>a,formReset:()=>r,markComplete:()=>o,submitForm:()=>l}),console.log("formsubmit loaded"),document.querySelectorAll("form.sim-form-wrapper").forEach((e=>e.addEventListener("submit",o))),window.addEventListener("beforeunload",(e=>{null==document.querySelector(".loadergif:not(.hidden)")&&(document.querySelectorAll("[data-pending]").forEach((t=>{console.log(t),console.log(`${t.defaultValue} - ${t.value}`),e.preventDefault(),e.returnValue="test2"})),document.querySelectorAll("form.sim-form-wrapper input:not([type=radio], [type=checkbox]), form textarea").forEach((t=>{t.defaultValue!=t.value&&(console.log(t),console.log(`${t.defaultValue} - ${t.value}`),e.preventDefault(),e.returnValue="test2")})),document.querySelectorAll("form.sim-form-wrapper input[type=radio], form input[type=checkbox]").forEach((t=>{t.defaultChecked!=t.checked&&(console.log(t),console.log(`${t.defaultValue} - ${t.value}`),e.preventDefault(),e.returnValue="test2")})),document.querySelectorAll("form.sim-form-wrapper select").forEach((t=>{0==t.selectedIndex||null==t.options[t.selectedIndex]||t.options[t.selectedIndex].defaultSelected||(console.log(t),console.log(t.options[t.selectedIndex].defaultSelected),e.preventDefault(),e.returnValue="test2")})))})),document.addEventListener("focusout",(e=>{e.target.matches(":invalid:not(select)")&&e.target.reportValidity()})),document.addEventListener("input",(e=>{e.target.matches(":invalid"),e.target.matches(".datalistinput.multiple")&&(null!=e.target.list.querySelector(`[value="${e.target.value}"]`)?s(e.target):e.target.closest(".multi-text-input-wrapper").querySelector(".add-list-selection").classList.remove("hidden"))})),document.addEventListener("click",(e=>{e.target.matches(".remove-list-selection")?e.target.closest(".listselection").remove():e.target.matches(".add-list-selection")&&s(e.target.closest(".multi-text-input-wrapper").querySelector(".datalistinput"))})),t})()));
//# sourceMappingURL=FormSubmit.min.js.map