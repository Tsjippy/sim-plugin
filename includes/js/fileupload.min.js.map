{"version":3,"file":"fileupload.min.js","mappings":"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","sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/./fileupload.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"fileupload\"] = factory();\n\telse\n\t\troot[\"fileupload\"] = factory();\n})(self, function() {\nreturn ","console.log(\"Fileupload.js loaded\");\n\nif(window.tinyMCE != undefined){\n\tsim = tinyMCEPopup.getWindowArg('sim');\n}\n\nfunction file_upload(target){\n\tfile_upload_wrap = target.closest('.file_upload_wrap');\n\t\n\t//Create a formdata element\n\tvar form_data = new FormData();\n\t\n\t//Add the ajax action name\n\tform_data.append('action', 'upload_files');\n\t\n\tdataset_string = '';\n\t//Loop over the dataset attributes and add them to post\n\ttarget.parentNode.querySelectorAll('input').forEach(\n\t\tfunction(input){\n\t\t\tform_data.append(input.name, input.value);\n\t\t\tdataset_string += 'data-'+input.name+'=\"'+input.value+'\" ';\n\t\t}\n\t);\n\n\t// Read selected files\n\ttotalfiles = target.files.length;\n\tif (totalfiles > 0){\n\t\t//Add all the files to the formdata\n\t\tfor (var index = 0; index < totalfiles; index++) {\n\t\t\tif(target.files[index].size > sim.max_file_size){\n\t\t\t\tdisplay_message('File to big, max file size is '+(parseInt(sim.max_file_size)/1024/1024)+'MB','error');\n\t\t\t\ttarget.value = '';\n\t\t\t\treturn;\n\t\t\t}else{\n\t\t\t\tform_data.append('files[]', target.files[index]);\n\t\t\t}\n\t\t}\n\t}else{\n\t\talert(\"Please select some files before hitting the uplad button!\");\n\t\treturn;\n\t}\n\t\n\t//AJAX request\n\tvar request = new XMLHttpRequest();\n\t\n\t//Listen to the state changes\n\trequest.onreadystatechange = function(){\n\t\t//If finished\n\t\tif(request.readyState == 4){\n\t\t\t//Success\n\t\t\tif (request.status >= 200 && request.status < 400) {\n\t\t\t\tfile_upload_upload_succes(request.responseText)\n\t\t\t//Error\n\t\t\t}else{\n\t\t\t\tdisplay_message(JSON.parse(request.responseText).error,'error');\n\t\t\t}\n\t\t\t\n\t\t\t//Hide loading gif\n\t\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\n\t\t\t\tfunction(loader){\n\t\t\t\t\tloader.classList.add('hidden');\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\t\t\n\t\t\t//Clear the input\n\t\t\tfile_upload_wrap.querySelector('.file_upload').value = \"\";\n\t\t}\n\t};\n\t\n\t//Listen to the upload status\n\trequest.upload.addEventListener('progress', file_upload_progress, false);\n\t\n\trequest.open('POST', sim.ajax_url, true);\n\t\n\t//Show loading gif\n\ttarget.closest('.upload_div').querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\n\t\tloader.classList.remove('hidden');\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\n\t\t\t//Change message text\n\t\t\tif (totalfiles > 1){\n\t\t\t\tel.textContent = \"Uploading documents\";\n\t\t\t}else{\n\t\t\t\tel.textContent = \"Uploading document\";\n\t\t\t}\n\t\t});\n\t});\n\t\n\t//Create a progressbar\n\tvar progressbar = document.createElement('progress');\n\tprogressbar.id = \"upload_progress\";\n\tprogressbar.value=\"0\";\n\tprogressbar.max=\"100\";\n\tfile_upload_wrap.appendChild(progressbar);\n\tvar progress_percentage = document.createElement('span');\n\tprogress_percentage.id = \"progress_percentage\";\n\tprogress_percentage.textContent=\"   0%\"\n\tfile_upload_wrap.appendChild(progress_percentage);\n\t\n\t//Send AJAX request\n\trequest.send(form_data);\n}\n\nfunction file_upload_progress(e){\n\tif(e.lengthComputable){\n\t\tvar max = e.total;\n\t\tvar current = e.loaded;\n\n\t\tvar Percentage = (current * 100)/max;\n\t\tPercentage = Math.round(Percentage*10)/10\n\t\t\n\t\tdocument.getElementById(\"upload_progress\").value = Percentage;\n\t\tdocument.getElementById(\"progress_percentage\").textContent = \"   \"+Percentage+\"%\";\n\n\t\tif(Percentage >= 99){\n\t\t\t//Remove progress barr\n\t\t\tdocument.getElementById(\"upload_progress\").remove();\n\t\t\tdocument.getElementById(\"progress_percentage\").remove();\n\t\t\t\n\t\t\t// process completed\n\t\t\tfile_upload_wrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\n\t\t\t\t//Change message text\n\t\t\t\tif (totalfiles > 1){\n\t\t\t\t\tel.textContent = \"Processing documents\";\n\t\t\t\t}else{\n\t\t\t\t\tel.textContent = \"Processing document\";\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}  \n}\n\nfunction file_upload_upload_succes(result){\n\tif(file_upload_wrap.closest('.mce-container') != null){\n\t\t//close the modal\n\t\twindow.tinyMCE.activeEditor.windowManager.close()\n\t}\t\n\t\n\tvar imgurls\t\t\t= JSON.parse(result);\n\t\n\tfor(var index = 0; index < imgurls.length; index++) {\n\t\tvar src = imgurls[index]['url'];\n\t\t\n\t\tif(imgurls[index]['id'] != undefined){\n\t\t\tdataset_string += ' data-libraryid=\"'+imgurls[index]['id']+'\"'\n\t\t}\n\t\t\n\t\tvar filename \t= src.split(\"/\")[src.split(\"/\").length-1];\n\t\t\n\t\tvar url \t\t= sim.base_url+'/'+src;\n\n\t\tif(imgurls[index]['id'] == undefined){\n\t\t\tvar value\t\t= url;\n\t\t}else{\n\t\t\tvar value\t\t= imgurls[index]['id'];\n\t\t}\n\n\t\t//Add link to tinymce\n\t\tif(file_upload_wrap.closest('.mce-container') != null){\n\t\t\twindow.tinyMCE.activeEditor.execCommand( 'mceInsertContent', false, '<p><a href=\"'+url+'\">'+filename+'</a></p>' );\n\t\t}else{\n\t\t\tvar html = \"<div class='document'>\";\n\t\t\thtml += \"<input type='hidden' name='\"+file_upload_wrap.querySelector('.file_upload').name.replace('_files','')+\"' value='\"+value+\"'>\";\n\t\t\t//is image\n\t\t\tif (src.toLowerCase().match(/\\.(jpe|jpeg|jpg|gif|png)$/) != null){\n\t\t\t\t//Add the image\n\t\t\t\thtml += '<a class=\"fileupload\" href=\"'+url+'\"><img src=\"'+url+'\" alt=\"picture\" style=\"width:150px;height:150px;\"></a>';\n\t\t\t}else{\n\t\t\t\t//Add a link\n\t\t\t\thtml += '<a class=\"fileupload\" href=\"'+url+'\">' + filename + '</a>';\n\t\t\t}\n\t\t\t\n\t\t\t//Add an remove button\n\t\t\thtml += '<button type=\"button\" class=\"remove_document button\" data-url=\"' + src + '\" ' + dataset_string +'>X</button>';\n\t\t\thtml += '<img class=\"remove_document_loader hidden\" src=\"' + sim.loading_gif + '\" style=\"height:40px;\">';\n\t\t\tfile_upload_wrap.querySelector('.documentpreview').insertAdjacentHTML('beforeend', html + '</div>');\n\t\t}\n\t}\n\t\n\tif(imgurls.length==1){\n\t\tdisplay_message(\"The file \" + filename + \" has been uploaded succesfully.\",'success',true);\n\t}else{\n\t\tdisplay_message(\"The files have been uploaded succesfully.\",'success',true);\n\t}\n\t\n\t//Hide upload button if only one file allowed\n\tif(file_upload_wrap.querySelector('.file_upload').multiple == false){\n\t\tfile_upload_wrap.querySelector('.upload_div').classList.add('hidden');\n\t}\n}\n\nwindow['afterdocumentremove'] = function(result,responsdata){\n\tvar docwrapper\t\t\t= document.querySelector('.remove_document[data-url=\"'+responsdata.url+'\"').closest('.document');\n\tvar file_upload_wrap\t= docwrapper.closest('.file_upload_wrap');\n\t\n\t//hide the loading gif\n\tdocwrapper.querySelector('.remove_document_loader').classList.add('hidden');\n\t\t\n\t// If successful\n\tif (result.status >= 200 && result.status < 400) {\n\t\ttry{\n\t\t\t//show the upload field\n\t\t\tfile_upload_wrap.querySelector('.upload_div').classList.remove('hidden');\n\t\t}catch{\n\t\t\t//remove featured image id\n\t\t\tdocument.querySelector('[name=\"post_image_id\"]').value = '';\n\t\t}\n\t\t\n\t\t//remove the document/picture\n\t\tdocwrapper.remove();\n\t\t\n\t\tre = new RegExp('(.*)[0-9](.*)',\"g\");\n\t\t//reindex documents\n\t\tfile_upload_wrap.querySelectorAll('.file_url').forEach((el,index)=>{\n\t\t\tel.name = el.name.replace(re, '$1'+index+'$2');\n\t\t});\n\t}\n}\n\nfunction remove_document(target){\n\tvar data = new FormData();\n\tdata.append(\"action\",\"remove_document\");\n\t\t\n\t//Loop over the dataset attributes and add them to post\n\tfor(var d in target.dataset){\n\t\tif(target.dataset[d] != ''){\n\t\t\tdata.append(d,target.dataset[d]);\n\t\t}\n\t}\n\t\n\t//hide the remove button\n\ttarget.style.display = \"none\";\n\t\n\t//add an id to the remove button so we can query for it later\n\ttarget.parentNode.classList.add('removethisdocument');\n\t\n\t//show loader\n\ttarget.parentNode.querySelector('.remove_document_loader').classList.remove('hidden');\n\t\n\tsendAJAX(data);\n}\n\n//Remove picture on button click\nwindow.addEventListener(\"click\", function(event) {\n\tvar target = event.target;\n\t\n\tif (target.className.includes(\"remove_document\")){\n\t\tremove_document(target);\n\t}\n});\n\nwindow.addEventListener(\"change\", event => {\n\tvar target = event.target;\n\n\tif (target.className.includes(\"file_upload\")){\n\t\tfile_upload(target);\n\t}\n});"],"names":["root","factory","exports","module","define","amd","self","file_upload_progress","e","lengthComputable","max","total","Percentage","loaded","Math","round","document","getElementById","value","textContent","remove","file_upload_wrap","querySelectorAll","forEach","el","totalfiles","console","log","undefined","window","tinyMCE","sim","tinyMCEPopup","getWindowArg","result","responsdata","docwrapper","querySelector","url","closest","classList","add","status","re","RegExp","index","name","replace","addEventListener","event","target","className","includes","data","FormData","d","append","dataset","style","display","parentNode","sendAJAX","remove_document","form_data","dataset_string","input","files","length","size","max_file_size","display_message","parseInt","request","XMLHttpRequest","onreadystatechange","readyState","activeEditor","windowManager","close","imgurls","JSON","parse","src","filename","split","base_url","execCommand","html","toLowerCase","match","loading_gif","insertAdjacentHTML","multiple","file_upload_upload_succes","responseText","error","loader","upload","open","ajax_url","progressbar","createElement","id","appendChild","progress_percentage","send","alert","file_upload"],"sourceRoot":""}