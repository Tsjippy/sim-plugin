{"version":3,"file":"fileupload.min.js","mappings":"MAAAA,QAAQC,IAAI,wBAEZ,IAAIC,EAAe,EACfC,EAAkB,GAClBC,EAAiB,GAErB,SAASC,EAAkBC,EAAQC,GAElCD,EAAOE,QAAQ,eAAeC,iBAAiB,sBAAsBC,SAAQC,IAC5EA,EAAOC,UAAUC,OAAO,UACxBF,EAAOF,iBAAiB,kBAAkBC,SAAQI,IACjDA,EAAGC,YAAc,mBACjBD,EAAGF,UAAUI,IAAI,wBAInBC,KAAO,qLAOPd,EAAee,mBAAmB,YAAaD,MAGhD,SAASE,EAAWC,EAAMC,GACzB,IAEIJ,EAAO,8DAFCd,EAAemB,cAAc,gBAAgBC,KAAKC,QAAQ,SAAS,eAIjCH,YAC3CD,0DACgDK,IAAIC,8CAKvD,OAFAvB,EAAemB,cAAc,oBAAoBJ,mBAAmB,YAAaD,GAE1Ed,EAAemB,cAAc,8BAiGrC,SAASK,EAAmBC,GAC3B,GAAGA,EAAEC,iBAAiB,CACrB,IAAIC,EAAMF,EAAEG,MAGRC,EAAwB,IAFdJ,EAAEK,OAEiBH,EACjCE,EAAaE,KAAKC,MAAiB,GAAXH,GAAe,GAEvCI,SAASC,eAAe,mBAAmBhB,MAAWW,EACtDI,SAASC,eAAe,uBAAuBtB,YAAc,MAAMiB,KAEhEA,GAAc,KAEhBI,SAASC,eAAe,oBAAoBxB,SAG5CV,EAAeM,iBAAiB,kBAAkBC,SAAQI,IAGxDA,EAAGC,YADAb,EAAa,EACC,uBAEA,2BA4GtBoC,eAAeC,EAAYC,GAC1B,IAAIC,EAAW,IAAIC,cAAcC,YAAYH,GACzCI,QAAgBH,EAASI,cAG7B,IAAID,EAUH,OARAzC,EAAemB,cAAc,gBAAgBD,MAAQ,GAGrDe,SAASC,eAAe,oBAAoBxB,SAG5CuB,SAASd,cAAc,mCAAmCV,UAAUI,IAAI,WAEjE,EAIR,GAAId,EAAa,EAChB,IAAI4C,EAAI,SAEJA,EAAI,GAGTF,EAAOG,QAAQC,WAAe,SAASC,EAAeC,GAErD,IAAIlB,GAAciB,EAAgBC,EAAa,KAAKC,QAAQ,GAG5Df,SAASC,eAAe,mBAAmBhB,MAAUW,EACrDI,SAASC,eAAe,uBAAuBtB,YAAc,MAAMiB,KAEhEA,EAAW,KACbI,SAASd,cAAc,mBAAmBP,YAAc,mBAAmB+B,EAC3EV,SAASC,eAAe,oBAAoBzB,UAAUI,IAAI,YAI5D4B,EAAOG,QAAQK,UAAed,iBAC7B,IAAIe,EAASZ,EAASa,YAAYD,OAE9BE,EAAW,IAAIC,SACbD,EAASE,OAAO,UAAWJ,GAE3B,IAAIK,EAAU,IAAIC,eAClBD,EAAQE,KAAK,OAAQnC,IAAIoC,QAAQ,4CAA4C,GAC7EH,EAAQI,KAAKP,GAGnBnB,SAASC,eAAe,oBAAoBxB,SAS5C,IAAIkD,EAAW5C,EAPJ,6IAGqCsB,EAASa,YAAYU,4HAIrCX,GAGhCjB,SAASd,cAAc,mCAAmCV,UAAUI,IAAI,UAExEiD,KAAKC,eAAe,YAAY1B,EAAKjB,sCAAsC,WAAU,GAGzB,GAAzDpB,EAAemB,cAAc,gBAAgB6C,UAC/ChE,EAAemB,cAAc,eAAeV,UAAUI,IAAI,UAI3Db,EAAemB,cAAc,gBAAgBD,MAAQ,GAErDoB,EAAS2B,WAAWC,aAAa5B,EAASa,YAAYgB,eAGtD,IAAIC,EAAWnC,SAASC,eAAe,YACxB,MAAZkC,IACFA,EAASjD,cAAc,mBAAmBD,MAAS,OACnDkD,EAASjD,cAAc,oBAAoBD,MAAQgC,GAKpD,IADA,IAAImB,EAAS,IACNA,EAAOC,UACP,IAAIC,SAAQC,GAAOC,WAAWD,EAAK,OACrCH,QAAeK,MAClB,6DAA6DpC,EAASa,YAAYU,UAClF,CAACc,OAAQ,QAGX,IAAIC,QAAiBP,EAAOQ,OAE5BjB,EAAQzC,cAAc,kBAAkB2D,UAAYF,EAAS9D,MAG9D2B,EAAOG,QAAQmC,QAAe,SAASC,GACtCnF,QAAQmF,MAAM,mBAAqBA,IAIpC/C,SAASd,cAAc,mBAAmBP,YAAc,kBAAkB+B,EAC1EV,SAASC,eAAe,oBAAoBzB,UAAUC,OAAO,UAE7D+B,EAAOwC,QAIRC,OAAOC,iBAAiB,SAAS,SAASC,GACzC,IAAIjF,EAASiF,EAAMjF,OAEfA,EAAOkF,UAAUC,SAAS,qBAC7BF,EAAMG,iBAzKRpD,eAA8BhC,GAC7B,IAAIqF,EAAO,IAAInC,SAEf,IAAI,IAAIoC,KAAKtF,EAAOuF,QACK,IAArBvF,EAAOuF,QAAQD,IACjBD,EAAKlC,OAAOmC,EAAEtF,EAAOuF,QAAQD,IAK/BtF,EAAOwF,MAAMC,QAAU,OAGvBzF,EAAO0F,WAAWpF,UAAUI,IAAI,sBAGhCV,EAAO0F,WAAW1E,cAAc,2BAA2BV,UAAUC,OAAO,UAE5E,IAAIkE,QAAiBkB,WAAWC,aAAa,kBAAmBP,GAEhE,GAAGZ,EAAS,CACX,IAAIoB,EAAe7F,EAAOE,QAAQ,aAC9BL,EAAkBiG,WAAW5F,QAAQ,qBAGzC4F,WAAW9E,cAAc,2BAA2BV,UAAUI,IAAI,UAGlE,IAECb,EAAemB,cAAc,eAAeV,UAAUC,OAAO,UAC7D,MAEAuB,SAASd,cAAc,0BAA0BD,MAAQ,GAI1D8E,EAAWtF,SAEX,IAAIwF,EAAK,IAAIC,OAAO,gBAAgB,KAEpCnG,EAAeM,iBAAiB,aAAaC,SAAQ,CAACI,EAAGyF,KACxDzF,EAAGS,KAAOT,EAAGS,KAAKC,QAAQ6E,EAAI,KAAKE,EAAM,SAG1CtC,KAAKC,eAAea,IA6HpByB,CAAelG,OAIjB+E,OAAOC,iBAAiB,UAAUC,IACjC,IAAIjF,EAASiF,EAAMjF,OAEfA,EAAOkF,UAAUC,SAAS,iBAC7BF,EAAMG,iBAzVRpD,eAA0BhC,GACzBH,EAAiBG,EAAOE,QAAQ,qBAGhC,IAAI+C,EAAW,IAAIC,SAenB,GAZAD,EAASE,OAAO,SAAU,gBAG1BnD,EAAO0F,WAAWvF,iBAAiB,SAASC,SAC3C,SAAS+F,GACRlD,EAASE,OAAOgD,EAAMlF,KAAMkF,EAAMpF,OAClCjB,GAAiB,QAAQqG,EAAMlF,SAASkF,EAAMpF,WAKhDnB,EAAaI,EAAOoG,MAAMC,OACtBzG,EAAa,EAAjB,CAEC,IAAK,IAAIqG,EAAQ,EAAGA,EAAQrG,EAAYqG,IAEvC,GAA6C,SAA1CjG,EAAOoG,MAAMH,GAAOK,KAAKC,MAAM,KAAK,IAA0C,iBAAnB,cAC7DxG,EAAkBC,SAGZiC,EAAYjC,EAAOoG,MAAMH,QAE1B,IAAGjG,EAAOoG,MAAMH,GAAOO,KAAOrF,IAAIsF,YAGvC,OAFA9C,KAAKC,eAAe,kCAAmC8C,SAASvF,IAAIsF,aAAa,KAAK,KAAM,KAAK,cACjGzG,EAAOe,MAAQ,IAGfkC,EAASE,OAAO,UAAWnD,EAAOoG,MAAMH,IAS3C,GAA8B,MAA3BhD,EAAS0D,IAAI,WAAhB,CAKA,IAAIvD,EAAU,IAAIC,eAmClB,GAhCAD,EAAQwD,mBAAqB,WAEH,GAAtBxD,EAAQyD,aAENzD,EAAQ0D,QAAU,KAAO1D,EAAQ0D,OAAS,IAmEjD,SAA0B5C,GAGzB,IAFA,IAAI6C,EAAYC,KAAKC,MAAM/C,GAEnB+B,EAAQ,EAAGA,EAAQiB,QAAQb,OAAQJ,IAAS,CACnD,IAAIkB,EAAMD,QAAQjB,GAAY,IAEHmB,MAAxBL,EAAQd,GAAW,KACrBnG,GAAiB,oBAAoBoH,QAAQjB,GAAW,GAAE,KAG3D,IAAIoB,EAAYF,EAAIZ,MAAM,KAAKY,EAAIZ,MAAM,KAAKF,OAAO,GAEjDiB,EAAQnG,IAAIoC,QAAQ,IAAI4D,EAE5B,GAA2BC,MAAxBL,EAAQd,GAAW,GACrB,IAAIlF,EAASuG,OAETvG,EAASgG,EAAQd,GAAW,GAIjC,GAA4D,MAAxDkB,EAAII,cAAcC,MAAM,6BAE3B,IAAI1G,EAAO,+BAA+BwG,gBAAkBA,+DAGxDxG,EAAO,+BAA+BwG,MAAQG,eAInD5G,EAFAC,GAAQ,kEAAkEqG,MAAQrH,eAEjEiB,GAGC,GAAhBgG,EAAQV,OACV1C,KAAKC,eAAe,YAAYyD,mCAA0C,WAAU,GAEpF1D,KAAKC,eAAe,4CAA4C,WAAU,GAIf,GAAzD/D,EAAemB,cAAc,gBAAgB6C,UAC/ChE,EAAemB,cAAc,eAAeV,UAAUI,IAAI,UA3GxDgH,CAAiBtE,EAAQuE,cAGzBhE,KAAKC,eAAeoD,KAAKC,MAAM7D,EAAQuE,cAAc9C,MAAM,SAI5D/C,SAAS3B,iBAAiB,sBAAsBC,SAC/C,SAASC,GACRA,EAAOC,UAAUI,IAAI,aAKvBb,EAAemB,cAAc,gBAAgBD,MAAQ,KAKvDqC,EAAQd,OAAO0C,iBAAiB,WAAY3D,GAAoB,GAEhE+B,EAAQE,KAAK,OAAQnC,IAAIyG,SAAS,GAGlC7H,EAAkBC,GAGdJ,EAAa,EAChB,IAAI4C,EAAI,SAEJA,EAAI,GAETxC,EAAOE,QAAQ,eAAec,cAAc,kBAAkBP,YAAc,qBAAqB+B,EACjGV,SAASC,eAAe,oBAAoBzB,UAAUC,OAAO,UAE7D6C,EAAQI,KAAKP,SArDZU,KAAKC,eAAe,4DAA6D,SAoTjFiE,CAAW7H,Q","sources":["webpack://picture_select/./fileupload.js"],"sourcesContent":["console.log(\"Fileupload.js loaded\");\n\nlet totalFiles\t\t\t= 0;\nlet fileUploadWrap\t\t= '';\nlet datasetString\t\t= '';\n\nfunction createProgressBar(target, filetype){\n\t//Show loading gif\n\ttarget.closest('.upload_div').querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\n\t\tloader.classList.remove('hidden');\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\n\t\t\tel.textContent = \"Preparing upload\";\n\t\t\tel.classList.add('upload-message');\n\t\t});\n\t});\n\t\n\thtml\t= ` \n\t<div id=\"progress-wrapper\" class=\"hidden\">\n\t\t<progress id=\"upload_progress\" value=\"0\" max=\"100\"></progress>\n\t\t<span id=\"progress_percentage\">   0%</span>\n\t</div>\n\t`;\n\n\tfileUploadWrap.insertAdjacentHTML('beforeEnd', html);\n}\n\nfunction addPreview(link, value){\n\tvar name\t\t= fileUploadWrap.querySelector('.file_upload').name.replace('_files','');\n\n\tvar html = `\n\t<div class='document'>\n\t\t<input type='hidden' name='${name}' value='${value}'>\n\t\t${link}\n\t\t<img class=\"remove_document_loader hidden\" src=\"${sim.loadingGif}\" style=\"height:40px;\">\n\t</div>`;\n\n\tfileUploadWrap.querySelector('.documentpreview').insertAdjacentHTML('beforeend', html);\n\n\treturn fileUploadWrap.querySelector('.documentpreview .document');\n}\n\nasync function fileUpload(target){\n\tfileUploadWrap = target.closest('.file_upload_wrap');\n\t\n\t//Create a formData element\n\tvar formData = new FormData();\n\t\n\t//Add the ajax action name\n\tformData.append('action', 'upload_files');\n\t\n\t//Loop over the dataset attributes and add them to post\n\ttarget.parentNode.querySelectorAll('input').forEach(\n\t\tfunction(input){\n\t\t\tformData.append(input.name, input.value);\n\t\t\tdatasetString += `data-${input.name}=\"${input.value}`;\n\t\t}\n\t);\n\n\t// Read selected files\n\ttotalFiles = target.files.length;\n\tif (totalFiles > 0){\n\t\t//Add all the files to the formData\n\t\tfor (var index = 0; index < totalFiles; index++) {\n\t\t\t// file is a video and vimeo enabled\n\t\t\tif(target.files[index].type.split('/')[0] == 'video' && typeof(vimeoUploader) == 'object'){\n\t\t\t\tcreateProgressBar(target, 'video');\n\n\t\t\t\t//update post id on a postform\n\t\t\t\tawait uploadVideo(target.files[index]);\n\t\t\t// file to big\n\t\t\t}else if(target.files[index].size > sim.maxFileSize){\n\t\t\t\tmain.displayMessage('File too big, max file size is '+(parseInt(sim.maxFileSize)/1024/1024)+'MB','error');\n\t\t\t\ttarget.value = '';\n\t\t\t\treturn;\n\t\t\t}else{\n\t\t\t\tformData.append('files[]', target.files[index]);\n\t\t\t}\n\t\t}\n\t}else{\n\t\tmain.displayMessage(\"Please select some files before hitting the uplad button!\", 'error');\n\t\treturn;\n\t}\n\n\t// No files remaining to upload\n\tif(formData.get('files[]') == null){\n\t\treturn;\n\t}\n\t\n\t//AJAX request\n\tvar request = new XMLHttpRequest();\n\t\n\t//Listen to the state changes\n\trequest.onreadystatechange = function(){\n\t\t//If finished\n\t\tif(request.readyState == 4){\n\t\t\t//Success\n\t\t\tif (request.status >= 200 && request.status < 400) {\n\t\t\t\tfileUploadSucces(request.responseText)\n\t\t\t//Error\n\t\t\t}else{\n\t\t\t\tmain.displayMessage(JSON.parse(request.responseText).error,'error');\n\t\t\t}\n\t\t\t\n\t\t\t//Hide loading gif\n\t\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\n\t\t\t\tfunction(loader){\n\t\t\t\t\tloader.classList.add('hidden');\n\t\t\t\t}\n\t\t\t);\n\t\t\t\t\n\t\t\t//Clear the input\n\t\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\n\t\t}\n\t};\n\t\n\t//Listen to the upload status\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\n\t\n\trequest.open('POST', sim.ajaxUrl, true);\n\t\n\t//Create a progressbar\n\tcreateProgressBar(target, 'file');\n\t\n\t//Send AJAX request\n\tif (totalFiles > 1){\n\t\tvar s = \"s\";\n\t}else{\n\t\tvar s = \"\";\n\t}\n\ttarget.closest('.upload_div').querySelector('.uploadmessage').textContent = \"Uploading document\"+s;\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\n\n\trequest.send(formData);\n}\n\nfunction fileUploadProgress(e){\n\tif(e.lengthComputable){\n\t\tvar max = e.total;\n\t\tvar current = e.loaded;\n\n\t\tvar percentage = (current * 100)/max;\n\t\tpercentage = Math.round(percentage*10)/10\n\t\t\n\t\tdocument.getElementById(\"upload_progress\").value \t\t\t= percentage;\n\t\tdocument.getElementById(\"progress_percentage\").textContent\t= `   ${percentage}%`;\n\n\t\tif(percentage >= 99){\n\t\t\t//Remove progress barr\n\t\t\tdocument.getElementById(\"progress-wrapper\").remove();\n\t\t\t\n\t\t\t// process completed\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\n\t\t\t\t//Change message text\n\t\t\t\tif (totalFiles > 1){\n\t\t\t\t\tel.textContent = \"Processing documents\";\n\t\t\t\t}else{\n\t\t\t\t\tel.textContent = \"Processing document\";\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}  \n}\n\nfunction fileUploadSucces(result){\n\tvar imgUrls\t\t\t= JSON.parse(result);\n\t\n\tfor(var index = 0; index < imgurls.length; index++) {\n\t\tvar src = imgurls[index]['url'];\n\t\t\n\t\tif(imgUrls[index]['id'] != undefined){\n\t\t\tdatasetString += ' data-libraryid=\"'+imgurls[index]['id']+'\"'\n\t\t}\n\t\t\n\t\tvar fileName \t= src.split(\"/\")[src.split(\"/\").length-1];\n\t\t\n\t\tvar url \t\t= sim.baseUrl+'/'+src;\n\n\t\tif(imgUrls[index]['id'] == undefined){\n\t\t\tvar value\t\t= url;\n\t\t}else{\n\t\t\tvar value\t\t= imgUrls[index]['id'];\n\t\t}\n\n\t\t//is image\n\t\tif (src.toLowerCase().match(/\\.(jpe|jpeg|jpg|gif|png)$/) != null){\n\t\t\t//Add the image\n\t\t\tvar link\t= `<a class=\"fileupload\" href=\"${url}\"><img src=\"${url}\" alt=\"picture\" style=\"width:150px;height:150px;\"></a>`;\n\t\t}else{\n\t\t\t//Add a link\n\t\t\tvar link\t= `<a class=\"fileupload\" href=\"${url}\">${filename}</a>`;\n\t\t}\n\t\tlink += `<button type=\"button\" class=\"remove_document button\" data-url=\"${src}\" ${datasetString}>X</button>`;\n\n\t\taddPreview(link, value);\n\t}\n\t\n\tif(imgUrls.length==1){\n\t\tmain.displayMessage(`The file ${fileName} has been uploaded succesfully.`,'success',true);\n\t}else{\n\t\tmain.displayMessage(\"The files have been uploaded succesfully.\",'success',true);\n\t}\n\t\n\t//Hide upload button if only one file allowed\n\tif(fileUploadWrap.querySelector('.file_upload').multiple == false){\n\t\tfileUploadWrap.querySelector('.upload_div').classList.add('hidden');\n\t}\n}\n\nasync function removeDocument(target){\n\tvar data = new FormData();\t\t\n\t//Loop over the dataset attributes and add them to post\n\tfor(var d in target.dataset){\n\t\tif(target.dataset[d] != ''){\n\t\t\tdata.append(d,target.dataset[d]);\n\t\t}\n\t}\n\t\n\t//hide the remove button\n\ttarget.style.display = \"none\";\n\t\n\t//add an id to the remove button so we can query for it later\n\ttarget.parentNode.classList.add('removethisdocument');\n\t\n\t//show loader\n\ttarget.parentNode.querySelector('.remove_document_loader').classList.remove('hidden');\n\t\n\tvar response\t= await FormSubmit.fetchRestApi('remove_document', data);\n\n\tif(response){\n\t\tvar docWrapper\t\t\t= target.closest('.document');\n\t\tvar fileUploadWrap\t\t= docwrapper.closest('.file_upload_wrap');\n\t\t\n\t\t//hide the loading gif\n\t\tdocwrapper.querySelector('.remove_document_loader').classList.add('hidden');\n\t\t\t\n\t\t// If successful\n\t\ttry{\n\t\t\t//show the upload field\n\t\t\tfileUploadWrap.querySelector('.upload_div').classList.remove('hidden');\n\t\t}catch{\n\t\t\t//remove featured image id\n\t\t\tdocument.querySelector('[name=\"post_image_id\"]').value = '';\n\t\t}\n\t\t\n\t\t//remove the document/picture\n\t\tdocWrapper.remove();\n\t\t\n\t\tvar re = new RegExp('(.*)[0-9](.*)',\"g\");\n\t\t//reindex documents\n\t\tfileUploadWrap.querySelectorAll('.file_url').forEach((el,index)=>{\n\t\t\tel.name = el.name.replace(re, '$1'+index+'$2');\n\t\t});\n\n\t\tmain.displayMessage(response);\n\t}\n}\n\nfunction refreshVimeoiFrame(){\n\t// Show the vimeo video after 60 seconds when the video is hopefully rendered\n\tdocument.querySelectorAll('.vimeo-embed-container.loading iframe').forEach(el=>{\n\t\tel.src\t= el.src;\n\t});\n}\n\nasync function uploadVideo(file){\n\tvar uploader\t= new vimeoUploader.VimeoUpload(file);\n\tvar upload\t\t= await uploader.tusUploader();\n\n\t// Could not upload\n\tif(!upload){\n\t\t//clear file upload\n\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\n\t\t\t\t\n\t\t//Remove progress barr\n\t\tdocument.getElementById(\"progress-wrapper\").remove();\n\n\t\t// Hide the loader\n\t\tdocument.querySelector('.loadergif_wrapper:not(.hidden)').classList.add('hidden');\n\n\t\treturn false;\n\t}\n\n\t// Upload started\n\tif (totalFiles > 1){\n\t\tvar s = \"s\";\n\t}else{\n\t\tvar s = \"\";\n\t}\n\n\tupload.options.onProgress   = function(bytesUploaded, bytesTotal) {\n\t\t//calculate percentage\n\t\tvar percentage = (bytesUploaded / bytesTotal * 100).toFixed(2)\n\t\n\t\t//show percentage in progressbar\n\t\tdocument.getElementById(\"upload_progress\").value\t\t\t= percentage;\n\t\tdocument.getElementById(\"progress_percentage\").textContent\t= `   ${percentage}%`;\n\n\t\tif(percentage>98){\n\t\t\tdocument.querySelector('.upload-message').textContent = \"Processing video\"+s;\n\t\t\tdocument.getElementById('progress-wrapper').classList.add('hidden');\n\t\t}\n\t};\n\n\tupload.options.onSuccess    = async function() {\n\t\tvar postId\t= uploader.storedEntry.postId;\n\t\t// Add post id of the video to the form\n\t\tvar formData = new FormData();\n        formData.append('post_id', postId);\n    \n        var request = new XMLHttpRequest();\n        request.open('POST', sim.baseUrl+'/wp-json/sim/v1/vimeo/add_uploaded_vimeo', false);\n        request.send(formData);\n\n\t\t//Remove progress barr\n\t\tdocument.getElementById(\"progress-wrapper\").remove();\n\t\t\n\t\tlet link\t= `\n\t\t<div class=\"vimeo-wrapper\">\n\t\t\t<div class='vimeo-embed-container loading'>\n\t\t\t\t<iframe src='https://player.vimeo.com/video/${uploader.storedEntry.vimeoId}' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><br>\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tvar preview\t\t= addPreview(link, postId, postId);\n\n\t\t// Hide the loader\n\t\tdocument.querySelector('.loadergif_wrapper:not(.hidden)').classList.add('hidden');\n\n\t\tmain.displayMessage(`The file ${file.name} has been uploaded succesfully.`,'success',true);\n\t\t\n\t\t//Hide upload button if only one file allowed\n\t\tif(fileUploadWrap.querySelector('.file_upload').multiple == false){\n\t\t\tfileUploadWrap.querySelector('.upload_div').classList.add('hidden');\n\t\t}\n\n\t\t//clear file upload\n\t\tfileUploadWrap.querySelector('.file_upload').value = \"\";\n\t\t\n\t\tuploader.urlStorage.removeUpload(uploader.storedEntry.urlStorageKey);\n\n\t\t// check if we are uploading from frontend posting form\n\t\tvar postForm = document.getElementById('postform');\n\t\tif(postForm != null){\n\t\t\tpostForm.querySelector('[name=\"update\"]').value\t\t= 'true';\n\t\t\tpostForm.querySelector('[name=\"post_id\"]').value\t= postId;\n\t\t}\n\n\t\t// Wait for the video to be processed on Vimeo\n\t\tvar result\t= '';\n\t\twhile(!result.ok){\n\t\t\tawait new Promise(res => setTimeout(res, 10000));\n\t\t\tvar result = await fetch(\n\t\t\t\t`https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/${uploader.storedEntry.vimeoId}`,\n\t\t\t\t{method: 'GET'}\n\t\t\t);\n\t\t}\n\t\tvar response\t= await result.json();\n\n\t\tpreview.querySelector('.vimeo-wrapper').innerHTML = response.html;\n\t}\n\n\tupload.options.onError      = function(error) {\n\t\tconsole.error(\"Failed because: \" + error);\t\t\t\t\n\t\treturn;\n\t}\n\n\tdocument.querySelector('.upload-message').textContent = \"Uploading video\"+s;\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\n\n\tupload.start();\n}\n\n//Remove picture on button click\nwindow.addEventListener(\"click\", function(event) {\n\tvar target = event.target;\n\t\n\tif (target.className.includes(\"remove_document\")){\n\t\tevent.preventDefault();\n\t\tremoveDocument(target);\n\t}\n});\n\nwindow.addEventListener(\"change\", event => {\n\tvar target = event.target;\n\n\tif (target.className.includes(\"file_upload\")){\n\t\tevent.preventDefault();\n\t\tfileUpload(target);\n\t}\n});"],"names":["console","log","totalFiles","fileUploadWrap","datasetString","createProgressBar","target","filetype","closest","querySelectorAll","forEach","loader","classList","remove","el","textContent","add","html","insertAdjacentHTML","addPreview","link","value","querySelector","name","replace","sim","loadingGif","fileUploadProgress","e","lengthComputable","max","total","percentage","loaded","Math","round","document","getElementById","async","uploadVideo","file","uploader","vimeoUploader","VimeoUpload","upload","tusUploader","s","options","onProgress","bytesUploaded","bytesTotal","toFixed","onSuccess","postId","storedEntry","formData","FormData","append","request","XMLHttpRequest","open","baseUrl","send","preview","vimeoId","main","displayMessage","multiple","urlStorage","removeUpload","urlStorageKey","postForm","result","ok","Promise","res","setTimeout","fetch","method","response","json","innerHTML","onError","error","start","window","addEventListener","event","className","includes","preventDefault","data","d","dataset","style","display","parentNode","FormSubmit","fetchRestApi","docWrapper","docwrapper","re","RegExp","index","removeDocument","input","files","length","type","split","size","maxFileSize","parseInt","get","onreadystatechange","readyState","status","imgUrls","JSON","parse","imgurls","src","undefined","fileName","url","toLowerCase","match","filename","fileUploadSucces","responseText","ajaxUrl","fileUpload"],"sourceRoot":""}