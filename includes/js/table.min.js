!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SimTableFunctions=t():e.SimTableFunctions=t()}(self,()=>(()=>{"use strict";var e={d:(t,l)=>{for(var n in l)e.o(l,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:l[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{hideColumn:()=>c,positionTable:()=>r,setTableLabel:()=>o}),console.log("Table.js loaded");var l=!1;async function n(e){if(null!=e.target&&(e.stopImmediatePropagation(),e=e.target),l==e)return;l=e,setTimeout(function(){l=!1},500);let t=e.closest("td"),n=function(e,t,l=!0,n=null,o=!1){let a="",s="",r="",c="";return e instanceof Element?(a=e,"INPUT"!=a.tagName&&"TEXTAREA"!=a.tagName&&"SELECT"!=a.tagName&&null==a.closest(".nice-select-dropdown")&&(a=a.querySelector("input, select, textarea")),null==a&&(a=e),s=a.name):e.match("E[0-9]")?(c=`[id^=${e}]`,a=t.querySelector(c),s=a.name):(s=e,c=`[name='${s}' i]`,a=t.querySelector(c)),null==a?(console.trace(),console.log("cannot find element with name "+s),r):("radio"==a.type?r=function(e,t){let l=e.querySelector(`${t}:checked`);return null==l?"":l.value}(t,c):"checkbox"==a.type?r=function(e,t,l,n){let o="",a="";return"checkbox"==n.type&&null!=l?n.checked?n.value:"":(null!=l?(a=e.querySelector(`${t}[value="${l}" i]:checked`),null!=a&&(o=l)):(a=e.querySelectorAll(`${t}:checked`),o=[],a.forEach(e=>{o.push(e.value)})),o)}(t,c,n,e):null!=a.closest(".nice-select-dropdown")&&null!=a.dataset.value?r=a.dataset.value:null!=a.list&&""!=a.value&&l?r=function(e){let t="",l=e.list.querySelector(`[value='${e.value}' i]`);return t=null==l?e.value:l.dataset.value,t}(a):null!=a.name&&a.name.endsWith("[]")?r=function(e,t){let l=[];return e.querySelectorAll(`[name="${t.name}"]`).forEach(e=>l.push(e.value)),l}(t,a):null!=a.value&&"undefined"!=a.value&&(r=a.value),o?r.toLowerCase():r)}(e,t,!1),o=e.closest("table");if(n!=t.dataset.oldText){const l=new Event("table-content-before-update",{bubbles:!0,cancelable:!0});if(!t.dispatchEvent(l))return;if(0==t.classList.contains("editing"))return;let a=new FormData;a.append("value",JSON.stringify(n));for(let e in t.dataset)a.append(e,t.dataset[e]);for(let t in e.closest("tr").dataset)a.append(t,e.closest("tr").dataset[t]);Main.showLoader(t.firstChild);let s=o.dataset.url;if(null==s)return console.error("No rest api url found"),void(t.innerHTML=e.dataset.oldHtml);await FormSubmit.fetchRestApi(s,a)&&(t.innerHTML=n)}else t.innerHTML=e.dataset.oldHtml;t.classList.remove("editing")}function o(){document.querySelectorAll(".sim-table").forEach(function(e){let t=[];e.querySelectorAll("thead th").forEach((e,l)=>{null!=e.dataset.niceName?t[l]=e.dataset.niceName:t[l]=e.textContent}),e.querySelectorAll("tbody td").forEach(e=>{e.hasAttribute("label")||null==t[e.cellIndex]||e.setAttribute("label",t[e.cellIndex]),"X"!=e.textContent&&""!=e.textContent||e.classList.add("mobile-hidden")})})}async function a(e){e.textContent="Close full screen",e.classList.replace("show","close");let t=e.closest(".table-wrapper");window.lastY=window.pageYOffset,window.scrollTo(0,0),document.querySelector("body").style.overflow="hidden",document.querySelector("header").style.zIndex="unset",t.classList.add("fullscreen"),t.style.marginLeft="0px";let l=new URL(window.location);l.searchParams.set("fullscreen",t.querySelector("table").dataset.formId),window.history.pushState({},"",l),s(),t.requestFullscreen().catch(e=>{})}function s(){let e,t,l=new URLSearchParams(window.location.search).get("fullscreen");document.querySelectorAll(".sim-table").forEach(n=>{let o=n.closest(".table-wrapper");if(null==o)return;null!=l?(t=0,o.querySelectorAll(".table-head").forEach(e=>t=e.offsetHeight)):t=document.querySelector("header").offsetHeight,e=0,o.querySelectorAll(".sim-table-footer").forEach(t=>e=t.offsetHeight);let a=t+e+40;n.style.maxHeight=`calc(100vh - ${a}px)`})}function r(){document.querySelectorAll(".table-wrapper").forEach(e=>{let t="",l=0,n=e.querySelector("table");if(null==n)return;let o=n.scrollWidth;if(0!=o){if(window.innerWidth<570)t=e.getBoundingClientRect().x;else{let n=window.innerWidth-o;o/window.innerWidth<.7?null!=document.querySelector(".is-right-sidebar")&&(n=.7*window.innerWidth-o):(document.getElementById("primary").style.zIndex=1,document.querySelectorAll("#right-sidebar").forEach(e=>e.style.zIndex=0)),l=n<20?10:n/2,""!=e.style.marginLeft&&(e.style.marginLeft="-0px"),t=parseInt(e.getBoundingClientRect().x)-l}e.style.marginLeft=`-${t}px`}})}const c=async e=>{let t;if("SPAN"==e.tagName&&(e=e.querySelector("img")),e.parentNode.matches("th")?t=e.parentNode:e.matches("th")&&(t=e),t){let e=t.closest("table").rows;for(const l of e)l.cells[t.cellIndex].classList.add("hidden");null==sim.hidden&&(sim.hidden=[]),sim.hidden.push(t.cellIndex),t.closest(".table-wrapper").querySelectorAll(".reset-col-vis").forEach(e=>e.classList.remove("hidden"))}};document.addEventListener("click",e=>{let t=e.target;if(document.querySelector(".editing")&&document.querySelector(".editing")!=t.closest("td")&&n(document.querySelector(".editing")),"TH"==t.tagName)!function(e){let t,l,n,o=e.closest("table"),a=!0;var s="asc";for(e.classList.contains("desc")&&(s="desc");a;){a=!1,n=o.rows;for(let o=1;o<n.length-1;o++){if(t=n[o].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),l=n[o+1].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),isNaN(t)||isNaN(l)){let e=new Date(t),n=new Date(l);"Invalid Date"===e||isNaN(e)||70==e.getYear()||"Invalid Date"===n||isNaN(n)||70==n.getYear()||(t=e.getTime(),l=n.getTime())}else t=parseFloat(t),l=parseFloat(l);("asc"==s&&t>l||"desc"==s&&l>t)&&(n[o].parentNode.insertBefore(n[o+1],n[o]),a=!0)}}"asc"==s?(e.classList.add("desc"),e.classList.replace("asc","desc")):e.classList.replace("desc","asc")}(t);else if(t.matches("td.edit:not(.editing)"))!function(e){e=e.closest("td"),document.querySelectorAll("td.editing").forEach(t=>{t!=e&&n(t)}),e.classList.add("editing"),e.dataset.oldHtml=e.innerHTML,e.dataset.oldText=e.textContent,"Click to update"!=e.textContent&&"X"!=e.textContent||(e.dataset.oldText="",e.dataset.oldHtml=""),e.innerHTML=`<div class='override-wrapper'><input type="text" value="${e.textContent}"></div>`;let t=document.createElement("button");t.innerHTML="Save changes",t.classList.add("button","small","save","hidden"),t.addEventListener("click",e=>n(e.target.closest("td"))),e.appendChild(t);const l=new Event("table-content-update-inputs-loaded",{bubbles:!0,cancelable:!0});e.dispatchEvent(l)&&(t.classList.remove("hidden"),function(e){let t=e.querySelectorAll("input,select,textarea");t.forEach(l=>{e.dataset.oldText.split(",").forEach(t=>{"checkbox"==l.type||"radio"==l.type?l.value==t.trim()&&(l.checked=!0):"select"==l.type?l.querySelector('option[value="'+t+'"]').selected=!0:l.value=e.dataset.oldText}),"select-one"==l.type&&null==l._niceSelect&&Main.attachNiceSelect(l),"checkbox"==l.type&&1!=t.length||l.focus()})}(e))}(t);else if(t.matches(".show.fullscreenbutton"))a(t);else if(t.matches(".close.fullscreenbutton"))!function(e){let t=100;e.textContent="Show full screen",e.classList.replace("close","show"),null!=window.lastY&&(t=window.lastY),window.scrollTo(0,t),console.log("scrolling"),document.querySelector("body").style.overflow="unset",document.querySelector("header").style.zIndex="99999",e.closest(".table-wrapper").classList.remove("fullscreen"),r();let l=new URL(window.location);l.searchParams.delete("fullscreen"),window.history.pushState({},"",l),document.exitFullscreen(),s()}(t);else if(t.classList.contains("visibility-icon"))c(t);else{if(!t.matches(".reset-col-vis"))return;!async function(e){e.closest(".table-wrapper").querySelector(".reset-col-vis").classList.add("hidden"),e.closest(".form.table-wrapper").querySelector("table").querySelectorAll("th.hidden, td.hidden").forEach(e=>e.classList.remove("hidden"))}(t)}e.stopImmediatePropagation()}),document.addEventListener("DOMContentLoaded",function(){r(),window.addEventListener("resize",r),o();let e=new URLSearchParams(window.location.search).get("fullscreen");if(null!=e)try{a(document.querySelector(`table[data-form-id="${e}"]`).closest(".table-wrapper").querySelector(".fullscreenbutton"))}catch{console.error(`table[data-form-id="${e}"]`)}s()});let i={};return document.addEventListener("keydown",e=>{i[e.key]=!0}),document.addEventListener("keyup",function(e){["Enter","NumpadEnter"].includes(e.key)&&null==i.Shift&&n(e),delete i[e.key]}),t})());
//# sourceMappingURL=table.min.js.map