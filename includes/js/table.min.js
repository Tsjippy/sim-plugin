!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SimTableFunctions=t():e.SimTableFunctions=t()}(self,(()=>(()=>{"use strict";var e={d:(t,l)=>{for(var n in l)e.o(l,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:l[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function l(e){Array.from(e.options).forEach((function(e){e.defaultSelected=!1}))}e.r(t),e.d(t,{positionTable:()=>m,setTableLabel:()=>d});let n,o=[];function r(e){e.querySelectorAll(":scope > .clone_div").forEach(((e,t)=>{""!=e.id&&(e.id=e.id.replace(/(\d)/g,t)),null!=e.dataset.divid&&(e.dataset.divid=t),e.querySelectorAll("h3, h4").forEach((e=>{e.textContent=e.textContent.replace(/(\d)/g,t+1)})),e.querySelectorAll("legend").forEach((e=>{e.innerHTML=e.innerHTML.replace(/ (\d)/g," "+(t+1))})),e.querySelectorAll("input,select,textarea").forEach((e=>{e.classList.contains("nice-select-search")||(""!=e.id&&null!=e.id&&(e.id=e.id.replace(/(\d)/g,t)),""!=e.name&&null!=e.name&&(e.name=e.name.replace(/(\d)/g,t)),"button"==e.type&&(e.value=e.value.replace(/\d/g,t)))}))}))}async function a(e){let t=e.closest(".form.table-wrapper"),l=e.outerHTML,n=new FormData,o=t.querySelector(".sim-table.form-data-table").dataset.formid,r=t.querySelector(".sim-table.form-data-table").dataset.shortcodeid;n.append("formid",o),n.append("id",r);const a=new URL(window.location);a.searchParams.get("onlyown")&&n.append("onlyown",!0),a.searchParams.get("archived")&&n.append("archived",!0);let c=Main.showLoader(e,!1,"Requesting form results...");t.innerHTML=c.outerHTML;let s=await FormSubmit.fetchRestApi("forms/show_form_results",n);s?t.innerHTML=s:c.outerHTML=l}function c(e){null!=e.target.closest("td")&&e.target.closest("td").matches(".editing")||(e.stopPropagation(),document.removeEventListener("click",c),i(e,document.querySelector(".editing input, .editing select, .editing textarea")))}function s(e){e.closest("td").classList.add("editing"),n=e.textContent,"Click to update"!=n&&"X"!=n||(n=""),e.innerHTML=`<input type="text" value="${n}">`,function(e){let t=e.querySelectorAll("input,select,textarea");t.forEach((e=>{n.split(",").forEach((t=>{"checkbox"==e.type||"radio"==e.type?e.value==t.trim()&&(e.checked=!0):"select"==e.type?e.querySelector('option[value="'+t+'"]').selected=!0:e.value=n})),"select-one"==e.type&&(e._niceselect=NiceSelect.bind(e,{searchable:!0})),e.addEventListener("keyup",(function(e){13===e.keyCode&&i(e)})),document.addEventListener("click",c),"checkbox"==e.type&&1!=t.length||("date"==e.type?e.addEventListener("blur",(function(e){""!=e.target.value&&i(e)})):e.addEventListener("change",(function(e){""!=e.target.value&&i(e)})),e.focus())}))}(e)}async function i(e,t){void 0===t&&(t=e.target);let l=t.closest("td"),o=function(e,t,l=!0,n=null,o=!1){let r="",a="",c="";return e instanceof Element?(r=e,"INPUT"!=r.tagName&&"TEXTAREA"!=r.tagName&&"SELECT"!=r.tagName&&null==r.closest(".nice-select-dropdown")&&(r=r.querySelector("input, select, textarea")),null==r&&(r=e),a=r.name):(a=e,r=t.querySelector(`[name='${a}' i]`)),null==r?(console.trace(),console.log("cannot find element with name "+a),c):("radio"==r.type?c=function(e,t){let l=e.querySelector(`[name='${t}' i]:checked`);return null==l?"":l.value}(t,a):"checkbox"==r.type?c=function(e,t,l,n){let o="",r="";return"checkbox"==n.type?n.checked?n.value:"":(null!=l?(r=e.querySelector(`[name='${t}' i][value="${l}" i]:checked`),null!=r&&(o=l)):(r=e.querySelectorAll(`[name="${t}" i]:checked`),r.forEach((e=>{""!=o&&(o+=", "),o+=e.value}))),o)}(t,a,n,e):null!=r.closest(".nice-select-dropdown")&&null!=r.dataset.value?c=r.dataset.value:null!=r.list&&l?c=function(e){let t="",l=e.list.querySelector("[value='"+e.value+"' i]");return null==l?t=e.value:(t=l.dataset.value,""==t&&(t=e.value)),t}(r):null!=r.value&&"undefined"!=r.value&&(c=r.value),o?c.toLowerCase():c)}(t,l,!1),r=t.closest("table");if(o!=n){let e=new FormData;e.append("value",o);for(let t in l.dataset)e.append(t,l.dataset[t]);for(let l in t.closest("tr").dataset)e.append(l,t.closest("tr").dataset[l]);Main.showLoader(l.firstChild),await FormSubmit.fetchRestApi(r.dataset.url,e)&&(l.innerHTML=o)}else console.log(o),t.closest("td").innerHTML=n;l.classList.remove("editing")}function d(){document.querySelectorAll(".sim-table").forEach((function(e){let t=[];e.querySelectorAll("thead th").forEach(((e,l)=>{null!=e.dataset.nicename?t[l]=e.dataset.nicename:t[l]=e.textContent})),e.querySelectorAll("tbody tr").forEach((e=>{Array.from(e.children).forEach((function(e,l){e.setAttribute("label",t[l]),"X"!=e.textContent&&""!=e.textContent||e.classList.add("mobile-hidden")}))}))}))}function u(e){e.textContent="Close full screen",e.classList.replace("show","close");let t=e.closest(".table-wrapper");window.lastY=window.pageYOffset,window.scrollTo(0,0),document.querySelector("body").style.overflow="hidden",document.querySelector("header").style.zIndex="unset",t.classList.add("fullscreen"),t.style.marginLeft="0px";let l=new URL(window.location);l.searchParams.set("fullscreen",t.querySelector("table").dataset.formid),window.history.pushState({},"",l)}function m(){document.querySelectorAll(".table-wrapper").forEach((e=>{let t="",l=0,n=e.querySelector("table");if(null==n)return;let o=n.scrollWidth;if(0!=o){if(window.innerWidth<570)t=e.getBoundingClientRect().x;else{let n=window.innerWidth-o;o/window.innerWidth<.7?null!=document.querySelector(".is-right-sidebar")&&(n=.7*window.innerWidth-o):(document.getElementById("primary").style.zIndex=1,document.querySelectorAll("#right-sidebar").forEach((e=>e.style.zIndex=0))),l=n<20?10:n/2,""!=e.style.marginLeft&&(e.style.marginLeft="-0px"),t=parseInt(e.getBoundingClientRect().x)-l}e.style.marginLeft=`-${t}px`}}))}return document.addEventListener("DOMContentLoaded",(function(){console.log("Forms.js is loaded")})),window.addEventListener("online",(function(){document.querySelectorAll(".form_submit").forEach((e=>{e.disabled=!1,e.querySelectorAll(".offline").forEach((e=>e.remove()))}))})),window.addEventListener("offline",(function(){document.querySelectorAll(".form_submit").forEach((e=>{e.disabled=!0,null==e.querySelector(".online")&&(e.innerHTML='<div class="online">'+e.innerHTML+"</div>"),e.innerHTML+='<div class="offline">You are offline</div>'}))})),document.addEventListener("click",(function(e){let t=e.target;if(t.matches(".add")){let e=function(e){let t=function(e,t=!0){!function(e){e.querySelectorAll("select").forEach((e=>{-1!=e.selectedIndex&&(e.options[e.selectedIndex].defaultSelected||l(e)),e.selectedOptions.length>0&&(e.selectedOptions[0].defaultSelected=!0),e._niceselect.destroy()})),"undefined"!=typeof tinymce&&e.querySelectorAll(".wp-editor-area").forEach((e=>{let t=tinymce.get(e.id);null!=t&&(o[e.id]=t.settings,t.save(),t.remove())}))}(e);let n=e.cloneNode(!0);return e.querySelectorAll("select").forEach((e=>{e._niceselect=NiceSelect.bind(e,{searchable:!0}),""==e.value&&e._niceselect.clear()})),e.querySelectorAll(".wp-editor-area").forEach((e=>{tinymce.init(o[e.id])})),t?n.querySelectorAll("input,select,textarea").forEach((e=>{"checkbox"==e.type||"radio"==e.type?e.checked=!1:"hidden"!=e.type&&(e.value=""),"select-one"==e.type&&(l(e),e._niceselect=NiceSelect.bind(e,{searchable:!0}),e._niceselect.clear())})):n.querySelectorAll("select").forEach((e=>{e._niceselect=NiceSelect.bind(e,{searchable:!0})})),n}(e);t.querySelectorAll(".upload-files").forEach((function(e){e.dataset.index=nodeNr})),t.querySelectorAll(".documentpreview").forEach((function(e){e.innerHTML=""}));let n=0;if(t.querySelectorAll("select").forEach((t=>{let l=e.getElementsByTagName("select")[n].selectedIndex;t.options[l].style.display="none",t._niceselect.update(),t.nextSibling.querySelector(".current").textContent="Select an option",n++})),null==e.querySelector(".remove")){let l=t.querySelector(".add"),n=`<button type="button" class="${l.className.replace("add","remove")}" id="${l.id.replace("add","remove")}" style="flex: 1;">${l.textContent.replace("Add","Remove this").replace("an","").replace("+","-")}</button>`;e.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",n),t.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",n)}return e.parentNode.insertBefore(t,e.nextSibling),t}(t.closest(".clone_div"));r(t.closest(".clone_divs_wrapper")),e.querySelectorAll(".wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)})),t.remove()}t.matches(".remove")&&function(e){let t=e.closest(".clone_div"),l=t.closest(".clone_divs_wrapper"),n=l.querySelectorAll(".clone_div");if(n[n.length-1]==t){let e=t.querySelector(".add");t.previousElementSibling.querySelector(".buttonwrapper").appendChild(e)}t.remove(),1==l.querySelectorAll(".clone_div").length&&l.querySelector(".remove").remove(),r(l)}(t),t.matches('.sim_form [name="submit_form"]')&&(e.stopPropagation(),async function(e){let t=e.closest("form"),l=await FormSubmit.submitForm(e,"forms/save_form_input");l&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(l),"true"==t.dataset.reset&&FormSubmit.formReset(t))}(t)),(t.matches(".formbuilder-switch")||t.matches(".formbuilder-switch-back"))&&async function(e){let t,l=e.closest(".sim_form.wrapper"),n=e.outerHTML,o=new FormData;const r=new URL(window.location);e.matches(".formbuilder-switch")?(o.append("formbuilder",!0),r.searchParams.set("formbuilder",!0),t=l.querySelector("form.sim_form").dataset.formid):(r.searchParams.delete("formbuilder"),t=l.querySelector('[name="formid"]').value),window.history.pushState({},"",r),o.append("formid",t);let a=Main.showLoader(e,!1,"Requesting form...");l.innerHTML=a.outerHTML;let c=await FormSubmit.fetchRestApi("forms/form_builder",o);c?l.innerHTML=c:a.outerHTML=n}(t),(t.matches(".archive-switch-hide")||t.matches(".archive-switch-show"))&&async function(e){const t=new URL(window.location);e.matches(".archive-switch-show")?t.searchParams.set("archived",!0):t.searchParams.delete("archived"),window.history.pushState({},"",t),a(e)}(t),(t.matches(".onlyown-switch-all")||t.matches(".onlyown-switch-on"))&&async function(e){const t=new URL(window.location);e.matches(".onlyown-switch-on")?t.searchParams.set("onlyown",!0):t.searchParams.delete("onlyown"),window.history.pushState({},"",t),a(e)}(t)})),document.addEventListener("click",(e=>{let t=e.target;"TH"==t.tagName&&function(e){let t,l,n,o=e.closest("table"),r=!0,a=!1;var c="asc";for(e.classList.contains("dsc")&&(c="dsc");r;){r=!1,n=o.rows;for(let o=1;o<n.length-1;o++){if(a=!1,t=n[o].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),l=n[o+1].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),isNaN(t)||isNaN(l)){let e=new Date(t),n=new Date(l);"Invalid Date"===e||isNaN(e)||70==e.getYear()||"Invalid Date"===n||isNaN(n)||70==n.getYear()||(t=e.getTime(),l=n.getTime())}else t=parseFloat(t),l=parseFloat(l);("asc"==c&&t>l||"dsc"==c&&l>t)&&(n[o].parentNode.insertBefore(n[o+1],n[o]),r=!0)}}"asc"==c?(e.classList.remove("asc"),e.classList.add("dsc")):(e.classList.remove("dsc"),e.classList.add("asc"))}(t);let l=t.closest("td");t.matches("td.edit")?(e.stopPropagation(),s(t)):null!=l&&l.matches("td.edit")&&"INPUT"!=t.tagName&&"A"!=t.tagName&&"TEXTAREA"!=t.tagName&&!t.closest(".nice-select")?(e.stopPropagation(),s(t.closest("td"))):t.matches(".show.fullscreenbutton")?u(t):t.matches(".close.fullscreenbutton")&&function(e){let t=100;e.textContent="Show full screen",e.classList.replace("close","show"),null!=window.lastY&&(t=window.lastY),window.scrollTo(0,t),document.querySelector("body").style.overflow="unset",document.querySelector("header").style.zIndex="99999",e.closest(".table-wrapper").classList.remove("fullscreen"),m();let l=new URL(window.location);l.searchParams.delete("fullscreen"),window.history.pushState({},"",l)}(t)})),document.addEventListener("DOMContentLoaded",(function(){console.log("Table.js loaded"),m(),window.addEventListener("resize",m),d();let e=new URLSearchParams(window.location.search).get("fullscreen");if(null!=e)try{u(document.querySelector(`table[data-formid="${e}"]`).closest(".table-wrapper").querySelector(".fullscreenbutton"))}catch{console.error(`table[data-formid="${e}"]`)}})),t})()));
//# sourceMappingURL=table.min.js.map